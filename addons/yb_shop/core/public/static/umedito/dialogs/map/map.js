!function(){var a="map";UM.registerWidget(a,{tpl:'<style type="text/css">.edui-dialog-map .edui-map-content{width:530px; height: 350px;margin: 10px auto;}.edui-dialog-map .edui-map-content table{width: 100%}.edui-dialog-map .edui-map-content table td{vertical-align: middle;}.edui-dialog-map .edui-map-button { border: 1px solid #ccc; float: left; cursor: default; height: 23px; width: 70px; cursor: pointer; margin: 0; font-size: 12px; line-height: 24px; text-align: center; }.edui-dialog-map .edui-map-button:hover {background:#eee;}.edui-dialog-map .edui-map-city,.edui-dialog-map .edui-map-address{height:21px;background: #FFF;border:1px solid #d7d7d7; line-height: 21px;}.edui-dialog-map .edui-map-city{width:90px}.edui-dialog-map .edui-map-address{width:150px}.edui-dialog-map .edui-map-dynamic-label span{vertical-align:middle;margin: 3px 0px 3px 3px;}.edui-dialog-map .edui-map-dynamic-label input{vertical-align:middle;margin: 3px;}</style><div class="edui-map-content"><table><tr><td><%=lang_city%>:</td><td><input class="edui-map-city" type="text" value="<%=city.value%>"/></td><td><%=lang_address%>:</td><td><input class="edui-map-address" type="text" value="" /></td><td><a class="edui-map-button"><%=lang_search%></a></td><td><label class="edui-map-dynamic-label"><input class="edui-map-dynamic" type="checkbox" name="edui-map-dynamic" /><span><%=lang_dynamicmap%></span></label></td></tr></table><div style="width:100%;height:340px;margin:5px auto;border:1px solid gray" class="edui-map-container"></div></div><script class="edui-tpl-container" type="text/plain"><!DOCTYPE html><html><head><title></title></head><body><scr_ipt>window.onload = function(){var scripts = document.scripts || document.getElementsByTagName("script"),src = [];for( var i = 1, len = scripts.length; i<len; i++ ) {src.push( scripts[i].src );}parent.UM.getEditor(<<id>>).getWidgetData(\'map\').requestMapApi( src );};function mapReadyStateChange ( state ) {  if ( state === \'complete\' || state === \'loaded\' ) { document.close();  } }</scr_ipt><scr_ipt onreadystatechange=\'mapReadyStateChange(this.readyState);\' onload=\'mapReadyStateChange("loaded");\' src="http://api.map.baidu.com/api?v=2.0&ak=6b6c1a67eaa7db1ca6d6da28e590e343&services=true"></scr_ipt></body></html></script>',initContent:function(b){var d=this,e=b.getLang(a),f=b.options.themePath+b.options.theme;return d.inited?(d.preventDefault(),!1):(d.inited=!0,d.lang=e,d.editor=b,d.root().html($.parseTmpl(d.tpl,$.extend({},e["static"],{theme_url:f}))),d.initRequestApi(),void 0)},initRequestApi:function(){var a=null;window.BMap&&window.BMap.Map?this.initBaiduMap():(a=$('<iframe style="display: none;"></iframe>'),a.appendTo(this.root()),a=a[0].contentWindow.document,a.open(),a.write(this.root().find(".edui-tpl-container").html().replace(/scr_ipt/g,"script").replace("<<id>>","'"+this.editor.id+"'")))},requestMapApi:function(a){var c,b=this;a.length?(c=a[0],a=a.slice(1),c?$.getScript(c,function(){b.requestMapApi(a)}):b.requestMapApi(a)):b.initBaiduMap()},initBaiduMap:function(){var d,e,f,h,i,j,a=this.root(),b=new BMap.Map(a.find(".edui-map-container")[0]),c=this,g=$(c.editor.selection.getRange().getClosedNode());b.enableInertialDragging(),b.enableScrollWheelZoom(),b.enableContinuousZoom(),g.length&&/api[.]map[.]baidu[.]com/gi.test(g.attr("src"))?(h=g.attr("src"),i=c.getPars(h,"center").split(","),j=c.getPars(h,"markers").split(","),e=new BMap.Point(Number(i[0]),Number(i[1])),d=new BMap.Marker(new BMap.Point(Number(j[0]),Number(j[1]))),b.addControl(new BMap.NavigationControl),b.centerAndZoom(e,Number(c.getPars(h,"zoom"))),f=g.attr("style")):(e=new BMap.Point(116.404,39.915),d=new BMap.Marker(e),b.addControl(new BMap.NavigationControl),b.centerAndZoom(e,10)),d.enableDragging(),b.addOverlay(d),c.map=b,c.marker=d,c.imgcss=f},doSearch:function(){var d,a=this,b=a.root().find(".edui-map-city").val(),c=a.root().find(".edui-map-address").val();return b?(d=new BMap.LocalSearch(b,{onSearchComplete:function(b){var c,d;if(b&&b.getNumPois()){for(c=[],d=0;d<b.getCurrentNumPois();d++)c.push(b.getPoi(d).point);c.length>1?a.map.setViewport(c):a.map.centerAndZoom(c[0],13),point=a.map.getCenter(),a.marker.setPoint(point)}else alert(a.lang.errorMsg)}}),d.search(c||b),void 0):(alert(a.lang.cityMsg),void 0)},getPars:function(a,b){var c=new RegExp(b+"=((\\d+|[.,])*)","g");return c.exec(a)[1]},reset:function(){this.map&&this.map.reset()},initEvent:function(){var a=this,b=a.root();b.find(".edui-map-address").on("keydown",function(b){return b=b||event,13==b.keyCode?(a.doSearch(),!1):void 0}),b.find(".edui-map-button").on("click",function(){a.doSearch()}),b.find(".edui-map-address").focus(),b.on("mousewheel DOMMouseScroll",function(){return!1})},width:580,height:408,buttons:{ok:{exec:function(b){var h,i,c=b.getWidgetData(a),d=c.map.getCenter(),e=c.map.getZoom(),f=c.map.getSize(),g=c.marker.P;c.root().find(".edui-map-dynamic")[0].checked?(h=b.getOpt("UMEDITOR_HOME_URL"),i=[h+(/\/$/.test(h)?"":"/")+"dialogs/map/map.html"+"#center="+d.lng+","+d.lat,"&zoom="+e,"&width="+f.width,"&height="+f.height,"&markers="+g.lng+","+g.lat].join(""),b.execCommand("inserthtml",'<iframe class="ueditor_baidumap" src="'+i+'" frameborder="0" width="'+(f.width+4)+'" height="'+(f.height+4)+'"></iframe>')):(i="http://api.map.baidu.com/staticimage?center="+d.lng+","+d.lat+"&zoom="+e+"&width="+f.width+"&height="+f.height+"&markers="+g.lng+","+g.lat,b.execCommand("inserthtml",'<img width="'+f.width+'"height="'+f.height+'" src="'+i+'"'+(c.imgcss?' style="'+c.imgcss+'"':"")+"/>",!0)),c.reset()}},cancel:{exec:function(b){b.getWidgetData(a).reset()}}}})}();