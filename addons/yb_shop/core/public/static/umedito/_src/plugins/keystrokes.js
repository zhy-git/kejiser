UM.plugins["keystrokes"]=function(){var a=this,b=!0;a.addListener("keydown",function(c,d){var g,h,i,j,k,l,m,e=d.keyCode||d.which,f=a.selection.getRange();if(!f.collapsed&&!(d.ctrlKey||d.shiftKey||d.altKey||d.metaKey)&&(e>=65&&90>=e||e>=48&&57>=e||e>=96&&111>=e||{13:1,8:1,46:1}[e])&&(g=f.startContainer,domUtils.isFillChar(g)&&f.setStartBefore(g),g=f.endContainer,domUtils.isFillChar(g)&&f.setEndAfter(g),f.txtToElmBoundary(),f.endContainer&&1==f.endContainer.nodeType&&(g=f.endContainer.childNodes[f.endOffset],g&&domUtils.isBr(g)&&f.setEndAfter(g)),0==f.startOffset&&(g=f.startContainer,domUtils.isBoundaryNode(g,"firstChild")&&(g=f.endContainer,f.endOffset==(3==g.nodeType?g.nodeValue.length:g.childNodes.length)&&domUtils.isBoundaryNode(g,"lastChild")))))return a.fireEvent("saveScene"),a.body.innerHTML="<p>"+(browser.ie?"":"<br/>")+"</p>",f.setStart(a.body.firstChild,0).setCursor(!1,!0),a._selectionChange(),void 0;if(8==e){if(f=a.selection.getRange(),b=f.collapsed,a.fireEvent("delkeydown",d))return;if(f.collapsed&&f.inFillChar()&&(h=f.startContainer,domUtils.isFillChar(h)?(f.setStartBefore(h).shrinkBoundary(!0).collapse(!0),domUtils.remove(h)):(h.nodeValue=h.nodeValue.replace(new RegExp("^"+domUtils.fillChar),""),f.startOffset--,f.collapse(!0).select(!0))),h=f.getClosedNode())return a.fireEvent("saveScene"),f.setStartBefore(h),domUtils.remove(h),f.setCursor(),a.fireEvent("saveScene"),domUtils.preventDefault(d),void 0;if(!browser.ie&&(h=domUtils.findParentByTagName(f.startContainer,"table",!0),i=domUtils.findParentByTagName(f.endContainer,"table",!0),h&&!i||!h&&i||h!==i))return d.preventDefault(),void 0;if(h=f.startContainer,f.collapsed&&1==h.nodeType&&(j=h.childNodes[f.startOffset-1],j&&1==j.nodeType&&"BR"==j.tagName&&(a.fireEvent("saveScene"),f.setStartBefore(j).collapse(!0),domUtils.remove(j),f.select(),a.fireEvent("saveScene"))),browser.chrome&&f.collapsed){for(;0==f.startOffset&&!domUtils.isEmptyBlock(f.startContainer);)f.setStartBefore(f.startContainer);k=f.startContainer.childNodes[f.startOffset-1],k&&"BR"==k.nodeName&&(f.setStartBefore(k),a.fireEvent("saveScene"),$(k).remove(),f.setCursor(),a.fireEvent("saveScene"))}}if(browser.gecko&&46==e&&(l=a.selection.getRange(),l.collapsed&&(h=l.startContainer,domUtils.isEmptyBlock(h)))){for(m=h.parentNode;1==domUtils.getChildCount(m)&&!domUtils.isBody(m);)h=m,m=m.parentNode;return h===m.lastChild&&d.preventDefault(),void 0}}),a.addListener("keyup",function(a,c){var e,g,h,i,j,k,d=c.keyCode||c.which,f=this;if(8==d){if(f.fireEvent("delkeyup"))return;if(e=f.selection.getRange(),e.collapsed){if(h=["h1","h2","h3","h4","h5","h6"],(g=domUtils.findParentByTagName(e.startContainer,h,!0))&&domUtils.isEmptyBlock(g)){if(i=g.previousSibling,i&&"TABLE"!=i.nodeName)return domUtils.remove(g),e.setStartAtLast(i).setCursor(!1,!0),void 0;if(j=g.nextSibling,j&&"TABLE"!=j.nodeName)return domUtils.remove(g),e.setStartAtFirst(j).setCursor(!1,!0),void 0}domUtils.isBody(e.startContainer)&&(g=domUtils.createElement(f.document,"p",{innerHTML:browser.ie?domUtils.fillChar:"<br/>"}),e.insertNode(g).setStart(g,0).setCursor(!1,!0))}!b&&(3==e.startContainer.nodeType||1==e.startContainer.nodeType&&domUtils.isEmptyBlock(e.startContainer))&&(browser.ie?(k=e.document.createElement("span"),e.insertNode(k).setStartBefore(k).collapse(!0),e.select(),domUtils.remove(k)):e.select())}})};