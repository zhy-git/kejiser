<?php
 class Uploader { private $fileField; private $file; private $config; private $oriName; private $fileName; private $fullName; private $fileSize; private $fileType; private $stateInfo; private $stateMap = array("\123\125\103\103\x45\123\123", "\346\x96\x87\xe4\273\266\xe5\xa4\xa7\345\xb0\217\350\266\x85\xe5\x87\xba\40\165\x70\154\157\x61\x64\x5f\155\x61\170\137\x66\151\154\x65\163\x69\x7a\145\40\351\231\x90\345\210\266", "\xe6\226\x87\xe4\xbb\xb6\xe5\xa4\247\xe5\xb0\217\350\266\205\345\207\xba\40\x4d\101\130\x5f\106\x49\114\x45\137\x53\x49\x5a\x45\x20\351\x99\x90\xe5\210\266", "\xe6\x96\207\344\273\xb6\xe6\234\xaa\350\xa2\xab\xe5\256\214\346\225\xb4\xe4\270\x8a\xe4\xbc\xa0", "\xe6\262\241\xe6\x9c\x89\xe6\226\x87\xe4\xbb\xb6\350\xa2\253\xe4\270\212\344\xbc\xa0", "\xe4\xb8\212\344\274\240\346\226\x87\xe4\273\xb6\xe4\xb8\xba\xe7\xa9\xba", "\x50\x4f\123\x54" => "\346\226\207\xe4\xbb\266\xe5\xa4\xa7\345\260\217\xe8\266\x85\xe5\207\272\40\160\x6f\163\x74\137\x6d\141\x78\137\163\151\x7a\145\40\351\x99\x90\xe5\x88\266", "\x53\x49\x5a\x45" => "\xe6\226\207\xe4\xbb\xb6\xe5\244\xa7\xe5\xb0\217\xe8\xb6\x85\xe5\207\xba\xe7\275\221\xe7\253\x99\xe9\x99\220\xe5\x88\xb6", "\x54\131\120\105" => "\344\xb8\x8d\345\x85\201\350\xae\xb8\xe7\x9a\204\346\x96\x87\344\xbb\xb6\347\261\xbb\345\236\x8b", "\104\111\x52" => "\347\233\256\xe5\xbd\x95\345\x88\x9b\345\273\272\xe5\xa4\xb1\350\264\245", "\x49\x4f" => "\350\276\223\345\205\245\xe8\276\x93\xe5\x87\xba\xe9\x94\x99\xe8\257\xaf", "\x55\x4e\113\x4e\x4f\x57\116" => "\xe6\234\252\347\237\245\xe9\x94\x99\350\xaf\257", "\x4d\117\x56\x45" => "\346\x96\207\344\273\xb6\344\277\x9d\xe5\xad\230\346\x97\266\345\207\272\xe9\x94\231", "\x44\111\x52\x5f\x45\122\x52\117\122" => "\xe5\210\x9b\xe5\273\xba\xe7\233\256\345\275\x95\xe5\244\xb1\350\xb4\245"); public function __construct($fileField, $config, $base64 = false) { goto tSgXy; KAJnx: $this->stateInfo = $this->stateMap[0]; goto jkg50; Iia6p: $this->config = $config; goto KAJnx; tSgXy: $this->fileField = $fileField; goto Iia6p; jkg50: $this->upFile($base64); goto T3aWF; T3aWF: } private function upFile($base64) { goto oh4gg; E_5b0: return; goto peYOJ; c1mxu: vHuwY: goto ujyZV; AVlnX: $this->fileType = $this->getFileExt(); goto yuF3A; R4yjW: $this->stateInfo = $this->getStateInfo("\123\x49\132\x45"); goto JyJ89; oUgd2: $this->stateInfo = $this->getStateInfo("\125\116\x4b\x4e\117\x57\116"); goto dGvk5; VdnuD: $this->stateInfo = $this->getStateInfo("\115\117\126\x45"); goto lDR1H; filjV: $this->stateInfo = $this->getStateInfo("\x54\x59\120\105"); goto OgFh0; MPNWZ: if (!($this->stateInfo == $this->stateMap[0])) { goto vHuwY; } goto TzPfp; iE4YM: if ($file) { goto IJdRS; } goto bem8q; hrSTy: $content = $_POST[$this->fileField]; goto xXf4y; vWwuc: SgjxL: goto yDTFs; M7R4O: return; goto SbYsv; U8Bgj: if (!$this->file["\x65\162\162\157\162"]) { goto bpc4P; } goto DBCaV; hCCNM: IJdRS: goto U8Bgj; rQtfm: $this->fullName = $folder . "\x2f" . $this->getName(); goto MPNWZ; cYEaZ: v4n9v: goto fx0A9; lDR1H: Smnqg: goto c1mxu; w_Vch: return; goto hCCNM; jJJwo: if (!($folder === false)) { goto zCqCs; } goto kz58q; DBCaV: $this->stateInfo = $this->getStateInfo($file["\x65\x72\x72\x6f\162"]); goto E_5b0; xXf4y: $this->base64ToImage($content); goto ljQZr; oh4gg: if (!("\x62\141\x73\x65\x36\x34" == $base64)) { goto POWHt; } goto hrSTy; XjXDk: $this->fileSize = $file["\163\x69\x7a\x65"]; goto AVlnX; TzPfp: if (move_uploaded_file($file["\x74\x6d\x70\137\x6e\x61\x6d\145"], $this->fullName)) { goto Smnqg; } goto VdnuD; NCps1: POWHt: goto VqkAf; VqkAf: $file = $this->file = $_FILES[$this->fileField]; goto iE4YM; JyJ89: return; goto vWwuc; goPtk: if (is_uploaded_file($file["\164\x6d\x70\137\156\x61\x6d\145"])) { goto v4n9v; } goto oUgd2; OgFh0: return; goto ih0RJ; yuF3A: if ($this->checkSize()) { goto SgjxL; } goto R4yjW; pbWOH: $folder = $this->getFolder(); goto jJJwo; bem8q: $this->stateInfo = $this->getStateInfo("\x50\x4f\x53\x54"); goto w_Vch; kz58q: $this->stateInfo = $this->getStateInfo("\104\x49\122\x5f\105\x52\122\x4f\x52"); goto M7R4O; ih0RJ: M3KHX: goto pbWOH; ljQZr: return; goto NCps1; yDTFs: if ($this->checkType()) { goto M3KHX; } goto filjV; fx0A9: $this->oriName = $file["\156\141\155\145"]; goto XjXDk; dGvk5: return; goto cYEaZ; peYOJ: bpc4P: goto goPtk; SbYsv: zCqCs: goto rQtfm; ujyZV: } private function base64ToImage($base64Data) { goto usydh; Dg4dP: $this->oriName = ''; goto m1N2M; fV0qJ: zg8VW: goto Dg4dP; m1N2M: $this->fileSize = strlen($img); goto vce2f; NT0s0: if (file_put_contents($this->fullName, $img)) { goto zg8VW; } goto qB028; qB028: $this->stateInfo = $this->getStateInfo("\x49\x4f"); goto CZXv_; IQix5: $this->fileName = time() . rand(1, 10000) . "\x2e\160\156\147"; goto o57LQ; vce2f: $this->fileType = "\56\x70\x6e\x67"; goto dwfpj; usydh: $img = base64_decode($base64Data); goto IQix5; CZXv_: return; goto fV0qJ; o57LQ: $this->fullName = $this->getFolder() . "\x2f" . $this->fileName; goto NT0s0; dwfpj: } public function getFileInfo() { return array("\x6f\162\151\x67\x69\x6e\141\154\116\x61\x6d\145" => $this->oriName, "\x6e\141\x6d\x65" => $this->fileName, "\165\x72\154" => $this->fullName, "\x73\151\x7a\145" => $this->fileSize, "\164\x79\x70\x65" => $this->fileType, "\x73\x74\141\164\x65" => $this->stateInfo); } private function getStateInfo($errCode) { return !$this->stateMap[$errCode] ? $this->stateMap["\x55\116\x4b\116\117\127\x4e"] : $this->stateMap[$errCode]; } private function getName() { return $this->fileName = time() . rand(1, 10000) . $this->getFileExt(); } private function checkType() { return in_array($this->getFileExt(), $this->config["\141\x6c\154\157\x77\x46\x69\154\x65\163"]); } private function checkSize() { return $this->fileSize <= $this->config["\155\x61\x78\123\x69\x7a\x65"] * 1024; } private function getFileExt() { return strtolower(strrchr($this->file["\156\141\155\x65"], "\x2e")); } private function getFolder() { goto Ca6V1; HIv7Q: if (!(strrchr($pathStr, "\x2f") != "\57")) { goto NsrqY; } goto JmSmg; mo9TG: $pathStr .= date("\x59\155\144"); goto rcSnM; MIvBb: NsrqY: goto mo9TG; ysLqS: BL0De: goto rI2iT; Ca6V1: $pathStr = $this->config["\163\x61\x76\145\x50\x61\x74\x68"]; goto HIv7Q; X6kJ4: if (mkdir($pathStr, 0777, true)) { goto QOyMR; } goto iWDaa; rcSnM: if (file_exists($pathStr)) { goto BL0De; } goto X6kJ4; iWDaa: return false; goto MxI2l; rI2iT: return $pathStr; goto m4E9g; JmSmg: $pathStr .= "\x2f"; goto MIvBb; MxI2l: QOyMR: goto ysLqS; m4E9g: } }
