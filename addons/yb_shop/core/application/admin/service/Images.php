<?php
 namespace app\admin\service; use app\common\model\GoodsDeleted; use app\common\model\ImagesGroup; use think\Db; load()->func("\x66\x69\154\145"); class Images extends Base { public $images_group; public $images; function __construct() { goto Ca59u; mh2o3: $this->images = new \app\common\model\Images(); goto VDu8W; VDu8W: $this->images_group = new ImagesGroup(); goto mv_wB; Ca59u: parent::__construct(); goto mh2o3; mv_wB: } public function getAlubmPictureDetail($condition) { $res = $this->images->getInfo($condition, "\x2a"); return $res; } public function getGoodsAlbumUsePictureQuery($condition = '') { goto igTxX; H4PBv: Uc7F1: goto f3ynO; igTxX: $goods = new \app\common\model\Goods(); goto h0MJi; UzsUM: $img_array = array(); goto TCokl; h0MJi: $goods_query = $goods->getQuerys($condition, "\x69\155\x67\x5f\x69\144\x5f\141\x72\162\x61\x79", ''); goto UzsUM; pAX4W: return $img_array; goto Vz2wV; f3ynO: $img_array = array_unique($img_array); goto pAX4W; TCokl: foreach ($goods_query as $k => $v) { goto MvH8m; UgN5j: F5WX8: goto hmf3h; FE2Gm: $img_array = array_merge($img_array, $tmp_array); goto UgN5j; MvH8m: if (!(trim($v["\x69\x6d\147\137\151\144\x5f\x61\x72\x72\141\x79"]) != '')) { goto F5WX8; } goto YU7LU; hmf3h: hsyJ4: goto NiKOU; YU7LU: $tmp_array = explode("\54", trim($v["\151\155\147\x5f\x69\144\x5f\141\162\x72\141\171"])); goto FE2Gm; NiKOU: } goto H4PBv; Vz2wV: } public function getAlbumClassAll($data = '') { goto m2WY7; JAHBb: if (empty($res)) { goto OMLI9; } goto n3Hi8; Jqst5: return $res; goto vBrfO; J80nn: OMLI9: goto Jqst5; t6ccF: dAolp: goto J80nn; n3Hi8: foreach ($res as $k => $v) { goto qyGLa; KaPzd: $res[$k]["\160\151\143\x5f\143\x6f\x75\x6e\164"] = $count; goto F3QQ8; qyGLa: $count = $this->getAlbumPictureCount($v["\147\x72\157\x75\160\137\x69\x64"]); goto KaPzd; F3QQ8: Ox_iY: goto DvLXE; DvLXE: } goto t6ccF; m2WY7: $res = $this->images_group->getQuerys($data, "\52", "\163\x6f\x72\164"); goto JAHBb; vBrfO: } public function addPicture($album_id, $pic_name, $pic_tag, $pic_cover, $pic_size, $pic_spec, $pic_cover_big, $pic_size_big, $pic_spec_big, $pic_cover_mid, $pic_size_mid, $pic_spec_mid, $pic_cover_small, $pic_size_small, $pic_spec_small, $pic_cover_micro, $pic_size_micro, $pic_spec_micro, $upload_type, $domain, $bucket) { goto Dv5Hi; OD8Gx: goto Bvyv5; goto UbPNq; UbPNq: xIu_A: goto Ux6Zt; JLU0E: return $res; goto OD8Gx; mEpDP: Bvyv5: goto wrcOa; Dv5Hi: $data = array("\x67\162\x6f\165\160\137\151\144" => $album_id, "\151\163\x5f\x77\151\144\145" => "\x30", "\x69\x6d\x67\137\x6e\x61\x6d\x65" => $pic_name, "\151\155\x67\x5f\164\x61\x67" => $pic_tag, "\151\x6d\x67\x5f\x63\157\166\x65\x72" => $pic_cover, "\151\x6d\147\x5f\163\151\x7a\145" => $pic_size, "\x69\155\x67\137\x73\x70\145\143" => $pic_spec, "\151\155\147\137\143\157\x76\x65\162\x5f\142\x69\x67" => $pic_cover_big, "\151\x6d\147\137\163\151\x7a\x65\x5f\142\x69\147" => $pic_size_big, "\151\x6d\147\137\x73\160\x65\x63\x5f\142\151\x67" => $pic_spec_big, "\x69\155\x67\x5f\143\x6f\x76\145\x72\x5f\x6d\x69\x64" => $pic_cover_mid, "\x69\x6d\147\x5f\163\x69\172\x65\137\x6d\x69\x64" => $pic_size_mid, "\x69\x6d\147\137\163\x70\145\x63\x5f\x6d\151\x64" => $pic_spec_mid, "\151\155\x67\x5f\143\x6f\166\145\x72\x5f\x73\155\x61\154\x6c" => $pic_cover_small, "\x69\x6d\x67\137\x73\x69\x7a\145\137\x73\x6d\x61\x6c\x6c" => $pic_size_small, "\151\155\x67\x5f\x73\x70\x65\143\137\x73\x6d\141\x6c\154" => $pic_spec_small, "\151\x6d\147\137\x63\x6f\x76\145\162\137\x6d\151\143\x72\x6f" => $pic_cover_micro, "\x69\155\x67\137\163\151\x7a\x65\137\155\151\143\162\x6f" => $pic_size_micro, "\x69\155\147\x5f\x73\160\145\x63\137\x6d\151\143\162\157" => $pic_spec_micro, "\165\x70\x6c\157\x61\144\137\x74\151\155\145" => time(), "\x75\x70\x6c\157\x61\144\137\x74\x79\160\x65" => $upload_type, "\144\157\155\141\151\156" => $domain, "\x62\x75\143\x6b\x65\x74" => $bucket); goto jzeSz; Ux6Zt: return $this->images->img_id; goto mEpDP; T2Wln: if ($res == 1) { goto xIu_A; } goto JLU0E; jzeSz: $res = $this->images->save($data); goto T2Wln; wrcOa: } public function ModifyAlbumPicture($pic_id, $pic_cover, $pic_size, $pic_spec, $pic_cover_big, $pic_size_big, $pic_spec_big, $pic_cover_mid, $pic_size_mid, $pic_spec_mid, $pic_cover_small, $pic_size_small, $pic_spec_small, $pic_cover_micro, $pic_size_micro, $pic_spec_micro, $instance_id, $upload_type, $domain, $bucket) { goto QRC_s; Hm2RQ: $res = $this->images->save($data, ["\160\151\143\x5f\151\144" => $pic_id]); goto Y9OGP; Y9OGP: return $res; goto ZY12I; QRC_s: $data = array("\x69\x6d\147\137\x63\x6f\166\145\162" => $pic_cover, "\x69\155\147\137\x73\151\x7a\145" => $pic_size, "\x69\x6d\147\137\x73\160\145\x63" => $pic_spec, "\x69\x6d\x67\137\143\157\166\145\x72\137\x62\151\147" => $pic_cover_big, "\x69\x6d\x67\x5f\x73\x69\x7a\x65\x5f\x62\x69\147" => $pic_size_big, "\x69\155\x67\137\163\x70\x65\x63\x5f\x62\x69\147" => $pic_spec_big, "\151\x6d\x67\137\143\x6f\x76\x65\162\137\155\x69\x64" => $pic_cover_mid, "\x69\x6d\x67\137\163\x69\x7a\145\137\x6d\x69\x64" => $pic_size_mid, "\151\155\147\x5f\x73\160\145\143\x5f\155\151\144" => $pic_spec_mid, "\x69\155\x67\x5f\143\157\x76\x65\x72\x5f\x73\x6d\x61\154\x6c" => $pic_cover_small, "\x69\155\x67\x5f\163\x69\x7a\x65\x5f\x73\155\x61\154\x6c" => $pic_size_small, "\151\x6d\x67\137\163\x70\145\143\137\163\155\x61\x6c\x6c" => $pic_spec_small, "\151\155\147\137\143\157\166\x65\x72\x5f\x6d\x69\143\x72\157" => $pic_cover_micro, "\x69\x6d\x67\x5f\163\151\172\145\x5f\155\x69\x63\162\x6f" => $pic_size_micro, "\151\155\147\137\163\160\x65\x63\137\155\x69\143\x72\157" => $pic_spec_micro, "\x75\160\x6c\157\141\x64\x5f\x74\x69\x6d\145" => time(), "\165\160\x6c\x6f\x61\x64\137\164\171\160\x65" => $upload_type, "\144\157\x6d\x61\x69\x6e" => $domain, "\142\x75\143\x6b\x65\x74" => $bucket); goto Hm2RQ; ZY12I: } public function getDefaultAlbumDetail() { $res = $this->images_group->getInfo(["\x69\163\137\x64\x65\x66\x61\165\154\164" => 1]); return $res; } public function GetDefAll($condition) { $res = $this->images_group->getInfo($condition); return $res; } public function addAlbumClass($aclass_name, $aclass_sort, $pid = 0, $aclass_cover = '', $is_default = 0, $mch_id) { goto O1CLE; i_kqr: gdShL: goto bwI1_; IVzrO: return $retval; goto YXzE1; c9l8y: $retval = $album_class->save($data); goto wPkVx; b91U4: return $album_class->group_id; goto i_kqr; iiTo7: S96bR: goto b91U4; IdFi6: $data = array("\147\x72\x6f\x75\160\137\156\141\155\145" => $aclass_name, "\163\x6f\x72\x74" => $aclass_sort, "\147\162\x6f\x75\x70\137\x63\157\x76\145\162" => $aclass_cover, "\x69\163\137\144\x65\x66\141\x75\154\164" => $is_default, "\x63\162\x65\x61\164\145\137\164\151\x6d\x65" => time(), "\160\x69\144" => $pid, "\151\x64\145\x6e\164" => '', "\x70\x61\147\145\x73\137\x75\x72\x6c" => '', "\x69\x73\137\163\x79\x73\x74\x65\x6d" => 0, "\x69\144\145\x6e\164\x5f\143\154\141\x73\163" => '', "\x6d\143\150\x5f\151\144" => $mch_id); goto c9l8y; O1CLE: $album_class = new ImagesGroup(); goto IdFi6; wPkVx: if ($retval == 1) { goto S96bR; } goto IVzrO; YXzE1: goto gdShL; goto iiTo7; bwI1_: } public function getAlbumClassList($condition = '', $search_text, $order) { goto MKdXD; Y1kLt: cl1pM: goto Lq3hZ; d0rBB: if (empty($list)) { goto cl1pM; } goto rAABP; rAABP: foreach ($list as $k => $v) { goto arYrW; aHeD_: RuBbZ: goto WBuYr; sSPNs: $album_picture = new \app\common\model\Images(); goto vKAjK; MyUOz: $pic_info = $album_picture->getInfo(["\147\162\157\x75\x70\137\151\144" => $v["\147\162\x6f\x75\160\137\151\144"], "\151\x6d\147\137\x69\144" => $v["\147\162\x6f\165\x70\x5f\x63\x6f\x76\x65\x72"]], "\151\155\x67\x5f\x63\x6f\166\x65\x72\54\x75\x70\154\x6f\141\x64\x5f\x74\x79\x70\145\x2c\x64\x6f\155\141\151\x6e"); goto Xd6hU; PQG_P: viZC3: goto HkMBm; vKAjK: $pic_cover = ''; goto PMwOp; HkMBm: $list[$k]["\x69\x6d\x67\137\x69\156\x66\x6f"] = $pic_info; goto fuAOx; Xd6hU: if (empty($pic_info)) { goto viZC3; } goto iOCy2; arYrW: $count = $this->getAlbumPictureCount($v["\x67\162\157\165\160\x5f\151\144"]); goto gF787; fuAOx: $list[$k]["\x69\x6d\147\x5f\x61\154\142\x75\155\x5f\x63\157\x76\x65\x72"] = $pic_cover; goto aHeD_; WBuYr: e0s9g: goto Yub0l; iOCy2: $pic_cover = $pic_info["\151\x6d\x67\x5f\x63\157\x76\145\162"]; goto PQG_P; PMwOp: if (!$v["\x67\x72\157\165\160\x5f\x63\157\166\x65\162"]) { goto RuBbZ; } goto MyUOz; gF787: $list[$k]["\x69\x6d\147\137\143\x6f\x75\x6e\x74"] = $count; goto sSPNs; Yub0l: } goto XBLEb; Lq3hZ: return $list; goto ObLpA; u0dwZ: $list = $album_class->getPageLisy($condition, $search_text, $order); goto d0rBB; MKdXD: $album_class = new ImagesGroup(); goto u0dwZ; XBLEb: y9qdE: goto Y1kLt; ObLpA: } private function getAlbumPictureCount($group_id) { goto yFkee; yFkee: $album_picture = new \app\common\model\Images(); goto p6FEb; juI8N: return $count; goto RfllC; p6FEb: $count = $album_picture->where("\147\162\x6f\x75\x70\x5f\151\144\x3d" . $group_id)->count(); goto juI8N; RfllC: } public function getAlbumClassDetail($group_id) { $res = $this->images_group->get($group_id); return $res; } public function getPictureList($condition = '', $search_text = '', $order = '') { $list = $this->images->getPageLisy($condition, $search_text, $order); return $list; } public function getImgList($condition = '', $field = "\x2a", $order = '') { $list = $this->images->getQuerys($condition, $field, $order); return $list; } public function deletePicture($pic_id_array) { goto mIcwt; tPiAr: return DELETE_FAIL; goto FFjXD; RvRs9: s1UHs: goto rD7Lj; rD7Lj: $user_img_array = $this->getGoodsAlbumUsePictureQuery(); goto eHJpt; kpSt6: if ($res == 1) { goto cjDAN; } goto tPiAr; mIcwt: global $_W; goto EDu2e; xiCMP: $res = 1; goto jDJGO; leYqq: return SUCCESS; goto zq9JA; xkoAb: $where["\x69\x6d\x67\x5f\x69\144"] = ["\x69\156", $pic_id_array]; goto ArkYw; zq9JA: HTHSW: goto bDWWf; eHJpt: foreach ($pic_array as $pic_id) { goto rW_dF; WPRfz: removeImageFile($pic_cover_small); goto FawF1; P3x8k: $pic_cover_small = $picture_obj["\151\155\147\137\143\x6f\x76\145\x72\137\x73\155\141\154\x6c"]; goto WPRfz; HmfwQ: IIb6o: goto s7SMF; QtL1K: $condition = array("\x69\155\147\x5f\151\144" => $pic_id); goto Yk8cb; nefcE: ZPKGa: goto SSzlz; YomTe: removeImageFile($pic_cover); goto DTYGm; R6979: $res = -1; goto jEKMf; Bzf4J: IjEpO: goto N1tXN; DTYGm: $pic_cover_big = $picture_obj["\151\155\147\x5f\143\x6f\x76\x65\162\x5f\x62\151\147"]; goto XEsny; lmtCj: w0wQO: goto QtL1K; S23DA: vsEIq: goto Bzf4J; jopGe: if (!$retval) { goto w0wQO; } goto R6979; s7SMF: FCrQ4: goto IBV2K; wbpa5: $pic_cover = $picture_obj["\151\x6d\x67\x5f\143\157\x76\145\162"]; goto YomTe; Yk8cb: $picture_obj = $this->images->get($pic_id); goto kC5Ox; qzYqq: removeImageFile($pic_cover_mid); goto P3x8k; FawF1: $pic_cover_micro = $picture_obj["\x69\x6d\x67\x5f\143\x6f\166\145\x72\x5f\x6d\151\x63\x72\x6f"]; goto rNiV3; kC5Ox: if (empty($picture_obj)) { goto ZPKGa; } goto wbpa5; XEsny: removeImageFile($pic_cover_big); goto Wiz3h; rNiV3: removeImageFile($pic_cover_micro); goto nefcE; IXABn: if (!(!$result > 0)) { goto vsEIq; } goto PicZD; SSzlz: if (empty($imgs[$pic_id . ''])) { goto FCrQ4; } goto NlRcS; NlRcS: foreach ($type_arr as $type) { goto MrVE8; EtI2T: file_get_contents($url); goto GVq2i; GVq2i: FFC7K: goto xECP6; MrVE8: $url = $_W["\x73\151\164\145\162\157\157\164"] . "\141\x64\x64\157\156\x73\x2f\x79\x62\137\x73\150\157\160\x2f\x63\x6f\x72\145\x2f" . url("\141\160\160\x2f\125\155\165\160\154\157\x61\144\x2f\x64\x65\154\145\164\x65\x69\155\x67") . "\46\146\x69\x6c\145\75" . $imgs[$pic_id . ''] . "\46\x74\x79\x70\x65\x3d" . $type; goto EtI2T; xECP6: } goto HmfwQ; jEKMf: goto IjEpO; goto lmtCj; IBV2K: $result = $this->images->destroy($condition); goto IXABn; rW_dF: $retval = in_array($pic_id, $user_img_array); goto jopGe; N1tXN: Bf16L: goto WkppS; Wiz3h: $pic_cover_mid = $picture_obj["\x69\155\x67\137\x63\x6f\166\x65\x72\x5f\155\151\x64"]; goto qzYqq; PicZD: $res = -1; goto S23DA; WkppS: } goto Q2Gmq; jDJGO: $type_arr = ["\x31", "\x32", "\63", "\64"]; goto roXm8; qRHQE: c0qAU: goto kpSt6; JA6yN: $imgs = array(); goto BmgVa; h1h91: $res = -1; goto yKxca; EDu2e: $pic_array = explode("\x2c", $pic_id_array); goto xkoAb; qEdwO: cjDAN: goto leYqq; Q2Gmq: gBYHp: goto qRHQE; yKxca: goto c0qAU; goto RvRs9; roXm8: if (!empty($pic_array)) { goto s1UHs; } goto h1h91; K7W4M: yxtWW: goto xiCMP; FFjXD: goto HTHSW; goto qEdwO; BmgVa: foreach ($all_imgs as $item) { $imgs[$item["\x69\x6d\x67\137\x69\144"] . ''] = $item["\151\155\x67\x5f\x63\157\166\x65\x72"]; pP13d: } goto K7W4M; ArkYw: $all_imgs = $this->images->where($where)->field("\x69\155\147\137\x69\144\54\151\155\x67\137\x63\x6f\x76\x65\x72")->select(); goto JA6yN; bDWWf: } public function deleteImgGroup($img_id) { goto XSFD4; XSFD4: $res = $this->images_group->destroy(["\147\x72\157\165\160\137\x69\x64" => $img_id]); goto Gu0sU; z2Stn: return $res; goto og9BY; Gu0sU: $this->images->destroy(["\147\x72\157\165\160\137\151\x64" => $img_id]); goto z2Stn; og9BY: } public function updateImagesGroupBox($img_id) { goto slXGu; HPcAm: $data = array("\x67\162\157\x75\160\x5f\x63\157\166\145\x72" => $img["\151\155\x67\137\x69\144"], "\147\x72\157\165\160\x5f\x69\x64" => $img["\147\162\x6f\x75\160\x5f\x69\x64"]); goto T_9aX; P7JEZ: return $res; goto NWgJY; slXGu: $img = $this->images->getInfo(["\151\x6d\147\137\x69\144" => $img_id]); goto HPcAm; T_9aX: $res = $this->images_group->save($data, ["\x67\x72\157\x75\160\x5f\x69\x64" => $img["\147\x72\x6f\165\160\137\x69\x64"]]); goto P7JEZ; NWgJY: } public function addImagesGroup($mch_id) { goto Dt2l0; T_ivt: $res = $this->images_group->save($data); goto MUk8R; MUk8R: return $res; goto wMRUV; Dt2l0: $data = array("\x67\162\157\x75\x70\137\156\141\x6d\x65" => "\351\xbb\x98\xe8\xae\244\347\233\270\xe5\206\214", "\x69\x73\x5f\x64\x65\x66\x61\165\154\x74" => 1, "\143\162\145\x61\x74\x65\137\x74\151\155\145" => time(), "\155\143\150\x5f\151\x64" => $mch_id); goto T_ivt; wMRUV: } }
