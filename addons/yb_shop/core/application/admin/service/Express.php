<?php
 namespace app\admin\service; use app\common\model\Area; use app\common\model\ExpressCompany; use app\common\model\ExpressShipping; use think\Db; class Express extends Base { function __construct() { parent::__construct(); $this->express = new ExpressCompany(); } public function addExpressCompany($company_name, $express_logo, $express_no, $is_enabled, $phone, $is_default, $mch_id) { goto RI7AL; GTU_q: try { goto vJJtH; Ay7ZC: $this->defaultExpressCompany($mch_id); goto ZijWK; L8OZ0: $ns_express_company->commit(); goto lrr11; ZijWK: nm2vl: goto bdU7g; a3lnJ: $ns_express_company->save($data); goto L8OZ0; vJJtH: if (!($is_default == 1)) { goto nm2vl; } goto Ay7ZC; bdU7g: $data = array("\143\x6f\155\160\141\156\x79\x5f\156\x61\x6d\145" => $company_name, "\145\170\160\x72\145\x73\x73\x5f\x6c\x6f\147\157" => $express_logo, "\x65\x78\160\x72\145\x73\x73\x5f\156\x6f" => $express_no, "\151\x73\137\x65\x6e\141\142\154\x65\144" => $is_enabled, "\160\150\x6f\x6e\145" => $phone, "\x69\163\137\144\145\x66\x61\165\x6c\164" => $is_default, "\143\x72\x65\x61\x74\x65\x5f\164\x69\x6d\x65" => time(), "\x6d\143\x68\137\x69\144" => $mch_id); goto a3lnJ; lrr11: return $ns_express_company->co_id; goto Xvn0O; Xvn0O: } catch (\Exception $e) { $ns_express_company->rollback(); return $e->getCode(); } goto yYOcz; RI7AL: $ns_express_company = new ExpressCompany(); goto eHL6C; eHL6C: $ns_express_company->startTrans(); goto GTU_q; yYOcz: } public function updateExpressCompany($co_id, $company_name, $express_logo, $express_no, $is_enabled, $phone, $is_default, $mch_id) { goto anR6j; F4fxw: $data = array("\x63\x6f\155\160\141\x6e\171\137\156\141\x6d\x65" => $company_name, "\x65\170\160\x72\x65\163\x73\x5f\154\157\x67\x6f" => $express_logo, "\145\170\x70\162\x65\x73\163\137\156\157" => $express_no, "\151\163\137\x65\x6e\141\x62\x6c\145\144" => $is_enabled, "\160\x68\x6f\x6e\x65" => $phone, "\151\x73\x5f\144\x65\146\141\x75\154\164" => $is_default, "\x6d\143\150\137\151\x64" => $mch_id); goto Kc9aA; eSdjP: return $res; goto NrJLA; anR6j: $ns_express_company = new ExpressCompany(); goto Nz6A8; rTINS: Hh7kg: goto F4fxw; Nz6A8: if (!($is_default == 1)) { goto Hh7kg; } goto l9hVG; Kc9aA: $res = $ns_express_company->save($data, ["\x63\x6f\x5f\x69\144" => $co_id, "\155\143\x68\137\151\x64" => $mch_id]); goto eSdjP; l9hVG: $this->defaultExpressCompany($co_id); goto rTINS; NrJLA: } public function expressCompanyQuery($where = '', $field = "\52") { $ns_express_company = new ExpressCompany(); return $ns_express_company->where($where)->field($field)->select(); } public function expressCompanyDetail($co_id) { $ns_express_company = new ExpressCompany(); return $ns_express_company->get($co_id); } public function defaultExpressCompany($co_id) { Db::name("\171\142\x73\143\137\x65\x78\x70\162\x65\163\x73\x5f\x63\x6f\x6d\160\x61\x6e\x79")->whereNotIn("\143\x6f\137\x69\144", $co_id)->update(["\x69\x73\x5f\x64\x65\146\x61\165\x6c\x74" => 0]); } public function getShippingFeeList($condition = '', $field = "\x2a", $order = '') { goto NZidt; N111e: foreach ($list as $k => $v) { goto RWVTf; n3p2K: $list[$k]["\x61\x64\144\x72\x65\163\163\137\x6c\x69\x73\x74"] = $address->getAddressListById($v["\x70\162\x6f\x76\x69\x6e\143\x65\x5f\151\x64\x5f\141\162\162\x61\171"], $v["\143\151\x74\x79\137\151\x64\137\141\162\162\x61\171"]); goto u0mHd; RWVTf: $address = new \app\admin\service\Area(); goto n3p2K; u0mHd: fcZim: goto NLjaE; NLjaE: } goto oOykc; EMJ8T: return $list; goto n4oyy; oOykc: iByxS: goto EMJ8T; wLGWv: $list = $ns_order_shipping_fee->getQuerys($condition, $field, $order); goto N111e; NZidt: $ns_order_shipping_fee = new ExpressShipping(); goto wLGWv; n4oyy: } public function getExpressCompanyList($condition, $search_text, $order = '') { goto DHadZ; DHadZ: $ns_express_company = new ExpressCompany(); goto VkoVl; VkoVl: $list = $ns_express_company->getPageLisy($condition, $search_text, $order); goto aoh_w; aoh_w: return $list; goto T0Viu; T0Viu: } public function getExpressCompany($condition, $field = "\x2a", $order) { goto wmvQh; H2nQS: return $list; goto bGhWw; LOhu8: $list = $ns_express_company->getQuerys($condition, $field, $order); goto H2nQS; wmvQh: $ns_express_company = new ExpressCompany(); goto LOhu8; bGhWw: } public function expressCompanyDelete($co_id) { goto jtsur; AGsQr: Kn1pY: goto K5H1j; Ep12l: if ($ns_express_company_return > 0) { goto Kl8rb; } goto ett3S; jtsur: $ns_express_company = new ExpressCompany(); goto nL7K_; nL7K_: $conditon = array("\143\x6f\137\x69\x64" => array("\151\156", $co_id)); goto szWnm; sp14y: Kl8rb: goto ycvyd; szWnm: $ns_express_company_return = $ns_express_company->destroy($conditon); goto Ep12l; Q1OmT: goto Kn1pY; goto sp14y; ycvyd: return 1; goto AGsQr; ett3S: return -1; goto Q1OmT; K5H1j: } public function addShippingFee($co_id, $is_default, $shipping_fee_name, $province_id_array, $city_id_array, $district_id_array, $weight_is_use, $weight_snum, $weight_sprice, $weight_xnum, $weight_xprice, $volume_is_use, $volume_snum, $volume_sprice, $volume_xnum, $volume_xprice, $bynum_is_use, $bynum_snum, $bynum_sprice, $bynum_xnum, $bynum_xprice) { goto SDD78; YQXUl: return -1; goto Obvqt; ZVD8w: $order_shipping_fee->startTrans(); goto m94YI; SDD78: $order_shipping_fee = new ExpressShipping(); goto ZVD8w; m94YI: try { goto iP7KF; JVSRz: return 1; goto gaxSt; fotnZ: $order_shipping_fee->commit(); goto JVSRz; iP7KF: $data = array("\163\x68\151\160\x70\x69\x6e\x67\x5f\x66\145\x65\137\156\141\155\145" => $shipping_fee_name, "\143\157\x5f\151\144" => $co_id, "\x69\x73\137\144\x65\x66\x61\x75\x6c\x74" => $is_default, "\160\x72\x6f\166\151\x6e\x63\145\x5f\151\x64\137\x61\x72\x72\x61\171" => $province_id_array, "\143\151\164\171\x5f\151\x64\x5f\141\162\162\x61\x79" => $city_id_array, "\144\x69\x73\164\x72\151\x63\164\137\x69\x64\137\141\162\x72\x61\171" => $district_id_array, "\x77\145\x69\147\150\x74\137\151\x73\x5f\165\x73\145" => $weight_is_use, "\x77\145\151\147\150\x74\x5f\163\x6e\165\x6d" => $weight_snum, "\167\x65\151\x67\150\164\x5f\x78\156\165\x6d" => $weight_xnum, "\x77\145\151\147\150\164\x5f\163\x70\x72\151\143\145" => $weight_sprice, "\x77\x65\x69\147\150\164\x5f\170\160\162\151\x63\x65" => $weight_xprice, "\166\157\154\x75\155\145\137\x69\x73\x5f\165\x73\x65" => $volume_is_use, "\x76\157\154\x75\x6d\x65\137\163\x6e\165\x6d" => $volume_snum, "\166\x6f\x6c\x75\x6d\x65\137\x73\160\x72\151\x63\x65" => $volume_sprice, "\x76\157\x6c\x75\x6d\x65\x5f\x78\156\165\155" => $volume_xnum, "\166\x6f\154\x75\155\145\137\x78\160\162\x69\143\145" => $volume_xprice, "\x62\171\x6e\165\155\x5f\x69\x73\x5f\x75\x73\x65" => $bynum_is_use, "\142\171\x6e\165\x6d\137\163\x6e\165\x6d" => $bynum_snum, "\x62\171\156\165\155\137\x73\160\x72\151\x63\145" => $bynum_sprice, "\142\171\156\x75\155\137\x78\156\165\155" => $bynum_xnum, "\x62\x79\x6e\x75\x6d\137\170\160\x72\151\143\x65" => $bynum_xprice, "\143\x72\x65\141\x74\x65\137\164\151\x6d\x65" => time()); goto sWPUG; sWPUG: $order_shipping_fee->save($data); goto fotnZ; gaxSt: } catch (\Exception $e) { $order_shipping_fee->rollback(); return $e->getMessage(); } goto YQXUl; Obvqt: } public function updateShippingFee($shipping_fee_id, $is_default, $shipping_fee_name, $province_id_array, $city_id_array, $district_id_array, $weight_is_use, $weight_snum, $weight_sprice, $weight_xnum, $weight_xprice, $volume_is_use, $volume_snum, $volume_sprice, $volume_xnum, $volume_xprice, $bynum_is_use, $bynum_snum, $bynum_sprice, $bynum_xnum, $bynum_xprice) { goto p5UF8; iM94i: return -1; goto ns0YF; vo7Gd: $order_shipping_fee->startTrans(); goto wU1Lc; wU1Lc: try { goto LfTyZ; WpdeE: return 1; goto bSGKB; V52aM: $order_shipping_fee->commit(); goto WpdeE; eUTGk: $order_shipping_fee->save($data, ["\163\x68\x69\160\160\151\156\x67\137\146\x65\145\137\x69\144" => $shipping_fee_id]); goto V52aM; LfTyZ: $data = array("\x73\150\x69\160\x70\x69\156\147\137\146\145\145\x5f\x6e\141\x6d\145" => $shipping_fee_name, "\151\163\137\144\145\146\x61\x75\x6c\164" => $is_default, "\160\x72\157\166\x69\x6e\143\x65\137\x69\144\x5f\x61\x72\x72\x61\171" => $province_id_array, "\x63\x69\164\x79\137\x69\x64\137\141\x72\162\141\x79" => $city_id_array, "\144\151\163\164\x72\x69\x63\164\x5f\151\x64\x5f\141\162\162\141\171" => $district_id_array, "\x77\145\x69\x67\150\164\137\x69\x73\137\x75\x73\145" => $weight_is_use, "\167\x65\151\147\150\x74\x5f\163\156\x75\155" => $weight_snum, "\167\x65\151\x67\x68\x74\137\170\x6e\165\155" => $weight_xnum, "\x77\x65\x69\x67\x68\164\137\163\160\162\x69\143\145" => $weight_sprice, "\x77\145\x69\147\150\x74\137\x78\x70\162\x69\143\x65" => $weight_xprice, "\166\157\x6c\x75\155\x65\137\151\163\x5f\x75\163\145" => $volume_is_use, "\x76\157\154\165\x6d\145\137\x73\x6e\x75\x6d" => $volume_snum, "\166\157\x6c\x75\155\x65\x5f\163\x70\x72\151\143\x65" => $volume_sprice, "\166\x6f\x6c\x75\155\145\x5f\x78\x6e\x75\155" => $volume_xnum, "\166\x6f\154\165\x6d\x65\x5f\170\160\162\x69\x63\145" => $volume_xprice, "\142\171\x6e\165\x6d\137\151\x73\137\165\x73\x65" => $bynum_is_use, "\142\x79\156\x75\155\x5f\163\156\165\x6d" => $bynum_snum, "\x62\x79\156\165\155\x5f\163\160\x72\151\143\x65" => $bynum_sprice, "\142\171\x6e\x75\155\x5f\x78\x6e\165\x6d" => $bynum_xnum, "\142\x79\156\x75\155\137\170\x70\x72\x69\x63\x65" => $bynum_xprice, "\165\160\144\x61\164\x65\x5f\x74\x69\155\x65" => time()); goto eUTGk; bSGKB: } catch (\Exception $e) { $order_shipping_fee->rollback(); return $e->getMessage(); } goto iM94i; p5UF8: $order_shipping_fee = new ExpressShipping(); goto vo7Gd; ns0YF: } public function isHasExpressCompanyDefaultTemplate($co_id) { goto UkoKr; be1Wn: foreach ($list as $v) { goto gFx_B; sPwvN: $is_default = 0; goto M0fxA; Svjr8: UMx5h: goto tXeh1; M0fxA: goto MG3Zr; goto Svjr8; gFx_B: if (!$v["\x69\x73\x5f\x64\x65\x66\141\165\x6c\x74"]) { goto UMx5h; } goto sPwvN; tXeh1: bqVPh: goto tQMBz; tQMBz: } goto nnVrM; X0jgd: $is_default = 1; goto be1Wn; uV4P0: $list = $ns_order_shipping_fee->getQuerys(["\143\x6f\137\151\x64" => $co_id], "\151\163\137\144\x65\146\x61\x75\x6c\164", ''); goto X0jgd; UkoKr: $ns_order_shipping_fee = new ExpressShipping(); goto uV4P0; Mf1W0: return $is_default; goto PX7pi; nnVrM: MG3Zr: goto Mf1W0; PX7pi: } public function shippingFeeDetail($shipping_fee_id) { goto nuZDr; HolTq: return $order_shipping_fee_info; goto vIrNS; t7YAS: $address_name = ''; goto H7Zuh; XHpC7: foreach ($province_array as $e) { goto gy0Al; AsfHE: zwqsc: goto P2O0i; P2O0i: icdi6: goto pIHTx; gy0Al: foreach ($area as $p) { goto M_ltu; M_ltu: if (!($e == $p["\151\144"])) { goto wRXiE; } goto Zd1Cm; w1PJL: wRXiE: goto Fjebw; Fjebw: zHqiS: goto LKOKX; Zd1Cm: $address_name = $address_name . $p["\x6e\141\x6d\x65"] . "\54"; goto w1PJL; LKOKX: } goto AsfHE; pIHTx: } goto sGW24; O_BmN: $order_shipping_fee_info["\x61\144\144\162\x65\163\x73\137\x6e\141\x6d\x65"] = $address_name; goto HolTq; WterC: $address_name = substr($address_name, 0, strlen($address_name) - 1); goto O_BmN; GrWRq: $order_shipping_fee_info = $order_shipping_fee->get($shipping_fee_id); goto xjSDB; H7Zuh: $province_array = explode("\54", $order_shipping_fee_info["\x70\162\157\166\x69\156\143\145\137\151\144\137\141\162\x72\141\x79"]); goto XHpC7; nuZDr: $order_shipping_fee = new ExpressShipping(); goto GrWRq; xjSDB: $address = new \app\admin\service\Area(); goto Ir5WQ; Ir5WQ: $area = $address->getAreaList(); goto t7YAS; sGW24: s0xf3: goto WterC; vIrNS: } public function getExpressCompanyProvincesAndCitiesById($co_id, $current_province_id_array) { goto auAD2; q8t34: $res_list["\x70\x72\x6f\166\151\x6e\143\145\x5f\151\x64\137\141\162\x72\141\171"] = []; goto Cpxui; dAsup: array_push($curr_province_id_array, $current_province_id_array); goto BDdUQ; vPvQN: CeRi2: goto RzEL3; lzj5Y: if (empty($current_province_id_array)) { goto CeRi2; } goto ixicx; RzEL3: $ns_order_shipping_fee = new ExpressShipping(); goto vlsM5; BDdUQ: mHOh3: goto vPvQN; HB_yt: Hezgy: goto cJfzw; RT37d: if (!count($province_id_array)) { goto jpQwx; } goto hR8V2; suihA: return $res_list; goto VFBKz; auAD2: $curr_province_id_array = []; goto lzj5Y; ixicx: if (!strstr($current_province_id_array, "\54")) { goto Gu6ps; } goto GMObR; hR8V2: foreach ($province_id_array as $province_id) { goto wt_ch; wt_ch: $flag = true; goto oe2sx; oe2sx: foreach ($curr_province_id_array as $temp_province_id) { goto Y8q88; AOVKH: N8_tf: goto S1wvf; Z1Qu_: $flag = false; goto AOVKH; S1wvf: s8nTA: goto ymey6; Y8q88: if (!($province_id == $temp_province_id)) { goto N8_tf; } goto Z1Qu_; ymey6: } goto mfM4D; jgwvC: irtEm: goto iHi7k; B096L: array_push($res_list["\160\162\x6f\x76\151\x6e\x63\145\x5f\151\x64\x5f\141\x72\x72\x61\x79"], $province_id); goto jgwvC; iHi7k: oqJQU: goto JuTXV; uHKJu: if (!$flag) { goto irtEm; } goto B096L; mfM4D: Qu3ng: goto uHKJu; JuTXV: } goto HB_yt; HcQyT: goto mHOh3; goto BzsRA; GMObR: $curr_province_id_array = explode("\54", $current_province_id_array); goto HcQyT; BzsRA: Gu6ps: goto dAsup; zeTHA: lg7hu: goto RT37d; cJfzw: jpQwx: goto suihA; vlsM5: $list = $ns_order_shipping_fee->getQuerys(["\x63\157\137\x69\x64" => $co_id, "\x69\163\x5f\x64\145\x66\x61\165\154\x74" => 0], "\160\x72\157\x76\x69\x6e\x63\x65\x5f\x69\x64\x5f\x61\162\x72\141\x79\x2c\143\151\164\x79\x5f\x69\x64\137\x61\162\162\x61\x79\x2c\x64\151\163\x74\162\151\143\164\137\151\x64\137\x61\x72\162\141\171", ''); goto sc4zw; sc4zw: $province_id_array = []; goto q8t34; Cpxui: foreach ($list as $k => $v) { goto VATEu; F24gR: array_push($province_id_array, $v["\x70\x72\x6f\166\151\156\143\x65\x5f\x69\144\x5f\x61\162\162\x61\x79"]); goto hDWhL; HdZ3z: ImWn1: goto F24gR; MaCu2: $temp_province_array = explode("\x2c", $v["\x70\162\x6f\166\x69\156\x63\145\x5f\151\144\137\141\x72\x72\x61\x79"]); goto PnxDF; DcudK: P9o1K: goto YXQX0; PnxDF: foreach ($temp_province_array as $temp_province_id) { array_push($province_id_array, $temp_province_id); rX0zn: } goto DcudK; VATEu: if (!strstr($v["\x70\x72\157\166\151\156\x63\145\x5f\x69\144\137\x61\x72\x72\x61\x79"], "\x2c")) { goto ImWn1; } goto MaCu2; XpOKK: CDLj4: goto hB3Kg; hDWhL: F_qVj: goto XpOKK; YXQX0: goto F_qVj; goto HdZ3z; hB3Kg: } goto zeTHA; VFBKz: } public function shippingFeeDelete($shipping_fee_id) { goto XwYT1; aOqMn: HMpr6: goto cvHux; l4If6: $condition = array("\x73\x68\x69\x70\x70\x69\x6e\x67\137\146\145\x65\x5f\151\144" => array(array("\x69\156", $shipping_fee_id))); goto J_QO2; XwYT1: $order_shipping_fee = new ExpressShipping(); goto l4If6; J_QO2: $order_shipping_return = $order_shipping_fee->destroy($condition); goto d5tuc; Pc7Hl: Ognt1: goto loiGH; sJ4F0: return -1; goto rw33T; rw33T: goto Ognt1; goto aOqMn; cvHux: return 1; goto Pc7Hl; d5tuc: if ($order_shipping_return > 0) { goto HMpr6; } goto sJ4F0; loiGH: } }
