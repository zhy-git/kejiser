<?php
 namespace app\admin\service; use app\common\model\GoodsAttr; use app\common\model\GoodsAttrDel; use app\common\model\GoodsAttrModule; use app\common\model\GoodsAttrValue; use app\common\model\GoodsDeleted; use app\common\model\GoodsSku; use app\common\model\GoodsSkuDeleted; use app\common\model\GoodsSpec; use app\common\model\GoodsSpecFormat; use app\common\model\GoodsSpecValue; use app\common\model\GoodsSupplier; use think\Db; class Goods extends Base { function __construct() { parent::__construct(); $this->goods = new \app\common\model\Goods(); } public function getSupplierList($condition = '', $search_text) { $supplier = new GoodsSupplier(); return $supplier->getPageLisy($condition, $search_text); } public function getGoodsList($condition = '', $search_text = '') { $list = $this->getGoodsViewQueryField($condition, "\52", '', $search_text); return $list; } public function ModifyGoodsOnline($condition) { goto y0BsG; Y1O9J: $result = $this->goods->save($data, "\147\x6f\x6f\144\163\137\x69\144\x20\x20\151\x6e\50{$condition}\x29"); goto OQw13; SfU65: return UPDATA_FAIL; goto dMC1o; OQw13: if ($result > 0) { goto jA3hf; } goto SfU65; rLB04: q4H1v: goto nHOZg; oYpJ7: return SUCCESS; goto rLB04; y0BsG: $data = array("\x73\164\x61\164\145" => 1, "\165\160\x64\x61\164\x65\137\164\x69\155\145" => time()); goto Y1O9J; JH5xO: jA3hf: goto oYpJ7; dMC1o: goto q4H1v; goto JH5xO; nHOZg: } public function deleteGoods($goods_id) { $this->goods->startTrans(); try { goto FbokE; SPDb1: $res = $this->goods->save($data, "\x67\157\157\144\x73\137\151\144\40\40\x69\156\50{$goods_id}\51"); goto GSM3F; h2I1g: OBg4P: goto dZN4H; pwPP9: $this->goods->commit(); goto EqFsz; GSM3F: if ($res > 0) { goto GbAY6; } goto eQZNQ; mkPQg: GbAY6: goto pwPP9; eQZNQ: return DELETE_FAIL; goto n5gY_; FbokE: $data = array("\151\x73\137\144\x65\154" => 1, "\165\160\x64\x61\x74\x65\x5f\164\x69\155\x65" => time()); goto SPDb1; n5gY_: goto OBg4P; goto mkPQg; EqFsz: return SUCCESS; goto h2I1g; dZN4H: } catch (\Exception $e) { $this->goods->rollback(); return DELETE_FAIL; } } private function addGoodsDeleted($goods_ids) { $this->goods->startTrans(); try { goto b6uwu; paOeX: return 1; goto szCrF; b6uwu: $goods_id_array = explode("\54", $goods_ids); goto F1V87; LygTS: Dod3_: goto gQdon; F1V87: foreach ($goods_id_array as $k => $v) { goto FnEbD; oHBA7: if (!empty($goods_delete_obj)) { goto TaOp3; } goto X1AzO; BJsR5: $goods_attribute_list = $goods_attribute_model->getQuerys(["\147\157\x6f\144\x73\137\x69\x64" => $v], "\x2a", ''); goto fw84j; zsJgL: $goods_delete_model = new GoodsDeleted(); goto ovXka; n0OHc: L0SGB: goto ony7F; ovXka: $goods_info = json_decode(json_encode($goods_info), true); goto I4l_l; fw84j: foreach ($goods_attribute_list as $goods_attribute_obj) { goto Jg3As; Jg3As: $goods_attribute_delete_model = new GoodsAttrDel(); goto q042_; qvMfh: $goods_attribute_delete_model->save($goods_attribute_obj); goto raYKV; q042_: $goods_attribute_obj = json_decode(json_encode($goods_attribute_obj), true); goto qvMfh; raYKV: EcBF9: goto kXO2N; kXO2N: } goto Ye42O; sIUH3: foreach ($goods_sku_list as $goods_sku_obj) { goto w6fl_; cWKSH: IHXy8: goto Nm9ds; TJvmf: $goods_sku_deleted_model->save($goods_sku_obj); goto cWKSH; o82q_: $goods_sku_obj["\x75\160\x64\x61\164\x65\x5f\144\x61\x74\145"] = time(); goto TJvmf; w6fl_: $goods_sku_deleted_model = new GoodsSkuDeleted(); goto MRrp5; MRrp5: $goods_sku_obj = json_decode(json_encode($goods_sku_obj), true); goto o82q_; Nm9ds: } goto gYti0; FnEbD: $goods_info = $this->goods->get($v); goto zsJgL; VYbRy: TaOp3: goto n0OHc; gYti0: B1kRx: goto xDZaj; Ye42O: KqRX_: goto VYbRy; I4l_l: $goods_delete_obj = $goods_delete_model->getInfo(["\147\x6f\157\144\163\x5f\151\144" => $v]); goto oHBA7; dkPPU: $goods_delete_model->save($goods_info); goto iT58h; W3WUz: $goods_sku_list = $goods_sku_model->getQuerys(["\x67\x6f\x6f\x64\163\137\151\144" => $v], "\52", ''); goto sIUH3; iT58h: $goods_sku_model = new GoodsSku(); goto W3WUz; xDZaj: $goods_attribute_model = new GoodsAttr(); goto BJsR5; X1AzO: $goods_info["\x75\x70\144\141\x74\145\137\x74\x69\155\145"] = time(); goto dkPPU; ony7F: } goto LygTS; gQdon: $this->goods->commit(); goto paOeX; szCrF: } catch (\Exception $e) { $this->goods->rollback(); return $e->getMessage(); } } public function ModifyGoodsOffline($condition) { goto J7LED; Vb0C8: fNigg: goto wOWjI; hgydV: goto fNigg; goto XuH5J; XuH5J: okPIM: goto lAM40; Zt2L2: $result = $this->goods->save($data, "\147\157\157\144\163\x5f\151\x64\40\x20\151\156\50{$condition}\x29"); goto k_0LR; lAM40: return SUCCESS; goto Vb0C8; k_0LR: if ($result > 0) { goto okPIM; } goto XLWSB; J7LED: $data = array("\x73\164\141\164\145" => 0, "\x75\x70\x64\x61\x74\145\x5f\164\x69\x6d\145" => time()); goto Zt2L2; XLWSB: return UPDATA_FAIL; goto hgydV; wOWjI: } public function getGoodsViewQueryField($condition, $field, $order = '', $search_text = '') { goto UyAOq; pcAkO: $url = explode("\x26\x70\141\x67\145", $url[1]); goto CU69s; k117A: $list = $goods_view->alias("\156\147")->join("\171\142\163\143\137\x69\x6d\141\147\145\x73\x20\151\x6d\x61\147\145\163", "\156\147\x2e\151\155\141\x67\145\x73\x20\75\x20\x69\x6d\141\x67\x65\x73\56\151\155\147\x5f\151\144", "\154\x65\x66\x74")->order("\156\147\x2e\x73\157\162\164\x20\x64\145\163\143\x2c\156\147\x2e\x63\x72\x65\141\x74\x65\x5f\x74\x69\x6d\145\x20\x64\x65\x73\x63")->field($field)->where($condition)->paginate(10, false, $config = ["\161\165\x65\x72\x79" => ["\x73" => $url], "\x73\x65\x61\x72\x63\150\137\164\x65\170\164" => $search_text])->appends(request()->param()); goto d7ehc; CU69s: $url = "\x2f" . $url[0]; goto NzVNq; ZDeew: $url = explode("\x3d\57", $url); goto pcAkO; UyAOq: $url = request()->query(); goto ZDeew; d7ehc: return $list; goto WeuJW; NzVNq: $goods_view = new \app\common\model\Goods(); goto k117A; WeuJW: } public function addSupplier($supplier_name, $name, $tel, $address, $info, $logo, $mch_id) { goto j67IU; qLAAQ: $res = $supplier->save($data); goto mtUGH; mtUGH: return $res; goto CVKOv; nbAzC: $data = array("\x73\x75\x70\160\x6c\151\145\x72\x5f\x6e\x61\x6d\x65" => $supplier_name, "\156\141\x6d\145" => $name, "\164\145\154" => $tel, "\141\x64\144\x72\145\163\163" => $address, "\151\156\x66\x6f" => $info, "\x6c\x6f\147\x6f" => $logo, "\x63\162\145\x61\x74\x65\x5f\164\x69\155\x65" => time(), "\x6d\x63\x68\137\x69\144" => $mch_id); goto qLAAQ; j67IU: $supplier = new GoodsSupplier(); goto nbAzC; CVKOv: } public function updateSupplier($supplier_id, $supplier_name, $name, $tel, $address, $info, $logo, $bus_id) { goto PtSql; PtSql: $supplier = new GoodsSupplier(); goto AjR9t; AjR9t: $data = array("\x73\165\160\x70\154\151\x65\162\x5f\x6e\141\x6d\145" => $supplier_name, "\x6e\141\x6d\x65" => $name, "\164\145\154" => $tel, "\x61\x64\144\x72\x65\163\163" => $address, "\151\156\146\x6f" => $info, "\x6c\x6f\147\x6f" => $logo, "\155\143\x68\137\x69\144" => $bus_id); goto xRF31; xRF31: return $supplier->save($data, ["\163\x75\x70\160\154\151\x65\162\x5f\151\144" => $supplier_id]); goto eFk08; eFk08: } public function getSupplierInfo($supplier_id) { $supplier = new GoodsSupplier(); return $supplier->get($supplier_id); } public function deleteSupplier($supplier_id_array) { goto gCj6H; FaeGP: return $res; goto tBN74; Vyuk2: $res = $supplier->destroy($supplier_id_array); goto FaeGP; gCj6H: $supplier = new GoodsSupplier(); goto Vyuk2; tBN74: } protected function checkSupplierIsUse($supplier_id) { goto zn3rN; IzCyo: $count = $goods->getCount(["\163\x75\x70\x70\x6c\151\x65\162\137\151\x64" => $supplier_id]); goto xDNHQ; zn3rN: $goods = new \app\common\model\Goods(); goto UrWID; UrWID: $goods_deleted = new GoodsDeleted(); goto IzCyo; qfTox: return $count; goto D4ehb; xDNHQ: $count += $goods_deleted->getCount(["\x73\165\x70\160\x6c\x69\145\x72\137\151\x64" => $supplier_id]); goto qfTox; D4ehb: } public function addGoodsSpecService($spec_name, $show_type, $is_visible, $sort, $spec_value_str, $attr_id = 0, $is_screen, $cate_id, $mch_id) { goto V6sQZ; HnDC4: try { goto Dzxae; Bn_Yt: $attribute->save(["\163\x70\x65\x63\x5f\x69\144\137\141\162\162\141\171" => $spec_id], ["\x61\x74\x74\x72\x5f\151\x64" => $attr_id]); goto SHBXP; hC6ay: $spec_value_array = array_filter($spec_value_array); goto ZsMaO; MobYC: $attribute->save(["\x73\x70\145\143\x5f\x69\x64\137\x61\x72\x72\x61\x79" => $attribute_info["\x73\160\x65\143\x5f\151\144\x5f\141\x72\162\x61\171"] . "\x2c" . $spec_id], ["\x61\164\x74\162\137\x69\x64" => $attr_id]); goto mZfIO; ZsMaO: $spec_value_array = array_unique($spec_value_array); goto ymTKg; Q4rhh: $attribute = new GoodsAttrModule(); goto MlkBt; SgwIy: return $spec_id; goto sc4ea; ymTKg: foreach ($spec_value_array as $k => $v) { goto uUm8V; uUm8V: $spec_value = array(); goto CNtW6; QaBRY: $this->addGoodsSpecValueService($spec_id, $v, 1, 255); goto R19MR; RonJ4: $this->addGoodsSpecValueService($spec_id, $spec_value[0], 1, 255); goto w5D13; w5D13: CrQKk: goto DzYjM; bIqag: UaTY8: goto DVkYC; DVkYC: $spec_value = explode("\72", $v); goto RonJ4; DzYjM: UsXer: goto zLeaw; R19MR: goto CrQKk; goto bIqag; CNtW6: if ($show_type == 2) { goto UaTY8; } goto QaBRY; zLeaw: } goto IQyOX; SHBXP: b0TTE: goto hBJpW; hBJpW: xAUdc: goto FYMcV; BFYhi: R_vad: goto Bn_Yt; Dzxae: $data = array("\x73\160\x65\x63\x5f\156\141\x6d\145" => $spec_name, "\163\150\157\167\137\164\171\x70\x65" => 0, "\x69\163\137\x76\x69\163\x69\142\154\x65" => $is_visible, "\x73\x6f\162\x74" => $sort, "\x63\x72\145\x61\x74\x65\137\x74\x69\155\x65" => time(), "\143\141\164\145\137\151\144" => $cate_id, "\x6d\x63\x68\x5f\x69\144" => $mch_id); goto OTERA; OTERA: $goods_spec->save($data); goto C_cE3; mZfIO: goto b0TTE; goto BFYhi; FYMcV: $spec_value_array = explode("\x2c", $spec_value_str); goto hC6ay; j_LZ1: $goods_spec->commit(); goto SgwIy; MlkBt: $attribute_info = $attribute->getInfo(["\141\x74\164\162\x5f\x69\144" => $attr_id], "\x2a"); goto ml9z0; C_cE3: $spec_id = $goods_spec->spec_id; goto ulIKn; ulIKn: if (!($attr_id > 0)) { goto xAUdc; } goto Q4rhh; ml9z0: if ($attribute_info["\x73\160\x65\x63\x5f\151\144\x5f\x61\162\x72\141\171"] == '') { goto R_vad; } goto MobYC; IQyOX: HFvTL: goto j_LZ1; sc4ea: } catch (\Exception $e) { goto ZcrfG; ZcrfG: $goods_spec->rollback(); goto ckrzS; ckrzS: dump($e->getMessage()); goto YazbV; YazbV: return $e->getMessage(); goto lFXlC; lFXlC: } goto BTtra; fyKD0: $goods_spec->startTrans(); goto HnDC4; V6sQZ: $goods_spec = new GoodsSpec(); goto fyKD0; BTtra: } public function addGoodsSpecValueService($spec_id, $spec_value_name, $is_visible, $sort = "\60") { goto Pzw0W; vqMAv: return $goods_spec_value->spec_value_id; goto fhDuJ; OniuC: $goods_spec_value->save($data); goto vqMAv; jzREQ: $data = array("\163\160\x65\143\x5f\151\x64" => $spec_id, "\163\160\x65\x63\x5f\166\141\x6c\x75\x65\x5f\156\141\155\x65" => $spec_value_name, "\x69\x73\x5f\166\x69\x73\x69\142\x6c\145" => $is_visible, "\163\x6f\162\164" => $sort, "\x63\x72\x65\x61\164\x65\x5f\164\x69\x6d\x65" => time()); goto OniuC; Pzw0W: $goods_spec_value = new GoodsSpecValue(); goto jzREQ; fhDuJ: } public function getGoodsSpecList($condition = '', $search_text) { goto J5bAR; PofY4: NjPmj: goto Um3Kh; U3R5D: $goods_spec_value = new GoodsSpecValue(); goto Hvsfg; Hvsfg: $goods_spec_list = $goods_spec->getPageLisy($condition, $search_text); goto h6GKI; Fzbf3: return $goods_spec_list; goto s2v8W; h6GKI: if (empty($goods_spec_list)) { goto oiuG_; } goto wd0BW; Um3Kh: oiuG_: goto Fzbf3; J5bAR: $goods_spec = new GoodsSpec(); goto U3R5D; wd0BW: foreach ($goods_spec_list as $ks => $vs) { goto sF8dG; zqWKJ: $goods_spec_list[$ks]["\x73\160\145\143\x5f\166\x61\x6c\x75\x65\137\154\x69\163\x74"] = $spec_value_list; goto u0Wb4; sF8dG: $goods_spec_value_name = ''; goto KICAL; KICAL: $spec_value_list = $goods_spec_value->getQuerys(["\163\x70\x65\143\x5f\151\144" => $vs["\163\160\145\x63\x5f\x69\144"]], "\x2a", ''); goto kUIFd; u0Wb4: $goods_spec_value_name = $goods_spec_value_name == '' ? '' : substr($goods_spec_value_name, 1); goto mIbrH; bzEZN: VQ1Mw: goto zqWKJ; mIbrH: $goods_spec_list[$ks]["\163\160\x65\x63\x5f\166\x61\x6c\165\145\x5f\x6e\x61\x6d\145\137\x6c\151\x73\x74"] = $goods_spec_value_name; goto U5JeZ; U5JeZ: EUKvT: goto isHG_; kUIFd: foreach ($spec_value_list as $kv => $vv) { $goods_spec_value_name = $goods_spec_value_name . "\x2c" . $vv["\x73\x70\145\x63\x5f\x76\141\x6c\165\x65\x5f\x6e\141\155\145"]; uamTv: } goto bzEZN; isHG_: } goto PofY4; s2v8W: } public function getGoodsSpecAll($condition = '', $field = "\x2a", $order = '') { goto sNfRb; sNfRb: $goods_spec = new GoodsSpec(); goto AAA1D; M44ku: Xez2i: goto JmOHs; XI8ol: $goods_spec_list = $goods_spec->getQuerys($condition, $field, $order); goto DUo9O; DUo9O: if (empty($goods_spec_list)) { goto WCkoy; } goto Xv_nE; Xv_nE: foreach ($goods_spec_list as $ks => $vs) { goto P372B; jju4M: $goods_spec_value_name = $goods_spec_value_name == '' ? '' : substr($goods_spec_value_name, 1); goto ypaMx; HgKb3: auUAs: goto lbC_s; lbC_s: $goods_spec_list[$ks]["\163\160\x65\143\137\166\x61\154\165\x65\x5f\x6c\151\x73\x74"] = $spec_value_list; goto jju4M; ypaMx: $goods_spec_list[$ks]["\x73\160\145\143\x5f\166\x61\154\165\x65\137\156\141\x6d\x65\x5f\x6c\x69\x73\x74"] = $goods_spec_value_name; goto yYHVX; P372B: $goods_spec_value_name = ''; goto D19D0; D19D0: $spec_value_list = $goods_spec_value->getQuerys(["\x73\x70\x65\x63\x5f\x69\144" => $vs["\163\x70\x65\x63\x5f\151\144"]], "\52", ''); goto jkVo0; jkVo0: foreach ($spec_value_list as $kv => $vv) { $goods_spec_value_name = $goods_spec_value_name . "\x2c" . $vv["\163\160\x65\143\x5f\x76\141\154\x75\145\137\x6e\141\x6d\x65"]; dsvdq: } goto HgKb3; yYHVX: cn5L9: goto OZDKM; OZDKM: } goto M44ku; AAA1D: $goods_spec_value = new GoodsSpecValue(); goto XI8ol; JmOHs: WCkoy: goto UinXQ; UinXQ: return $goods_spec_list; goto dqQuP; dqQuP: } public function getAttrValueAll($condition = '', $field = "\52", $order = '') { goto ORZS3; io0RM: $attr_value_list = $attr_value->getQuerys($condition, $field, $order); goto fS2Q1; ORZS3: $attr_value = new GoodsAttrValue(); goto io0RM; fS2Q1: return $attr_value_list; goto O0wXV; O0wXV: } public function getGoodsSpecDetail($spec_id) { goto Tec0N; A0dsW: $goods_spec_value = new GoodsSpecValue(); goto ezf4N; NK0ai: $info["\163\160\x65\x63\x5f\166\141\154\165\145\137\x6c\151\x73\164"] = $spec_value_list; goto SuDah; pDyUF: $goods_spec_value_name = ''; goto t3eq5; SuDah: return $info; goto newBF; Dr9IW: $spec_value_list = $goods_spec_value->getQuerys(["\x73\x70\145\143\x5f\151\144" => $info["\x73\160\x65\x63\137\151\x64"]], "\x2a", ''); goto ZkFWX; B6WtC: XGMic: goto td5dF; ezf4N: $info = $goods_spec->getInfo(["\x73\x70\145\143\137\x69\144" => $spec_id], "\x2a"); goto pDyUF; ZkFWX: foreach ($spec_value_list as $kv => $vv) { $goods_spec_value_name = $goods_spec_value_name . "\x2c" . $vv["\163\160\145\x63\137\166\141\154\165\x65\x5f\x6e\141\x6d\145"]; QE91N: } goto jPHJc; jPHJc: U3NqP: goto B6WtC; t3eq5: if (empty($info)) { goto XGMic; } goto VWQdG; Tec0N: $goods_spec = new GoodsSpec(); goto A0dsW; VWQdG: $goods_spec_value->destroy(["\x73\160\145\x63\x5f\x69\x64" => $info["\163\160\x65\143\137\x69\144"], "\x73\x70\x65\x63\x5f\x76\141\154\165\145\137\156\x61\x6d\x65" => '']); goto Dr9IW; td5dF: $info["\163\x70\x65\x63\x5f\166\x61\154\165\145\x5f\x6e\x61\x6d\145\x5f\154\x69\163\164"] = substr($goods_spec_value_name, 1); goto NK0ai; newBF: } public function updateGoodsSpecService($spec_id, $spec_name, $is_visible, $sort, $spec_value_str, $cate_id, $bus_id) { goto et9LR; Cs2zJ: try { goto KWomn; OScnl: return $res; goto yNBZE; pO0_U: foreach ($spec_value_array as $k => $v) { $this->addGoodsSpecValueService($spec_id, $v, 1, 255); K80X4: } goto Zmc9y; Zmc9y: Umrv9: goto zZupE; K4ub4: $spec_value_array = array_unique($spec_value_array); goto pO0_U; lFSx6: $spec_value_array = array_filter($spec_value_array); goto K4ub4; VvUau: $res = $goods_spec->save($data, ["\163\160\145\x63\137\x69\144" => $spec_id]); goto T1CYd; KWomn: $data = array("\x73\160\x65\x63\x5f\x6e\x61\x6d\145" => $spec_name, "\151\x73\x5f\x76\x69\163\151\x62\x6c\x65" => $is_visible, "\x73\157\x72\164" => $sort, "\x63\x61\x74\145\x5f\x69\144" => $cate_id, "\x6d\143\x68\137\x69\x64" => $bus_id); goto VvUau; fnpZi: $spec_value_array = explode("\x2c", $spec_value_str); goto lFSx6; zZupE: oZU_B: goto VHd0N; T1CYd: if (empty($spec_value_str)) { goto oZU_B; } goto fnpZi; VHd0N: $goods_spec->commit(); goto OScnl; yNBZE: } catch (\Exception $e) { $goods_spec->rollback(); return $e->getMessage(); } goto PyxNQ; vMJMQ: $goods_spec->startTrans(); goto Cs2zJ; et9LR: $goods_spec = new GoodsSpec(); goto vMJMQ; PyxNQ: } public function addAttrModule($attr_mod_id, $attr_name, $spec_id, $attr_value_id, $is_use, $sort, $mch_id) { goto u5D_S; uBGN0: $attr_module->startTrans(); goto rEwuL; rEwuL: try { goto myK3C; uL1rH: return $attr_module_id; goto MN4lg; ePeIh: goto uv27f; goto zKMVN; Ih1nT: $attr_module->save($data); goto yHERa; yHERa: $attr_module_id = $attr_module->attr_id; goto HAQtH; f5YvV: $attr_module->commit(); goto uL1rH; myK3C: $data = array("\x61\164\164\x72\137\x6e\x61\155\145" => $attr_name, "\x69\x73\137\x75\163\x65" => $is_use, "\163\157\162\164" => $sort, "\163\160\x65\x63\x5f\x69\x64\137\141\x72\x72\x61\x79" => $spec_id, "\141\x74\x74\x72\137\166\x61\154\x75\145\137\151\x64" => $attr_value_id, "\x63\162\x65\141\x74\145\137\164\151\155\x65" => time(), "\155\x63\150\x5f\x69\144" => $mch_id); goto mbpXQ; d5Kf8: $attr_module_id = $attr_mod_id; goto ePeIh; mbpXQ: if ($attr_mod_id == 0) { goto ssHi_; } goto p_LP2; p_LP2: $attr_module->save($data, ["\x61\x74\164\x72\137\x69\x64" => $attr_mod_id]); goto d5Kf8; HAQtH: $values = array("\141\164\x74\162\x5f\x69\144" => $attr_module_id); goto lvUYu; lvUYu: uv27f: goto f5YvV; zKMVN: ssHi_: goto Ih1nT; MN4lg: } catch (\Exception $e) { $attr_module->rollback(); return $e->getMessage(); } goto WFZFK; u5D_S: $attr_module = new GoodsAttrModule(); goto uBGN0; WFZFK: } public function modifyGoodsSpecValueField($spec_value_id, $field_name, $field_value) { $goods_spec_value = new GoodsSpecValue(); return $goods_spec_value->save(["{$field_name}" => $field_value], ["\163\x70\x65\143\137\166\x61\154\x75\x65\137\151\x64" => $spec_value_id]); } public function deleteGoodsSpecValue($spec_id, $spec_value_id) { goto rDhTp; tb_zH: goto PF287; goto BB2AN; BB2AN: s4EjB: goto WW5sN; HvUvN: if ($result == 1) { goto s4EjB; } goto i1DrB; qIplz: PF287: goto JpVTG; WW5sN: return -2; goto qIplz; BMu_R: return $goods_spec_value->destroy($spec_value_id); goto tb_zH; rDhTp: $result = $this->getGoodsSpecValueCount(["\x73\x70\x65\143\x5f\x69\144" => $spec_id]); goto HvUvN; i1DrB: $goods_spec_value = new GoodsSpecValue(); goto BMu_R; JpVTG: } public function getGoodsSpecValueCount($condition) { goto IU0g0; IU0g0: $spec_value = new GoodsSpecValue(); goto t1FbO; WiwLZ: return $count; goto mowVI; t1FbO: $count = $spec_value->where($condition)->count(); goto WiwLZ; mowVI: } public function checkGoodsSpecValueIsUse($spec_id, $spec_value_id) { goto Rbiv8; Ed_Qi: $goods_sku = new GoodsSku(); goto qEOFH; cmsKR: return false; goto GTFAR; qEOFH: $goods_sku_delete = new GoodsSkuDeleted(); goto xCFjr; Cosok: Hlghh: goto BCLH_; rATJZ: return true; goto Cosok; n48gy: if ($res + $res_delete > 0) { goto d4mDc; } goto cmsKR; Rbiv8: $check_str = $spec_id . "\x3a" . $spec_value_id . "\73"; goto Ed_Qi; xCFjr: $res = $goods_sku->where("\x20\103\x4f\116\x43\x41\x54\50\x61\164\x74\162\137\166\141\x6c\165\145\x5f\151\164\x65\155\x73\x2c\40\x27\73\47\x29\40\x6c\151\153\x65\x20\x27\45" . $check_str . "\x25\47")->count(); goto Vw9Bo; FvCkp: d4mDc: goto rATJZ; Vw9Bo: $res_delete = $goods_sku_delete->where("\x20\x43\x4f\x4e\x43\x41\x54\50\x61\x74\164\162\x5f\166\x61\x6c\165\145\137\151\164\x65\155\x73\54\40\47\73\47\51\x20\x6c\x69\153\x65\x20\x27\x25" . $check_str . "\45\x27")->count(); goto n48gy; GTFAR: goto Hlghh; goto FvCkp; BCLH_: } public function modifyGoodsSpecField($spec_id, $field_name, $field_value) { goto JdQrL; hA4i5: $res = $goods_spec->save($data, ["\x73\x70\145\x63\x5f\151\144" => $spec_id]); goto xFaDQ; VXHy3: $data = array("{$field_name}" => $field_value); goto hA4i5; xFaDQ: return $res; goto RCbAd; JdQrL: $goods_spec = new GoodsSpec(); goto VXHy3; RCbAd: } public function modifyAttributeFieldService($attr_id, $field_name, $field_value) { $attribute = new GoodsAttrValue(); return $attribute->save(["{$field_name}" => $field_value], ["\141\164\x74\162\137\x76\141\154\x75\x65\137\151\x64" => $attr_id]); } public function getAttrModuleInfo($mod_id, $condition = '', $field = "\x2a", $order = '') { goto lt4IK; bVoVF: $attr_val_list = $attr_val->getQuerys($condition, $field, $order); goto tFhTr; BGGZ8: $attr_mod_list = $attr_mod->getInfo($where); goto F3Peu; E0CcM: $where["\141\x74\164\x72\x5f\x69\x64"] = array("\x65\161", $mod_id); goto BGGZ8; XmggX: OUQBx: goto bVoVF; polLf: $condition["\141\164\x74\x72\137\x76\x61\x6c\165\x65\137\151\x64"] = array("\x69\156", $attr_mod_list["\141\164\164\x72\137\166\x61\154\165\145\137\151\144"]); goto XmggX; F3Peu: $spec_id_array = explode("\x2c", $attr_mod_list["\x73\160\x65\x63\x5f\151\144\137\141\162\x72\x61\x79"]); goto n3yiS; n3yiS: $attr_mod_list["\163\160\145\143\x5f\151\144\x5f\x61\x72\x72\141\x79"] = $spec_id_array; goto Ryzyg; lt4IK: $attr_mod = new GoodsAttrModule(); goto E0CcM; McmmX: return $attr_mod_list; goto SbiFL; Ryzyg: $attr_val = new GoodsAttrValue(); goto f96Tp; f96Tp: if (!(!empty($attr_mod_list["\141\x74\x74\162\137\166\x61\x6c\x75\145\x5f\151\x64"]) && $attr_mod_list["\x61\x74\x74\162\137\166\141\154\165\145\137\x69\144"] == '')) { goto OUQBx; } goto polLf; tFhTr: $attr_mod_list["\x61\x74\x74\x72\137\166\141\x6c\x75\145\x73"] = $attr_val_list; goto McmmX; SbiFL: } public function deleteGoodsSpec($spec_id) { goto UYNYh; iwMOC: $spec_value = new GoodsSpecValue(); goto roWal; UYNYh: $goods_spec = new GoodsSpec(); goto iwMOC; WNSmr: try { goto ygnsi; aMdyF: foreach ($spec_id_array as $k => $v) { goto FeOqP; EdjQq: UYdo3: goto XHS3d; E_Xda: $goods_spec->rollback(); goto SyRWR; jfb9d: if ($res) { goto UYdo3; } goto UJECz; E0jFU: ZUeQB: goto lNRX1; FeOqP: $res = $this->checkGoodsSpecIsUse($v); goto jfb9d; ezbiy: goto f1yae; goto EdjQq; SyRWR: f1yae: goto E0jFU; UJECz: $goods_spec->destroy($v); goto JHvti; XHS3d: return -1; goto E_Xda; JHvti: $spec_value->destroy(["\x73\160\145\143\137\x69\x64" => $v]); goto ezbiy; lNRX1: } goto ipI0i; ipI0i: SvtDv: goto T8Lwy; RYHOr: return 1; goto R9qv1; T8Lwy: $goods_spec->commit(); goto RYHOr; ygnsi: $spec_id_array = explode("\54", $spec_id); goto aMdyF; R9qv1: } catch (\Exception $e) { $goods_spec->rollback(); return $e->getMessage(); } goto dhsjp; roWal: $goods_spec->startTrans(); goto WNSmr; dhsjp: } public function checkGoodsSpecIsUse($spec_id) { goto imDe5; bGNDa: if (!($res == 0)) { goto EPgTa; } goto pxkcm; m6YuU: return false; goto FqIp1; GF22x: $goods_sku = new GoodsSku(); goto hghCh; ZKIoL: $res = 0; goto kKobW; imDe5: $goods_spec_value = new GoodsSpecValue(); goto GF22x; xtlHs: $check_str = ''; goto ZKIoL; K2tdh: CYaah: goto bGNDa; pxkcm: return false; goto qmzZB; kKobW: foreach ($spec_value_list as $k => $v) { goto ueRAE; wCFZL: eJFOV: goto q8Lkz; ueRAE: $check_str = $spec_id . "\72" . $v["\x73\160\145\143\137\x76\x61\154\165\x65\137\x69\144"] . "\x3b"; goto pVktP; pVktP: $res += $goods_sku->where("\40\x43\x4f\x4e\x43\101\124\x28\x61\x74\164\x72\x5f\166\x61\x6c\x75\145\137\151\164\145\x6d\x73\54\x20\x27\73\47\51\x20\x6c\151\x6b\x65\x20\47\45" . $check_str . "\x25\x27")->count(); goto TLnPu; ZlYrI: goto CYaah; goto wCFZL; q8Lkz: JULyS: goto b4UU1; UhDtG: return true; goto ZlYrI; TLnPu: if (!($res > 0)) { goto eJFOV; } goto UhDtG; b4UU1: } goto K2tdh; hghCh: $spec_value_list = $goods_spec_value->getQuerys(["\x73\160\145\143\137\x69\x64" => $spec_id], "\x2a", ''); goto bqwmO; bqwmO: if (!empty($spec_value_list)) { goto ymXcy; } goto m6YuU; pWoOy: Uemxl: goto gX0zH; jKMMr: ymXcy: goto xtlHs; qmzZB: EPgTa: goto pWoOy; FqIp1: goto Uemxl; goto jKMMr; gX0zH: } public function addAttributeService($attr_name, $is_use, $sort, $value_string, $cate_id, $mch_id) { goto NpFwN; o8D6Q: $attribute->startTrans(); goto MAAkH; NpFwN: $attribute = new GoodsAttrValue(); goto o8D6Q; MAAkH: try { goto zQ56X; pVoUX: return $attr_value_id; goto PSITG; zQ56X: $data = array("\141\164\164\162\137\x76\x61\x6c\165\145\137\156\x61\155\x65" => $attr_name, "\151\163\x5f\x75\163\145" => $is_use, "\x73\x6f\162\164" => $sort, "\x61\164\x74\x72\x5f\151\x64" => 0, "\166\x61\x6c\165\x65" => $value_string, "\143\x61\x74\145\x5f\151\x64" => $cate_id, "\x6d\x63\x68\137\151\144" => $mch_id); goto N0j2m; h7Khb: $attr_value_id = $attribute->attr_value_id; goto geilf; N0j2m: $attribute->save($data); goto h7Khb; geilf: $attribute->commit(); goto pVoUX; PSITG: } catch (\Exception $e) { $attribute->rollback(); return $e->getMessage(); } goto p3nso; p3nso: } public function updateAttributeService($attr_id, $attr_name, $is_use, $attr_value_str, $sort, $cate_id) { goto WZCB1; WZCB1: $attribute = new GoodsAttrValue(); goto LEia0; Yy_ls: try { goto ePMkA; GP3wK: $res = $attribute->save($data, ["\141\x74\x74\162\x5f\x76\x61\x6c\x75\x65\x5f\151\x64" => $attr_id]); goto ylRnf; ylRnf: $attribute->commit(); goto adKia; ePMkA: $data = array("\x61\x74\x74\162\137\x76\141\154\165\145\x5f\156\x61\x6d\x65" => $attr_name, "\x69\x73\x5f\165\163\x65" => $is_use, "\x76\x61\x6c\165\x65" => $attr_value_str, "\x73\157\x72\x74" => $sort, "\143\141\x74\145\137\151\x64" => $cate_id); goto GP3wK; adKia: return $res; goto X27lN; X27lN: } catch (\Exception $e) { $attribute->rollback(); return $e->getMessage(); } goto xsMNA; LEia0: $attribute->startTrans(); goto Yy_ls; xsMNA: } public function addAttributeValueService($attr_id, $attr_value_name, $sort, $value) { goto WQnXn; Ou1cq: return $attribute_value->attr_value_id; goto vp93u; p1N4z: $attribute_value->save($data); goto Ou1cq; WQnXn: $attribute_value = new GoodsAttrValue(); goto rJXrt; rJXrt: $data = array("\141\x74\x74\x72\x5f\151\x64" => $attr_id, "\141\x74\x74\x72\x5f\x76\141\154\165\145\x5f\x6e\141\155\x65" => $attr_value_name, "\164\x79\160\x65" => 3, "\x73\x6f\x72\164" => $sort, "\166\141\x6c\x75\x65" => $value); goto p1N4z; vp93u: } public function getAttributeModServiceList($condition = '', $field = "\x2a", $order = '') { goto DUI5C; DUI5C: $attribute = new GoodsAttrModule(); goto y9x2_; xmsDS: MGMh8: goto vhwD0; acVOv: kWEXz: goto xmsDS; y9x2_: $attribute_value = new GoodsAttrValue(); goto PA0AK; PA0AK: $list = $attribute->getQuerys($condition, $field, $order); goto WdJf7; vhwD0: return $list; goto HXpzx; Ahqz4: foreach ($list as $k => $v) { goto YgOpv; k1il2: foreach ($new_array as $kn => $vn) { $value_str = $value_str . "\54" . $vn["\141\164\164\x72\x5f\x76\141\x6c\165\145\x5f\156\x61\x6d\x65"]; hWEjv: } goto GrMp8; YgOpv: $new_array = $attribute_value->getQuerys(["\141\164\164\162\x5f\x69\x64" => $v["\x61\164\164\162\x5f\x69\x64"]], "\x61\x74\164\x72\137\x76\x61\154\165\x65\137\156\141\155\145", ''); goto E6K55; GrMp8: heNcX: goto M11VZ; TV4dk: $list[$k]["\166\141\x6c\165\145\x5f\x73\164\162"] = $value_str; goto ElP7j; ElP7j: ygshf: goto OcF7L; E6K55: $value_str = ''; goto k1il2; M11VZ: $value_str = substr($value_str, 1); goto TV4dk; OcF7L: } goto acVOv; WdJf7: if (empty($list)) { goto MGMh8; } goto Ahqz4; HXpzx: } public function getAttributeServiceList($condition = '', $search_text = '') { goto xmV8g; ZI9qp: return $list; goto ljrM6; xmV8g: $attribute_value = new GoodsAttrValue(); goto msvhc; msvhc: $list = $attribute_value->getPageLisy($condition, $search_text); goto ZI9qp; ljrM6: } public function getAttributeServiceAll($condition = '', $field = "\52", $order = '') { goto g4jQ9; T595d: $list = $attribute_value->getQuerys($condition, $field, $order); goto iD6ck; g4jQ9: $attribute_value = new GoodsAttrValue(); goto T595d; iD6ck: return $list; goto SymJc; SymJc: } public function getAttributeServiceListSelect($condition = '', $search_text = '', $order = '') { goto RPZN9; UXybJ: a4lwK: goto MT4BZ; fLACR: G27mV: goto ASqFh; yxQYE: return $list; goto u3aef; USyuu: foreach ($list as $k => $v) { goto z1PH0; Gyftg: $list[$k]["\x76\x61\154\165\145\137\163\x74\162"] = $value_str; goto v7PrR; vLdYC: foreach ($attr_value_array as $kn => $vn) { goto MUfSM; baWjQ: $value_str = $value_str . "\x2c" . $attr_array["\141\x74\164\162\x5f\166\141\154\165\145\x5f\x6e\141\x6d\145"]; goto PrfBP; PrfBP: nlo07: goto LuD_K; MUfSM: $attr_array = $attribute_value->getInfo(["\141\164\164\x72\x5f\166\141\x6c\x75\x65\137\x69\x64" => $vn], "\141\x74\164\x72\x5f\166\x61\x6c\165\x65\x5f\156\x61\x6d\145", ''); goto baWjQ; LuD_K: } goto AbJpD; AbJpD: xBDox: goto orC04; z1PH0: $attr_value_array = explode("\54", $v["\x61\164\x74\x72\137\x76\141\x6c\x75\x65\137\x69\144"]); goto YYRA5; orC04: $value_str = substr($value_str, 1); goto Gyftg; YYRA5: $value_str = ''; goto vLdYC; v7PrR: WA2Nx: goto tddKV; tddKV: } goto fLACR; ogB8v: $attribute_value = new GoodsAttrValue(); goto SFh1E; ASqFh: foreach ($list as $k => $v) { goto SKXdf; HVm2k: rzksV: goto WMZMk; om2YT: foreach ($spec_value_array as $key => $value) { goto sSz7x; U2mxx: $spec_str = $spec_str . "\54" . $spec_array["\x73\160\x65\143\x5f\x6e\141\155\x65"]; goto J_dkj; J_dkj: jnLli: goto Y4OI9; sSz7x: $spec_array = $spec->getInfo(["\163\160\145\x63\x5f\x69\x64" => $value], "\163\x70\x65\x63\137\x6e\141\x6d\x65", ''); goto U2mxx; Y4OI9: } goto HVm2k; SKXdf: $spec_value_array = explode("\54", $v["\163\x70\145\x63\137\151\x64\x5f\141\162\162\141\171"]); goto Tzys0; YfpZG: $list[$k]["\x73\160\145\143\137\166\x61\154\x75\145\x5f\x73\x74\x72"] = $spec_str; goto SpAXI; SpAXI: R2L1y: goto eTAsg; Tzys0: $spec_str = ''; goto om2YT; WMZMk: $spec_str = substr($spec_str, 1); goto YfpZG; eTAsg: } goto UXybJ; SFh1E: $spec = new GoodsSpec(); goto y95S4; RPZN9: $attribute = new GoodsAttrModule(); goto ogB8v; IxevI: if (empty($list)) { goto NYwhv; } goto USyuu; MT4BZ: NYwhv: goto yxQYE; y95S4: $list = $attribute->getPageLisy($condition, $search_text, $order = ''); goto IxevI; u3aef: } public function getAttributeServiceDetail($attr_id, $condition = '') { goto wh7ds; qxvBy: $info = $attribute->get($attr_id); goto sJcxL; yt2Dg: $info["\145\170\160"] = $exp; goto wlu0C; wlu0C: return $info; goto Dk4Df; wh7ds: $attribute = new GoodsAttrValue(); goto qxvBy; sJcxL: $exp = explode("\54", $info["\166\141\154\x75\x65"]); goto yt2Dg; Dk4Df: } public function deleteAttributeValueService($attr_id, $attr_value_id) { goto xf4Oz; xf4Oz: $attribute_value = new GoodsAttrValue(); goto gIbDN; nv2ag: rzgSs: goto h7Q8Z; NMdA1: ipsf2: goto m7wf3; h7Q8Z: return -2; goto NMdA1; VNRXj: if ($result == 1) { goto rzgSs; } goto l9V5g; gIbDN: $result = $this->getGoodsAttrValueCount(["\141\x74\164\x72\x5f\x69\x64" => $attr_id]); goto VNRXj; l9V5g: return $attribute_value->destroy($attr_value_id); goto ERZOk; ERZOk: goto ipsf2; goto nv2ag; m7wf3: } public function deleteAttributeService($attr_id) { goto rQ_Tp; a4GrX: $res = $attribute_value->destroy(["\x61\164\164\162\137\166\141\154\165\145\137\151\x64" => $attr_id]); goto oiL_T; rQ_Tp: $attribute_value = new GoodsAttrValue(); goto a4GrX; oiL_T: return $res; goto DPxx0; DPxx0: } public function getGoodsAttrValueCount($condition) { goto WH0H_; iWXjf: return $count; goto inByO; WH0H_: $attr_value = new GoodsAttrValue(); goto hAqmC; hAqmC: $count = $attr_value->where($condition)->count(); goto iWXjf; inByO: } public function getAttributeValueServiceList($condition = '', $field = "\52", $order = '') { $attribute_value = new GoodsAttrValue(); return $attribute_value->getQuerys($condition, $field, $order); } public function getAttributeInfo($condition) { goto F6xHw; gzOS6: $info = $attribute->getInfo($condition, "\x2a"); goto AaXYc; F6xHw: $attribute = new GoodsAttrModule(); goto gzOS6; AaXYc: return $info; goto mxWLp; mxWLp: } public function getSpecInfo($condition) { goto pmmfH; DU1hf: return $info; goto PgntZ; zeJeR: $info = $attribute->getInfo($condition, "\52"); goto DU1hf; pmmfH: $attribute = new GoodsSpecValue(); goto zeJeR; PgntZ: } public function getGoodsSpecQuery($condition) { goto pIQ46; pIQ46: $goods_spec = new GoodsSpec(); goto kGaA1; lVjES: VCH0C: goto jaBGV; kGaA1: $goods_spec_query = $goods_spec->getQuerys($condition, "\x2a", "\163\x6f\162\x74"); goto yPGAa; yPGAa: foreach ($goods_spec_query as $k => $v) { goto liLlI; liLlI: $goods_spec_value = new GoodsSpecValue(); goto bieLU; tMNAt: $goods_spec_query[$k]["\x76\x61\154\165\145\163"] = $goods_spec_value_query; goto ZACnS; bieLU: $goods_spec_value_query = $goods_spec_value->getQuerys(["\x73\x70\x65\143\137\151\x64" => $v["\x73\x70\145\x63\x5f\151\144"]], "\52", ''); goto tMNAt; ZACnS: Khss0: goto rN17r; rN17r: } goto lVjES; jaBGV: return $goods_spec_query; goto fBr6L; fBr6L: } public function addGoodsSpecValue($spec_id, $spec_value, $sort = 0) { goto sjN5v; pSPAb: return $find_id["\x73\x70\x65\143\x5f\166\141\154\165\145\137\151\144"]; goto p9rz1; MV7Tr: $res = $spec_value_model->save($data); goto rK4a7; fPKBT: $data = array("\163\160\145\143\137\151\144" => $spec_id, "\163\160\x65\x63\137\166\x61\x6c\165\145\x5f\x6e\x61\155\145" => $spec_value, "\x73\x6f\162\x74" => $sort, "\143\x72\145\x61\164\x65\x5f\164\151\155\x65" => time()); goto QDo61; p9rz1: iFHWO: goto ElFBd; VJlaz: goto iFHWO; goto p60DV; p60DV: g4Eid: goto pSPAb; rK4a7: return $spec_value_model->spec_value_id; goto VJlaz; sjN5v: $spec_value_model = new GoodsSpecValue(); goto fPKBT; QDo61: $find_id = $spec_value_model->get(["\163\x70\x65\x63\x5f\166\x61\154\x75\145\137\x6e\x61\155\x65" => $spec_value, "\x73\x70\x65\143\137\151\x64" => $spec_id]); goto h51ed; h51ed: if (!empty($find_id)) { goto g4Eid; } goto MV7Tr; ElFBd: } public function getGoodsAttrSpecQuery($condition) { goto QcCeT; Oecca: Phh8T: goto Crn_z; AQVpp: return -1; goto Oecca; xncuh: $list["\x61\164\164\162\x69\x62\x75\164\145\x5f\x6c\151\x73\164"] = $attribute_list; goto En2SK; Crn_z: $goods_attribute = $this->getAttributeInfo($condition); goto XuK0Z; ks5MC: $spec_list = $this->getGoodsSpecQuery($condition_spec); goto RoTSr; Am2iO: $condition_spec["\x69\x73\x5f\166\151\x73\x69\142\154\x65"] = 1; goto ks5MC; Cxsio: JqWcE: goto lLCDf; lLCDf: $list["\163\x70\145\x63\137\154\x69\x73\x74"] = $spec_list; goto xncuh; RoTSr: $attribute_detail = $this->getAttributeServiceInfo($condition["\x61\x74\x74\162\x5f\151\144"], ["\151\x73\137\x73\x65\x61\162\143\150" => 1]); goto nXG9U; nXG9U: $attribute_list = $attribute_detail["\166\x61\154\x75\145\137\x6c\x69\x73\x74"]; goto gmt9K; En2SK: return $list; goto rnAlM; gmt9K: foreach ($attribute_list as $k => $v) { goto w9h1J; HKuVg: $attribute_list[$k]["\x76\x61\154\165\x65\137\151\x74\x65\x6d\163"] = $value_items; goto dCa5G; dCa5G: kSp9y: goto L1tLc; w9h1J: $value_items = explode("\54", $v["\166\141\154\165\x65"]); goto HKuVg; L1tLc: } goto Cxsio; QcCeT: if (!($condition["\x61\x74\164\162\137\151\x64"] == 0)) { goto Phh8T; } goto AQVpp; XuK0Z: $condition_spec["\x73\x70\x65\143\137\151\x64"] = array("\151\x6e", $goods_attribute["\x73\160\145\x63\x5f\151\x64\x5f\x61\x72\x72\x61\x79"]); goto Am2iO; rnAlM: } public function getAttributeServiceInfo($attr_id, $condition = '') { goto u1k3i; ELhmA: $array = $this->getAttributeValueServiceList($condition, $field = "\x2a", $order = ''); goto iZbcu; iZbcu: $info["\166\x61\x6c\x75\145\x5f\x6c\x69\163\164"] = $array; goto TcbzX; wtvOV: $condition["\x61\x74\x74\x72\137\x76\x61\154\x75\x65\137\151\144"] = array("\x69\156", $info["\x61\164\x74\x72\137\166\x61\154\165\145\x5f\151\x64"]); goto ELhmA; FFte4: if (empty($info)) { goto guxE4; } goto wtvOV; u1k3i: $attribute = new GoodsAttrModule(); goto TyX_0; TyX_0: $info = $attribute->get($attr_id); goto G03Vh; TcbzX: guxE4: goto hYoCE; G03Vh: $array = array(); goto zHkzq; zHkzq: $condition = array(); goto FFte4; hYoCE: return $info; goto msB_y; msB_y: } private function getGoodsCategoryId($category_id) { goto jVwEs; HuN96: if (!($info["\x6c\x65\x76\145\x6c"] == 3)) { goto Cs6Ex; } goto eEzqZ; OYdSs: if (!($info["\x6c\x65\166\x65\x6c"] == 1)) { goto mkCaU; } goto m2BIO; sW3NV: mkCaU: goto wWuDb; U89TY: return array($info["\160\x69\144"], $category_id, 0); goto ODKDH; eEzqZ: $info_parent = $goods_category->get($info["\x70\151\x64"]); goto TyaUv; jVwEs: $goods_category = new \app\common\model\GoodsCate(); goto Lo6Dq; ODKDH: GAdwZ: goto HuN96; TyaUv: return array($info_parent["\160\151\x64"], $info["\160\151\x64"], $category_id); goto EUPEE; wWuDb: if (!($info["\x6c\145\166\x65\x6c"] == 2)) { goto GAdwZ; } goto U89TY; Lo6Dq: $info = $goods_category->get($category_id); goto OYdSs; EUPEE: Cs6Ex: goto kV5HP; m2BIO: return array($category_id, 0, 0); goto sW3NV; kV5HP: } public function addOrEditGoods($this_lib, $mch_id, $goods_id, $goods_name, $category_id, $supplier_id, $brand_id, $market_price, $price, $cost_price, $shipping_fee, $shipping_fee_id, $stock, $min_buy, $max_buy, $clicks, $sales, $picture, $keywords, $introduction, $description, $sort, $image_array, $sku_array, $state, $goods_attribute_id, $goods_attribute, $goods_spec_format, $sku_picture_values, $barcode, $weight, $goods_type) { goto YE_L0; z6KTL: $this->goods->startTrans(); goto kmF79; kmF79: try { goto E0AEv; MT1Mo: $count = $goods_sku->getCount(["\147\157\157\x64\x73\x5f\151\x64" => $goods_id]); goto oLoP1; EOVkx: $goods_id = $this->goods->goods_id; goto GRX4i; n2gvd: $this->spec_format($goods_id, $spce); goto z3cPJ; jFJyO: goto ybxs7; goto cmSyL; z3cPJ: if (!empty($sku_array)) { goto AUrq8; } goto hrakr; E0AEv: $data_goods = array("\x67\x6f\157\x64\163\137\156\x61\155\x65" => $goods_name, "\143\x61\164\x65\x5f\x69\x64" => $category_id, "\x73\165\160\x70\154\151\145\x72\137\x69\x64" => $supplier_id, "\x62\162\x61\x6e\x64\137\151\x64" => $brand_id, "\x6d\141\162\x6b\x65\164\137\160\x72\151\143\x65" => $market_price, "\x70\x72\151\x63\x65" => $price, "\x70\162\157\155\157\x74\x69\157\156\x5f\160\x72\x69\143\x65" => $price, "\143\x6f\163\x74\137\x70\x72\151\143\x65" => $cost_price, "\x73\x68\x69\160\x70\x69\156\x67\x5f\x66\145\145" => $shipping_fee, "\x73\150\151\x70\x70\x69\x6e\x67\137\146\145\x65\x5f\151\144" => $shipping_fee_id, "\x73\164\x6f\x63\153" => $stock, "\x6d\x69\156\137\142\x75\x79" => $min_buy, "\x6d\141\x78\137\142\x75\x79" => $max_buy, "\x63\154\151\x63\153\x73" => $clicks, "\163\x61\154\145\163" => $sales, "\x6b\145\171\167\x6f\162\x64\x73" => $keywords, "\x69\156\x74\162\157\x64\165\x63\164\151\x6f\156" => $introduction, "\x64\x65\x73\x63\x72\x69\160\x74\x69\x6f\156" => $description, "\x73\x6f\162\164" => $sort, "\x69\x6d\141\x67\145\x73" => $picture, "\x69\x6d\147\137\151\x64\137\x61\x72\162\x61\171" => $image_array, "\x73\x74\141\x74\x65" => $state, "\147\157\157\144\163\x5f\x61\x74\x74\162\x69\142\165\x74\145\x5f\151\x64" => $goods_attribute_id, "\147\157\x6f\x64\x73\x5f\141\x74\x74\162\151\142\x75\x74\x65" => $goods_attribute, "\147\157\x6f\x64\163\137\x73\160\145\143\137\x66\157\162\155\141\164" => $goods_spec_format, "\x6d\143\x68\137\x69\x64" => $mch_id, "\x62\141\162\x63\157\x64\145" => $barcode, "\167\x65\151\147\150\x74" => $weight, "\147\157\157\x64\163\x5f\164\171\x70\x65" => $goods_type); goto U_mzP; U_mzP: $spce = json_decode($goods_spec_format, true); goto MxEWG; njcff: $ismain_id = ''; goto MOMGH; oLoP1: if ($count > 0) { goto Rw0g0; } goto NvKq5; INJJk: $this->goods->save($data_goods); goto EOVkx; MOMGH: $sku_imgs = array(); goto wt_8l; zvxM8: if (!($this_lib == 1 && $goods_id == 0)) { goto jMEhr; } goto WwI3U; zRNqk: iNmSd: goto jmw03; MvU1d: $this->goods->save($data_goods); goto pm_hN; JAIW2: $res = $goods_sku->save($sku_data); goto Do185; Y5fSR: if (!empty($sku_array)) { goto MjP5z; } goto roabH; ekrIE: foreach ($sku_list_array as $k => $v) { goto LaDEB; i4EXH: $error = 1; goto lFu0m; f7bsZ: kVafa: goto RdpyQ; thuZe: if ($res) { goto e2PeK; } goto i4EXH; lFu0m: e2PeK: goto f7bsZ; gE2rW: $res = $this->addOrUpdateGoodsSkuItem($goods_id, $v, $img_ids, $sku_picture_array); goto thuZe; kn_in: r1NA1: goto gE2rW; js9E0: foreach ($sku_imgs as $img_k => $img_v) { goto Rh1xS; Rh1xS: if (!strpos($v, $img_k)) { goto m6V1P; } goto ltO0v; r6LEE: goto r1NA1; goto eGypg; eGypg: m6V1P: goto TFE0y; TFE0y: YUJDR: goto QsSfG; ltO0v: $img_ids = $img_v; goto r6LEE; QsSfG: } goto kn_in; LaDEB: $img_ids = ''; goto js9E0; RdpyQ: } goto BoUpZ; ATebU: $this->goods->rollback(); goto ZYQ2q; mCuLV: aEBIp: goto dr578; Zkp2Z: $res = $goods_sku->save($sku_data, ["\x67\x6f\x6f\x64\x73\x5f\151\144" => $goods_id]); goto wUYPn; CQTVI: if (!($goods_id > 0 && $this_lib == 0)) { goto aEBIp; } goto m2H5X; vqVTB: Enj3s: goto nXgkt; GRX4i: $this->spec_format($goods_id, $spce); goto ujybJ; FyGV3: jMEhr: goto CQTVI; cmSyL: AUrq8: goto NvSfb; ZYQ2q: return 0; goto XnQpg; YqfqX: FNVWm: goto hIt1y; oXkFj: Rw0g0: goto CNixB; C5WPZ: $data_goods["\147\x6f\157\x64\163\137\163\x70\x65\x63\x5f\146\x6f\162\155\x61\164"] = json_encode($spce, true); goto UD1Im; hrakr: $sku_data = array("\147\x6f\157\x64\x73\137\x69\144" => $goods_id, "\163\x6b\165\x5f\x6e\141\155\x65" => '', "\x6d\141\x72\x6b\145\164\x5f\x70\x72\x69\143\x65" => $market_price, "\160\x72\151\143\x65" => $price, "\160\162\157\155\x6f\x74\x65\137\160\162\x69\x63\x65" => $price, "\x63\x6f\x73\164\x5f\160\x72\x69\143\x65" => $cost_price, "\x73\x74\157\143\153" => $stock, "\151\155\x61\x67\145\163" => 0, "\165\x70\x64\141\164\x65\x5f\x64\x61\164\145" => time()); goto qaPrx; mWHU3: foreach ($sku_list_array as $k => $v) { goto NcB4T; oPk3U: ZZy4n: goto t0Edf; NcB4T: $img_ids = ''; goto ayHuA; iH4zk: $error = 1; goto X0y5W; Oeto_: PUtYt: goto QZ1hj; ayHuA: foreach ($sku_imgs as $img_k => $img_v) { goto FF_JE; xxUyU: mnF9U: goto QuRcu; QuRcu: orpHW: goto vaHqe; FF_JE: if (!strpos($v, $img_k)) { goto mnF9U; } goto Db5Bj; TzPmR: goto ZZy4n; goto xxUyU; Db5Bj: $img_ids = $img_v; goto TzPmR; vaHqe: } goto oPk3U; X0y5W: tmwB0: goto Oeto_; t0Edf: $res = $this->addOrUpdateGoodsSkuItem($goods_id, $v, $img_ids, $sku_picture_array); goto mbmaT; mbmaT: if ($res) { goto tmwB0; } goto iH4zk; QZ1hj: } goto vqVTB; ytyrQ: $data_goods["\163\141\154\x65\x5f\144\141\x74\145"] = time(); goto MvU1d; KLuOk: $sku_list_array = explode("\xc2\xa7", $sku_array); goto ekrIE; dZmSx: $error = 1; goto XhrFO; GmI5V: TnG1e: goto sFPoj; ynaJr: wTeZg: goto zvxM8; eXr0X: foreach ($spce as &$sku_item) { goto YK1k3; b0Inp: foreach ($sku_item["\166\141\x6c\x75\145"] as &$sku_value) { goto Bn9TZ; Bn9TZ: $sk = $sku_value["\163\x70\145\143\x5f\x69\x64"] . "\72" . $sku_value["\163\x70\x65\143\x5f\166\141\154\x75\x65\x5f\x69\x64"]; goto x5zx8; rJyyI: p03sF: goto ZNnBj; c4K_w: hZBrr: goto ZZS85; qV9rr: unset($sku_value["\x69\155\x61\x67\x65\163"]); goto d0QFl; d0QFl: goto P1J52; goto c4K_w; WO2AA: P1J52: goto rJyyI; ZZS85: $sku_value["\151\155\141\147\145\163"] = $sku_imgs[$sk]; goto WO2AA; x5zx8: if (isset($sku_imgs[$sk])) { goto hZBrr; } goto qV9rr; ZNnBj: } goto Q0Xtd; grIwm: goto HNlLN; goto ANf6t; Q0Xtd: d1WBy: goto VDH41; jKRCw: unset($sku_item["\151\163\x6d\x61\151\x6e"]); goto grIwm; cxuKn: $sku_item["\151\163\x6d\x61\x69\x6e"] = true; goto AcqKq; YK1k3: if ($sku_item["\163\160\145\x63\x5f\x69\144"] == $ismain_id) { goto lD1Q4; } goto jKRCw; VDH41: BWWjB: goto lFWEw; AcqKq: HNlLN: goto b0Inp; ANf6t: lD1Q4: goto cxuKn; lFWEw: } goto NR7ue; NvKq5: $res = $goods_sku->save($sku_data); goto zI2QP; MxEWG: $sku_picture_array = json_decode($sku_picture_values, true); goto njcff; kgpE2: $res = $goods_sku->save($sku_data); goto LlJlf; oiYah: return $goods_id; goto G1CjP; MSW9H: $sku_data = array("\147\157\x6f\144\163\x5f\x69\144" => $goods_id, "\x73\153\x75\137\156\x61\155\x65" => '', "\155\141\x72\153\145\164\137\x70\162\151\143\x65" => $market_price, "\x70\162\151\x63\145" => $price, "\160\x72\x6f\x6d\x6f\x74\145\x5f\x70\162\x69\143\x65" => $price, "\x63\157\x73\x74\137\x70\162\x69\x63\x65" => $cost_price, "\x73\164\157\143\153" => $stock, "\151\155\x61\x67\x65\163" => 0, "\143\x72\x65\x61\164\x65\137\144\141\164\145" => time()); goto JAIW2; zI2QP: goto CQreu; goto oXkFj; G1CjP: hEi1A: goto bgo3l; oYmx1: $sku_data = array("\x67\157\x6f\x64\163\x5f\151\144" => $goods_id, "\x73\153\165\x5f\156\x61\155\x65" => '', "\x6d\141\162\153\145\164\137\x70\x72\151\143\145" => $market_price, "\x70\x72\x69\143\x65" => $price, "\x70\x72\x6f\x6d\157\x74\x65\x5f\160\162\x69\x63\145" => $price, "\x63\157\x73\164\x5f\160\162\151\143\145" => $cost_price, "\x73\x74\157\143\x6b" => $stock, "\151\x6d\x61\147\145\x73" => 0, "\x63\162\x65\141\x74\145\x5f\144\x61\164\145" => time()); goto kgpE2; UD1Im: if (!($this_lib == 1 && $goods_id != 0)) { goto wTeZg; } goto uCNSf; XmCRB: MjP5z: goto KLuOk; NvSfb: $sku_list_array = explode("\xc2\xa7", $sku_array); goto ugoRr; XnQpg: goto hEi1A; goto YqfqX; XIo8h: cO6fZ: goto IMXWI; uCNSf: $data_goods["\143\162\x65\x61\164\x65\x5f\164\151\x6d\x65"] = time(); goto Mu0Gy; pm_hN: $goods_id = $this->goods->goods_id; goto iYuOB; jmw03: $sku_list_array = explode("\302\xa7", $sku_array); goto QXUfN; SNTe1: $error = 1; goto GmI5V; x5qfm: k3u7w: goto eXr0X; XhrFO: HVKBA: goto qXIUf; wUYPn: CQreu: goto jFJyO; hIt1y: $this->goods->commit(); goto oiYah; qXIUf: goto h6vHX; goto zRNqk; roabH: $goods_sku = new GoodsSku(); goto oYmx1; qaPrx: $goods_sku = new GoodsSku(); goto MT1Mo; ebkwX: $goods_sku = new GoodsSku(); goto MSW9H; LlJlf: if ($res) { goto TnG1e; } goto SNTe1; Mu0Gy: $data_goods["\163\x61\154\x65\x5f\144\x61\x74\145"] = time(); goto INJJk; dr578: if ($error == 0) { goto FNVWm; } goto ATebU; ugoRr: $this->deleteSkuItem($goods_id, $sku_list_array); goto mWHU3; NR7ue: OcizY: goto C5WPZ; CNixB: $retval = $goods_sku->destroy(["\x67\157\x6f\x64\x73\x5f\151\x64" => $goods_id, "\x61\x74\164\x72\137\x76\141\x6c\x75\x65\x5f\x69\164\x65\155\x73" => array("\116\x45\121", '')]); goto Zkp2Z; aP_zs: JM6Td: goto FyGV3; nXgkt: ybxs7: goto mCuLV; WwI3U: $data_goods["\x63\x72\x65\x61\x74\x65\137\164\151\155\145"] = time(); goto ytyrQ; IMXWI: h6vHX: goto ynaJr; BoUpZ: Iq6Pa: goto aP_zs; w4Puj: $res = $this->goods->save($data_goods, ["\147\x6f\x6f\144\x73\137\x69\x64" => $goods_id]); goto n2gvd; sFPoj: goto JM6Td; goto XmCRB; Do185: if ($res) { goto HVKBA; } goto dZmSx; iYuOB: $this->spec_format($goods_id, $spce); goto Y5fSR; wt_8l: foreach ($sku_picture_array as $sku_img) { goto sCjaS; K0ngj: $img_k = $sku_img["\x73\160\145\143\137\151\144"] . "\x3a" . $sku_img["\x73\x70\x65\143\137\x76\x61\x6c\x75\145\x5f\x69\144"]; goto PFxBT; USQi0: vbk86: goto dS6Qn; sCjaS: $ismain_id = $sku_img["\x73\x70\x65\143\137\151\x64"]; goto K0ngj; PFxBT: $sku_imgs[$img_k] = $sku_img["\x69\x6d\147\x5f\x69\144\163"]; goto USQi0; dS6Qn: } goto x5qfm; QXUfN: foreach ($sku_list_array as $k => $v) { goto XQIOg; hk9z5: if ($res) { goto MHnOu; } goto lW8OL; jfBan: foreach ($sku_imgs as $img_k => $img_v) { goto k2ebV; Nyi_f: bbZn7: goto srfUm; Dmc08: goto JwGlE; goto Nyi_f; k2ebV: if (!strpos($v, $img_k)) { goto bbZn7; } goto XMsEk; srfUm: F4CkC: goto RhP0z; XMsEk: $img_ids = $img_v; goto Dmc08; RhP0z: } goto cX41G; cX41G: JwGlE: goto HABVN; HABVN: $res = $this->addOrUpdateGoodsSkuItem($goods_id, $v, $img_ids, $sku_picture_array); goto hk9z5; XQIOg: $img_ids = ''; goto jfBan; vf0cd: MHnOu: goto CAM7g; lW8OL: $error = 1; goto vf0cd; CAM7g: UIucZ: goto fB9CK; fB9CK: } goto XIo8h; ujybJ: if (!empty($sku_array)) { goto iNmSd; } goto ebkwX; m2H5X: $data_goods["\165\x70\x64\x61\x74\145\x5f\x74\151\x6d\x65"] = time(); goto w4Puj; bgo3l: } catch (\Exception $e) { $this->goods->rollback(); return $e->getMessage(); } goto S0Kr9; YE_L0: $error = 0; goto z6KTL; S0Kr9: } public function spec_format($goods_id, $spec_list) { foreach ($spec_list as $k => $v) { goto W36tr; W36tr: foreach ($v["\166\x61\154\x75\145"] as $x => $y) { goto wHTUt; X5tzz: YKqoT: goto H_rJ6; OH4ME: eYZTO: goto k23vu; wHTUt: $sku_form = new GoodsSpecFormat(); goto kThYJ; k23vu: $sku_form->save($data, ["\151\x64" => $check["\x69\144"]]); goto X5tzz; Jt5Y6: $check = Db::name("\x79\x62\x73\x63\137\x67\x6f\157\x64\x73\137\x73\160\145\143\x5f\x66\x6f\162\155\141\164")->where($data)->find(); goto n0FIi; n0FIi: if ($check) { goto eYZTO; } goto iqSze; H_rJ6: dYysI: goto XGYfM; iqSze: $sku_form->save($data); goto mZ9YK; kThYJ: $data = array("\147\x6f\x6f\144\x73\x5f\151\144" => $goods_id, "\x73\160\x65\143\137\166\x61\x6c\165\145\137\x6e\x61\155\x65" => $y["\163\160\145\143\x5f\166\141\154\x75\145\x5f\x6e\x61\x6d\145"], "\x73\x70\x65\143\x5f\156\141\x6d\x65" => $y["\163\x70\x65\x63\137\156\x61\155\x65"], "\x73\x70\145\143\137\x69\144" => $y["\x73\x70\x65\143\137\151\x64"], "\x73\x70\x65\143\137\166\x61\154\x75\x65\x5f\x69\x64" => $y["\163\x70\145\x63\137\166\141\x6c\165\x65\x5f\151\144"]); goto Jt5Y6; mZ9YK: goto YKqoT; goto OH4ME; XGYfM: } goto a8UpJ; yVlzI: QikuM: goto Pf0mP; a8UpJ: H2G3Q: goto yVlzI; Pf0mP: } ybMmx: } private function deleteSkuItem($goods_id, $sku_list_array) { goto yAkH9; yAkH9: $sku_item_list_array = array(); goto qHVU4; MK40k: PXh75: goto uSPnS; uSPnS: ySRjb: goto l4vi4; d2OiI: foreach ($list as $k => $v) { goto Xr0Qr; Bedx1: RJc5q: goto T73nv; TD0bZ: $goods_sku->destroy($v["\x73\x6b\x75\x5f\x69\x64"]); goto t3Mm8; Xr0Qr: if (in_array($v["\141\164\164\x72\x5f\x76\x61\154\165\x65\x5f\151\x74\x65\155\163"], $sku_item_list_array)) { goto PE3E7; } goto TD0bZ; t3Mm8: PE3E7: goto Bedx1; T73nv: } goto MK40k; IH8Zc: if (empty($list)) { goto ySRjb; } goto d2OiI; Cejid: $list = $goods_sku->where("\147\157\157\x64\163\137\x69\144\75" . $goods_id)->select(); goto IH8Zc; qRyms: t1wO_: goto eFVIT; qHVU4: foreach ($sku_list_array as $k => $sku_item_array) { goto p8Sy2; OoOMF: $sku_item_list_array[] = $sku_item[0]; goto RyKKL; RyKKL: lCVdq: goto YEpBU; p8Sy2: $sku_item = explode("\xc2\xa6", $sku_item_array); goto OoOMF; YEpBU: } goto qRyms; eFVIT: $goods_sku = new GoodsSku(); goto Cejid; l4vi4: } public function addGoodsSkuPicture($goods_id, $sku_img_array) { goto OfJzj; OfJzj: $goods_sku_picture = new GoodsSku(); goto lpHP0; emON_: $retval = $goods_sku_picture->save($data); goto LrMC0; lpHP0: $data = array("\147\157\x6f\x64\163\x5f\151\144" => $goods_id, "\151\x6d\141\147\145\x73" => $sku_img_array); goto emON_; LrMC0: return $retval; goto IjYji; IjYji: } private function addOrUpdateGoodsSkuItem($goods_id, $sku_item_array, $img_ids, $img_arr) { goto a1IFP; IMwuc: goto nTqxV; goto IZUSo; p9swj: $data = array("\x67\157\x6f\144\x73\137\151\144" => $goods_id, "\x73\153\165\137\x6e\x61\x6d\x65" => $sku_name, "\141\164\x74\x72\x5f\x76\141\154\165\145\137\x69\164\145\155\x73" => $sku_item[0], "\160\x72\151\x63\x65" => $sku_item[1], "\x70\x72\x6f\x6d\157\164\145\137\x70\x72\x69\x63\145" => $sku_item[1], "\x6d\x61\x72\153\145\164\x5f\x70\x72\x69\x63\145" => $sku_item[2], "\143\x6f\x73\164\137\x70\x72\x69\x63\145" => $sku_item[3], "\x73\164\x6f\143\153" => $sku_item[4], "\x69\x6d\141\147\145\x73" => $img_ids, "\x63\162\145\x61\x74\145\x5f\144\141\x74\145" => time()); goto pX29A; EHIt7: DZKIR: goto wmf3B; EZGz5: if (!$aa) { goto DZKIR; } goto ah9Kk; IZUSo: yhQK7: goto p9swj; P7e2P: if (empty($sku_count)) { goto yhQK7; } goto L12UY; wmf3B: orvWJ: goto GzEki; o3Oql: if (!(!empty($sku_item[0]) && !empty($img_arr))) { goto orvWJ; } goto j1iZE; pX29A: $goods_sku->save($data); goto MPSx0; L12UY: $data = array("\x67\157\x6f\x64\163\x5f\151\144" => $goods_id, "\x73\x6b\x75\x5f\156\141\155\145" => $sku_name, "\160\162\151\x63\145" => $sku_item[1], "\160\162\157\155\x6f\x74\145\x5f\x70\x72\151\x63\145" => $sku_item[1], "\155\141\x72\x6b\145\164\x5f\160\162\151\143\145" => $sku_item[2], "\143\157\x73\164\x5f\160\x72\151\143\145" => $sku_item[3], "\x73\164\x6f\143\x6b" => $sku_item[4], "\x69\155\x61\x67\145\163" => $img_ids, "\165\x70\x64\x61\164\x65\137\x64\x61\x74\x65" => time()); goto os3wS; TN64O: $sku_name = $this->createSkuName($sku_item[0]); goto wt4jA; wt4jA: $condition = array("\147\x6f\x6f\144\x73\x5f\151\144" => $goods_id, "\x61\x74\164\x72\x5f\x76\x61\154\165\145\137\x69\164\145\x6d\x73" => $sku_item[0]); goto o3Oql; gvXap: nTqxV: goto joiJU; GzEki: $sku_count = $goods_sku->where($condition)->find(); goto P7e2P; MPSx0: return $goods_sku->sku_id; goto gvXap; a1IFP: $sku_item = explode("\xc2\xa6", $sku_item_array); goto jArVk; os3wS: $res = $goods_sku->save($data, ["\x73\153\x75\137\151\x64" => $sku_count["\x73\153\x75\x5f\x69\144"]]); goto Wp8FC; ah9Kk: foreach ($aa as $k => $v) { goto WquFo; pMHHd: goto pB9yQ; goto iRi9E; WquFo: $v = explode("\72", $v); goto BX_91; wbU6Y: if (!($img_arr[$i]["\x73\x70\145\143\137\x69\144"] == $v[0] && $img_arr[$i]["\163\x70\x65\x63\x5f\166\x61\154\x75\145\x5f\x69\x64"] == $v[1])) { goto pXyxY; } goto hLkZy; xqN9Q: btXl8: goto CDCng; YY5Lr: pXyxY: goto lqyix; QUDmK: $i++; goto pMHHd; iRi9E: dXKe1: goto xqN9Q; lqyix: awAc_: goto QUDmK; BX_91: $i = 0; goto m73AG; m73AG: pB9yQ: goto V7aDC; hLkZy: $img_ids = $img_arr[$i]["\x69\155\147\137\x69\x64\x73"]; goto YY5Lr; V7aDC: if (!($i < count($img_arr))) { goto dXKe1; } goto wbU6Y; CDCng: } goto IIH1u; IIH1u: TbAIi: goto EHIt7; j1iZE: $aa = explode("\73", $sku_item[0]); goto EZGz5; Wp8FC: return $res; goto IMwuc; jArVk: $goods_sku = new GoodsSku(); goto TN64O; joiJU: } private function createSkuName($pvs) { goto BLeKp; MrTBG: return $name; goto NbIMJ; uXwCs: GZvzH: goto MrTBG; Wsp63: foreach ($pvs_array as $k => $v) { goto oa1jo; pxnk9: $value_name = $goods_spec_value_model->getInfo(["\x73\x70\x65\143\137\166\141\x6c\x75\x65\x5f\151\144" => $prop_value], "\163\x70\x65\x63\137\166\141\x6c\x75\145\137\x6e\141\155\145"); goto kk8L4; TDtnb: $prop_id = $value[0]; goto blx71; oa1jo: $value = explode("\x3a", $v); goto TDtnb; FqsV8: $goods_spec_value_model = new GoodsSpecValue(); goto pxnk9; kk8L4: $name = $name . $value_name["\163\x70\145\143\137\x76\x61\154\x75\145\x5f\x6e\141\155\145"] . "\x20"; goto NKndi; NKndi: x9tL2: goto dIN9Y; blx71: $prop_value = $value[1]; goto FqsV8; dIN9Y: } goto uXwCs; BLeKp: $name = ''; goto OukZ1; OukZ1: $pvs_array = explode("\x3b", $pvs); goto Wsp63; NbIMJ: } public function regainGoodsDeleted($goods_ids) { $this->goods->startTrans(); try { goto Jc1qe; Jc1qe: $data = array("\x69\x73\x5f\x64\x65\154" => 0, "\165\160\x64\141\x74\x65\x5f\x74\151\155\x65" => time()); goto YbD8m; gV2qb: return SUCCESS; goto wMoDP; OORhS: $this->goods->commit(); goto gV2qb; YbD8m: $result = $this->goods->save($data, "\147\x6f\x6f\144\163\137\151\144\x20\40\x69\156\50{$goods_ids}\x29"); goto OORhS; wMoDP: } catch (\Exception $e) { $this->goods->rollback(); return UPDATA_FAIL; } } public function deleteRecycleGoods($goods_id) { goto DlOpx; sCjEu: try { goto TEGM1; TEGM1: $res = $goods_delete->where("\147\x6f\157\144\163\137\151\x64\40\151\156\40\x28{$goods_id}\51\40")->delete(); goto p2YoY; T4ju5: Fyqzf: goto xTqEv; neUQC: K715V: goto sbKnM; lKF2T: if ($res > 0) { goto K715V; } goto Thq5p; Thq5p: return DELETE_FAIL; goto Lc6eE; ajbjc: $goods_sku_model = new GoodsSku(); goto uVK8O; W7WCd: eK5Dm: goto BYCtc; BYCtc: $goods_delete->commit(); goto lKF2T; l7ZXm: foreach ($goods_id_array as $k => $v) { goto YNVcj; AKyoB: $goods_attribute_model->where("\147\157\157\144\163\x5f\151\144\40\x3d\40{$v}")->delete(); goto wB_yV; YNVcj: $goods_sku_model->where("\x67\x6f\x6f\x64\x73\137\151\x64\x20\75\40{$v}")->delete(); goto AKyoB; wB_yV: sVDJX: goto s4ZuX; s4ZuX: } goto SiqjU; p2YoY: if (!($res > 0)) { goto eK5Dm; } goto sIaqw; sbKnM: return SUCCESS; goto T4ju5; Lc6eE: goto Fyqzf; goto neUQC; uVK8O: $goods_attribute_model = new GoodsAttr(); goto l7ZXm; SiqjU: nGnwq: goto W7WCd; sIaqw: $goods_id_array = explode("\54", $goods_id); goto ajbjc; xTqEv: } catch (\Exception $e) { $goods_delete->rollback(); return DELETE_FAIL; } goto j6vn_; DlOpx: $goods_delete = new \app\common\model\Goods(); goto BjiF3; BjiF3: $goods_delete->startTrans(); goto sCjEu; j6vn_: } public function getGoodsDetail($goods_id) { goto zdbY2; l5TC3: $goods_detail["\147\157\x6f\144\x73\137\x61\x74\164\162\x69\x62\165\164\145\x5f\156\x61\x6d\x65"] = ''; goto sOUiX; pdN4r: $goods_detail["\147\x6f\x6f\x64\163\x5f\141\164\x74\162\x69\142\165\x74\145\137\154\x69\163\x74"] = $goods_attribute_list; goto GcpHx; Mc3Ye: nO3pJ: goto dlGyt; tGRdQ: $goods_picture = $goods_img->get($goods_detail["\151\155\141\147\145\163"]); goto cyUux; Pax87: foreach ($goos_sku_picture_query as $k => $v) { goto mr5Aa; j7ruF: $tmp_img_array = $album_picture->getQuerys(["\x69\x6d\147\137\151\x64" => $v["\151\x6d\x61\x67\145\163"]], "\x2a", ''); goto AH8P4; AH8P4: $goos_sku_picture_query[$k]["\163\x6b\x75\137\160\x69\143\164\165\x72\x65\137\161\x75\x65\x72\171"] = $tmp_img_array; goto f4QhG; GUlS5: oNGNF: goto O7RaR; zdmVO: goto J0Q02; goto TcbOE; fyl_h: unset($goos_sku_picture_query[$k]); goto zdmVO; TcbOE: k_UP1: goto j7ruF; f4QhG: J0Q02: goto GUlS5; mr5Aa: if ($v["\151\155\141\147\145\x73"] != "\60") { goto k_UP1; } goto fyl_h; O7RaR: } goto Mc3Ye; Evpt0: goto bOHmE; goto Mtomy; icxx2: return $goods_detail; goto Rw19f; oS2p7: $goods_detail["\x70\x69\x63\x74\165\x72\x65\137\144\x65\164\141\x69\154"] = $goods_picture; goto Da4Tj; U3ike: $goos_sku_picture_query = $goods_sku->getQuerys(["\x67\x6f\157\x64\x73\137\151\x64" => $goods_id], "\x69\155\141\147\x65\x73\54\x61\x74\x74\162\137\166\141\x6c\x75\x65\x5f\151\x74\145\x6d\163", ''); goto OdEQO; hHbdN: foreach ($goods_sku_detail as $k => $goods_sku) { $goods_sku_detail[$k]["\x6d\145\155\142\x65\x72\137\160\x72\151\x63\145"] = $goods_sku["\x70\x72\151\143\145"]; QS10z: } goto bdqVx; qf8YU: return null; goto Bm2lW; lB_mo: $orderGoods = new \app\common\model\OrderGoods(); goto OdWXu; JOj6k: $goods_attribute_list = $goods_attribute_model->getQuerys(["\x67\x6f\x6f\144\x73\137\151\144" => $goods_id], "\x2a", ''); goto pdN4r; OXEXm: $goods_img_list = $goods_img->getQuerys(["\151\155\147\137\x69\x64" => ["\x69\x6e", $goods_detail["\x69\155\147\137\x69\144\137\x61\x72\162\x61\x79"]]], "\x2a", $order); goto TMDlk; xBMmA: $goods_sku_detail = $goods_sku->where("\x67\157\157\x64\x73\x5f\151\144\x3d" . $goods_id)->select(); goto hHbdN; x0pUh: if (empty($spec_list)) { goto rZLvR; } goto Zyofa; CAwS9: foreach ($img_array as $k => $v) { goto eTS_u; btANG: b35d4: goto f8r2V; ufdV3: nvJ3p: goto Rt6xH; eTS_u: if (empty($goods_img_list)) { goto ax0h1; } goto a9fFo; a9fFo: foreach ($goods_img_list as $t => $m) { goto GwujW; OT3pX: C0N50: goto t4fJe; GwujW: if (!($m["\x69\x6d\147\x5f\x69\x64"] == $v)) { goto x6GkC; } goto F8BhE; HK38C: x6GkC: goto OT3pX; F8BhE: $img_temp_array[] = $m; goto HK38C; t4fJe: } goto ufdV3; Rt6xH: ax0h1: goto btANG; f8r2V: } goto PPb0x; NAZOU: $goods_detail["\x73\x6b\x75\137\x6c\x69\x73\x74"] = $goods_sku_detail; goto iBiay; XLRgB: $goods_detail["\x67\157\157\144\x73\x5f\141\164\164\162\x69\x62\x75\164\x65\137\156\x61\x6d\145"] = $attribute_info["\141\164\164\162\137\x6e\x61\155\145"]; goto ujX_4; MeiX0: $goods_detail["\x73\153\x75\x5f\160\x69\143\164\165\162\145\137\x61\162\162\141\x79"] = $goos_sku_picture_query; goto lB_mo; dlGyt: sort($goos_sku_picture_query); goto MeiX0; Da4Tj: $category_name = $this->getGoodsCategoryName($goods_detail["\x63\x61\164\145\137\151\x64"]); goto nqkEb; GkLIJ: $goods_img = new \app\common\model\Images(); goto DaKYJ; bSafx: $attribute_info = $attribute_model->getInfo(["\x61\x74\x74\162\137\x69\144" => $goods_detail["\x67\157\157\144\163\137\141\x74\x74\x72\x69\142\165\x74\145\137\x69\x64"]], "\x61\x74\164\162\137\156\141\155\145"); goto XLRgB; Ns3SD: $num = $orderGoods->getSum(["\x67\x6f\157\x64\x73\137\x69\144" => $goods_id], "\156\x75\155"); goto xHYuS; TMDlk: $img_temp_array = array(); goto B60x7; bdqVx: Zgz6U: goto NAZOU; XFiAj: $goods_sku = new GoodsSku(); goto xBMmA; ZNn3z: jRPOi: goto tGRdQ; Mtomy: tvXt3: goto SUctk; B60x7: if (!(trim($goods_detail["\x69\155\147\x5f\151\x64\137\x61\162\x72\141\171"]) != '')) { goto jRPOi; } goto MD3rI; MD3rI: $img_array = explode("\54", $goods_detail["\151\155\147\x5f\x69\144\137\141\x72\162\141\x79"]); goto CAwS9; SUctk: $attribute_model = new GoodsAttrModule(); goto bSafx; zdbY2: $goods = new \app\common\model\Goods(); goto awTzd; sOUiX: $goods_detail["\147\157\x6f\144\x73\x5f\141\x74\x74\x72\151\142\x75\164\x65\x5f\x6c\151\163\x74"] = array(); goto Evpt0; QeTiH: rZLvR: goto ci35o; log3R: Zoe_b: goto QeTiH; Zyofa: foreach ($spec_list as $k => $v) { goto e3QSf; rwi5h: Wuuq3: goto wxbVO; wxbVO: ynl6r: goto lf5oD; e3QSf: foreach ($v["\x76\x61\x6c\165\x65"] as $m => $t) { goto xS1HU; xS1HU: if (!empty($t["\x73\160\x65\143\x5f\x73\150\157\x77\x5f\x74\x79\160\145"])) { goto LUnpZ; } goto KZxor; KZxor: $spec_list[$k]["\166\x61\x6c\x75\x65"][$m]["\163\160\x65\143\137\163\x68\x6f\167\137\x74\171\160\145"] = 1; goto TIJaE; TIJaE: LUnpZ: goto mjEPT; mjEPT: ZBD61: goto O1yqD; O1yqD: } goto rwi5h; lf5oD: } goto log3R; DQUCE: $goods_detail["\151\155\147\137\x6c\x69\163\164"] = $goods_img_list; goto oS2p7; nqkEb: $goods_detail["\x63\141\164\145\137\x6e\141\155\145"] = $category_name; goto LEcwq; LEcwq: if ($goods_detail["\x67\157\x6f\x64\x73\137\141\x74\164\162\x69\x62\x75\x74\145\137\151\144"] != 0) { goto tvXt3; } goto l5TC3; ujX_4: $goods_attribute_model = new GoodsAttr(); goto JOj6k; GcpHx: bOHmE: goto U3ike; awTzd: $goods_detail = $goods->get($goods_id); goto aGnay; PPb0x: wfOlO: goto ZNn3z; OdWXu: $num = 0; goto Ns3SD; DaKYJ: $order = "\x69\x6e\163\164\162\50\47\x2c" . $goods_detail["\151\155\x67\x5f\151\144\137\141\x72\x72\141\x79"] . "\x2c\47\x2c\x43\x4f\x4e\103\x41\x54\x28\47\54\x27\54\x69\x6d\147\137\x69\144\54\47\54\x27\51\51"; goto OXEXm; aGnay: if (!($goods_detail == null)) { goto rM0uv; } goto qf8YU; iBiay: $spec_list = json_decode($goods_detail["\x67\157\157\x64\163\137\163\x70\145\143\137\146\157\x72\155\x61\164"], true); goto x0pUh; cyUux: $goods_detail["\x69\x6d\147\137\164\x65\155\160\x5f\141\x72\x72\141\x79"] = $img_temp_array; goto DQUCE; Bm2lW: rM0uv: goto XFiAj; xHYuS: $goods_detail["\160\165\x72\x63\150\x61\163\x65\x5f\156\165\x6d"] = $num; goto icxx2; ci35o: $goods_detail["\163\x70\145\x63\x5f\x6c\x69\x73\x74"] = $spec_list; goto GkLIJ; OdEQO: $album_picture = new \app\common\model\Images(); goto Pax87; Rw19f: } private function getGoodsCategoryName($cate_id, $name = '') { goto dFPkM; skzze: $info = $goods_category->getInfo(["\x63\141\x74\145\137\x69\x64" => $cate_id], "\143\141\x74\x65\137\x6e\141\155\145\x2c\160\151\144"); goto B6Rte; C9AcA: $name = $info["\x63\x61\164\x65\137\156\141\x6d\145"] . "\40\76\40" . $name; goto jD6kn; My0jX: XwFoB: goto aSmJq; B6Rte: if (empty($info["\x63\x61\x74\x65\137\156\x61\155\145"])) { goto SdbSy; } goto pGhOV; o_GmO: WBzX0: goto UpcKv; nz24Z: if ($info["\160\x69\x64"] != 0) { goto Rt4RO; } goto usIHb; aauT6: goto XwFoB; goto hPXus; hPXus: Rt4RO: goto WfToQ; eOoq8: return $this->getGoodsCategoryName($cate_id, $name); goto My0jX; G1Ecx: cj3cZ: goto dTw2n; pGhOV: if ($name == '') { goto cj3cZ; } goto C9AcA; jD6kn: goto WBzX0; goto G1Ecx; dFPkM: $goods_category = new \app\common\model\GoodsCate(); goto skzze; UpcKv: SdbSy: goto nz24Z; dTw2n: $name .= $info["\143\x61\x74\x65\x5f\x6e\141\x6d\x65"]; goto o_GmO; WfToQ: $cate_id = $info["\x70\x69\144"]; goto eOoq8; usIHb: return $name; goto aauT6; aSmJq: } public function ModifyGoodsRecommend($goods_ids, $re) { goto ql2Cw; ql2Cw: $goods = new \app\common\model\Goods(); goto x_LKA; q7qAh: try { goto X982g; X982g: $goods_id_array = explode("\54", $goods_ids); goto Xk7N7; hmAnA: return 1; goto rs1kP; ogTb4: mIvmk: goto m41BB; Xk7N7: $data = array("\x69\163\x5f\x68\x6f\164" => $re); goto Mjagw; m41BB: $goods->commit(); goto hmAnA; Mjagw: foreach ($goods_id_array as $k => $v) { goto G4heX; G4heX: $goods = new \app\common\model\Goods(); goto f_kX0; lxhGa: Pubzd: goto u19Vg; f_kX0: $goods->save($data, ["\x67\x6f\157\x64\x73\137\151\x64" => $v]); goto lxhGa; u19Vg: } goto ogTb4; rs1kP: } catch (\Exception $e) { $goods->rollback(); return $e->getMessage(); } goto z59Sg; x_LKA: $goods->startTrans(); goto q7qAh; z59Sg: } public function ModifyGoodsRecommendNew($goods_ids, $new) { goto Bcevo; Bcevo: $goods = new \app\common\model\Goods(); goto yusbf; uerKB: try { goto ipHTN; K0qXh: MFVaS: goto Cu1kC; ipHTN: $goods_id_array = explode("\54", $goods_ids); goto F_2bi; F_2bi: $data = array("\151\163\x5f\x6e\145\167" => $new); goto J8B_F; Cu1kC: $goods->commit(); goto carBk; carBk: return 1; goto Ebnjs; J8B_F: foreach ($goods_id_array as $k => $v) { goto UObFG; UObFG: $goods = new \app\common\model\Goods(); goto JrpNP; JrpNP: $goods->save($data, ["\147\157\157\144\x73\137\x69\x64" => $v]); goto w4ttX; w4ttX: xXdju: goto S3hel; S3hel: } goto K0qXh; Ebnjs: } catch (\Exception $e) { $goods->rollback(); return $e->getMessage(); } goto tp9Yx; yusbf: $goods->startTrans(); goto uerKB; tp9Yx: } public function ModifyGoodsRecommendTui($goods_ids, $new) { goto rzIQ0; yJ2kl: $goods->startTrans(); goto JTao7; JTao7: try { goto hw_En; hw_En: $goods_id_array = explode("\54", $goods_ids); goto JoeDc; JoeDc: $data = array("\151\x73\x5f\x72\145\x63\157\155\155\145\x6e\144" => $new); goto WTzOs; oAYcG: KzKy3: goto K0d7d; OAOcG: return 1; goto amZrt; WTzOs: foreach ($goods_id_array as $k => $v) { goto euFgG; NPTqs: UY9i8: goto HWeca; euFgG: $goods = new \app\common\model\Goods(); goto ec1fp; ec1fp: $goods->save($data, ["\147\x6f\x6f\x64\163\x5f\x69\x64" => $v]); goto NPTqs; HWeca: } goto oAYcG; K0d7d: $goods->commit(); goto OAOcG; amZrt: } catch (\Exception $e) { $goods->rollback(); return $e->getMessage(); } goto vWb23; rzIQ0: $goods = new \app\common\model\Goods(); goto yJ2kl; vWb23: } public function attrModDel($mod_id) { goto ax1Qt; ax1Qt: $mod = new GoodsAttrModule(); goto KzRnv; MQngM: return $res; goto vahlj; KzRnv: $res = $mod->destroy(["\141\164\x74\162\137\x69\x64" => $mod_id]); goto MQngM; vahlj: } public function attrModIs_use($mod_id) { goto N6pxg; Xff_7: return $res; goto Guvgv; N6pxg: $mod = new GoodsAttrModule(); goto UJZW1; UJZW1: $res = $mod->destroy(["\x61\x74\x74\162\x5f\x69\x64" => $mod_id]); goto Xff_7; Guvgv: } public function attrModOff($mod_id) { goto fUNmp; fUNmp: $mod = new GoodsAttrModule(); goto EuvlT; EuvlT: $res = $mod->save(["\x69\163\x5f\165\163\145" => 0], ["\x61\164\x74\162\x5f\151\144" => $mod_id]); goto Ux3dF; Ux3dF: return $res; goto GY_d3; GY_d3: } public function attrModOn($mod_id) { goto X2krq; lvBk7: return $res; goto xDq2e; xPCOs: $res = $mod->save(["\151\x73\x5f\x75\163\145" => 1], ["\x61\164\x74\x72\137\x69\144" => $mod_id]); goto lvBk7; X2krq: $mod = new GoodsAttrModule(); goto xPCOs; xDq2e: } public function editGoodsType($good_id, $key) { goto tn00s; qxgrr: if (!($key == "\x68\x6f\x74")) { goto OgddZ; } goto bEABN; Dhs0l: OgddZ: goto OeCyj; W_qf9: if (!($key == "\x6e\145\167")) { goto s5H4B; } goto f5CIx; pf781: s5H4B: goto qxgrr; bEABN: $data = array("\x69\x73\137\x68\157\x74" => 0); goto Dhs0l; Jt_V8: $res = $goods->save($data, ["\x67\x6f\x6f\x64\x73\137\x69\x64" => $good_id]); goto LXDDM; H93vD: $data = array("\x69\163\x5f\x72\x65\x63\157\x6d\x6d\x65\x6e\144" => 0); goto jrU08; jrU08: L2wxy: goto Jt_V8; LXDDM: return $res; goto Zwe_a; f5CIx: $data = array("\x69\x73\137\156\145\x77" => 0); goto pf781; tn00s: $goods = new \app\common\model\Goods(); goto W_qf9; OeCyj: if (!($key == "\164\165\x69")) { goto L2wxy; } goto H93vD; Zwe_a: } }
