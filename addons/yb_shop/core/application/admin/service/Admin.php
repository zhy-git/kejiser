<?php
 namespace app\admin\service; use app\common\model\AdminGroup; use app\common\model\AdminModule; use think\Session; class Admin extends Base { function __construct() { goto nwu_J; PdENN: $this->admin = new \app\common\model\Admin(); goto Yy98I; nwu_J: parent::__construct(); goto PdENN; Yy98I: $this->admin_module = new AdminModule(); goto Q7URU; Q7URU: } private function initLoginInfo($user_info) { goto I7rce; a5zWj: $auth_group = new AdminGroup(); goto GRgYA; GRgYA: $auth = $auth_group->get($user_info["\162\157\x6c\145\137\151\x64\137\141\x72\x72\x61\171"]); goto AbR2T; EjcOB: Session::set("\151\163\x5f\141\144\155\x69\156", $user_info["\151\x73\x5f\141\x64\x6d\x69\156"]); goto a5zWj; eojdT: Session::set("\155\x6f\x64\x75\154\x65\x5f\151\144\137\141\x72\x72\x61\171", $no_control . $auth["\x6d\x6f\x64\165\x6c\x65\137\151\x64\137\141\162\x72\x61\171"]); goto Jh5_B; I7rce: Session::set("\x61\144\x6d\x69\156\x5f\151\x64", $user_info["\151\144"]); goto EjcOB; AbR2T: $no_control = $this->getNoControlAuth(); goto eojdT; Jh5_B: } public function getAdminLisy($condition, $search_text) { $list = $this->admin->getAdminLisy($condition, $search_text); return $list; } public function deleteAdminUser($admin_id) { goto XUkRI; O2n8N: goto jaE4L; goto iOC5p; bPPME: jaE4L: goto WHhJ6; NSHAO: return 0; goto O2n8N; oi8p2: $retval = $this->admin->destroy($admin_id); goto eYFzU; iOC5p: iFUyQ: goto oi8p2; eYFzU: return $retval; goto bPPME; WGKdG: if ($admin_user_info["\x69\163\x5f\x61\x64\155\x69\x6e"] == 0) { goto iFUyQ; } goto NSHAO; XUkRI: $admin_user_info = $this->admin->getInfo(["\151\144" => $admin_id]); goto WGKdG; WHhJ6: } public function resetUserPassword($admin_id) { $retval = $this->admin->save(["\x70\x61\x73\x73\167\157\x72\x64" => md5(123456)], ["\x69\144" => $admin_id]); return $retval; } public function login($user_name, $password = '') { goto BV2uM; nZwPs: HGVr9: goto ldQDU; aja02: goto HGVr9; goto cJ0LI; BV2uM: $this->Logout(); goto I0fWG; I0fWG: $condition = array("\165\x73\x65\x72\x5f\x6e\x61\155\x65" => $user_name, "\160\x61\163\163\x77\157\x72\x64" => md5($password), "\x61\144\x6d\151\x6e\137\163\x74\x61\164\165\x73" => 1); goto P6eIZ; uy5ZN: if (!empty($user_info)) { goto l5rE7; } goto q2xiK; g2Mdq: $this->initLoginInfo($user_info); goto UyWxc; cJ0LI: l5rE7: goto g2Mdq; UyWxc: return 1; goto nZwPs; P6eIZ: $user_info = $this->admin->getInfo($condition, $field = "\151\144\54\x75\163\x65\162\x5f\156\141\155\x65\54\151\163\x5f\141\x64\155\151\156\x2c\x72\157\x6c\x65\137\151\144\x5f\141\x72\162\x61\x79"); goto uy5ZN; q2xiK: return 0; goto aja02; ldQDU: } public function addAdminUser($user_name, $group_id, $password, $info) { goto q0Icl; q0Icl: $data_admin = array("\x75\163\145\x72\x5f\x6e\x61\x6d\145" => $user_name, "\x6e\x61\x6d\145" => $user_name, "\x72\157\x6c\x65\x5f\x69\144\137\141\162\162\141\171" => $group_id, "\x70\141\x73\163\x77\x6f\162\x64" => md5($password), "\141\x64\x6d\x69\x6e\x5f\163\164\141\x74\x75\x73" => 1, "\x69\x6e\x66\x6f" => $info, "\x63\x72\145\141\x74\x65\x5f\164\x69\155\x65" => time()); goto W4wjZ; v9HVV: return $res; goto DY1mT; W4wjZ: $res = $this->admin->save($data_admin); goto v9HVV; DY1mT: } public function editAdminUser($admin_id, $user_name, $group_id, $info, $admin_status) { goto pWC5h; SstsO: mMNfu: goto GHqp7; O4AKa: $data = array("\165\x73\145\162\x5f\x6e\x61\x6d\145" => $user_name, "\x72\x6f\x6c\145\x5f\151\144\137\x61\x72\162\x61\171" => $group_id, "\141\144\x6d\151\156\137\x73\x74\141\164\x75\163" => $admin_status, "\x69\x6e\146\x6f" => $info); goto gvU6F; UCtwy: if (!$res) { goto mMNfu; } goto O4AKa; GHqp7: return $res; goto ojZ39; pWC5h: $res = $this->ModifyUserName($admin_id, $user_name); goto UCtwy; gvU6F: $res = $this->admin->save($data, ["\151\144" => $admin_id]); goto SstsO; ojZ39: } public function ModifyUserName($admin_id, $user_name) { goto xqW57; QEOXd: GZYhA: goto rqCtX; iltBf: if (!($info["\x75\163\145\x72\137\x6e\141\155\x65"] == $user_name)) { goto vzirh; } goto SHdCt; HYWvR: if (!($count > 0)) { goto GZYhA; } goto aj1DM; eIfL7: $count = $this->admin->where(["\165\163\145\162\137\x6e\x61\x6d\x65" => $user_name])->count(); goto HYWvR; SHdCt: return 1; goto BtM_V; xqW57: $info = $this->admin->get($admin_id); goto iltBf; aj1DM: return USER_REPEAT; goto QEOXd; BtM_V: vzirh: goto eIfL7; rqCtX: } public function Logout() { goto RoKxD; ChKSU: Session::set("\x72\157\154\x65\x5f\151\144\x5f\x61\x72\162\141\171", ''); goto pJgsY; h5m01: Session::set("\151\x73\137\141\144\x6d\151\x6e", ''); goto ChKSU; RoKxD: Session::set("\x61\x64\155\x69\x6e\137\x69\x64", ''); goto h5m01; pJgsY: } public function adminLock($admin_id) { $retval = $this->admin->save(["\x61\x64\155\x69\156\x5f\163\164\141\164\165\163" => 0], ["\x69\144" => $admin_id]); return $retval; } public function adminUnlock($admin_id) { $retval = $this->admin->save(["\141\x64\155\151\x6e\x5f\163\x74\141\164\165\163" => 1], ["\x69\144" => $admin_id]); return $retval; } private function getNoControlAuth() { goto wuGQO; yo92k: foreach ($list as $v) { $str .= $v["\155\157\x64\x75\x6c\145\x5f\151\144"] . "\54"; IS5L6: } goto iJamd; ZGsJv: $list = $moudle->getQuerys(["\151\x73\x5f\x63\157\x6e\164\x72\157\x6c\x5f\141\x75\164\x68" => 0], "\x6d\x6f\x64\165\x6c\x65\x5f\151\x64", ''); goto N8Td3; N8Td3: $str = ''; goto yo92k; iJamd: J_M19: goto ccV6n; ccV6n: return $str; goto zyc7J; wuGQO: $moudle = new AdminModule(); goto ZGsJv; zyc7J: } public function getSessionAdminId() { return $this->admin_id; } public function getchildModuleQuery($moduleid) { goto UTC4y; OBECl: $new_list = $list; goto tV1wH; e02qC: $list = $auth_group->getAuthList($moduleid); goto OBECl; tV1wH: return $new_list; goto OEOm5; UTC4y: $auth_group = new AdminModule(); goto e02qC; OEOm5: } public function selectAll() { goto Rbjeg; Rbjeg: $auth_group = new AdminModule(); goto z0uHA; GbLqX: return $list; goto byMyZ; z0uHA: $list = $auth_group->getAuthListLevel(2); goto GbLqX; byMyZ: } public function checkAuth($module_id) { goto pBZHX; RgE74: goto AyJL0; goto rP4hp; rP4hp: Ae_zB: goto yH6Xj; yH6Xj: return 1; goto XtM74; pBZHX: if ($this->is_admin) { goto Ae_zB; } goto cdB5w; XtM74: AyJL0: goto DZS5Y; X_3dM: return 1; goto ssSpL; wWIcy: goto fKwr2; goto HdbLV; HdbLV: b7Qci: goto X_3dM; R7Y2M: if (in_array($module_id, $module_id_array)) { goto b7Qci; } goto jH_3C; cdB5w: $module_id_array = explode("\x2c", $this->module_id_array); goto R7Y2M; jH_3C: return 0; goto wWIcy; ssSpL: fKwr2: goto RgE74; DZS5Y: } public function getModuleIdByModule($controller, $action) { $res = $this->admin_module->getModuleIdByModule($controller, $action); return $res; } public function getAdminInfo() { $res = $this->admin->getInfo("\151\144\x3d" . $this->admin_id, "\52"); return $res; } public function getAdminUserInfo($condition, $field = "\52") { $admin_user_info = $this->admin->getInfo($condition, $field = "\x2a"); return $admin_user_info; } public function getSystemModuleInfo($module_id, $field = "\x2a") { $res = $this->admin_module->getInfo(array("\x6d\157\x64\x75\x6c\145\x5f\x69\x64" => $module_id), $field); return $res; } public function getModuleRootAndSecondMenu($module_id) { goto sUog4; PgQtG: oHK3u: goto xy3Gc; hK4_R: f_0aV: goto WFc2j; Cb9dd: xDnOm: goto yruDR; wz3wY: goto Z9Z4q; goto mzIRS; yfuXr: if ($module["\x6c\145\166\x65\154"] == 2) { goto SNCpk; } goto LPASy; nIKFc: Z9Z4q: goto XwsH4; VClzT: if (!($count == 0)) { goto jiNuj; } goto edicW; XwsH4: goto oHK3u; goto Cb9dd; wmKea: if (empty($info)) { goto VwHy9; } goto a5Z3I; LPASy: $pid = $module["\x70\151\144"]; goto wz3wY; vrz6_: $pid = $info["\x70\x69\x64"]; goto PgQtG; WFc2j: goto qbIX5; goto ama9l; oX1k1: lzaRa: goto ebbLV; oelDe: $pid = 0; goto M7q5L; YfbVD: $module = $this->admin_module->getInfo(["\x6d\157\x64\165\x6c\x65\137\x69\144" => $pid, "\x70\151\144" => array("\156\145\x71", 0)], "\x70\151\x64\54\x20\x6d\x6f\144\165\154\145\x5f\x69\144\54\x20\x6c\145\166\x65\154"); goto yfuXr; UIj3H: return array($module_id, 0); goto pZuw8; mzIRS: SNCpk: goto oelDe; M7q5L: return array($module["\x70\151\x64"], $module["\155\x6f\x64\165\154\x65\x5f\x69\x64"]); goto nIKFc; ebbLV: return array($info["\160\x69\144"], $module_id); goto hK4_R; ama9l: VwHy9: goto UIj3H; a5Z3I: if ($info["\x6c\x65\166\x65\154"] == 2) { goto lzaRa; } goto vrz6_; edicW: return array(0, 0); goto ghw_s; sUog4: $count = $this->admin_module->where(["\155\x6f\x64\165\x6c\x65\137\151\x64" => $module_id])->count(); goto VClzT; MlOZV: $info = $this->admin_module->getInfo(["\155\157\144\165\154\x65\137\151\x64" => $module_id, "\160\x69\x64" => array("\x6e\x65\161", 0)], "\160\x69\144\54\x20\x6c\145\x76\145\x6c"); goto wmKea; yruDR: goto f_0aV; goto oX1k1; xy3Gc: if (!($pid != 0)) { goto xDnOm; } goto YfbVD; pZuw8: qbIX5: goto kNbiL; ghw_s: jiNuj: goto MlOZV; kNbiL: } }
