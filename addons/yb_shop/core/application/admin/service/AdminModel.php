<?php
 namespace app\admin\service; use app\common\model\AdminModule; use think\Request; use think\Session; class AdminModel extends Base { private $admin_model; function __construct() { parent::__construct(); $this->admin_model = new AdminModule(); } public function addSytemModule($module_name, $controller, $method, $pid = 0, $url, $is_menu, $sort, $logo, $info, $is_control_auth) { goto wuaHa; wuaHa: if (!empty($pid)) { goto BNbcc; } goto PpYkY; iI7QE: $level = $this->getSystemModuleInfo($pid, $field = "\x6c\145\x76\x65\x6c")["\x6c\x65\166\145\154"] + 1; goto EmNlA; Sq8QZ: $this->updateUserModule(); goto Z2RIe; QKy2g: $mod = new AdminModule(); goto Vjt9F; dSMIH: BNbcc: goto EUbRQ; Z2RIe: return $res; goto N16K5; Vjt9F: $res = $mod->save($data); goto Sq8QZ; susRf: ojCTL: goto weNJH; EmNlA: goto IQQKo; goto j8mvm; BJrlK: $sort = 0; goto susRf; SaeS1: IQQKo: goto VRf7l; UYwLJ: $level = 1; goto SaeS1; weNJH: if ($pid == 0) { goto dEN2T; } goto iI7QE; VRf7l: $data = array("\x6d\157\x64\165\154\x65\137\x6e\x61\x6d\x65" => $module_name, "\x63\x6f\x6e\x74\162\x6f\154\154\x65\162" => $controller, "\x6d\x65\164\150\157\144" => $method, "\160\151\x64" => $pid, "\154\145\166\x65\x6c" => $level, "\165\x72\x6c" => $url, "\151\x73\x5f\x6d\145\156\165" => $is_menu, "\151\163\x5f\143\x6f\x6e\x74\162\x6f\x6c\x5f\x61\x75\x74\x68" => $is_control_auth, "\x73\157\x72\x74" => $sort, "\151\x6e\x66\x6f" => $info, "\x6c\x6f\147\x6f" => $logo, "\x63\x72\145\141\x74\x65\x5f\x74\151\155\x65" => time()); goto QKy2g; EUbRQ: if (!empty($sort)) { goto ojCTL; } goto BJrlK; j8mvm: dEN2T: goto UYwLJ; PpYkY: $pid = 0; goto dSMIH; N16K5: } public function updateSystemModule($module_id, $module_name, $controller, $method, $pid, $url, $is_menu, $sort, $logo, $info, $is_control_auth) { goto cedMQ; keUSL: $level = $this->getSystemModuleInfo($pid, $field = "\154\x65\166\x65\154")["\x6c\x65\x76\145\x6c"] + 1; goto HMqVW; cedMQ: if ($pid == 0) { goto h_lXN; } goto keUSL; dvBjz: $mod = new AdminModule(); goto X88Gq; oNgml: $data = array("\x6d\x6f\x64\x75\x6c\145\x5f\151\x64" => $module_id, "\x6d\x6f\x64\165\x6c\x65\x5f\x6e\141\x6d\x65" => $module_name, "\143\x6f\156\x74\162\157\154\x6c\145\x72" => $controller, "\155\145\164\x68\x6f\x64" => $method, "\x70\151\144" => $pid, "\x6c\x65\166\145\x6c" => $level, "\165\162\x6c" => $url, "\x69\163\x5f\155\x65\x6e\165" => $is_menu, "\151\x73\137\x63\157\x6e\164\162\157\154\137\x61\x75\x74\150" => $is_control_auth, "\163\x6f\x72\x74" => $sort, "\154\157\147\157" => $logo, "\x69\156\146\157" => $info, "\x75\160\144\141\164\145\x5f\x74\x69\155\145" => time()); goto dvBjz; X88Gq: $res = $mod->allowField(true)->save($data, ["\x6d\157\x64\165\154\145\x5f\x69\x64" => $module_id]); goto j_ekw; OnziI: return $res; goto NOSyN; wIS8I: ccbKe: goto oNgml; j_ekw: $this->updateUserModule(); goto OnziI; adbJD: h_lXN: goto w_OeB; w_OeB: $level = 1; goto wIS8I; HMqVW: goto ccbKe; goto adbJD; NOSyN: } public function deleteSystemModule($module_id_array) { goto TEks0; tApP7: goto kI_uB; goto J1G93; J1G93: ls6LA: goto whFU2; whFU2: $res = 2; goto EGKoz; t_RYn: $res = $this->admin_model->destroy($module_id_array); goto tApP7; Jn_CW: if (!empty($sub_list)) { goto ls6LA; } goto t_RYn; TEks0: $sub_list = $this->getModuleListByParentId($module_id_array); goto Jn_CW; bw95i: return $res; goto VbFiN; EGKoz: kI_uB: goto bw95i; VbFiN: } public function getModuleListByParentId($pid) { $list = $this->getSystemModuleList("\x70\151\x64\75" . $pid); return $list; } public function getSystemModuleInfo($module_id, $field = "\x2a") { $res = $this->admin_model->getInfo(array("\155\157\144\165\154\x65\137\151\x64" => $module_id), $field); return $res; } public function getSystemModuleList($condition = '', $order = '', $field = "\52") { $res = $this->admin_model->getQuerys($condition, $field, $order); return $res; } private function updateUserModule() { goto QFPRP; QFPRP: $module = request()->module(); goto KVACW; ZE2YS: $module_id_list = $mod->getQuerys('', "\155\x6f\x64\165\154\x65\137\151\x64", ''); goto TI_zY; bf1lJ: $mod = new AdminModule(); goto ZE2YS; TI_zY: foreach ($module_id_list as $k => $v) { Session::set("\x6d\x6f\144\165\154\145\x5f\154\151\163\x74\56" . $module . "\x6d\157\144\x75\x6c\x65\x5f\154\x69\x73\164\x5f" . $v["\155\x6f\x64\165\154\x65\x5f\151\x64"], ''); mr4yl: } goto aL3jb; KVACW: Session::set("\x6d\x6f\144\165\154\x65\x5f\154\x69\x73\x74\x2e" . $module . "\155\157\144\165\x6c\145\x5f\154\151\x73\x74\137\60", ''); goto bf1lJ; aL3jb: PZssY: goto Mx47U; Mx47U: } }
