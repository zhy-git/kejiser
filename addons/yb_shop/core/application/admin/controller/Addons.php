<?php
 namespace app\admin\controller; use app\admin\service\AdminModel; use app\common\model\AdminModule; use app\common\model\Module; use think\Db; class Addons extends Base { protected $addons; public function __construct() { $this->addons = new \app\admin\service\Addons(); parent::__construct(); } public function index() { goto Ld0YP; Ld0YP: $addons = new \app\admin\service\Addons(); goto ucL1i; EXRpC: $this->assign("\154\151\x73\x74", $list); goto gpMAz; ucL1i: $list = $addons->getAddonsList(); goto EXRpC; gpMAz: return view("\x61\x64\x64\157\x6e\163\57\x69\156\x64\x65\170"); goto hufLi; hufLi: } public function install() { goto us2N1; zd7Qn: nrWgo: goto ds6ye; aBw3l: if (!(is_array($addons->menu_info) && $addons->menu_info !== array())) { goto USnEt; } goto Q4zps; rSuNL: foreach ($menu as $k => $v) { goto nWoTu; UX33F: $method = "\x6d\145\x6e\x75\x5f" . $controller; goto A18pG; nWoTu: $parent_module_info = $module_model->getInfo(["\155\x6f\144\x75\x6c\x65\137\156\141\155\145" => $v["\160\141\162\x65\156\x74\x5f\155\157\144\x75\154\145\x5f\x6e\141\x6d\145"]], "\155\x6f\144\x75\154\145\x5f\x69\x64\54\x20\143\157\156\x74\162\x6f\x6c\154\145\162"); goto vD1sE; ybrj2: $last_module_id = $module_model->getInfo(["\x6d\157\144\165\x6c\x65\x5f\156\141\x6d\145" => $v["\x6c\x61\x73\164\x5f\155\x6f\x64\165\154\x65\137\156\x61\155\x65"]], "\x6d\x6f\x64\x75\154\145\x5f\x69\x64\54\40\163\x6f\162\164"); goto tYIrK; tkhG1: $controller = $parent_module_info["\x63\x6f\156\164\x72\157\154\x6c\145\x72"]; goto NJprU; pjN6z: goto oRQbr; goto C6p_h; tYIrK: $res = $website->addSytemModule($v["\x6d\157\144\x75\x6c\x65\137\156\141\x6d\x65"], $controller, $method, $parent_module_info["\x6d\157\x64\x75\x6c\145\x5f\x69\144"], $url, $v["\x69\163\x5f\x6d\145\x6e\165"], $last_module_id["\x73\157\162\164"], $v["\x69\x63\x6f\156\137\143\154\141\163\163"], $v["\x64\x65\163\143"], $v["\151\163\137\143\x6f\x6e\164\x72\x6f\154\x5f\141\165\164\x68"]); goto wsMcj; C6p_h: bNRuj: goto m97np; vnzp7: XzT6R: goto FJ5_b; Ric_a: $addons->uninstall(); goto ms6QJ; ms6QJ: $this->error("\345\xae\x89\350\243\205\xe8\217\x9c\345\x8d\225\xe6\x93\x8d\xe4\275\x9c\xe5\244\xb1\xe8\xb4\xa5\xef\274\214\350\257\xb7\xe6\243\200\xe6\237\245\xe8\x8f\234\345\215\225\351\205\215\347\xbd\256"); goto pjN6z; A18pG: $url = "\101\144\144\157\x6e\163" . "\57\x6d\x65\156\x75\137" . $controller . "\77\x61\x64\x64\157\x6e\163\x3d" . $v["\150\157\x6f\x6b\x5f\x6e\x61\x6d\145"]; goto ybrj2; wsMcj: if ($res) { goto bNRuj; } goto Ric_a; m97np: MqSwn: goto yu1pd; GEBYb: xqVE3: goto UX33F; NJprU: goto xqVE3; goto vnzp7; vD1sE: if (empty($parent_module_info)) { goto XzT6R; } goto tkhG1; FJ5_b: $controller = $v["\x70\x61\x72\x65\x6e\x74\x5f\x6d\157\144\165\x6c\x65\137\156\x61\155\x65"]; goto GEBYb; yu1pd: } goto Tkb1E; Tkb1E: oRQbr: goto bvZLB; bvZLB: USnEt: goto BsV70; XNIX6: cache("\x68\157\x6f\x6b\x73", null); goto HS_Z7; vCsSv: if ($install_flag) { goto fbghv; } goto GIqW3; uTvYC: lLnv4: goto XNIX6; FpxQB: knPZ2: goto utTf7; pyETG: $info = $addons->info; goto X3ItB; XCZWf: $this->error("\346\217\x92\344\xbb\xb6\xe4\xb8\x8d\xe5\255\x98\345\x9c\xa8"); goto BV7o7; RjkfI: $this->addons->deleteAddons(["\156\x61\x6d\x65" => $addon_name]); goto ag612; ag612: $this->error("\346\x9b\xb4\xe6\226\xb0\xe9\x92\xa9\345\xad\x90\xe5\244\x84\xe6\217\x92\344\xbb\xb6\345\xa4\xb1\350\264\245\x2c\350\xaf\xb7\xe5\215\270\350\275\275\xe5\220\216\xe5\xb0\235\350\257\225\xe9\207\x8d\346\x96\xb0\xe5\256\211\xe8\xa3\205"); goto tqZWe; HS_Z7: $this->success("\xe5\xae\x89\350\243\205\346\x88\220\345\212\237"); goto FpxQB; Q4zps: $menu = $addons->menu_info; goto gayu9; yK2po: if ($hooks_update) { goto lLnv4; } goto RjkfI; ifko_: $addon_name = trim(request()->get("\141\144\x64\157\156\137\x6e\x61\x6d\x65", '')); goto pfM6r; gayu9: $website = new AdminModel(); goto bE2CO; us2N1: $addons = new \app\admin\service\Addons(); goto ifko_; AeCy2: $install_flag = $addons->install(); goto vCsSv; BsV70: $info["\143\157\x6e\x66\x69\x67"] = json_encode($addons->getOneConfig()); goto nq2_7; brxTw: $addons = new $class(); goto pyETG; cbm0e: pn8d0: goto T97tF; HzWhf: $this->error("\346\x8f\222\344\xbb\266\xe4\277\241\346\201\xaf\xe7\xbc\xba\xe5\244\xb1"); goto zd7Qn; GIqW3: $this->error("\346\x89\xa7\350\241\214\346\x8f\222\344\273\266\351\xa2\x84\xe5\256\211\350\243\205\xe6\x93\x8d\xe4\275\x9c\345\244\261\xe8\264\xa5" . session("\x61\x64\144\x6f\x6e\163\x5f\151\x6e\163\164\141\x6c\x6c\137\x65\162\162\157\162")); goto pDC4k; X3ItB: if ($info) { goto nrWgo; } goto HzWhf; bE2CO: $module_model = new Module(); goto rSuNL; pfM6r: $class = get_addon_class($addon_name); goto WLcGz; ds6ye: session("\x61\144\144\x6f\x6e\x73\x5f\x69\156\163\x74\x61\154\x6c\137\x65\162\x72\x6f\162", null); goto AeCy2; pDC4k: fbghv: goto aBw3l; utTf7: KZP20: goto oRuc0; BV7o7: BjYXV: goto brxTw; CajBN: goto KZP20; goto cbm0e; WLcGz: if (class_exists($class)) { goto BjYXV; } goto XCZWf; g0afE: $this->error("\xe5\x86\231\345\x85\245\xe6\217\x92\xe4\xbb\266\xe6\225\xb0\346\x8d\256\xe5\244\261\350\xb4\xa5"); goto CajBN; e7nsQ: if ($res) { goto pn8d0; } goto g0afE; nq2_7: $res = $this->addons->addAddons($info["\x6e\x61\155\x65"], $info["\164\x69\x74\154\145"], $info["\x64\x65\163\x63"], $info["\163\164\141\x74\165\163"], $info["\143\157\156\146\x69\147"], $info["\x61\165\x74\150\157\162"], $info["\166\145\162\163\x69\x6f\x6e"], $info["\143\x6f\x6e\x74\x65\156\x74"]); goto e7nsQ; tqZWe: goto knPZ2; goto uTvYC; T97tF: $hooks_update = $this->addons->updateHooks($addon_name); goto yK2po; oRuc0: } public function uninstall() { goto rSA2A; luVNo: $module_model = new AdminModule(); goto beJo3; T2UEo: if (!(!$db_addons || !class_exists($class))) { goto qAP_V; } goto EOMFT; JDCdx: session("\141\x64\x64\157\x6e\163\x5f\165\x6e\151\x6e\x73\x74\x61\x6c\154\137\x65\162\162\157\162", null); goto QgaqL; SnWn9: $uninstall_flag = $addons->uninstall(); goto jKWIo; jKWIo: if ($uninstall_flag) { goto rb9xO; } goto m5jeH; beJo3: foreach ($menu as $k => $v) { goto ss0Vb; aHc8A: $module_model->destroy(["\x6d\157\144\x75\x6c\x65\137\x6e\141\155\145" => $v["\155\157\144\x75\154\145\137\x6e\141\155\x65"], "\155\145\164\x68\x6f\x64" => $method]); goto d9PzX; ss0Vb: $method = "\155\x65\x6e\x75\137\101\144\x64\157\x6e\163"; goto aHc8A; d9PzX: uN9Py: goto yQvOC; yQvOC: } goto KAlWp; AjRfJ: goto i_w_P; goto tsrkg; QgaqL: $addons = new $class(); goto SnWn9; EpY8f: $db_addons = $this->addons->getAddonsInfo(["\x69\x64" => $id], "\x2a"); goto zVhrv; G1TX0: $menu = $addons->menu_info; goto luVNo; ufGkf: $this->error("\345\x8d\270\xe8\xbd\xbd\xe6\217\222\344\273\266\345\xa4\xb1\350\264\245"); goto qD0Xo; xpAD1: cache("\x68\x6f\x6f\x6b\163", null); goto e9F_2; rSA2A: $id = trim(request()->get("\x69\x64", 0)); goto EpY8f; rUqAO: $this->success("\xe5\x8d\xb8\350\xbd\xbd\xe6\x88\x90\345\212\237"); goto AjRfJ; qD0Xo: i_w_P: goto nA73c; tsrkg: IkVIB: goto ufGkf; mnxeI: if (!(is_array($addons->menu_info) && $addons->menu_info !== array())) { goto DeuZT; } goto G1TX0; ItRtC: $this->error("\345\215\xb8\350\275\xbd\346\217\x92\344\273\xb6\346\x89\x80\346\x8c\202\350\xbd\xbd\347\232\x84\351\222\xa9\xe5\255\220\xe6\x95\260\346\x8d\xae\xe5\xa4\261\xe8\xb4\245"); goto hVrsc; KAlWp: elmKv: goto ucPqa; e9F_2: $delete = $this->addons->deleteAddons(["\156\x61\x6d\x65" => $db_addons["\x6e\x61\155\x65"]]); goto YJ6w5; hVrsc: B3m7L: goto xpAD1; lRl2Q: if (!($hooks_update === false)) { goto B3m7L; } goto ItRtC; YJ6w5: if ($delete === false) { goto IkVIB; } goto rUqAO; EOMFT: $this->error("\xe6\x8f\x92\344\273\266\xe4\xb8\215\xe5\xad\x98\xe5\234\xa8"); goto X05sl; S2iZH: rb9xO: goto mnxeI; ucPqa: DeuZT: goto ZLf2H; zVhrv: $class = get_addon_class($db_addons["\156\141\155\145"]); goto T2UEo; m5jeH: $this->error("\346\x89\247\350\xa1\x8c\346\217\222\344\273\xb6\xe9\242\x84\345\x8d\xb8\350\275\xbd\xe6\x93\x8d\xe4\275\234\xe5\xa4\261\350\xb4\xa5" . session("\141\x64\144\x6f\x6e\x73\x5f\165\x6e\x69\156\163\164\141\154\x6c\137\145\162\162\157\x72")); goto S2iZH; ZLf2H: $hooks_update = $this->addons->removeHooks($db_addons["\156\141\155\x65"]); goto lRl2Q; X05sl: qAP_V: goto JDCdx; nA73c: } public function menu_addons() { goto mNmrl; mNmrl: $addons = request()->param("\x61\x64\144\157\x6e\x73"); goto TeyMq; HWDKX: $this->assign("\x70\x61\162\141\155\x73", json_decode($params, true)); goto NIIuv; Wcl7p: return view("\151\156\x64\x65\170\57\141\x64\144\x6f\156\x6d\x65\156\165"); goto niBNB; TeyMq: $params = request()->get("\x70\141\162\x61\155\x73", ''); goto HWDKX; NIIuv: $this->assign("\150\157\x6f\x6b\x5f\x6e\141\x6d\x65", $addons); goto Wcl7p; niBNB: } public function execute($addons = null, $controller = null, $action = null, $addons_type = null) { goto gvRL3; vZ5g9: DM67w: goto SV5Cu; FkvCQ: P_yun: goto sO_GP; glAiP: if (!($model === false)) { goto FKVxx; } goto tzyV0; VbeOx: goto P_yun; goto vZ5g9; Fjtwb: $class = get_addon_class($addons_type, $addons, $controller); goto VbeOx; sO_GP: if (class_exists($class)) { goto yMHJt; } goto XvIZ3; gvRL3: if (!(!empty($addons) && !empty($controller) && !empty($action))) { goto GPyiA; } goto i2ax2; XvIZ3: $this->error(lang("\xe6\x8e\xa7\345\x88\xb6\345\231\250\xe4\xb8\x8d\xe5\255\230\xe5\234\250" . $class)); goto PxjT9; sA6_z: GPyiA: goto Mb2A2; SV5Cu: $class = get_addon_class($addons, "\141\x64\144\157\x6e\x5f\x63\x6f\x6e\164\x72\157\154\x6c\x65\x72", $controller); goto FkvCQ; PxjT9: goto IWd2Y; goto LXbM3; KL4Qp: FKVxx: goto SydoU; SydoU: return \think\App::invokeMethod([$class, $action]); goto jA2rm; i2ax2: if ($addons_type == null) { goto DM67w; } goto Fjtwb; LXbM3: yMHJt: goto glAiP; jA2rm: IWd2Y: goto sA6_z; tzyV0: $this->error(lang("\x61\144\x64\x6f\156\x20\151\x6e\151\x74\40\x66\x61\x69\x6c")); goto KL4Qp; Mb2A2: } }
