<?php
 namespace app\web\service; use think\Controller; use think\session; use think\Db; class Wechat extends Controller { protected $appid = "\167\170\x30\x30\67\70\x33\65\143\x33\x63\70\x33\141\65\67\70\x35"; protected $appsecret = "\143\x61\x39\x61\145\x34\60\145\67\x31\71\145\x31\x61\61\62\66\142\143\x66\x66\70\x38\x35\70\144\x64\145\141\142\x34\x37"; public function __construct() { goto dBag_; QYmWC: if (empty($account_wechats)) { goto J8Zmz; } goto VKs6V; VKs6V: $this->appid = $account_wechats["\x6b\145\x79"]; goto GQ0fU; GQ0fU: $this->appsecret = $account_wechats["\x73\145\x63\x72\145\164"]; goto O138q; bKgk3: $account_wechats = Db::name("\x61\143\x63\157\x75\156\164\137\167\x65\x63\x68\x61\x74\163")->where("\165\x6e\x69\x61\x63\151\144", $wechats["\x61\x63\x63\157\x75\156\x74\137\167\145\143\150\141\x74\x73\x5f\x75\156\151\x61\x63\x69\144"])->find(); goto QYmWC; MVs_b: if (empty($wechats)) { goto dqhkZ; } goto bKgk3; gFL_V: dqhkZ: goto uPCrI; dBag_: $mch_id = Session::get("\155\x63\150\137\x69\x64"); goto PiJmU; O138q: J8Zmz: goto gFL_V; PiJmU: $wechats = Db::name("\x79\x62\163\143\137\167\x65\143\150\141\x74\x73")->where("\x6d\x63\150\137\x69\x64", $mch_id)->find(); goto MVs_b; uPCrI: } public function accredit($redirect_url) { goto a3rje; CS0IH: $url = "\x68\164\x74\160\163\72\57\x2f\157\x70\145\156\56\167\145\x69\170\x69\156\x2e\161\161\56\x63\x6f\x6d\57\143\x6f\x6e\x6e\145\x63\x74\x2f\157\141\x75\x74\x68\62\57\141\x75\x74\x68\157\x72\151\x7a\145\77\141\160\160\x69\144\x3d{$this->appid}\46\162\x65\144\151\162\145\x63\164\137\x75\x72\151\x3d{$redirect_url}\46\x72\x65\163\x70\x6f\x6e\x73\x65\137\x74\171\x70\x65\x3d\143\157\x64\145\x26\163\143\x6f\160\x65\x3d\163\x6e\163\x61\160\151\137\165\163\145\162\x69\156\146\x6f\46\x73\x74\141\164\x65\x3d\60\x23\x77\145\143\150\141\x74\137\162\x65\144\x69\162\x65\143\164"; goto czCPw; a3rje: $redirect_url = urlencode($redirect_url); goto CS0IH; czCPw: header("\114\157\143\141\x74\151\x6f\156\x3a{$url}"); goto RyTa_; RyTa_: } public function getAccessToken($code) { goto NVPZF; RBXvz: return $access_token; goto aHH1M; bYIBS: $res = file_get_contents($url); goto Xv59D; NVPZF: $url = "\150\164\x74\x70\163\72\x2f\x2f\141\x70\151\x2e\x77\x65\x69\x78\151\x6e\56\161\161\x2e\143\x6f\x6d\57\163\156\x73\x2f\157\141\165\x74\150\62\x2f\141\x63\143\145\x73\x73\x5f\164\x6f\x6b\x65\x6e\x3f\x61\x70\x70\x69\x64\75{$this->appid}\x26\x73\x65\x63\162\145\164\x3d{$this->appsecret}\x26\143\157\144\145\x3d{$code}\46\147\162\141\x6e\x74\x5f\x74\171\x70\145\75\x61\x75\x74\150\x6f\162\x69\x7a\141\164\x69\x6f\x6e\137\x63\157\x64\x65"; goto bYIBS; Xv59D: $access_token = json_decode($res, true); goto RBXvz; aHH1M: } public function getWeChatUserInfo($access_token, $openid) { goto W3Axw; UJtiS: $weChatUserInfo = json_decode($output, true); goto wNrwz; rszVp: $output = file_get_contents($url); goto UJtiS; W3Axw: $url = "\150\164\x74\160\163\x3a\x2f\x2f\141\160\151\56\167\145\x69\x78\151\156\56\161\161\x2e\143\x6f\155\57\163\156\163\57\x75\x73\x65\x72\x69\156\x66\157\77\x61\x63\143\x65\163\x73\137\164\x6f\x6b\x65\x6e\x3d{$access_token}\x26\x6f\160\145\156\151\144\x3d{$openid}\x26\154\141\x6e\x67\75\x7a\x68\x5f\103\116"; goto rszVp; wNrwz: return $weChatUserInfo; goto G9Hef; G9Hef: } }
