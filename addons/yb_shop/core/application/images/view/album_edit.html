<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="application/images/public/css/h-ui/css/H-ui.min.css?v=1.0"/>
    <link rel="stylesheet" href="application/images/public/css/h-ui/css/H-ui.admin.css"/>
    <link rel="stylesheet" href="application/images/public/css/h-ui/css/style.css"/>
    <link rel="stylesheet" href="application/images/public/css/ns_blue_common.css"/>
    <script src="application/images/public/js/jquery-2.1.1.js"></script>
    <script src="application/images/public/js/layer/2.4/layer.js"></script>
    <script src="application/images/public/js/public_js.js"></script>
    <style>
        input[type="checkbox"] + label::before {
            content: "\a0";  /*不换行空格*/
            display: inline-block;
            vertical-align: .2em;
            height: 15px;
            width: 15px;
            font-size: 22px;
            margin-right: .2em;
            border-radius: .2em;
            background-color: white;
            border: 1px solid #93a1a1;
            text-indent: .15em;
            line-height: .65;  /*行高不加单位，子元素将继承数字乘以自身字体尺寸而非父元素行高*/
            z-index: 9999;
            position: absolute;
        }
        input[type="checkbox"]:checked + label::before {
            content: "\2714";
            background-color:#00a0e9;
            color: white;
            height: 15px;
            width: 15px;
            font-size: 22px;
        }
        input[type="checkbox"] {
            position: absolute;
            clip: rect(0, 0, 0, 0);
            cursor:pointer;
        }
    </style>
</head>
<body>
<div class="pd-20">
    <input type="hidden" value="{$group_id}" id="group_id">
    <div class="cl pd-5 bg-1 bk-gray mt-20">
		<span class="l">
		<a href="javascript:;" id="open_uploader" class="btn btn-primary radius"> 上传图片</a>
        <input accept="image/gif, image/jpeg, image/png, image/jpg" type="file" id="fileupload" style="display: none" name="file_upload" multiple="multiple"/>
        <a href="javascript:;" onclick="album_images_del()" class="btn btn-danger radius"> 批量删除</a>
        <a href="javascript:;" onclick="album_cover()" class="btn btn-warning radius"> 设为封面</a>
        <a href="javascript:;" onclick="album_images_move()" class="btn btn-primary radius"> 移动图片到其他相册</a>
		</span>
    </div>
    {include file="uploadImg"/}
    <div class="portfolio-content">
        <ul class="cl portfolio-area">
            {volist name="list" id="vo"}
            <li class="item">
                <div class="portfoliobox">
                    <input class="checkbox" id="che-{$vo['img_id']}" name="img_array" type="checkbox" value="{$vo['img_id']}">
                    <label for="che-{$vo['img_id']}" style="height:150px;overflow: hidden;position: relative;">
                        <div  class="picbox" style="position: absolute;">
                            <img class="radius" src="{$vo['img_cover']}">
                        </div>
                    </label>
                </div>
            </li>
            {/volist}
        </ul>
        <div class="n_page_no">
            {$page}
        </div>
    </div>
</div>
<script type="text/javascript">
    $('#open_uploader').click(function () {
        $('#fileupload').click();
    });

    function album_images_del() {
        var ids = [];
        $('input[type=checkbox]:checked').each(function() {
            if (!isNaN($(this).val())) {
                ids.push($(this).val());
            }
        });
        if (ids.length === 0) {
            layer.msg('请选择图片', {icon: 2, time: 1000});
            return false;
        }
        ids = ids.join();
        layer.confirm('确认要删除吗？',function(index){
            layer.msg('图片删除中...', {
                icon: 16
                ,shade: 0.05
                ,time:900000
            });
            AjaxPost("{:url('images/index/album_images_del')}",{'img_ids':ids},function () {
                window.location.reload();
            });
        });
    }

    function album_images_move() {
        var ids = [];
        $('input[type=checkbox]:checked').each(function() {
            if (!isNaN($(this).val())) {
                ids.push($(this).val());
            }
        });
        if (ids.length === 0) {
            layer.msg('请选择图片', {icon: 2, time: 1000});
            return false;
        }
        ids = ids.join();
        var group_id = $("#group_id").val();
        layer.open({
            type: 2,
            area: ['600px', '400px'],
            fix: false, //不固定
            maxmin: true,
            shade:0.4,
            title: '要转移到那个相册？',
            content: "{:url('images/index/album_images_move')}&img_ids="+ids+"&group_id="+group_id,
            scrollbar:false,
            shadeClose:true,
        });
    }
    function album_cover() {
        var ids = []; //定义一数组
        $('input[type=checkbox]:checked').each(function() {
            if (!isNaN($(this).val())) {
                ids.push($(this).val());
            }
        });
        if (ids.length === 0) {
            layer.msg('请选择图片', {icon: 2, time: 1000});
            return false;
        } else if(ids.length > 1) {
            layer.msg('请选择一张图片作为封面', {icon: 2, time: 1000});
            return false;
        }
        var id = ids[0];
        AjaxPost("{:url('images/index/album_cover')}",{'img_id':id},function () {
            window.parent.location.reload();
        });
    }
</script>
</body>
</html>