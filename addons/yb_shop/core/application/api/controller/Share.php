<?php
 namespace app\api\controller; require_once BASE_ROOT . "\x63\x6f\162\145\57\141\160\160\x6c\x69\143\x61\164\151\x6f\x6e\57\x61\x70\151\57\143\x6f\x6e\x74\x72\157\x6c\x6c\x65\162\x2f\102\141\x73\145\x43\x6f\x6e\164\162\157\154\154\x65\x72\x2e\x70\x68\160"; use think\Request; use think\Db; use think\Session; use think\Cache; class Share extends BaseController { public function share() { goto RJ0iL; EbYUD: $mch_id = $this->getMchId($app_id); goto qzaXt; sz3D0: $data = $this->send_post($url, $post_data); goto jaPnZ; b346i: return json_encode($rs); goto rKKn7; cYu12: $ACCESS_TOKEN = $this->getWxAccessToken($APP_ID, $APPSECRET); goto wYAac; f5yvx: $APP_ID = $param["\101\x50\x50\137\x49\104"]; goto bBWID; RJ0iL: $rs = array("\143\157\x64\145" => 0, "\151\x6e\146\x6f" => array()); goto Wm9Pa; qzaXt: $type = Request::instance()->param("\x74\171\160\145"); goto ml7eg; iq55K: $post_data = array("\x73\143\145\156\145" => $id, "\160\141\x74\150" => $paths[$type]); goto sDsTh; Wm9Pa: $app_id = Request::instance()->param("\151"); goto EbYUD; l1W4l: if (empty($result)) { goto doNjy; } goto oP7UU; QyGYm: $rs["\x6d\163\147"] = "\346\x9c\252\xe9\x85\x8d\xe7\275\xae\345\225\x86\xe6\210\267\xe4\277\xa1\346\201\xaf"; goto sXiFb; wYAac: $url = "\150\x74\x74\160\163\72\x2f\57\141\x70\x69\x2e\167\145\x69\x78\x69\156\56\161\x71\x2e\143\x6f\x6d\x2f\x77\x78\141\57\x67\145\164\167\170\x61\143\157\144\145\x75\156\154\x69\155\151\x74\77\x61\143\x63\145\x73\163\x5f\x74\x6f\x6b\x65\156\75" . $ACCESS_TOKEN["\141\143\x63\x65\x73\163\x5f\164\x6f\x6b\145\156"]; goto iq55K; oP7UU: $rs["\143\157\x64\x65"] = 1; goto y1Yfl; PJb65: $rule = [["\x6d\x63\x68\137\x69\144", "\162\145\161\x75\x69\162\x65", "\xe4\xb8\215\xe5\xad\x98\345\x9c\250\345\225\x86\346\210\xb7"]]; goto RiOeA; KnmX_: $paths = array("\147\157\x6f\144\163" => "\171\142\137\163\x68\157\x70\57\x70\x61\147\145\163\57\x67\x6f\x6f\144\x73\57\144\x65\164\x61\151\154\57\x69\156\x64\145\170", "\x6b\141\x6e\152\x69\x61" => "\171\x62\137\163\x68\x6f\160\x2f\160\141\x67\145\163\x2f\153\x61\156\152\151\141\57\x67\157\x6f\144\x73\137\151\x6e\x66\x6f\57\x69\x6e\144\145\x78", "\160\151\156\164\165\141\156" => "\171\x62\x5f\x73\x68\157\x70\x2f\x70\x61\147\x65\163\x2f\160\151\156\x74\x75\x61\x6e\57\x70\141\x67\145\x73\57\x67\157\x6f\144\x73\57\144\x65\164\141\151\154"); goto PJb65; tojUs: Qt18x: goto cYu12; rKKn7: doNjy: goto AOLs8; sXiFb: return json_encode($rs); goto tojUs; RiOeA: $data = ["\155\x63\x68\x5f\x69\x64" => $mch_id]; goto Msz3l; PcZei: $this->createSharePng($gData, BASE_ROOT . "\57\163\143\x61\x6e\56\160\156\x67"); goto aTVPF; Msz3l: $result = $this->checkParam($rule, $data); goto l1W4l; lmbNN: $param = json_decode($param, true); goto f5yvx; tK1CH: $rs["\x63\x6f\x64\145"] = 1; goto QyGYm; jaPnZ: $gData = ["\160\x69\143" => Request::instance()->param("\151\x6d\x67"), "\x74\151\164\x6c\x65" => Request::instance()->param("\164\x69\x74\154\x65"), "\160\162\151\143\x65" => Request::instance()->param("\x70\162\x69\143\x65"), "\157\x72\x69\x67\x69\x6e\x61\x6c\137\160\162\x69\143\145" => Request::instance()->param("\157\x72\x69\147\151\x6e\x61\154\137\160\162\x69\x63\145") * 2, "\x63\x6f\x75\160\x6f\156\x5f\x70\162\151\143\x65" => 100, "\x71\x63\x6f\x64\x65" => $data]; goto PcZei; bBWID: $APPSECRET = $param["\x41\x50\x50\x5f\x53\105\103\x52\x45\x54"]; goto YLISn; sDsTh: $post_data = json_encode($post_data); goto sz3D0; YLISn: if (!(empty($APP_ID) || empty($APPSECRET))) { goto Qt18x; } goto tK1CH; y1Yfl: $rs["\155\x73\x67"] = $result; goto b346i; AOLs8: $param = Db::name("\171\142\x73\x63\137\143\157\156\x66\x69\147")->where("\153\x65\x79", "\127\x58\x50\x41\131")->where("\x6d\143\x68\x5f\151\144", $mch_id)->value("\166\141\154\x75\145"); goto lmbNN; ml7eg: $id = Request::instance()->param("\x69\144"); goto KnmX_; aTVPF: } public function getpic() { goto eDfSl; j_S2U: $url = Request::instance()->param("\x75\x72\154"); goto LKNgt; NSb7G: return json_encode($rs); goto qdbzc; bmUGj: $data = $this->get_url_content3(urldecode($url)); goto m65as; CujPe: $result = $this->checkParam($rule, $data); goto sBnVy; LKNgt: $rule = [["\155\x63\x68\x5f\151\144", "\162\145\161\165\x69\x72\x65", "\344\xb8\215\xe5\255\230\345\x9c\xa8\xe5\x95\206\346\x88\267"]]; goto AfObO; lwXPW: $rs["\143\157\x64\x65"] = 1; goto WacJU; eDfSl: $app_id = Request::instance()->param("\151"); goto J2sZY; WacJU: $rs["\155\163\x67"] = $result; goto NSb7G; AfObO: $data = ["\155\x63\150\x5f\151\144" => $mch_id]; goto CujPe; Gvb2X: exit($data); goto kxFrj; qdbzc: xwOAc: goto bmUGj; sBnVy: if (empty($result)) { goto xwOAc; } goto lwXPW; J2sZY: $mch_id = $this->getMchId($app_id); goto j_S2U; m65as: Header("\103\x6f\156\x74\145\x6e\164\x2d\x54\171\x70\x65\x3a\x20\151\x6d\141\147\145\57\160\156\147"); goto Gvb2X; kxFrj: } function get_url_content3($url, $method = true) { goto FhitE; UiS_4: curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, false); goto Xdguw; RcpAZ: curl_setopt($ch, CURLOPT_RETURNTRANSFER, true); goto FQfHN; BqgSS: y4cgb: goto LdiV2; kKzNR: curl_setopt($ch, CURLOPT_BINARYTRANSFER, 1); goto PdrB6; FhitE: $ch = curl_init(); goto STRP_; gF6KR: curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false); goto UiS_4; LdiV2: return $cont; goto m06Pp; FQfHN: curl_setopt($ch, CURLOPT_FOLLOWLOCATION, true); goto kKzNR; STRP_: curl_setopt($ch, CURLOPT_URL, $url); goto RcpAZ; uvphW: $cont = curl_exec($ch); goto ldb1n; Xdguw: QOgkV: goto uvphW; xfqxN: curl_close($ch); goto iu8qG; PdrB6: curl_setopt($ch, CURLOPT_HEADER, 0); goto ZeeYh; iu8qG: if (!($httpCode >= 300)) { goto y4cgb; } goto JSIqT; ldb1n: $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE); goto xfqxN; JSIqT: $cont = file_get_contents($url); goto BqgSS; ZeeYh: if (!$method) { goto QOgkV; } goto gF6KR; m06Pp: } public function getqrcode() { goto WreSe; SdbGD: $rs["\x63\x6f\144\145"] = 1; goto DLzat; fyHJp: Header("\x43\157\156\164\145\156\164\55\x54\171\160\145\x3a\x20\x69\x6d\141\147\x65\x2f\160\x6e\147"); goto eB_Vu; DLzat: $rs["\155\163\x67"] = $result; goto tNKpp; eB_Vu: exit($data); goto O5LcL; sd3Xw: if (empty($result)) { goto vnGdz; } goto SdbGD; nxWKv: $scene = Request::instance()->param("\x73\143\145\x6e\145"); goto KzUnQ; f_Mp8: return json_encode($rs); goto fZ_B9; Zc3JC: if (!(empty($APP_ID) || empty($APPSECRET))) { goto yCFp0; } goto Os3D8; qxQn2: $param = Db::name("\x79\142\x73\x63\x5f\143\x6f\156\146\x69\147")->where("\x6b\145\x79", "\127\x58\x50\101\131")->where("\155\x63\150\x5f\151\x64", $mch_id)->value("\166\141\x6c\165\145"); goto skH06; cW0AG: $post_data = json_encode($post_data); goto E3sHG; iD3HQ: vnGdz: goto qxQn2; Os3D8: $rs["\x63\x6f\144\145"] = 1; goto KrZww; gH85m: $APPSECRET = $_W["\141\143\x63\157\x75\x6e\164"]["\163\x65\143\162\x65\164"] ? $_W["\x61\x63\x63\x6f\165\156\x74"]["\x73\145\x63\162\145\164"] : $param["\x41\x50\x50\137\123\x45\x43\x52\105\124"]; goto Zc3JC; Z3E_R: $rule = [["\155\x63\150\x5f\x69\x64", "\x72\145\161\165\151\x72\145", "\344\xb8\215\xe5\255\230\xe5\234\xa8\345\225\206\346\x88\267"]]; goto xxeA3; BEvmD: $post_data = array("\163\x63\x65\156\x65" => $scene . "\x2c" . $pid, "\160\141\147\x65" => $path); goto cW0AG; WreSe: $rs = array("\x63\x6f\144\145" => 0, "\x69\156\146\x6f" => array()); goto cWr63; xxeA3: $data = ["\155\x63\x68\137\x69\144" => $mch_id]; goto RqXYc; NG010: $path = Request::instance()->param("\160\x61\164\150"); goto nxWKv; KrZww: $rs["\155\163\147"] = "\346\x9c\xaa\351\x85\215\xe7\275\xae\345\x95\x86\346\210\267\xe4\277\xa1\346\x81\257"; goto f_Mp8; NfAa2: $mch_id = $this->getMchId($app_id); goto NG010; fZ_B9: yCFp0: goto Bi_uu; kOeKj: global $_W; goto D6gHt; Bi_uu: $ACCESS_TOKEN = $this->getWxAccessToken($APP_ID, $APPSECRET); goto M9OL8; M9OL8: $url = "\x68\x74\164\x70\x73\72\x2f\57\141\x70\151\x2e\167\x65\x69\x78\x69\x6e\x2e\161\x71\56\x63\157\155\57\167\170\141\x2f\147\145\164\167\x78\x61\x63\157\144\x65\x75\156\154\151\x6d\x69\x74\x3f\x61\143\143\x65\x73\x73\137\164\157\153\x65\x6e\x3d" . $ACCESS_TOKEN["\141\x63\143\x65\163\x73\x5f\x74\x6f\x6b\145\156"]; goto BEvmD; tNKpp: return json_encode($rs); goto iD3HQ; KzUnQ: $pid = Request::instance()->param("\160\x69\144", 0); goto Z3E_R; RqXYc: $result = $this->checkParam($rule, $data); goto sd3Xw; E3sHG: $data = $this->post_data2($url, $post_data, false); goto fyHJp; D6gHt: $APP_ID = $_W["\x61\143\143\x6f\165\156\x74"]["\153\x65\171"] ? $_W["\x61\x63\x63\x6f\165\156\164"]["\x6b\145\x79"] : $param["\101\120\120\137\111\x44"]; goto gH85m; cWr63: $app_id = Request::instance()->param("\x69"); goto NfAa2; skH06: $param = json_decode($param, true); goto kOeKj; O5LcL: } private function createSharePng($gData, $codeName, $fileName = '') { goto gL0Hf; sXDz0: list($code_w, $code_h) = getimagesize($codeName); goto akqlG; AGEho: $theTitle = $this->cn_row_substr($gData["\x74\x69\x74\x6c\145"], 2, 16); goto UfG82; XJojF: imagesetthickness($im, 2); goto JSo0z; jrypF: imagettftext($im, 14, 0, 12, 920, $font_color_3, $font_file, "\345\216\x9f\xe4\273\267\357\xbf\245" . $gData["\x6f\x72\x69\147\x69\x6e\141\x6c\x5f\x70\162\151\143\145"]); goto mmITC; WVnYi: Header("\x43\x6f\x6e\164\145\x6e\x74\x2d\x54\x79\x70\145\72\x20\151\155\x61\147\x65\57\160\x6e\x67"); goto Qdohl; NKcxo: list($g_w, $g_h) = getimagesize($gData["\x70\151\143"]); goto syd6I; GcfAU: imagedestroy($goodImg); goto dVFcv; gL0Hf: $im = imagecreatetruecolor(750, 1030); goto CrHxI; k65xV: imagettftext($im, 28, 0, 85, 990, $font_color_red, $font_file_bold, $gData["\x70\x72\151\143\x65"]); goto XJojF; DsxCd: $font_color_3 = ImageColorAllocate($im, 129, 129, 129); goto ziVDH; mmITC: imagettftext($im, 14, 0, 12, 990, $font_color_2, $font_file, "\344\xbc\230\346\x83\240\344\273\267\357\277\xa5"); goto k65xV; EDbJn: $font_color_2 = ImageColorAllocate($im, 28, 28, 28); goto DsxCd; ziVDH: $font_color_red = ImageColorAllocate($im, 217, 45, 32); goto eGCAI; dVFcv: imagedestroy($codeImg); goto EVOLT; WOuxy: imagefill($im, 0, 0, $color); goto wLbKt; zltyy: $font_file_bold = BASE_ROOT . "\x2f\143\157\x72\145\x2f\160\x75\142\154\151\x63\x2f\163\x74\141\164\151\143\x2f\146\x6f\x6e\x74\x2f\x4d\123\131\x48\x42\x44\56\x54\x54\103"; goto EDbJn; E7YSr: t_OaU: goto hL0PE; Qdohl: imagepng($im); goto Y7j2g; akqlG: $codeImg = $this->createImageFromFile($codeName); goto q5Uiw; o9CsH: B9oz1: goto er79r; eGCAI: $fang_bg_color = ImageColorAllocate($im, 254, 216, 217); goto NKcxo; v4z59: if ($fileName) { goto B9oz1; } goto WVnYi; q5Uiw: imagecopyresized($im, $codeImg, 485, 765, 0, 0, 250, 250, $code_w, $code_h); goto O1duB; Y7j2g: goto t_OaU; goto o9CsH; O1duB: $codeImg = @imagecreatefromstring($gData["\x71\x63\157\x64\x65"]); goto q2akl; kauiq: imagettftext($im, 18, 0, 12, 840, $font_color_2, $font_file, $theTitle[2]); goto jrypF; hL0PE: imagedestroy($im); goto GcfAU; iI4yk: imagecopyresized($im, $goodImg, 0, 0, 0, 0, 750, 750, $g_w, $g_h); goto sXDz0; syd6I: $goodImg = $this->createImageFromFile($gData["\x70\x69\143"]); goto iI4yk; wLbKt: $font_file = BASE_ROOT . "\57\143\x6f\162\x65\x2f\x70\165\x62\154\x69\143\57\x73\164\x61\164\151\x63\57\146\x6f\x6e\x74\57\x4d\123\131\x48\56\x54\x54\103"; goto zltyy; q2akl: imagecopyresized($im, $codeImg, 524, 800, 0, 0, 170, 170, 430, 430); goto AGEho; JSo0z: imageline($im, 12, 912, 120, 912, $font_color_3); goto v4z59; er79r: imagepng($im, $fileName); goto E7YSr; UfG82: imagettftext($im, 18, 0, 12, 805, $font_color_2, $font_file, $theTitle[1]); goto kauiq; CrHxI: $color = imagecolorallocate($im, 255, 255, 255); goto WOuxy; EVOLT: } function createImageFromFile($file) { goto DRIqz; XdLRX: Vk9cz: goto MKLKp; EGZHz: Ll6Zx: goto ArHSo; jM9RX: $fileSuffix = pathinfo($file, PATHINFO_EXTENSION); goto L1fGH; L1fGH: goto f8AV8; goto EGZHz; oIwSh: ql2Z_: goto XdLRX; ArHSo: $fileSuffix = $this->getNetworkImgType($file); goto LGzal; nIQxj: return false; goto lPh2K; MKLKp: return $theImage; goto Tsy4N; DRIqz: if (preg_match("\x2f\150\164\164\160\x28\x73\51\x3f\x3a\134\x2f\x5c\57\x2f", $file)) { goto Ll6Zx; } goto jM9RX; Pn6v_: switch ($fileSuffix) { case "\x6a\160\x65\x67": $theImage = @imagecreatefromjpeg($file); goto Vk9cz; case "\152\x70\x67": $theImage = @imagecreatefromjpeg($file); goto Vk9cz; case "\160\x6e\147": $theImage = @imagecreatefrompng($file); goto Vk9cz; case "\x67\x69\x66": $theImage = @imagecreatefromgif($file); goto Vk9cz; default: $theImage = @imagecreatefromstring(file_get_contents($file)); goto Vk9cz; } goto oIwSh; LGzal: f8AV8: goto ramQj; ramQj: if ($fileSuffix) { goto SxINZ; } goto nIQxj; lPh2K: SxINZ: goto Pn6v_; Tsy4N: } function getNetworkImgType($url) { goto sbfGG; arUCK: ukp3m: goto Cx7Ic; sbfGG: $ch = curl_init(); goto yJYlm; facn6: dhUOm: goto EWack; Jn5nc: return false; goto tTIew; EWack: $theImgType = explode("\57", $http_code["\143\x6f\x6e\x74\145\x6e\x74\x5f\164\171\160\145"]); goto iaDZB; Xy1uH: o5XmD: goto PZxT0; n9D9X: curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false); goto FhM4w; ipr__: $http_code = curl_getinfo($ch); goto yx_Zz; iaDZB: if ($theImgType[0] == "\151\155\x61\x67\145") { goto ukp3m; } goto i_mBM; tTIew: goto o5XmD; goto facn6; yx_Zz: curl_close($ch); goto NtCVA; Cx7Ic: return $theImgType[1]; goto soxFi; yJYlm: curl_setopt($ch, CURLOPT_URL, $url); goto osPUX; i_mBM: return false; goto TT4BL; osPUX: curl_setopt($ch, CURLOPT_NOBODY, 1); goto Jb8nr; Jb8nr: curl_setopt($ch, CURLOPT_CONNECTTIMEOUT, 3); goto jUS8h; soxFi: kYalx: goto Xy1uH; TT4BL: goto kYalx; goto arUCK; jUS8h: curl_setopt($ch, CURLOPT_TIMEOUT, 3); goto n9D9X; NtCVA: if ($http_code["\150\x74\164\x70\x5f\x63\157\144\145"] == 200) { goto dhUOm; } goto Jn5nc; FhM4w: curl_exec($ch); goto ipr__; PZxT0: } function cn_row_substr($str, $row = 1, $number = 10, $suffix = true) { goto RkOFe; N2z8e: $r = 1; goto LqcPf; cFRBY: FvDWi: goto SviOi; XtvzY: if (!($r <= $row)) { goto eSCFh; } goto Pobv0; Pobv0: if ($r == $row and $theStrlen > $r * $oneRowNum and $suffix) { goto nqoh3; } goto vuCIN; t4iqN: goto t5dSi; goto GA1wq; SviOi: $theStrlen = strlen($str); goto c9mXt; tg0fn: $r++; goto A6RUt; K00Bd: cToDs: goto ruVWH; c9mXt: $oneRowNum = $number * 3; goto yuSLN; aGam2: w1SAf: goto g0krh; qUMt_: return $result; goto Y1gRR; IWpdb: sKJSh: goto XtvzY; A6RUt: goto sKJSh; goto ItaWH; NuS84: if (!($r <= $row)) { goto TtAeO; } goto tQ25i; BHXwT: goto COMdq; goto O_eLn; O_eLn: TtAeO: goto Pk6wQ; RkOFe: $result = array(); goto N2z8e; OEsfN: goto eSCFh; goto aGam2; TN8DT: $result[$r] = $this->mg_cn_substr($str, $oneRowNum - 6, ($r - 1) * $oneRowNum) . "\x2e\x2e\56"; goto Im1px; ItaWH: eSCFh: goto qUMt_; GA1wq: nqoh3: goto TN8DT; JvufE: return $result; goto cFRBY; g0krh: JyOVJ: goto tg0fn; yuSLN: $r = 1; goto IWpdb; qbZ3q: if ($str) { goto FvDWi; } goto JvufE; Pk6wQ: $str = trim($str); goto qbZ3q; LqcPf: COMdq: goto NuS84; Im1px: t5dSi: goto ZMfZF; ZMfZF: if (!($theStrlen < $r * $oneRowNum)) { goto w1SAf; } goto OEsfN; tQ25i: $result[$r] = ''; goto K00Bd; vuCIN: $result[$r] = $this->mg_cn_substr($str, $oneRowNum, ($r - 1) * $oneRowNum); goto t4iqN; ruVWH: $r++; goto BHXwT; Y1gRR: } function mg_cn_substr($str, $len, $start = 0) { goto TD2ow; N8_xZ: if (ord(substr($str, $i, 1)) > 0xa0) { goto V7xS2; } goto KpzHN; X_bof: $i = $start; goto kYce5; Fc_Ns: goto EZ9qb; goto GGVgi; TVy_3: if (!($a < 3)) { goto N4geR; } goto M4Wcx; tMLlA: HCRcD: goto J8MEt; wQ3D_: goto N4geR; goto j2SDC; KpzHN: $q_str .= substr($str, $i, 1); goto Fc_Ns; jXIB1: $q_str .= substr($str, $i, 3); goto tUVlN; rtDUZ: goto hyhc_; goto DwHcf; oU08T: if (!(json_encode($m_str) !== false)) { goto VwXLO; } goto Fu9N4; fDr43: goto WusB_; goto KBJyv; aqkGx: return $q_str; goto IELKx; j2SDC: VwXLO: goto tMLlA; XlOLI: ZtRjO: goto yZPvI; QT_9T: $m_str = substr($str, $new_start, 3); goto oU08T; kYce5: hyhc_: goto qnJCQ; Zgxuf: if (!($start and json_encode(substr($str, $start, 1)) === false)) { goto qSDGm; } goto Qi2dr; J8MEt: $a++; goto fDr43; KBJyv: N4geR: goto KLHjT; TD2ow: $q_str = ''; goto oKM0q; oKM0q: $q_strlen = $start + $len > strlen($str) ? strlen($str) : $start + $len; goto Zgxuf; DwHcf: OajBO: goto aqkGx; yZPvI: $i++; goto rtDUZ; qnJCQ: if (!($i < $q_strlen)) { goto OajBO; } goto N8_xZ; FByEI: EZ9qb: goto XlOLI; Qi2dr: $a = 0; goto Mcuij; Fu9N4: $start = $new_start; goto wQ3D_; M4Wcx: $new_start = $start + $a; goto QT_9T; Mcuij: WusB_: goto TVy_3; tUVlN: $i += 2; goto FByEI; GGVgi: V7xS2: goto jXIB1; KLHjT: qSDGm: goto X_bof; IELKx: } }
