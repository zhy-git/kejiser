<?php
 namespace app\api\controller; use think\Request; use think\Db; use app\api\service\UsercardService; use app\api\service\OrderService; require_once BASE_ROOT . "\x63\157\162\145\57\141\x70\160\x6c\x69\143\x61\x74\x69\157\x6e\x2f\x61\160\151\x2f\143\157\x6e\x74\x72\157\154\154\x65\162\57\x42\x61\x73\x65\103\x6f\x6e\164\162\x6f\x6c\154\x65\162\x2e\160\x68\160"; class Usercard extends BaseController { public function cardinfo() { goto t32Jq; nlJA9: return json_encode($rs); goto lkreT; w77Vp: $info = $goods->get_cardinfo($data); goto xn20q; t32Jq: $app_id = Request::instance()->param("\151"); goto NyXK7; un3dE: if (empty($result)) { goto qUedm; } goto ORmOY; jRQpg: $goods = new UsercardService(); goto w77Vp; tbdeT: $result = $this->checkParam($rule, $data); goto un3dE; xn20q: return $info; goto fsE3R; NyXK7: $mch_id = $this->getMchId($app_id); goto wgqaw; lkreT: qUedm: goto jRQpg; aIq5S: $rs["\x6d\163\147"] = $result; goto nlJA9; wgqaw: $data = ["\155\143\150\x5f\x69\144" => $mch_id, "\165\163\x65\162\137\151\144" => Request::instance()->param("\165\151\x64")]; goto YUZ5T; YUZ5T: $rule = [["\x6d\x63\x68\137\151\144", "\x72\145\x71\x75\x69\162\145", "\344\270\215\345\255\230\xe5\x9c\250\345\225\x86\xe6\210\267"], ["\165\163\145\162\x5f\x69\x64", "\162\x65\x71\165\151\162\145", "\346\234\252\xe8\216\267\xe5\x8f\226\xe7\224\250\xe6\x88\xb7\xe4\277\xa1\346\201\257"]]; goto tbdeT; ORmOY: $rs["\x63\157\144\x65"] = 1; goto aIq5S; fsE3R: } public function addcard() { goto SbnjI; SbnjI: $rs = array("\143\x6f\144\145" => 0, "\x69\x6e\x66\157" => array()); goto hPV2L; uQi22: $rs["\155\x73\147"] = $result; goto vwWCY; RHFg_: $data = ["\x6d\x63\150\x5f\x69\x64" => $mch_id, "\x75\x73\x65\162\137\151\144" => Request::instance()->param("\165\151\x64"), "\155\x6f\x62\x69\154\145" => Request::instance()->param("\x6d\x6f\x62\151\x6c\x65", ''), "\x6e\x61\x6d\145" => Request::instance()->param("\156\141\155\x65", '')]; goto Ek3hi; hPV2L: $app_id = Request::instance()->param("\151"); goto yTsoK; MG5Fm: $rs["\x63\x6f\144\145"] = 1; goto uQi22; jH4Ag: $goods = new UsercardService(); goto o7YlW; vwWCY: return json_encode($rs); goto qAR_2; qAR_2: XFivl: goto jH4Ag; Ek3hi: $rule = [["\155\143\x68\137\x69\x64", "\162\x65\161\165\x69\x72\145", "\xe4\xb8\x8d\xe5\255\x98\345\234\250\345\225\206\xe6\x88\xb7"], ["\165\x73\x65\162\x5f\151\x64", "\x72\x65\x71\x75\151\x72\x65", "\346\x9c\xaa\350\216\267\xe5\217\x96\347\224\xa8\xe6\210\xb7\344\277\241\xe6\x81\xaf"], ["\x6e\x61\x6d\145", "\162\145\161\165\x69\x72\x65", "\345\247\223\xe5\x90\x8d\xe4\xb8\215\xe8\203\275\344\270\xba\xe7\251\272"], ["\155\x6f\142\x69\154\x65", "\x72\x65\x71\x75\151\162\145", "\xe6\x89\213\346\x9c\xba\xe5\217\xb7\xe4\xb8\x8d\350\x83\275\344\270\272\xe7\251\xba"]]; goto OuyZt; yTsoK: $mch_id = $this->getMchId($app_id); goto RHFg_; lU0Kf: return $info; goto uVwsj; BjuDW: if (empty($result)) { goto XFivl; } goto MG5Fm; o7YlW: $info = $goods->get_addcard($data); goto lU0Kf; OuyZt: $result = $this->checkParam($rule, $data); goto BjuDW; uVwsj: } public function rechargemeal() { goto GOdE4; MlWY3: $rule = [["\x6d\143\150\137\x69\144", "\162\x65\161\x75\151\162\145", "\344\xb8\x8d\xe5\xad\x98\xe5\x9c\xa8\xe5\225\x86\346\x88\267"], ["\x75\x73\145\x72\137\x69\144", "\162\x65\x71\x75\x69\x72\145", "\xe6\234\252\350\x8e\xb7\345\x8f\226\347\224\xa8\xe6\x88\267\344\277\xa1\346\201\257"]]; goto A9_60; qjS4O: $rs["\x63\157\x64\145"] = 1; goto JjVPh; JjVPh: $rs["\155\163\x67"] = $result; goto DL29Z; DL29Z: return json_encode($rs); goto H1rGW; hVF0u: $mch_id = $this->getMchId($app_id); goto tUMAG; GOdE4: $app_id = Request::instance()->param("\x69"); goto hVF0u; eilI9: return $info; goto mwTQ8; Q22iz: $goods = new UsercardService(); goto keqH_; tUMAG: $data = ["\x6d\143\x68\x5f\151\144" => $mch_id, "\x75\163\145\x72\x5f\x69\x64" => Request::instance()->param("\165\x69\x64")]; goto MlWY3; A9_60: $result = $this->checkParam($rule, $data); goto tO09S; keqH_: $info = $goods->get_rechargemeal($data); goto eilI9; tO09S: if (empty($result)) { goto S752Z; } goto qjS4O; H1rGW: S752Z: goto Q22iz; mwTQ8: } public function createOrder() { goto pejZ4; Hu_Gp: try { goto lFegP; lFegP: $id = Db::name("\171\x62\163\143\x5f\x75\x73\x65\162\x5f\143\141\x72\144\137\x6f\x72\x64\x65\162\x73")->strict(true)->insertGetId($data); goto uJxHh; Db1S2: Db::commit(); goto Ou1eB; uJxHh: $pay_data = array("\157\165\164\137\164\x72\141\x64\x65\137\x6e\x6f" => $data["\x6f\x75\164\x5f\164\x72\x61\x64\145\x5f\x6e\x6f"], "\x70\141\171\137\x74\x79\160\x65" => Request::instance()->param("\x70\x61\x79\x5f\x74\171\160\145", "\61"), "\164\171\160\145\x5f\141\x6c\151\163\x5f\x69\x64" => $id, "\x70\x61\x79\137\142\x6f\144\171" => "\xe5\271\263\345\217\260\xe6\224\xaf\xe4\273\x98", "\x70\x61\171\x5f\x64\145\x74\141\x69\x6c" => "\xe4\274\232\xe5\221\230\xe5\x8d\241\345\205\205\345\x80\274", "\x70\x61\171\x5f\x6d\x6f\x6e\145\x79" => $data["\160\x61\x79\160\162\x69\x63\145"], "\143\162\145\x61\164\x65\137\x74\151\155\x65" => $time); goto S41BC; S41BC: Db::name("\x79\142\x73\143\137\x75\x73\x65\162\137\143\141\x72\x64\137\160\141\171\x6d\x65\x6e\x74")->insert($pay_data); goto Db1S2; Ou1eB: } catch (\Exception $e) { $id = 0; Db::rollback(); } goto Fnsey; dmr5M: $GLOBALS["\155\x63\150\x5f\x69\144"] = $mch_id; goto ktOgY; XMo3W: $rs["\x6d\x73\x67"] = "\xe7\x94\237\xe6\210\220\xe8\256\242\345\x8d\x95\345\244\261\350\xb4\xa5"; goto gsntJ; ijhKr: $pay_info["\160\141\x79\123\x69\x67\156"] = $pay_info["\163\151\x67\x6e"]; goto jqpzW; EK7p6: foreach ($this->objectArray($res) as $value) { $pay_info = $value; m4S9t: } goto hHYPq; lFI1D: $pay_info = array(); goto EK7p6; UK0ri: $input->SetNotify_url($notice_url); goto bOVa6; pFyCH: $input->SetTotal_fee($pay_data["\x70\141\x79\137\155\x6f\156\145\x79"] * 100); goto hwX2_; pejZ4: $rs = array("\143\157\x64\x65" => 0, "\x69\x6e\x66\x6f" => array()); goto q1s0g; ZZV7v: $rs["\155\163\x67"] = "\345\x85\205\xe5\200\274\xe5\244\261\xe8\264\xa5"; goto LZvvL; r1xPj: $rs["\155\x73\147"] = $result; goto mTgeS; tQ5bc: $rs["\x63\157\x64\x65"] = 1; goto ZZV7v; PjfG9: $notice_url = $_W["\163\x69\x74\x65\162\157\157\x74"] . "\x61\x64\x64\157\156\163\57\x79\x62\x5f\x73\150\x6f\160\x2f\143\157\162\145\x2f\x70\x61\x79\x5f\x63\141\x72\144\x2e\x70\150\160"; goto UK0ri; PPD0Y: exit(json_encode($rs, true)); goto yhP9K; QvC2n: le4aO: goto CBg6O; BBpV4: unset($data["\x6f\160\145\x6e\151\x64"]); goto Aqp2D; hwX2_: $input->SetOut_trade_no($pay_data["\157\165\x74\x5f\x74\x72\141\144\x65\x5f\156\157"]); goto T69cU; dUYsL: $data["\x70\141\171\x70\x72\151\143\145"] = round(floatval($data["\x70\141\x79\x70\162\x69\143\145"]), 2); goto CPvBN; CPvBN: $data["\143\162\x65\x61\x74\145\137\164\151\155\145"] = $time; goto ouLfM; nhi4H: $input->SetBody($pay_data["\x70\141\171\x5f\142\157\144\x79"]); goto qNsP8; ktOgY: $input = new \WxPayUnifiedOrder(); goto nhi4H; h6Wpo: $time = time(); goto hDQPJ; tQKJg: $rs["\x63\x6f\144\x65"] = 1; goto CO6WN; L_V1e: $rule = [["\x6d\x63\x68\x5f\151\x64", "\162\145\x71\165\151\x72\x65", "\344\270\215\xe5\255\230\345\x9c\xa8\xe5\x95\x86\xe6\210\xb7"], ["\157\160\145\156\x69\144", "\x72\145\x71\165\x69\x72\x65", "\346\x9c\252\350\x8e\267\xe5\x8f\x96\xe7\224\250\346\210\xb7\xe4\277\241\346\x81\xaf"], ["\x63\x61\x72\144\137\151\144", "\x72\x65\161\x75\x69\x72\145", "\346\234\252\350\x8e\xb7\xe5\x8f\226\xe7\x94\xa8\xe6\x88\xb7\xe4\xbf\241\xe6\x81\xaf"]]; goto ppIN6; x048V: goto STGvC; goto Dv9PR; rbmMY: fRJuB: goto fqxP2; zeSmO: if (empty($result)) { goto j1mk4; } goto tdO4z; L1LjR: Db::startTrans(); goto Hu_Gp; Ukinq: $rs["\155\163\x67"] = $unifiedorder["\162\x65\164\165\162\156\137\155\x73\x67"]; goto PPD0Y; hHYPq: I2TNP: goto ijhKr; Aqp2D: $data["\151\163\x70\x61\x79"] = 0; goto dUYsL; CO6WN: $rs["\x6d\163\x67"] = $unifiedorder["\x65\x72\162\x5f\x63\x6f\144\x65\x5f\x64\x65\163"]; goto xC3e6; KIL2x: $res = $this->weixinapp($unifiedorder); goto lFI1D; Dv9PR: m00o4: goto dmr5M; qNsP8: $input->SetOpenid($openid); goto JEyTV; jqpzW: unset($pay_info["\163\x69\147\x6e"]); goto SmrbB; q1s0g: $app_id = Request::instance()->param("\x69"); goto W1T7J; ppIN6: $result = $this->checkParam($rule, $data); goto zeSmO; ouLfM: $data["\157\x72\x64\145\162\137\x6e\x6f"] = $this->createOrderNo(); goto PmPX_; Fnsey: if (!empty($id)) { goto fRJuB; } goto tQ5bc; XGa04: $rs["\143\x6f\x64\x65"] = 1; goto XMo3W; xC3e6: exit(json_encode($rs, true)); goto QvC2n; VeWD1: $data = ["\x6d\143\150\137\151\x64" => $mch_id, "\x70\x61\171\x70\162\x69\143\x65" => Request::instance()->param("\x70\141\x79\160\162\x69\143\x65", 0), "\x67\151\x76\145\x70\162\x69\x63\145" => Request::instance()->param("\147\x69\166\145\160\162\x69\143\145", 0), "\143\x61\x72\144\137\x69\144" => Request::instance()->param("\143\x61\x72\144\x5f\151\144"), "\157\x70\x65\x6e\151\144" => Request::instance()->param("\157\x70\x65\x6e\x69\144"), "\x69\x6e\164\x65\147\x72\x61\x6c" => Request::instance()->param("\151\x6e\x74\145\x67\x72\x61\x6c", 0)]; goto L_V1e; eTI7r: $rs["\x63\157\x64\145"] = 1; goto Ukinq; gvgGs: global $_W; goto PjfG9; yhP9K: z3zxb: goto PJRXw; CBg6O: Db::name("\x79\142\x73\143\x5f\165\x73\145\x72\x5f\x63\x61\162\144\x5f\157\x72\144\145\162\163")->where("\x6f\x75\164\x5f\x74\x72\x61\x64\145\137\x6e\x6f", $data["\x6f\165\164\x5f\164\162\x61\x64\145\137\156\x6f"])->update(["\x70\x72\x65\x70\x61\x79\x5f\151\x64" => $unifiedorder["\160\x72\145\x70\141\x79\x5f\x69\x64"]]); goto KIL2x; PmPX_: $data["\x6f\x75\164\x5f\164\162\141\x64\145\x5f\156\x6f"] = $this->createOutTradeNo(); goto L1LjR; mTgeS: return json_encode($rs); goto SRqZF; JEyTV: $input->SetDetail($pay_data["\160\141\171\x5f\x64\x65\164\141\151\154"]); goto pFyCH; T69cU: $input->SetTrade_type("\x4a\123\x41\120\111"); goto gvgGs; SmrbB: $rs["\151\x6e\146\x6f"] = $pay_info; goto s3OGe; hDQPJ: $openid = $data["\x6f\160\145\156\x69\144"]; goto BBpV4; jFu29: STGvC: goto u0IUo; gsntJ: return json_encode($rs); goto x048V; fqxP2: if (!empty($pay_data)) { goto m00o4; } goto XGa04; vILhe: if (!($unifiedorder["\162\145\x74\x75\162\156\x5f\143\x6f\144\x65"] == "\106\x41\x49\114")) { goto z3zxb; } goto eTI7r; SRqZF: j1mk4: goto h6Wpo; PJRXw: if (!($unifiedorder["\x72\x65\x73\165\x6c\x74\x5f\x63\x6f\144\x65"] == "\x46\x41\x49\x4c")) { goto le4aO; } goto tQKJg; bOVa6: $unifiedorder = \WxPayApi::unifiedOrder($input); goto vILhe; W1T7J: $mch_id = $this->getMchId($app_id); goto VeWD1; tdO4z: $rs["\x63\x6f\144\x65"] = 1; goto r1xPj; s3OGe: return json_encode($rs); goto jFu29; LZvvL: return json_encode($rs); goto rbmMY; u0IUo: } private function weixinapp($unifiedorder) { goto qyeZ_; ukoYQ: $input->SetNonceStr($this->createNoncestr()); goto kEJCz; iPKgO: $input->SetSign(); goto qIdYU; kEJCz: $input->SetPackage("\160\x72\145\160\141\x79\x5f\x69\144\75" . $unifiedorder["\160\162\x65\160\141\x79\x5f\x69\x64"]); goto G7MKV; B7btH: $input->SetTimeStamp('' . time() . ''); goto ukoYQ; qyeZ_: $param = Db::name("\x79\142\163\x63\137\x63\x6f\x6e\x66\151\x67")->where("\x6b\145\171", "\x57\130\120\x41\x59")->where("\155\x63\x68\x5f\x69\x64", $GLOBALS["\155\x63\150\x5f\x69\x64"])->where("\x69\x73\x5f\x75\x73\x65", 1)->value("\x76\x61\154\x75\x65"); goto BVzMt; FhZbU: $input = new \WxPayJsApiPay(); goto F3TA7; G7MKV: $input->SetSignType("\x4d\104\65"); goto iPKgO; F3TA7: $input->SetAppid($param["\101\x50\x50\x5f\111\104"]); goto B7btH; qIdYU: return $input; goto UgIzJ; BVzMt: $param = json_decode($param, true); goto FhZbU; UgIzJ: } private function createNoncestr($length = 32) { goto tolD4; BZxgk: if (!($i < $length)) { goto ax6rI; } goto xzRnK; d0qIX: $i = 0; goto tvHaX; SjlBg: $i++; goto o8nCJ; dnHuU: $str = ''; goto d0qIX; PGeBi: return $str; goto mtVq7; o8nCJ: goto G_Mqm; goto Z5w5V; tolD4: $chars = "\141\x62\143\x64\145\146\147\x68\x69\152\153\x6c\155\156\x6f\x70\161\162\x73\x74\x75\x76\167\x78\171\172\60\61\x32\x33\64\x35\66\67\x38\71"; goto dnHuU; tvHaX: G_Mqm: goto BZxgk; Z5w5V: ax6rI: goto PGeBi; xzRnK: $str .= substr($chars, mt_rand(0, strlen($chars) - 1), 1); goto NcQmi; NcQmi: Kuu8A: goto SjlBg; mtVq7: } public function consumeLog() { goto vfFE7; RUHcK: $app_id = Request::instance()->param("\x69"); goto iKekW; KSSek: $rs["\143\x6f\x64\145"] = 1; goto zeowN; WZm3n: $page = Request::instance()->param("\160\141\x67\x65", 1); goto RUHcK; zgs34: return json_encode($rs); goto OqU72; d1_Qd: $rule = [["\142\165\x79\x65\162\x5f\x69\x64", "\x72\145\161\x75\x69\162\x65", "\165\151\x64\344\xb8\215\xe8\203\xbd\344\270\xba\xe7\251\272"], ["\x6d\143\x68\137\151\144", "\x72\x65\161\x75\151\162\x65", "\xe4\270\x8d\xe5\xad\230\xe5\x9c\xa8\xe5\225\206\xe6\x88\267"]]; goto MxhxN; OqU72: Vu7mQ: goto RSNr1; vfFE7: $rs = array("\x63\157\x64\x65" => 0, "\151\x6e\x66\157" => array()); goto kmg6l; RSNr1: $order = new OrderService(); goto OMaC9; iKekW: $mch_id = $this->getMchId($app_id); goto d1_Qd; Y4OCb: $result = $this->checkParam($rule, $data); goto lUWUI; Hd4lA: $rs["\151\x6e\x66\157"] = $info; goto fMxoZ; zeowN: $rs["\155\x73\147"] = $result; goto zgs34; MxhxN: $data = ["\x62\x75\171\x65\162\137\151\x64" => $uid, "\x6d\x63\150\x5f\x69\x64" => $mch_id]; goto Y4OCb; fMxoZ: return json_encode($rs); goto vQ_27; lUWUI: if (empty($result)) { goto Vu7mQ; } goto KSSek; yDT_t: $info = $order->orderList($data, $page); goto Hd4lA; OMaC9: $data["\160\141\171\x5f\x74\171\x70\145"] = 2; goto yDT_t; kmg6l: $uid = Request::instance()->param("\165\151\x64"); goto WZm3n; vQ_27: } public function exchangelog() { goto qbByn; P0UF8: if (empty($result)) { goto VObgK; } goto MNhjj; o69Zc: $page = Request::instance()->param("\x70\x61\147\x65", 1); goto zYzFz; GhR8H: VObgK: goto TLWB1; nfW1f: return json_encode($rs); goto kdksy; mdcjy: $app_id = Request::instance()->param("\151"); goto o69Zc; vC2Va: $rule = [["\x6d\x63\150\137\x69\144", "\162\x65\161\165\151\162\145", "\344\270\215\xe5\xad\230\345\234\xa8\345\x95\x86\xe6\210\xb7"], ["\x63\x61\x72\x64\137\x69\x64", "\x72\145\x71\165\151\162\x65", "\xe6\234\xaa\xe8\x8e\267\xe5\x8f\x96\347\x94\xa8\xe6\x88\267\xe4\277\241\xe6\201\257"]]; goto Jy93g; ZxFn3: $rs["\x6d\x73\147"] = $result; goto U0smq; MNhjj: $rs["\x63\157\x64\x65"] = 1; goto ZxFn3; gIV2o: $info = $goods->get_exchangelog($data, $page); goto Ys2nF; zYzFz: $mch_id = $this->getMchId($app_id); goto r3rJQ; Ys2nF: $rs["\151\x6e\146\157"] = $info; goto nfW1f; qbByn: $rs = array("\143\157\x64\x65" => 0, "\x69\156\146\x6f" => array()); goto mdcjy; U0smq: return json_encode($rs); goto GhR8H; TLWB1: $goods = new UsercardService(); goto gIV2o; Jy93g: $result = $this->checkParam($rule, $data); goto P0UF8; r3rJQ: $data = ["\155\143\150\x5f\x69\144" => $mch_id, "\x63\141\162\x64\137\x69\x64" => Request::instance()->param("\143\141\162\144\137\x69\144")]; goto vC2Va; kdksy: } }
