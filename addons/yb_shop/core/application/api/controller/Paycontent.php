<?php
 namespace app\api\controller; use think\Request; use think\Db; use think\Cache; require_once BASE_ROOT . "\x63\157\162\x65\57\145\x78\164\145\156\144\57\x57\x78\x70\x61\171\x2f\127\x78\x50\x61\x79\x2e\101\160\x69\x2e\x70\x68\x70"; require_once BASE_ROOT . "\143\157\x72\x65\x2f\x61\x70\160\x6c\x69\143\141\x74\151\157\x6e\57\x61\160\151\x2f\143\x6f\x6e\x74\x72\x6f\x6c\x6c\x65\x72\x2f\x42\x61\x73\145\103\x6f\x6e\x74\162\x6f\154\x6c\145\162\56\160\x68\160"; class Paycontent extends BaseController { public function paycontentClass() { goto xGCH_; xnjPn: $result = $this->checkParam($rule, $data); goto kHXcU; Gh1kn: if (!($info != false)) { goto Ms2zx; } goto OsfZ1; OsfZ1: $rs["\x69\156\x66\157"] = $info; goto OsAv9; hcntx: zQ32Z: goto CBcNe; bPVGC: $rule = [["\x6d\143\x68\137\x69\x64", "\x72\145\161\165\151\x72\145", "\xe4\xb8\x8d\345\255\230\345\234\xa8\345\225\x86\346\x88\xb7"]]; goto xnjPn; ZEzFW: $rs["\x69\x6e\146\x6f"] = $info; goto CFdJq; OsAv9: json_encode($rs); goto halQA; kHXcU: if (empty($result)) { goto zQ32Z; } goto V5SVq; halQA: Ms2zx: goto lW27v; xGCH_: $rs = array("\143\x6f\x64\145" => 0, "\x69\156\146\157" => array()); goto qwdx1; V5SVq: $rs["\143\x6f\144\145"] = 1; goto a3IMW; ImF45: return json_encode($rs); goto hcntx; a3IMW: $rs["\155\163\x67"] = $result; goto ImF45; CFdJq: return json_encode($rs); goto xUIMJ; teMzN: foreach ($cate_list as $value) { $info[] = $value; cfiEG: } goto c8B6X; EqsdM: $mch_id = $this->getMchId($app_id); goto PiAbI; lxgf0: $cate_list = Db::name("\x79\x62\163\143\x5f\x70\141\171\143\x6f\x6e\x74\x65\156\164\137\x63\154\x61\163\x73")->where("\x6d\143\150\137\x69\x64", $mch_id)->order("\163\157\162\164\x20\x61\x73\x63")->select(); goto teMzN; lW27v: $info = array(); goto lxgf0; kgRef: Cache::set($mch_id . "\x5f\160\x61\x79\143\157\156\164\145\x6e\164\x5f\143\154\141\163\x73", $rs, CACHE_TIME); goto ZEzFW; qwdx1: $app_id = Request::instance()->param("\x69"); goto EqsdM; c8B6X: TDkGA: goto kgRef; CBcNe: $info = Cache::get($mch_id . "\x5f\x70\x61\x79\143\x6f\x6e\164\x65\x6e\x74\x5f\143\154\x61\163\x73"); goto Gh1kn; PiAbI: $data = ["\155\143\x68\137\x69\144" => $mch_id]; goto bPVGC; xUIMJ: } public function paycontent_list() { goto MjQvq; H9WJ3: $mch_id = $this->getMchId($app_id); goto K_OCz; GKuBD: $info = Db::name("\x79\142\x73\x63\x5f\x70\x61\171\143\157\x6e\x74\x65\x6e\x74")->alias("\x70")->join("\x79\142\x73\x63\x5f\160\141\171\x63\x6f\156\x74\145\x6e\x74\137\157\x72\144\145\162\163\40\157", "\x6f\56\143\157\156\x74\145\x6e\164\137\151\x64\x20\x3d\40\160\56\151\144\40\x61\x6e\x64\x20\x6f\56\151\x73\120\x61\171\x20\x3d\40\61\40\40\141\156\144\40\157\56\165\x69\144\x3d" . $uid, "\114\105\x46\x54")->where($where)->field("\160\x2e\151\x64\x2c\160\56\163\157\162\x74\x2c\x70\56\x74\x69\x74\154\145\54\x70\x2e\143\154\141\x73\163\x5f\x69\x64\x2c\x70\x2e\x67\x72\x6f\165\160\x5f\151\144\x2c\x70\x2e\x69\155\141\x67\145\54\160\56\x70\x61\171\143\157\156\164\x65\156\164\x5f\x74\x79\x70\145\x2c\160\x2e\160\162\151\x63\x65\x2c\x70\x2e\x63\x72\145\x61\x74\145\137\164\151\155\x65\x2c\x70\x2e\146\162\x65\145\54\160\56\x76\151\x65\167\54\160\x2e\154\151\x6b\145\163\x2c\160\x2e\x62\165\171\x5f\x63\157\x75\156\x74\x5f\151\156\x69\x74\x2c\160\x2e\142\165\171\x5f\143\x6f\x75\x6e\164\137\162\145\141\x6c\54\157\56\151\x64\x20\x61\163\x20\x69\x73\x62\165\171")->order("\x70\56\x73\157\x72\x74\x20\x61\x73\143\54\x70\x2e\x69\144\x20\x64\145\x73\x63")->page($page, 20)->select(); goto HFJr8; omXcN: $uid = Request::instance()->param("\x75\x69\144", 0); goto H9WJ3; ro7aa: $rule = [["\155\x63\150\x5f\x69\x64", "\x72\x65\x71\x75\151\162\x65", "\xe4\270\x8d\xe5\255\x98\xe5\x9c\xa8\345\225\206\346\210\xb7"]]; goto shnr3; shnr3: $result = $this->checkParam($rule, $data); goto VcD3D; ZVJiW: return json_encode($rs); goto huDeg; HFJr8: if (!empty($info)) { goto kMmXy; } goto ZVJiW; c3gs4: return json_encode($rs); goto hP0VC; huDeg: kMmXy: goto uJbSY; VW6Xt: $class_id = Request::instance()->param("\x63\154\x61\x73\163\x5f\151\144", 0); goto loCwH; uJbSY: $rs["\151\x6e\x66\157"] = $info; goto c3gs4; qtOCD: if (!($class_id > 0)) { goto l09_a; } goto CU1WY; emiTO: l09_a: goto GKuBD; EZgy5: $where["\160\56\x6d\143\150\x5f\151\x64"] = $mch_id; goto MheAG; wr_oM: Ou2r_: goto EZgy5; VcD3D: if (empty($result)) { goto Ou2r_; } goto EbrP8; K_OCz: $data = ["\155\x63\x68\137\x69\x64" => $mch_id, "\143\154\141\163\163\x5f\x69\x64" => $class_id]; goto V0UB0; V0UB0: $data = array_filter($data); goto ro7aa; CU1WY: $where["\160\x2e\x63\154\141\x73\x73\137\x69\x64"] = $class_id; goto emiTO; loCwH: $app_id = Request::instance()->param("\x69"); goto CyF8O; MjQvq: $rs = array("\143\157\x64\x65" => 0, "\151\156\x66\x6f" => array()); goto VW6Xt; CyF8O: $page = Request::instance()->param("\x70\141\x67\145", 1); goto omXcN; MheAG: $where["\160\56\163\164\141\164\x75\x73"] = 1; goto qtOCD; EbrP8: $rs["\143\x6f\144\x65"] = 1; goto goLQ0; he2I8: return json_encode($rs); goto wr_oM; goLQ0: $rs["\155\163\x67"] = $result; goto he2I8; hP0VC: } public function checkuser() { goto aHJ44; zbxcX: $mch_id = $this->getMchId($app_id); goto NYjSz; J2IOx: $rule = [["\155\143\150\x5f\x69\x64", "\162\145\161\x75\x69\162\145", "\344\270\x8d\xe5\255\230\xe5\234\250\xe5\225\x86\xe6\210\267"]]; goto ctkiH; unogt: Bm1Gk: goto kYImF; ctkiH: $result = $this->checkParam($rule, $data); goto GyXy5; UMvXh: return json_encode($rs); goto unogt; vzoaN: if (!empty($user)) { goto N6aeU; } goto xMDqi; kYImF: $user = Db::name("\171\142\x73\x63\137\160\141\x79\143\x6f\x6e\x74\145\x6e\x74\137\x75\x73\145\162")->where(["\165\x69\x64" => $uid])->find(); goto vzoaN; ktuvA: return json_encode($rs); goto CY7VZ; eoMdD: $app_id = Request::instance()->param("\151"); goto XrAzJ; GyXy5: if (empty($result)) { goto Bm1Gk; } goto BpM9h; XrAzJ: $uid = Request::instance()->param("\165\151\x64", 0); goto zbxcX; xMDqi: $user["\145\170\160\151\x72\x65"] = 0; goto LfVFq; Qm02t: $data = array_filter($data); goto J2IOx; V2qlP: $rs["\151\x6e\146\x6f"] = $user["\x65\x78\160\x69\162\145"] >= time(); goto ktuvA; LfVFq: N6aeU: goto V2qlP; BpM9h: $rs["\143\x6f\x64\x65"] = 1; goto tgb3S; aHJ44: $rs = array("\143\x6f\144\145" => 0, "\x69\x6e\x66\x6f" => array()); goto LaDlM; LaDlM: $class_id = Request::instance()->param("\x63\154\141\x73\163\x5f\x69\x64", 0); goto eoMdD; tgb3S: $rs["\155\163\147"] = $result; goto UMvXh; NYjSz: $data = ["\x6d\x63\150\137\x69\144" => $mch_id, "\143\154\x61\x73\x73\137\x69\x64" => $class_id]; goto Qm02t; CY7VZ: } public function paycontent_info() { goto GOs_g; nVql_: $user = Db::name("\x79\x62\x73\143\x5f\x70\x61\171\143\x6f\x6e\x74\x65\156\164\137\x75\x73\145\x72")->where(["\x75\151\144" => $uid, "\x6d\143\150\137\x69\x64" => $mch_id, "\x65\x78\160\151\x72\145" => ["\x67\164", time()]])->find(); goto MZ2tQ; LRkc0: $samegroup = Db::name("\x79\142\x73\143\x5f\x70\141\171\x63\157\156\x74\145\x6e\164")->where(["\147\x72\x6f\165\x70\x5f\151\x64" => $info["\147\x72\157\165\160\137\x69\x64"], "\155\143\150\x5f\151\x64" => $mch_id])->count(); goto PadLA; AAseG: $group["\x62\165\x79\137\x63\157\x75\156\164"] = $info["\x62\165\x79\137\x63\157\x75\156\164\137\x69\156\x69\164"] + $info["\142\165\x79\x5f\x63\157\165\156\x74\137\x72\x65\141\x6c"]; goto hhdoZ; pXC8w: $rs["\x6d\x73\147"] = "\xe6\232\x82\xe6\227\xa0\346\x96\207\xe7\xab\240"; goto lgf6k; gpKmK: $group = Db::name("\171\142\x73\x63\137\160\141\171\x63\157\156\x74\145\156\164\137\147\162\x6f\x75\x70")->where(["\151\144" => $info["\147\x72\x6f\x75\160\x5f\x69\x64"], "\x6d\x63\150\x5f\151\x64" => $mch_id])->find(); goto cXMbV; ga95E: $info = Db::name("\171\142\163\x63\x5f\x70\x61\171\x63\x6f\x6e\164\145\156\164")->alias("\160")->join("\x79\142\x73\143\x5f\160\141\x79\143\x6f\156\164\x65\x6e\164\137\157\x72\x64\145\x72\x73\40\x6f", "\x70\x2e\151\144\x20\75\x20\x6f\x2e\x63\x6f\156\164\x65\x6e\164\137\x69\x64\40\141\x6e\x64\40\x6f\56\151\163\120\x61\171\x20\75\40\61\40\x20\141\x6e\x64\x20\x6f\56\165\x69\144\75" . $uid, "\x4c\105\x46\x54")->where(["\x70\56\x69\144" => $id, "\160\56\155\x63\x68\x5f\151\144" => $mch_id])->field("\160\56\52\54\157\56\x69\x64\40\x61\x73\x20\x69\163\x62\x75\x79")->find(); goto pzeE1; gDMEE: $mch_id = $this->getMchId($app_id); goto e_C_R; FBum4: $group["\154\x69\x6b\x65\137\143\x6f\165\x6e\164"] = $info["\x6c\x69\153\x65\163"]; goto AAseG; dGKkp: unset($info["\x76\x69\144\x65\x6f\x5f\x75\x72\x6c"]); goto SBRTE; UaegG: $info["\147\x72\157\x75\160"] = $group; goto DkGm8; F_XEK: Db::name("\171\x62\163\143\x5f\x70\141\171\x63\x6f\x6e\164\145\x6e\164")->where(["\x69\144" => $id, "\x6d\143\x68\137\x69\x64" => $mch_id])->setInc("\166\x69\145\167"); goto vv98h; TYrDJ: $group["\160\162\x69\x63\x65"] = $group_price; goto hwI3h; hvuDC: uG1yo: goto sanjn; r2LKZ: $info["\x6c\151\x6b\145\x64"] = !empty($likes); goto sI1v_; VmilQ: $uid = Request::instance()->param("\x75\151\144", 0); goto ga95E; e_C_R: $id = Request::instance()->param("\x69\144"); goto VmilQ; y03Pe: uPds3: goto F_XEK; hZYro: $app_id = Request::instance()->param("\x69"); goto gDMEE; MZ2tQ: if (!($info["\146\x72\145\145"] != 1 && ($info["\160\162\151\143\x65"] == 0.0 && empty($user) || $info["\160\x72\x69\143\x65"] > 0.0 && empty($info["\151\x73\x62\x75\171"])))) { goto d2z5J; } goto jOGmB; oy5HN: if (empty($info["\x67\x72\x6f\165\x70\137\x69\x64"])) { goto pDlHb; } goto LRkc0; GOs_g: $rs = array("\143\x6f\x64\x65" => 0, "\x69\x6e\x66\157" => array()); goto hZYro; hwY3D: NX_eq: goto Sld89; FDWIZ: $group["\x70\162\151\x63\x65"] = $group_price; goto hwY3D; R9bK9: $group["\x76\151\x65\x77\137\x63\x6f\x75\x6e\x74"] = $count["\166\151\145\x77\x5f\x63\x6f\165\x6e\164"]; goto C6k2D; S3wms: $samegroup = 0; goto oy5HN; C6k2D: $group["\x6c\x69\x6b\x65\x5f\x63\x6f\165\x6e\x74"] = $count["\x6c\x69\153\145\x5f\143\x6f\x75\x6e\x74"]; goto hCzrR; hCzrR: $group["\142\x75\x79\x5f\143\x6f\x75\156\x74"] = $count["\x62\x75\x79\x5f\143\157\x75\156\164"]; goto FDWIZ; PadLA: pDlHb: goto gpKmK; sanjn: $count = Db::name("\x79\142\x73\x63\137\x70\141\x79\x63\157\x6e\164\145\156\x74")->where(["\x67\162\157\x75\160\137\x69\144" => $info["\x67\x72\x6f\165\160\x5f\151\x64"], "\x6d\143\x68\137\151\144" => $mch_id])->field("\x73\x75\155\x28\x76\151\x65\167\51\40\141\x73\x20\x76\151\x65\167\x5f\143\157\x75\156\x74\54\163\x75\155\50\154\x69\x6b\x65\x73\x29\40\141\x73\x20\154\x69\x6b\x65\137\x63\x6f\x75\156\x74\54\x73\x75\x6d\x28\x62\x75\x79\x5f\143\x6f\165\156\164\137\151\156\x69\164\x2b\142\x75\171\137\x63\x6f\165\x6e\x74\137\162\145\141\x6c\51\40\x61\x73\40\142\x75\171\x5f\143\157\x75\x6e\x74")->find(); goto R9bK9; hwI3h: goto NX_eq; goto hvuDC; lgf6k: return json_encode($rs); goto y03Pe; Bu3G9: $group = array(); goto lefbK; hhdoZ: $group["\151\155\x67"] = $info["\x69\x6d\141\x67\x65"]; goto TYrDJ; DkGm8: $likes = Db::name("\x79\x62\x73\x63\137\160\141\x79\x63\x6f\156\164\145\156\164\x5f\x6c\151\x6b\145\x73")->where(["\165\151\x64" => $uid, "\155\143\150\137\151\144" => $mch_id, "\160\x61\x79\143\x6f\x6e\164\145\156\164\x5f\x69\144" => $id])->find(); goto r2LKZ; sI1v_: $rs["\x69\156\x66\x6f"] = $info; goto tm1g1; lefbK: $group["\166\151\145\x77\x5f\143\x6f\165\156\164"] = $info["\x76\151\145\x77"]; goto FBum4; SBRTE: unset($info["\x61\x75\144\151\157\x5f\x75\162\154"]); goto YV1cv; Sld89: $group["\163\141\155\145\x5f\143\x6f\165\156\164"] = $samegroup; goto nVql_; cXMbV: $group_price = empty($group["\160\x72\x69\x63\x65"]) ? 0.0 : $group["\160\x72\x69\143\145"]; goto jmrgI; YV1cv: d2z5J: goto UaegG; pzeE1: if (!empty($info)) { goto uPds3; } goto pXC8w; jOGmB: unset($info["\143\157\156\x74\145\156\164"]); goto dGKkp; jmrgI: if (!empty($group)) { goto uG1yo; } goto Bu3G9; vv98h: $info["\166\151\145\x77"] += 1; goto S3wms; tm1g1: return json_encode($rs); goto RFmnq; RFmnq: } public function samegroup() { goto GrP13; U1fUm: ofCXv: goto vsndp; T_VRO: R3Umn: goto Bc6y7; ERO0g: $uid = Request::instance()->param("\x75\x69\144"); goto YJSUT; t5_GX: if (!$uid) { goto JUimx; } goto q3qyi; Poj2M: JUimx: goto e9OxK; xeGyD: $app_id = Request::instance()->param("\x69"); goto WeZSf; pi09w: $where["\160\x2e\x6d\x63\x68\x5f\151\x64"] = $mch_id; goto w0jbG; SG6Z0: $where2 = "\x6f\x2e\143\157\x6e\x74\145\156\164\x5f\151\x64\x20\75\x20\160\x2e\151\144\40\141\156\144\x20\x6f\56\x69\163\x50\x61\171\x20\75\x20\61"; goto t5_GX; ld501: fi2LR: goto SG6Z0; DEp4Y: $info = Db::name("\x79\142\163\x63\x5f\160\141\171\x63\157\x6e\164\145\x6e\x74")->where(["\x69\144" => $id, "\155\x63\x68\x5f\151\144" => $mch_id])->find(); goto ijxo3; Bc6y7: $where["\x70\x2e\147\x72\157\x75\160\137\151\144"] = $info["\x67\162\157\x75\160\x5f\151\144"]; goto ld501; e9OxK: $list = Db::name("\x79\x62\x73\x63\137\160\x61\171\143\x6f\156\164\x65\156\x74")->alias("\x70")->join("\x79\142\x73\x63\137\160\x61\x79\x63\157\x6e\x74\145\156\x74\137\x6f\x72\x64\x65\x72\163\40\157", $where2, "\x4c\x45\106\124")->where($where)->field("\x70\x2e\151\x64\54\x70\x2e\163\157\162\164\54\160\x2e\x74\x69\x74\x6c\145\54\x70\x2e\143\x6c\141\163\163\x5f\x69\144\x2c\160\x2e\x67\162\157\165\x70\137\x69\144\x2c\160\x2e\x69\x6d\x61\x67\x65\x2c\x70\x2e\x70\x61\x79\143\x6f\x6e\164\x65\156\164\x5f\x74\171\160\145\x2c\160\56\160\x72\x69\x63\145\54\160\56\x63\x72\145\141\x74\x65\137\x74\x69\x6d\145\x2c\160\x2e\146\162\145\x65\x2c\160\56\166\x69\x65\x77\x2c\x70\x2e\154\151\x6b\x65\x73\54\160\x2e\x62\165\171\137\143\x6f\165\x6e\x74\x5f\x69\x6e\151\164\x2c\x70\56\x62\x75\171\137\x63\157\165\156\164\x5f\x72\x65\x61\x6c\x2c\157\x2e\151\144\40\141\x73\x20\x69\163\x62\x75\x79")->order("\160\x2e\x73\x6f\x72\x74\x20\141\x73\x63\54\160\x2e\x69\x64\x20\144\145\163\143")->page($page, 20)->select(); goto Is39j; MMU4w: goto fi2LR; goto T_VRO; muaQ1: $id = Request::instance()->param("\151\144"); goto ERO0g; GrP13: $rs = array("\x63\x6f\144\145" => 0, "\x69\156\146\x6f" => array()); goto xeGyD; Is39j: $rs["\x69\156\146\157"] = $list; goto bAVL7; rcwEh: $where["\160\x2e\143\154\141\163\x73\x5f\x69\x64"] = $info["\143\x6c\x61\163\163\137\151\144"]; goto MMU4w; q3qyi: $where2 = $where2 . "\40\141\156\x64\40\x75\151\x64\x3d" . $uid; goto Poj2M; qp0FK: return json_encode($rs); goto U1fUm; WeZSf: $mch_id = $this->getMchId($app_id); goto muaQ1; ijxo3: if (!empty($info)) { goto ofCXv; } goto fp0jh; bAVL7: return json_encode($rs); goto czhUM; w0jbG: if (!empty($info["\147\162\x6f\165\x70\x5f\x69\x64"]) && $info["\x67\162\157\x75\x70\137\151\144"] > 0) { goto R3Umn; } goto rcwEh; fp0jh: $rs["\155\x73\x67"] = "\346\x9a\x82\346\x97\xa0\xe5\206\205\xe5\xae\xb9"; goto qp0FK; YJSUT: $page = Request::instance()->param("\x70\x61\x67\145", 1); goto DEp4Y; vsndp: $where = array(); goto pi09w; czhUM: } public function dolike() { goto kCLqF; kCLqF: $rs = array("\143\157\144\145" => 0, "\151\x6e\146\157" => array()); goto tBI4q; RGhfU: $rs["\x63\157\x64\145"] = $res; goto lH2a_; CXOQq: NOlqo: goto RGhfU; JmslQ: U6cmJ: goto kQQF9; kQQF9: $data["\x75\151\x64"] = $uid; goto WrjYQ; WrjYQ: $data["\160\x61\x79\x63\157\156\x74\145\156\164\x5f\x69\144"] = $id; goto FxPnS; tBI4q: $app_id = Request::instance()->param("\151"); goto IHXQA; xmCq9: $id = Request::instance()->param("\151\x64"); goto oLF9F; FxPnS: $data["\155\x63\x68\137\x69\144"] = $mch_id; goto tfPMg; N1bVb: $res = Db::name("\x79\142\x73\x63\x5f\160\x61\x79\143\157\156\164\x65\156\164\137\154\151\x6b\x65\x73")->where(["\x69\144" => $likes["\x69\144"]])->delete(); goto PGIfB; UkiqI: $likes = Db::name("\171\x62\x73\x63\137\x70\141\x79\143\157\x6e\164\x65\156\x74\137\x6c\151\153\x65\163")->where(["\165\151\144" => $uid, "\155\x63\x68\137\151\x64" => $mch_id, "\x70\141\171\x63\157\x6e\164\145\156\x74\x5f\151\x64" => $id])->find(); goto vuoVo; oLF9F: $uid = Request::instance()->param("\165\151\144", 0); goto UkiqI; IHXQA: $mch_id = $this->getMchId($app_id); goto xmCq9; rdtb6: Db::name("\171\x62\163\x63\137\160\x61\171\143\x6f\x6e\164\145\x6e\x74")->where(["\151\144" => $id, "\155\x63\x68\137\x69\144" => $mch_id])->setInc("\x6c\151\153\x65\163"); goto CXOQq; tfPMg: $res = Db::name("\x79\x62\x73\x63\137\160\x61\171\143\x6f\x6e\x74\145\156\164\x5f\x6c\x69\x6b\x65\163")->insert($data); goto rdtb6; lH2a_: return json_encode($rs); goto hZvzT; PGIfB: goto NOlqo; goto JmslQ; vuoVo: if (empty($likes)) { goto U6cmJ; } goto N1bVb; hZvzT: } public function allprice() { goto pfFYd; aWn8R: $list = [["\x6e\x61\x6d\x65" => "\xe5\215\225\xe7\213\254\350\264\xad\xe4\271\xb0", "\x69\144" => 0, "\x70\162\x69\x63\x65" => $info["\160\162\151\x63\x65"], "\x69\x6e\x66\x6f" => "\xe8\xb4\255\344\271\xb0\xe5\x90\216\345\x8d\xb3\345\217\257\346\265\217\xe8\247\x88\346\x9f\245\xe7\x9c\x8b\xe6\255\xa4\xe5\x86\205\xe5\xae\xb9"]]; goto RJkzL; JzJsg: tZTh1: goto aWn8R; UhE7X: $mch_id = $this->getMchId($app_id); goto F8oV0; HMvtE: return json_encode($rs); goto pOBXt; F8oV0: $id = Request::instance()->param("\151\x64", 0); goto H_RiF; pfFYd: $rs = array("\x63\157\144\145" => 0, "\x69\156\x66\x6f" => array()); goto XSGBq; UEPli: $list = Db::name("\x79\x62\163\x63\x5f\x70\x61\x79\x63\x6f\156\x74\x65\x6e\164\x5f\x70\162\151\143\145\x73")->where(["\155\143\150\137\x69\x64" => $mch_id, "\163\x74\x61\x74\165\x73" => 1])->order("\163\x6f\x72\x74\40\141\163\x63")->select(); goto HQoyB; RJkzL: H2AqP: goto bSWHf; bSWHf: $rs["\151\156\146\157"] = $list; goto HMvtE; H_RiF: $info = Db::name("\171\142\x73\x63\137\160\x61\x79\x63\x6f\x6e\x74\x65\156\x74")->where(["\x6d\143\x68\x5f\x69\144" => $mch_id, "\x69\144" => $id])->find(); goto wJHOl; HQoyB: goto H2AqP; goto JzJsg; XSGBq: $app_id = Request::instance()->param("\x69"); goto UhE7X; wJHOl: if (!empty($info) && $info["\x70\162\x69\x63\x65"] > 0) { goto tZTh1; } goto UEPli; pOBXt: } public function uinfo() { goto XjNhA; avdW1: $rs["\x69\x6e\x66\x6f"] = $user; goto pA6dx; hC65b: $mch_id = $this->getMchId($app_id); goto gK5SD; nDsvp: $user["\x69\163\166\x69\160"] = $user["\145\x78\160\x69\x72\145"] > time(); goto lpwff; pA6dx: return json_encode($rs); goto JNh2A; gK5SD: $uid = Request::instance()->param("\x75\151\x64", 0); goto ZPlkm; QazGB: $app_id = Request::instance()->param("\x69"); goto hC65b; m5hqz: $user["\145\170\x70\151\x72\145\137\144\141\171"] = date("\131\55\155\55\x64", $user["\145\x78\160\151\x72\x65"]); goto nDsvp; ZPlkm: $user = Db::name("\171\142\163\143\x5f\160\141\171\143\x6f\x6e\x74\145\x6e\164\137\x75\163\145\162")->where(["\165\x69\x64" => $uid, "\x6d\143\x68\x5f\x69\x64" => $mch_id])->find(); goto brz73; XjNhA: $rs = array("\x63\x6f\144\x65" => 0, "\x69\156\146\157" => array()); goto QazGB; brz73: if (empty($user)) { goto lZ0dB; } goto m5hqz; lpwff: lZ0dB: goto rYIKo; rYIKo: $rs["\x63\x6f\144\145"] = empty($user) ? 0 : 1; goto avdW1; JNh2A: } public function order() { goto urX8W; CiZGY: $list = Db::name("\171\142\163\143\137\x70\141\171\143\x6f\x6e\x74\145\156\164\x5f\157\162\144\x65\162\x73")->where(["\165\x69\144" => $uid, "\155\143\x68\x5f\151\x64" => $mch_id, "\x69\163\x50\141\x79" => 1])->page($page, 20)->select(); goto RwsCd; HBztp: return json_encode($rs); goto MLx58; JRpii: $rs["\x63\x6f\144\145"] = 1; goto W8LLB; lnOOU: $mch_id = $this->getMchId($app_id); goto ylLIi; urX8W: $rs = array("\x63\157\x64\x65" => 0, "\151\156\x66\157" => array()); goto lcHCE; RwsCd: foreach ($list as &$item) { goto mNTnm; MjG1L: XT3pk: goto MF2QN; U_ZM_: $item["\x62\165\x79\137\151\156\x66\x6f"] = $item["\160\162\x69\x63\x65\137\156\x61\155\x65"] . "\x20\x78\x20" . $item["\156\165\x6d"]; goto MjG1L; mNTnm: $item["\142\165\171\137\164\151\x6d\x65"] = date("\131\x2d\155\55\x64\40\110\x3a\x69\72\163", $item["\x63\x72\145\141\164\145\x5f\164\151\155\145"]); goto U_ZM_; MF2QN: } goto F62jF; J39oU: $page = Request::instance()->param("\160\x61\x67\145", 1); goto CiZGY; W8LLB: $rs["\151\x6e\146\157"] = $list; goto HBztp; lcHCE: $app_id = Request::instance()->param("\x69"); goto lnOOU; F62jF: Nk7zC: goto JRpii; ylLIi: $uid = Request::instance()->param("\x75\x69\x64", 0); goto J39oU; MLx58: } public function order_del() { goto XAr6O; kbMu5: $rs["\151\x6e\146\x6f"] = $info; goto QZpYJ; iF0cu: if (!($id > 0)) { goto YWZTo; } goto jagzA; XAr6O: $rs = array("\143\157\144\145" => 0, "\x69\156\x66\x6f" => array()); goto YV86X; nOD9I: $mch_id = $this->getMchId($app_id); goto VuMiu; jagzA: $info = Db::name("\171\142\163\x63\x5f\160\x61\x79\x63\x6f\156\164\145\x6e\x74\x5f\x6f\x72\144\145\x72\x73")->where(["\151\144" => $id, "\155\x63\x68\137\151\144" => $mch_id, "\x75\151\x64" => $uid])->delete(); goto kbMu5; YEctm: YWZTo: goto iDn3C; J9RML: $uid = Request::instance()->param("\165\151\x64", 0); goto iF0cu; VuMiu: $id = Request::instance()->param("\157\162\144\x65\162\x5f\151\x64", 0); goto J9RML; YV86X: $app_id = Request::instance()->param("\151"); goto nOD9I; iDn3C: return json_encode($rs); goto cmMaR; QZpYJ: $rs["\143\157\x64\145"] = 1; goto YEctm; cmMaR: } public function likes() { goto H1aMr; dlxH_: $page = Request::instance()->param("\160\x61\x67\145", 1); goto V6GIA; NoE8k: $app_id = Request::instance()->param("\151"); goto Ke4yJ; V6GIA: $list = Db::name("\x79\142\163\x63\x5f\160\x61\171\x63\x6f\156\164\145\156\164\137\x6c\151\153\145\x73")->alias("\154")->join("\x79\142\x73\x63\137\x70\x61\x79\143\x6f\156\x74\x65\x6e\x74\x20\143", "\154\56\x70\141\171\143\157\156\x74\x65\156\164\x5f\x69\144\x3d\143\x2e\151\144")->where(["\154\x2e\165\x69\144" => $uid, "\x6c\x2e\x6d\143\x68\x5f\x69\x64" => $mch_id])->field("\x63\56\x2a")->page($page, 20)->select(); goto CvjbB; xKiff: $rs["\151\x6e\146\x6f"] = $list; goto XrPQd; Ke4yJ: $mch_id = $this->getMchId($app_id); goto plucc; CvjbB: $rs["\143\x6f\144\145"] = 1; goto xKiff; XrPQd: return json_encode($rs); goto HDr_M; H1aMr: $rs = array("\x63\157\x64\x65" => 0, "\x69\x6e\x66\157" => array()); goto NoE8k; plucc: $uid = Request::instance()->param("\x75\x69\x64", 0); goto dlxH_; HDr_M: } public function createOrder() { goto b_5Ow; Guh7T: $unifiedorder = \WxPayApi::unifiedOrder($input); goto ro4mG; Gh9kG: return json_encode($rs); goto iUegg; m7PWn: $mch_id = $this->getMchId($app_id); goto rr7SD; wrK9F: $input = new \WxPayUnifiedOrder(); goto r0UPm; ZZb7b: laJcM: goto KHV0F; tGs6G: $data["\x74\x6f\164\x61\x6c\x50\162\151\143\145"] = round($data["\x6e\x75\x6d"] * $data["\160\x72\x69\143\x65"], 2); goto HCeFk; R_YVi: $data["\143\162\x65\x61\164\145\x5f\164\151\155\145"] = $time; goto jxc0t; kStUk: if (!empty($id)) { goto laJcM; } goto DhJWK; YxPD3: $rs["\x63\157\144\145"] = 1; goto evRrV; r0UPm: $input->SetBody($pay_data["\160\141\171\x5f\142\157\x64\x79"]); goto gC3Bg; xWiLu: $rs["\x63\157\x64\x65"] = 1; goto LMpYV; qTAjv: $uid = Request::instance()->param("\x75\x69\x64"); goto rI1AU; uOBjg: $input->SetDetail($pay_data["\160\x61\171\x5f\144\145\x74\141\151\x6c"]); goto mAujb; yB8cD: $notice_url = $_W["\x73\x69\164\x65\x72\157\157\x74"] . "\x61\x64\x64\x6f\156\x73\x2f\x79\x62\x5f\163\x68\157\x70\x2f\143\x6f\162\x65\x2f\x70\141\x79\137\160\141\171\x63\157\x6e\164\x65\156\x74\x2e\x70\150\x70"; goto IWniT; LMpYV: $rs["\155\x73\x67"] = $unifiedorder["\x72\145\x74\165\162\x6e\137\x6d\x73\x67"]; goto LatTu; gnXCV: u63MO: goto JORo8; JORo8: $time = time(); goto Ac0x5; I8uy7: $data["\156\x75\x6d"] = $num; goto tGs6G; i3VTe: $info = Db::name("\171\x62\163\143\137\160\x61\x79\143\x6f\156\164\145\x6e\x74")->where(["\151\144" => $content_id, "\155\x63\x68\x5f\x69\x64" => $mch_id])->find(); goto RVYXu; gna4I: unset($pay_info["\163\151\147\156"]); goto sAA3q; NZT1l: return json_encode($rs); goto tk02N; EaGAC: $data["\x6f\x72\x64\145\x72\x5f\x6e\x6f"] = $this->createOrderNo(); goto HLVfs; Fmu8F: $pay_info["\x70\141\x79\123\x69\x67\156"] = $pay_info["\x73\x69\147\x6e"]; goto gna4I; gC3Bg: $input->SetOpenid($openid); goto uOBjg; rbzMz: $price_info = Db::name("\x79\142\163\x63\137\160\141\x79\143\157\156\164\x65\156\x74\x5f\160\x72\x69\x63\145\163")->where(["\x69\144" => $price_id, "\x6d\x63\150\x5f\x69\144" => $mch_id])->find(); goto gnXCV; O80yH: edg5n: goto t19FE; Gri3r: OB_Ju: goto Fmu8F; EBVnq: uETql: goto nzcRO; cwHAH: goto u63MO; goto pf6Hd; u69ly: $data["\x70\162\x69\x63\x65\137\x69\x64"] = $price_id; goto N9q2V; nlSLS: $content_id = Request::instance()->param("\x63\157\x6e\164\x65\x6e\164\x5f\151\x64", 0); goto dWkqr; LZx_K: $app_id = Request::instance()->param("\x69"); goto m7PWn; fzwsA: TRjwN: goto oT_tW; cwVx_: $rs["\x63\157\x64\x65"] = 1; goto MknZ2; N9q2V: $data["\x70\x72\151\x63\x65\x5f\156\141\x6d\145"] = $price_info["\156\x61\x6d\145"]; goto I8uy7; UBzR8: $data["\143\x6f\x6e\164\x65\x6e\164\x5f\x69\x64"] = $content_id; goto u69ly; DhJWK: $rs["\143\x6f\x64\145"] = 1; goto xA02I; rr7SD: $price_id = Request::instance()->param("\160\162\x69\143\145\137\x69\x64", 0); goto YYHiF; tk02N: HA6bd: goto nAL2i; Ra5MM: $input->SetOut_trade_no($pay_data["\x6f\x75\164\x5f\164\162\x61\144\145\137\x6e\157"]); goto rFj3K; AWUUX: return json_encode($rs); goto ZZb7b; Ac0x5: $data["\x70\x72\151\x63\x65"] = $price_info["\160\x72\x69\x63\145"]; goto dQKo6; hII0U: exit(json_encode($rs, true)); goto EBVnq; p3ZZk: global $_W; goto yB8cD; ztUH4: Db::startTrans(); goto J85MF; YYHiF: $num = Request::instance()->param("\156\165\155"); goto qTAjv; oT_tW: $GLOBALS["\155\x63\x68\137\x69\x64"] = $mch_id; goto wrK9F; dWkqr: if ($price_id > 0) { goto ksCZR; } goto i3VTe; xA02I: $rs["\x6d\x73\147"] = "\xe7\224\x9f\xe6\210\x90\350\xae\242\xe5\x8d\225\xe5\244\xb1\350\264\245"; goto AWUUX; dQKo6: $data["\x75\151\x64"] = $uid; goto UBzR8; wiymd: foreach ($this->objectArray($res) as $value) { $pay_info = $value; DqYWK: } goto Gri3r; rFj3K: $input->SetTrade_type("\112\123\101\x50\x49"); goto p3ZZk; zWmHg: $pay_info = array(); goto wiymd; HCeFk: $data["\144\141\171"] = $price_info["\144\141\171"]; goto R_YVi; MknZ2: $rs["\155\x73\x67"] = $unifiedorder["\x65\x72\x72\137\143\157\144\145\x5f\x64\x65\163"]; goto hII0U; sAA3q: $rs["\151\x6e\x66\x6f"] = $pay_info; goto NZT1l; evRrV: $rs["\155\163\147"] = "\xe7\224\x9f\346\x88\220\xe8\xae\xa2\xe5\215\x95\345\xa4\xb1\350\xb4\245"; goto Gh9kG; jxc0t: $data["\x6d\x63\150\137\x69\x64"] = $mch_id; goto EaGAC; HLVfs: $data["\x6f\165\164\x5f\x74\162\x61\144\x65\137\x6e\157"] = $this->createOutTradeNo(); goto ztUH4; b_5Ow: $rs = array("\x63\x6f\x64\x65" => 0, "\151\156\x66\157" => array()); goto LZx_K; nzcRO: $res = $this->weixinapp($unifiedorder); goto zWmHg; J85MF: try { goto zkYHl; F1F0Y: Db::commit(); goto vE3gB; ucSx4: $pay_data = array("\x6f\x75\x74\137\164\162\141\x64\145\137\x6e\157" => $data["\x6f\165\164\x5f\x74\x72\141\x64\145\137\x6e\x6f"], "\160\x61\171\137\164\x79\160\145" => Request::instance()->param("\160\x61\x79\137\164\171\x70\145", "\x31"), "\x74\171\160\145\x5f\141\154\151\163\x5f\151\x64" => $id, "\160\x61\171\x5f\x62\157\144\x79" => "\345\271\263\345\x8f\260\346\x94\xaf\xe4\273\230", "\160\141\171\x5f\144\145\x74\141\151\154" => "\345\271\263\xe5\x8f\260\350\xb4\255\xe4\xb9\xb0\xe5\x95\206\345\x93\x81", "\160\x61\x79\x5f\x6d\157\x6e\145\171" => $data["\x74\x6f\x74\x61\x6c\120\x72\151\x63\145"], "\143\162\145\x61\x74\145\x5f\164\x69\x6d\145" => $time); goto R0xnj; zkYHl: $id = Db::name("\171\142\163\x63\x5f\x70\141\171\x63\x6f\156\164\145\x6e\x74\137\157\x72\x64\145\x72\x73")->strict(true)->insertGetId($data); goto ucSx4; R0xnj: Db::name("\171\142\163\x63\x5f\x70\141\x79\x63\x6f\x6e\x74\145\156\x74\x5f\x70\x61\x79\155\x65\x6e\164")->insert($pay_data); goto F1F0Y; vE3gB: } catch (\Exception $e) { $id = 0; Db::rollback(); } goto kStUk; LatTu: exit(json_encode($rs, true)); goto O80yH; pf6Hd: ksCZR: goto rbzMz; IWniT: $input->SetNotify_url($notice_url); goto Guh7T; ro4mG: if (!($unifiedorder["\162\145\164\x75\x72\x6e\137\143\x6f\x64\x65"] == "\x46\101\111\114")) { goto edg5n; } goto xWiLu; iUegg: goto HA6bd; goto fzwsA; mAujb: $input->SetTotal_fee($pay_data["\x70\x61\171\x5f\155\157\x6e\x65\171"] * 100); goto Ra5MM; rI1AU: $openid = Request::instance()->param("\x6f\160\x65\x6e\151\144"); goto nlSLS; KHV0F: if (!empty($pay_data)) { goto TRjwN; } goto YxPD3; t19FE: if (!($unifiedorder["\x72\x65\163\165\x6c\164\x5f\x63\x6f\x64\x65"] == "\x46\x41\111\x4c")) { goto uETql; } goto cwVx_; RVYXu: $price_info = ["\x70\x72\x69\x63\x65" => $info["\x70\162\x69\x63\x65"], "\156\x61\x6d\x65" => "\345\x86\x85\xe5\xae\xb9\345\x8d\225\347\x8b\xac\350\264\xad\344\xb9\xb0", "\x64\x61\x79" => 0]; goto cwHAH; nAL2i: } private function weixinapp($unifiedorder) { goto r7ktx; MHHkH: $param = json_decode($param, true); goto X0wSv; M2dlU: return $input; goto XD0cH; X0wSv: $input = new \WxPayJsApiPay(); goto wFjlg; r7ktx: $param = Db::name("\x79\x62\x73\143\137\143\x6f\x6e\x66\151\x67")->where("\x6b\x65\171", "\127\130\120\x41\x59")->where("\155\x63\x68\x5f\x69\144", $GLOBALS["\x6d\143\150\137\151\144"])->where("\151\163\x5f\165\163\145", 1)->value("\166\x61\154\x75\x65"); goto MHHkH; wFjlg: $input->SetAppid($param["\101\x50\x50\137\111\x44"]); goto hwkW4; erJWy: $input->SetNonceStr($this->createNoncestr()); goto CAob3; OC6hx: $input->SetSign(); goto M2dlU; CAob3: $input->SetPackage("\x70\162\145\160\141\x79\137\x69\144\x3d" . $unifiedorder["\160\162\x65\x70\x61\171\137\151\144"]); goto y2XK3; hwkW4: $input->SetTimeStamp('' . time() . ''); goto erJWy; y2XK3: $input->SetSignType("\x4d\x44\x35"); goto OC6hx; XD0cH: } private function createNoncestr($length = 32) { goto ocmrZ; E9z_L: return $str; goto Q9uj0; rrI3x: z0IL5: goto eRP5v; go1RE: $i = 0; goto rrI3x; V3aYn: goto z0IL5; goto a59qb; ocmrZ: $chars = "\x61\142\143\144\145\146\x67\x68\151\x6a\153\x6c\x6d\156\157\160\x71\x72\x73\x74\165\x76\167\170\x79\x7a\x30\61\62\63\64\65\x36\x37\70\71"; goto GLYjo; a59qb: kCIbk: goto E9z_L; MEVVT: $i++; goto V3aYn; eRP5v: if (!($i < $length)) { goto kCIbk; } goto CTwgA; q82Ar: nx8fL: goto MEVVT; CTwgA: $str .= substr($chars, mt_rand(0, strlen($chars) - 1), 1); goto q82Ar; GLYjo: $str = ''; goto go1RE; Q9uj0: } }
