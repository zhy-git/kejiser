<?php
 namespace app\api\controller; use think\Request; use think\Log; use app\api\service\CaterPayService; use app\common\model\Business; use app\common\model\ResOrder; use app\common\model\BusinessStamping; require EXTEND_PATH . "\x4e\145\164\x70\x72\x69\156\164\x2f\x70\162\151\x6e\164\x68\x65\x6c\x70\x65\x72\56\160\x68\x70"; class Caterpay extends BaseController { public function OrderInfo() { goto su4na; geLjj: if (!empty($info)) { goto nAF5O; } goto S1DdO; U1wTm: return json_encode($rs); goto Mm3EG; S1DdO: $rs["\x63\x6f\144\145"] = 1; goto QNm1G; rBrJ_: $result = $this->checkParam($rule, $data); goto mmcMl; ORqla: return json_encode($rs); goto ngdTV; mmcMl: if (empty($result)) { goto rE0MG; } goto BZCCN; su4na: $rs = array("\x63\157\x64\145" => 0, "\151\156\146\157" => array()); goto KNLae; ngdTV: rE0MG: goto uHTts; n3iQf: $rs["\155\x73\x67"] = $result; goto ORqla; RzD0C: return json_encode($rs); goto Iwsal; heSVR: $rule = [["\x6f\x72\x64\x65\x72\137\x69\144", "\x72\145\161\x75\x69\162\145"]]; goto rBrJ_; Mm3EG: nAF5O: goto EdYm9; QNm1G: $rs["\x6d\163\x67"] = "\xe8\256\xa2\345\x8d\x95\344\277\xa1\346\201\257\xe4\270\272\347\xa9\272"; goto U1wTm; jH6EZ: $info = $pay->orderInfo($data); goto geLjj; uHTts: $pay = new CaterPayService(); goto jH6EZ; EdYm9: $rs["\151\x6e\146\x6f"] = $info; goto RzD0C; KNLae: $data = ["\157\162\x64\x65\162\x5f\x69\x64" => Request::instance()->param("\x6f\x72\x64\145\x72\137\x69\144")]; goto heSVR; BZCCN: $rs["\143\x6f\x64\145"] = 1; goto n3iQf; Iwsal: } public function Pay() { goto DqxVG; bkaih: $rs["\x69\156\x66\157"] = $pay_info; goto T1LJY; wc6xy: $result = $this->checkParam($rule, $data); goto e1l7o; uv09Y: $pay_info = array(); goto QPycD; e1l7o: if (empty($result)) { goto V9Aci; } goto qYncq; xZYD5: unset($pay_info["\x73\x69\147\156"]); goto bkaih; osUsn: $rs["\x63\157\144\145"] = 1; goto ve4dZ; ve4dZ: $rs["\155\x73\147"] = $info["\x6d\163\x67"]; goto EvKkj; wlhT0: $rule = [["\157\165\164\137\164\162\x61\x64\145\137\156\157", "\x72\145\x71\x75\151\x72\145"], ["\157\x70\x65\x6e\x69\x64", "\x72\145\161\165\151\x72\x65"], ["\x6d\x63\x68\137\x69\x64", "\162\145\x71\x75\x69\162\145", "\344\xb8\x8d\xe5\xad\x98\345\234\xa8\345\225\x86\xe6\x88\xb7"]]; goto wc6xy; EvKkj: return json_encode($rs); goto mrCqk; m_1Gc: $pay_info["\x70\x61\x79\x53\151\147\156"] = $pay_info["\x73\151\147\156"]; goto xZYD5; mrCqk: uq7VE: goto uv09Y; laKHM: $data = ["\x6f\165\164\x5f\164\162\141\144\x65\x5f\x6e\x6f" => Request::instance()->param("\157\x75\164\x5f\164\x72\x61\144\x65\x5f\x6e\157"), "\157\160\x65\x6e\151\x64" => Request::instance()->param("\x6f\160\x65\x6e\x69\x64"), "\155\x63\150\137\151\x64" => $mch_id]; goto wlhT0; a0U1T: V9Aci: goto ZuQfk; CJdB0: if (!($info["\143\x6f\144\x65"] == 1)) { goto uq7VE; } goto osUsn; RLf1b: $info = $pay->orderPay($data); goto CJdB0; w5mmr: $mch_id = $this->getMchId($app_id); goto laKHM; kmZyd: return json_encode($rs); goto a0U1T; T1LJY: return json_encode($rs); goto gstm3; ZuQfk: $pay = new CaterPayService(); goto RLf1b; tCO0a: ZCdVh: goto m_1Gc; MnysF: $app_id = Request::instance()->param("\x69"); goto w5mmr; QPycD: foreach ($this->objectArray($info["\x69\x6e\x66\157"]) as $value) { $pay_info = $value; nepem: } goto tCO0a; qYncq: $rs["\143\x6f\144\145"] = 1; goto llMLH; DqxVG: $rs = array("\143\x6f\x64\x65" => 0, "\x69\x6e\146\157" => array()); goto MnysF; llMLH: $rs["\155\x73\x67"] = $result; goto kmZyd; gstm3: } public function PayCallback() { goto RxMqw; qOX_c: $rs["\151\156\x66\157"] = $info; goto FHdTI; rEqAe: $out_trade_no = $doc->getElementsByTagName("\157\x75\x74\x5f\x74\x72\141\x64\x65\x5f\156\157")->item(0)->nodeValue; goto C3hCo; FHdTI: return json_encode($rs); goto Mrzhh; eS40T: $notify_data = $GLOBALS["\x48\x54\124\x50\x5f\122\x41\127\x5f\x50\x4f\x53\x54\137\x44\101\124\101"] ?: ''; goto O82ps; HtqII: $doc = new \DOMDocument(); goto gw6Al; Fabii: $this->printorder($out_trade_no); goto qOX_c; TN9PP: lnZvk: goto HtqII; RxMqw: $notify_data = file_get_contents("\x70\x68\x70\72\57\57\x69\156\x70\x75\164"); goto dsIWS; wpkDu: $pay = new CaterPayService(); goto mBPm_; dsIWS: if ($notify_data) { goto wq29s; } goto eS40T; C3hCo: Log::write($out_trade_no . "\x2c\xe6\224\xaf\344\xbb\230\345\256\x8c\xe6\210\x90", "\x63\x61\x74\x65\x72\137\x70\x61\171\x5f\163\x75\143\143\145\x73\x73"); goto wpkDu; mBPm_: $info = $pay->payCallback($out_trade_no, 1); goto Fabii; ERa00: if ($notify_data) { goto lnZvk; } goto gAj5n; gAj5n: exit("\346\234\xaa\346\224\xb6\xe5\210\xb0\xe5\x9b\236\xe8\xb0\203"); goto TN9PP; gw6Al: $doc->loadXML($notify_data); goto rEqAe; O82ps: wq29s: goto ERa00; Mrzhh: } public function printorder($out_trade_no) { goto Mjze2; CjEMq: file_get_contents($url); goto h_M2H; iL99b: $url = "\150\x74\164\x70\163\x3a\57\x2f\x76\x69\x70\x2e\x6c\171\61\x30\x30\x2e\x77\141\x6e\147\57\141\160\x69\57\x61\x70\160\x2f\x41\x6c\151\171\x75\156\x2f\x70\165\x73\150\77\155\143\x68\137\x69\x64\75" . $info["\x6d\x63\150\x5f\x69\x64"]; goto CjEMq; TrwKl: $resorder->where("\157\x75\x74\137\x74\x72\x61\144\145\137\156\x6f", $out_trade_no)->update(["\x69\163\x5f\x70\162\151\156\x74" => 1]); goto dYilD; J07Fa: foreach ($print_list as $item) { $res[] = $helper->printHtmlContent($item["\165\165\x69\x64"], "\150\164\164\x70\x73\x3a\57\x2f\x76\151\160\x2e\x6c\x79\x31\x30\60\56\167\141\156\x67\x2f\167\141\160\57\x63\157\x75\156\164\57\122\x65\x73\117\x72\x64\x65\162\x44\x69\163\150\x4c\x69\x73\x74\x3f\x61\160\x70\x5f\x69\x64\x3d\132\120\x52\132\x49\x4a\x4e\120\106\x32\x26\x6f\x72\144\145\x72\x5f\151\144\x3d" . $info["\x6f\162\x64\145\162\137\x69\144"], $item["\x6f\160\x65\x6e\x5f\x75\163\145\x72\x5f\x69\144"]); Ze_ae: } goto yByMm; NYAt3: $print_list = $print->where("\x6d\x63\150\x5f\151\144", $info["\x6d\143\150\137\x69\x64"])->select(); goto lAyam; lAyam: $res = array(); goto J07Fa; Gm7PF: $print = new BusinessStamping(); goto NYAt3; kCN33: Fgyc2: goto iL99b; Jea72: exit; goto kCN33; Mjze2: $resorder = new ResOrder(); goto cziq8; IYz1t: if (!empty($info)) { goto Fgyc2; } goto Jea72; cziq8: $info = $resorder->where("\157\165\x74\x5f\164\162\x61\144\145\137\156\x6f", $out_trade_no)->where("\x69\163\x5f\160\x72\x69\156\x74", "\x30")->find(); goto IYz1t; h_M2H: $helper = new \PrintHelper(); goto Gm7PF; yByMm: HA2WT: goto TrwKl; dYilD: } }
