<?php
 namespace app\api\service; use think\Db; use think\log; use think\Exception; require_once BASE_ROOT . "\143\x6f\x72\145\x2f\145\170\x74\x65\156\144\x2f\x57\x78\x70\x61\x79\x2f\127\x78\x50\x61\x79\56\101\x70\x69\x2e\160\x68\x70"; require_once BASE_ROOT . "\x63\157\x72\x65\57\141\x70\160\154\151\x63\141\164\x69\157\156\57\x61\x70\151\57\x73\145\x72\166\151\143\x65\x2f\x52\145\146\x75\x6e\144\x53\x65\x72\166\x69\x63\x65\56\x70\150\x70"; use app\api\service\RefundService; class MiaoshaService { private $g = "\x79\x62\x73\143\137\141\x63\164\151\166\x69\164\171"; public function get_msGoodsList($data, $page, $type) { goto KkyXa; TOyew: lOnbj: goto v1WAB; f26bS: jQ08A: goto wunSl; IIdIA: $data["\x73\164\141\164\165\x73"] = 1; goto C9DTQ; V3lh5: $data["\145\x74\x69\x6d\x65"] = ["\x3e", $time]; goto Jz3ft; Jz3ft: if ($type == 1) { goto XfbzL; } goto sw6CQ; C9DTQ: $data["\x69\x73\137\x64\145\x6c"] = 2; goto V3lh5; ZD30S: foreach ($list as $k => $v) { goto Xc2_U; U1j8d: $list[$k]["\x72\145\x73\x74\137\x73\x65\x6c\154"] = intval($list[$k]["\x61\x6c\154\137\163\145\x6c\154"]) - intval($list[$k]["\x69\x73\x5f\x62\x75\x79"]); goto ytGxI; SA0Pd: CjjmN: goto lsDBJ; Wo3iF: YmYI0: goto rtTJN; lsDBJ: $where = ["\141\x63\x74\151\x76\151\164\171\137\x6f\x72\x64\145\162\137\x74\x79\x70\x65" => 3, "\157\162\x64\x65\162\137\x73\x74\x61\x74\x75\163" => ["\151\156", [1, 2, 3]], "\x70\x61\171\x5f\163\x74\x61\164\165\163" => 1, "\151\163\137\x64\x65\x6c\x65\x74\x65\x64" => 0, "\155\143\150\x5f\151\144" => $data["\155\x63\x68\x5f\151\x64"], "\142\x61\x72\x67\x61\x69\x6e\x5f\151\144" => $v["\151\144"]]; goto Tv4NM; IlT1m: Z4Rx4: goto Wo3iF; ytGxI: $list[$k]["\x70\x72\157\x67\x72\x65\163\163"] = round(intval($list[$k]["\x72\x65\163\164\x5f\x73\x65\154\154"]) / intval($list[$k]["\141\x6c\x6c\137\163\145\154\x6c"]) * 100, 2); goto IlT1m; Tv4NM: $list[$k]["\x69\x73\137\x62\x75\171"] = Db::name("\171\x62\163\143\137\x61\143\x74\x69\x76\151\164\171\x5f\157\162\144\145\x72")->where($where)->count(); goto U1j8d; G2Y_4: goto Z4Rx4; goto SA0Pd; ZkzWi: $list[$k]["\162\x65\163\x74\137\163\145\x6c\154"] = 0; goto EAzUO; EAzUO: $list[$k]["\x70\x72\157\x67\x72\145\x73\x73"] = 100; goto G2Y_4; Xc2_U: if ($type == 1) { goto CjjmN; } goto XByFt; XByFt: $list[$k]["\x61\154\x6c\x5f\x73\145\154\x6c"] = 0; goto ZkzWi; rtTJN: } goto TOyew; uCqqf: return $list; goto MWIxD; KkyXa: $time = time(); goto IIdIA; n9Y01: if (empty($list)) { goto JqKK_; } goto ZD30S; v1WAB: JqKK_: goto uCqqf; sw6CQ: $data["\163\164\151\155\x65"] = ["\76", $time]; goto GLxSV; g5Klh: $data["\163\x74\151\155\x65"] = ["\74", $time]; goto f26bS; NAbTl: XfbzL: goto g5Klh; GLxSV: goto jQ08A; goto NAbTl; wunSl: $list = Db::name($this->g)->where($data)->page($page, 10)->order("\x73\157\x72\164", "\144\x65\x73\x63")->order("\x69\144", "\x64\145\x73\x63")->select(); goto n9Y01; MWIxD: } public function get_msGoodsmodel($data) { goto UI3pU; wUGDj: $data["\x69\x73\137\x64\x65\x6c"] = 2; goto jjqGQ; w4UEk: JNLdK: goto k20Nc; mwuF1: $list = Db::name($this->g)->where($data)->order("\163\x6f\x72\164", "\144\x65\163\143")->order("\x69\x64", "\x64\145\x73\x63")->select(); goto IlNX6; xpmxB: mR21k: goto w4UEk; IlNX6: if (empty($list)) { goto JNLdK; } goto B4tnP; k20Nc: return $list; goto CHiau; jjqGQ: $time = time(); goto mwuF1; UI3pU: $data["\x73\x74\x61\164\x75\163"] = 1; goto wUGDj; B4tnP: foreach ($list as $k => $v) { goto tkYBg; tkYBg: if (intval($v["\145\164\x69\x6d\x65"]) < $time) { goto qCiOB; } goto qalo4; HxDAJ: $list[$k]["\x70\162\x6f\x67\162\x65\163\x73"] = 100; goto NTP8v; paKT6: $list[$k]["\163\164\x61\164\165\x73"] = 0; goto pf5ZZ; AqiUh: goto u_9Ta; goto XlkJe; s_Lgi: $list[$k]["\x73\164\x61\x74\165\163"] = 2; goto MzJF8; i8tVz: $list[$k]["\x69\163\137\142\x75\x79"] = Db::name("\x79\142\163\x63\x5f\141\143\x74\151\166\151\164\x79\x5f\x6f\x72\144\x65\162")->where($where)->count(); goto ddlHJ; QyzBr: goto EuBf8; goto xK9Yw; DBFqu: $list[$k]["\x73\164\141\164\x75\163"] = 1; goto QOmuC; xK9Yw: qCiOB: goto paKT6; QOmuC: $list[$k]["\x61\154\154\x5f\163\x65\x6c\154"] = 0; goto tAIE2; et5et: lmwqL: goto s1onR; tAIE2: $list[$k]["\162\x65\x73\164\137\x73\145\x6c\154"] = 0; goto HxDAJ; Nwe88: $list[$k]["\160\162\157\x67\x72\x65\x73\163"] = round(intval($list[$k]["\162\x65\163\x74\x5f\163\145\154\154"]) / intval($list[$k]["\x61\154\x6c\137\163\145\154\x6c"]) * 100, 2); goto AqiUh; pf5ZZ: EuBf8: goto et5et; ddlHJ: $list[$k]["\x72\x65\x73\164\137\x73\x65\x6c\154"] = intval($list[$k]["\x61\154\154\x5f\x73\145\x6c\x6c"]) - intval($list[$k]["\x69\163\x5f\x62\x75\171"]); goto Nwe88; qalo4: if (intval($v["\163\x74\x69\155\x65"]) > $time) { goto bvvoO; } goto s_Lgi; NTP8v: u_9Ta: goto QyzBr; MzJF8: $where = ["\x61\143\x74\151\x76\x69\x74\x79\x5f\157\x72\144\x65\x72\137\x74\x79\x70\x65" => 3, "\x6f\x72\144\x65\x72\x5f\163\x74\141\164\x75\163" => ["\x69\156", [1, 2, 3]], "\160\x61\x79\x5f\x73\164\141\x74\x75\x73" => 1, "\151\x73\137\144\x65\154\x65\x74\x65\x64" => 0, "\x6d\x63\150\x5f\x69\144" => $data["\x6d\x63\150\137\x69\x64"], "\x62\141\162\x67\141\x69\x6e\137\x69\x64" => $v["\x69\x64"]]; goto i8tVz; XlkJe: bvvoO: goto DBFqu; s1onR: } goto xpmxB; CHiau: } public function get_msGoodsDetail($data) { goto ybErg; uKVUj: $goodsInfo["\144\145\x73\143\x72\151\160\x74\151\x6f\x6e"] = Db::name("\x79\142\163\143\x5f\147\x6f\x6f\144\x73")->where(["\147\x6f\x6f\x64\x73\x5f\151\144" => $goodsInfo["\147\157\157\x64\163\137\151\x64"]])->value("\x64\145\163\x63\162\151\160\x74\x69\x6f\x6e"); goto Ma2s_; WPP29: goto YJwMH; goto Mzlt5; TzfKV: $data["\151\163\x5f\x64\145\x6c"] = 2; goto SAuUE; iSoW2: KJ3tt: goto YjOPg; Imfur: $goodsInfo = Db::name($this->g)->where($data)->find(); goto SjNUS; RIhjD: mNBAX: goto fSPvT; WF55u: $goodsInfo["\x72\x65\x73\164\x5f\x73\x65\x6c\x6c"] = intval($goodsInfo["\141\154\154\x5f\x73\145\x6c\x6c"]) - intval($goodsInfo["\x69\163\137\142\165\171"]); goto QTgwx; Z9DD3: goto mNBAX; goto llbuP; UOa1L: if (intval($goodsInfo["\145\164\x69\x6d\145"]) < $time) { goto i0yc2; } goto HzUyA; dH_Vn: goto KJ3tt; goto c0eh_; NYaDV: $goodsInfo["\163\x74\x61\x74\165\163"] = 2; goto WPP29; Ma2s_: $goodsInfo["\151\x73\x5f\x62\x75\x79"] = Db::name("\171\x62\x73\x63\137\141\x63\164\x69\166\151\x74\x79\x5f\x6f\x72\144\145\162")->where($where)->count(); goto WF55u; llbuP: zyowl: goto ZJS7W; YjOPg: return $goodsInfo; goto FFEkX; fSPvT: $where = ["\141\143\x74\x69\166\151\x74\171\x5f\x6f\162\144\x65\x72\137\x74\x79\x70\x65" => 3, "\x6f\162\x64\x65\x72\137\x73\x74\x61\x74\x75\x73" => ["\151\156", [1, 2, 3]], "\x70\141\x79\137\x73\164\141\x74\x75\163" => 1, "\151\163\137\144\145\x6c\145\164\x65\x64" => 0, "\155\143\x68\x5f\151\x64" => $data["\x6d\143\150\137\x69\144"], "\x62\141\x72\x67\x61\151\x6e\137\x69\x64" => $goodsInfo["\x69\x64"]]; goto uKVUj; Jh6lH: if (!empty($goodsInfo["\151\x6d\x67"])) { goto zyowl; } goto ZWPek; HzUyA: if (intval($goodsInfo["\x73\164\x69\155\145"]) > $time) { goto ENgej; } goto NYaDV; SAuUE: $time = time(); goto Imfur; QTgwx: $goodsInfo["\142\141\163\x65\137\163\145\x6c\x6c"] = intval($goodsInfo["\x62\x61\163\x65\x5f\163\x65\154\154"]) + intval($goodsInfo["\x69\x73\137\x62\165\171"]); goto UOa1L; gm1BN: $goodsInfo["\163\164\x61\164\x75\163"] = 1; goto QPRXH; ZWPek: $goodsInfo["\151\x6d\x67"] = []; goto Z9DD3; c0eh_: i0yc2: goto VBzNc; ybErg: $data["\163\x74\141\164\x75\163"] = 1; goto TzfKV; QPRXH: YJwMH: goto dH_Vn; Mzlt5: ENgej: goto gm1BN; IoXok: return null; goto BClHC; BClHC: ZLBQE: goto Jh6lH; ZJS7W: $goodsInfo["\151\x6d\147"] = json_decode($goodsInfo["\151\155\147"], true); goto RIhjD; SjNUS: if ($goodsInfo) { goto ZLBQE; } goto IoXok; VBzNc: $goodsInfo["\163\x74\141\164\165\163"] = 0; goto iSoW2; FFEkX: } public function createOrder($data) { goto ymC0F; ymC0F: $info = Db::name("\x79\142\x73\143\137\141\143\164\x69\166\x69\x74\171")->where("\151\144", $data["\x62\x61\x72\147\141\x69\x6e\x5f\x69\x64"])->find(); goto QFSyM; QFSyM: $data["\x62\141\x72\x67\141\x69\x6e\x5f\156\x61\x6d\x65"] = $info["\x6e\141\x6d\x65"]; goto wAFix; wAFix: $data["\x62\x61\x72\147\141\151\156\x5f\x70\151\x63"] = $info["\160\151\x63"]; goto Qpv29; CJNcF: try { goto rKXKO; XICrE: Db::commit(); goto jAxQK; ULeNs: Db::name("\x79\x62\x73\143\137\x61\x63\x74\x69\166\x69\164\171\x5f\157\162\x64\x65\162\137\x70\x61\x79\155\145\x6e\164")->insert($pay_data); goto XICrE; tubuH: $pay_data = array("\x6f\165\x74\x5f\x74\162\x61\144\x65\x5f\156\x6f" => $data["\157\x75\164\x5f\x74\162\x61\144\x65\x5f\156\157"], "\160\141\x79\x5f\164\171\160\x65" => $data["\160\x61\171\x5f\x74\171\160\x65"], "\x74\171\160\145\137\x61\154\x69\163\x5f\151\x64" => $id, "\x70\141\171\137\x62\x6f\x64\x79" => mb_substr($data["\142\x61\162\147\x61\151\156\137\x6e\x61\x6d\145"], 0, 20, "\x75\164\146\55\70"), "\160\141\171\x5f\x64\145\x74\141\151\154" => "\345\271\xb3\345\217\xb0\xe8\xb4\255\344\271\xb0\xe5\225\x86\345\x93\201", "\160\x61\x79\x5f\155\x6f\156\145\171" => $data["\160\x61\x79\x5f\x6d\x6f\x6e\x65\171"], "\x63\162\145\141\164\x65\137\164\x69\x6d\145" => time()); goto ULeNs; rKXKO: $id = Db::name("\x79\x62\x73\x63\137\x61\143\164\x69\166\151\x74\171\137\x6f\x72\x64\x65\162")->strict(true)->insertGetId($data); goto tubuH; jAxQK: } catch (\Exception $e) { Db::rollback(); return null; } goto L9WVA; Qpv29: $data["\x6f\162\x69\x67\x69\x6e\x61\x6c\137\x70\162\151\x63\x65"] = $info["\x6e\x70\x72\151\143\x65"]; goto RRFne; L9WVA: return $id; goto j0LOj; RRFne: Db::startTrans(); goto CJNcF; j0LOj: } public function orderList($data, $page = 1) { goto vOtq1; OR3UQ: return $order_list; goto KAcHt; a1HrO: foreach ($order_list as $key => $value) { goto BQ4GG; NVsH3: $order_list[$key]["\x68\141\x76\145\x5f\154\157\x67"] = $this->check_log($value["\x6f\x72\x64\x65\x72\x5f\151\144"]); goto a5y_u; kGufL: $order_list[$key]["\143\157\x6e\x73\151\x67\x6e\x5f\x74\151\x6d\145"] = __TIME($value["\x63\157\x6e\163\151\x67\x6e\137\x74\151\155\x65"]); goto NVsH3; BQ4GG: $order_list[$key]["\163\151\147\156\x5f\x74\x69\155\x65"] = __TIME($value["\x73\151\147\156\x5f\x74\x69\x6d\145"]); goto eXvnN; a5y_u: YMKH3: goto Ko64r; eXvnN: $order_list[$key]["\x70\x61\171\137\x74\x69\155\x65"] = __TIME($value["\x70\141\x79\137\x74\x69\155\145"]); goto kGufL; Ko64r: } goto ApqcY; KAcHt: mezEM: goto a1HrO; yFoLu: $order_list = Db::name("\171\142\x73\x63\x5f\x61\143\x74\x69\166\x69\164\x79\x5f\x6f\x72\x64\x65\x72")->where("\x62\165\x79\145\x72\137\x69\x64", $data["\142\x75\x79\145\162\x5f\x69\144"])->where("\x69\x73\x5f\144\145\154\145\164\145\x64", 0)->where("\157\162\x64\x65\162\137\x73\x74\141\164\x75\x73", $data["\157\162\144\145\162\x5f\163\164\x61\164\165\163"])->page($page, PAGE_NUM)->order("\x63\x72\x65\141\x74\145\x5f\x74\151\155\145", "\x64\x65\x73\143")->select(); goto K0VNn; K0VNn: if (!empty($order_list)) { goto mezEM; } goto OR3UQ; LhvqK: return $order_list; goto mUg71; vOtq1: $order_list = null; goto yFoLu; ApqcY: PemtF: goto LhvqK; mUg71: } public function check_log($order, $type = 4) { goto XoeFc; txDge: $count = 0; goto CJDMm; mL8mK: $count = 1; goto VTB1C; VTB1C: ARH2n: goto FpU1E; FpU1E: return $count; goto rKICC; CXm7S: if (!empty($res) && $res["\162\x65\146\165\x6e\x64\x5f\x73\x74\x61\x74\165\x73"] != 3) { goto YDJDJ; } goto txDge; CJDMm: goto ARH2n; goto ysbt_; XoeFc: $res = Db::name("\171\142\x73\x63\137\157\162\144\145\162\x5f\x72\x65\x66\165\156\x64")->field("\162\x65\x66\165\x6e\x64\x5f\x73\164\x61\x74\x75\x73")->where(["\157\162\144\145\x72\x5f\x69\x64" => $order, "\164\171\x70\145" => $type])->order("\151\144", "\x64\x65\163\x63")->find(); goto CXm7S; ysbt_: YDJDJ: goto mL8mK; rKICC: } public function getOrder($data) { goto Z3g0R; Z3g0R: $order_info = null; goto OPkWp; crPgg: if (!empty($order_info)) { goto TGaCS; } goto GJFz0; la4Hm: $address["\143\x69\x74\x79"] = $city["\x6e\x61\x6d\145"]; goto Y18Hs; Fzvs4: $order_info["\143\x6f\156\163\151\x67\156\x5f\x74\x69\155\145"] = __TIME($order_info["\143\x6f\x6e\163\x69\x67\156\x5f\x74\151\155\x65"]); goto JVZFb; Wb20f: return $order_info; goto Go8B2; K7n6T: $res = Db::name("\x79\142\x73\143\137\x61\x72\145\x61")->where("\151\x64", $order_info["\162\145\x63\x65\151\166\145\x72\x5f\141\162\145\141"])->find(); goto nVQzU; Xm2yy: TGaCS: goto e1Q0r; LSwAB: $address["\x70\x72\x6f\x76\x69\x6e\143\x65"] = $pro["\156\141\x6d\145"]; goto la4Hm; hnowr: $order_info["\x70\141\171\x5f\x74\151\x6d\x65"] = __TIME($order_info["\x70\x61\171\137\x74\x69\x6d\x65"]); goto Fzvs4; GJFz0: return $order_info; goto Xm2yy; JVZFb: $order_info["\x63\x72\x65\x61\164\145\137\164\x69\155\x65"] = __TIME($order_info["\x63\162\x65\x61\164\x65\x5f\x74\151\x6d\145"]); goto K7n6T; OPkWp: $order_info = Db::name("\x79\142\x73\x63\137\x61\143\164\151\x76\151\x74\171\x5f\x6f\x72\x64\x65\x72")->where($data)->where("\x69\163\137\144\145\x6c\x65\x74\x65\144", 0)->find(); goto crPgg; nVQzU: $city = Db::name("\171\x62\163\x63\137\141\162\x65\141")->where("\x69\x64", $res["\160\x69\144"])->find(); goto TKZcW; Y18Hs: $address["\144\x69\x73\x74\x72\151\143\164"] = $res["\x6e\141\155\145"]; goto jCo_l; e1Q0r: $order_info["\163\151\x67\156\137\164\151\x6d\x65"] = __TIME($order_info["\x73\x69\147\x6e\x5f\x74\151\x6d\x65"]); goto hnowr; TKZcW: $pro = Db::name("\171\142\163\x63\x5f\141\162\145\x61")->where("\x69\x64", $city["\x70\x69\x64"])->find(); goto LSwAB; jCo_l: $order_info["\x61\144\x64\x72\x65\163\163"] = $address; goto Wb20f; Go8B2: } public function signOrder($data) { goto Qu0NA; Qu0NA: $info = Db::name("\x79\x62\x73\143\137\x61\x63\x74\x69\166\x69\x74\171\x5f\x6f\x72\x64\145\x72")->where($data)->find(); goto C4Kyq; JgLww: HJlOS: goto Eu_Ni; wPQpH: return json_encode($rs); goto JgLww; yuQra: return $res; goto bi1gb; Eu_Ni: $new_data = array("\x6f\162\x64\x65\x72\x5f\x73\x74\x61\164\165\x73" => 3, "\x73\x69\147\x6e\x5f\x74\x69\x6d\145" => time()); goto JhSJh; C4Kyq: if (!empty($info)) { goto HJlOS; } goto wnI3U; rIMct: $rs["\x6d\x73\147"] = "\350\257\245\350\xae\xa2\345\215\225\347\212\xb6\xe6\x80\x81\xe5\274\202\xe5\xb8\270\xef\274\201"; goto wPQpH; wnI3U: $rs["\x63\x6f\x64\145"] = 1; goto rIMct; JhSJh: $res = Db::name("\171\x62\163\143\x5f\141\x63\164\151\166\x69\164\171\137\157\x72\144\x65\x72")->where(["\157\x72\x64\x65\x72\137\151\x64" => $data["\x6f\x72\x64\145\x72\x5f\x69\x64"]])->update($new_data); goto yuQra; bi1gb: } public function cancelOrder($data) { goto Ilfbr; vRZQv: Oopo_: goto xldP4; Ilfbr: $info = Db::name("\171\142\163\143\137\x61\143\x74\x69\166\x69\164\x79\137\157\x72\x64\x65\x72")->where($data)->find(); goto xijF_; MtH6R: Db::startTrans(); goto BH3qx; r11BI: return $res; goto arnC8; pAy3D: return null; goto vRZQv; xijF_: if (!empty($info)) { goto Oopo_; } goto pAy3D; FJtFU: hua4E: goto MtH6R; xldP4: $bargain = Db::name("\171\142\163\143\137\x62\141\162\x67\141\151\156")->where("\151\x64\x3d" . $info["\x62\x61\x72\x67\x61\151\156\137\x69\x64"])->find(); goto RHaFW; HVK3Y: Db::name("\x79\x62\163\x63\137\142\141\162\x67\141\151\156")->where("\x69\x64\75" . $info["\142\x61\162\x67\141\151\156\137\x69\144"])->setInc("\x62\141\x72\147\x61\151\156\137\151\x6e\x76\x65\x6e\x74\157\x72\x79", $info["\164\x6f\x74\141\x6c"]); goto FJtFU; BH3qx: try { goto yiEpG; vMLCI: Db::commit(); goto k0Q1D; yiEpG: $new_data = array("\x6f\x72\x64\x65\162\137\163\164\x61\164\165\x73" => -1); goto xbWDX; xbWDX: $res = Db::name("\x79\x62\163\x63\x5f\141\143\164\151\x76\x69\x74\x79\x5f\x6f\162\144\145\162")->where(["\x6f\162\x64\x65\162\x5f\x69\144" => $data["\x6f\162\144\x65\162\x5f\x69\144"]])->update($new_data); goto vMLCI; k0Q1D: } catch (\Exception $e) { Db::rollback(); return $e->getMessage(); } goto r11BI; RHaFW: if (empty($bargain)) { goto hua4E; } goto HVK3Y; arnC8: } public function delOrder($data) { goto n2ETu; pri7w: return null; goto q5jVM; n1NUC: $res = Db::name("\171\142\163\143\137\x61\x63\x74\x69\166\x69\x74\x79\x5f\x6f\x72\144\x65\x72")->where(["\x6f\x72\144\145\x72\137\x69\x64" => $data["\x6f\x72\x64\x65\x72\x5f\151\144"]])->update($new_data); goto DA45C; anA3v: if (!empty($info)) { goto BZ4MQ; } goto pri7w; HGvbK: $new_data = array("\151\x73\x5f\144\145\154\145\164\145\x64" => 1); goto n1NUC; DA45C: return $res; goto fbGOS; q5jVM: BZ4MQ: goto HGvbK; n2ETu: $info = Db::name("\x79\142\163\x63\137\x61\x63\x74\x69\166\x69\164\x79\137\157\162\144\x65\162")->where($data)->find(); goto anA3v; fbGOS: } public function refundOrder($data, $apply_refund) { goto QAQ4v; QAQ4v: $info = Db::name("\x79\142\163\x63\137\141\143\x74\151\x76\x69\x74\x79\x5f\x6f\x72\x64\145\162")->where($data)->find(); goto Juo6z; t17Q0: return $res; goto U8jVG; s63NA: $refund = new RefundService(); goto sMaHw; cA3yQ: onW9W: goto KsMXE; sMaHw: $refund->refundLog($info["\x6d\x63\x68\137\151\144"], $info["\142\165\x79\x65\162\x5f\151\x64"], $apply_refund, $info["\x6f\162\144\x65\x72\137\151\144"], 4); goto vujEH; Juo6z: if (!empty($info)) { goto onW9W; } goto gg5DK; KsMXE: $new_data = array("\157\x72\x64\145\162\137\x73\x74\141\164\x75\163" => 4, "\x72\145\x66\x75\156\x64\137\164\x69\x6d\x65" => time(), "\162\145\x66\165\x6e\x64\137\163\x74\x61\x74\x75\163" => $info["\157\x72\144\x65\162\137\x73\x74\141\164\165\163"]); goto whcop; gg5DK: return null; goto cA3yQ; vFjA5: if (!($res && $apply_refund)) { goto Ick4P; } goto s63NA; vujEH: Ick4P: goto t17Q0; whcop: $res = Db::name("\x79\142\163\143\x5f\x61\143\164\151\x76\x69\164\x79\x5f\x6f\162\144\145\x72")->where(["\157\x72\144\x65\x72\137\151\x64" => $data["\157\162\144\145\x72\x5f\151\144"]])->update($new_data); goto vFjA5; U8jVG: } public function checkOrder($buyer_id, $bargain_id) { $rs = Db::name("\171\142\x73\143\x5f\x61\143\x74\151\x76\151\x74\x79\137\x6f\162\x64\145\162")->where("\142\x75\x79\145\162\137\151\144", $buyer_id)->where("\142\x61\x72\x67\141\151\x6e\x5f\151\x64", $bargain_id)->where("\x61\x63\164\x69\166\x69\x74\x79\137\x6f\x72\x64\x65\162\137\164\x79\x70\x65", 1)->where("\x6f\162\x64\x65\162\x5f\163\x74\x61\164\x75\163", "\x3c\76", -1)->count(); return $rs; } public function checkmsOrder($buyer_id, $bargain_id) { goto rDr7s; mKkxp: ndIix: goto lxXDf; LPybS: if (!(empty($act["\x6d\141\x78\x5f\160\162\x65"]) || $act["\155\x61\170\x5f\160\162\145"] == 0)) { goto bXbKT; } goto pE_AJ; lxXDf: goto y3Rdh; goto PjDWp; qG8l7: y3Rdh: goto gJa0o; aQc2g: if ($act["\x6d\x61\x78\137\x70\162\x65"] <= $rs) { goto Lbm2h; } goto JzgSh; rDr7s: $act = Db::name("\171\x62\x73\143\137\141\x63\x74\151\166\x69\164\171")->where("\x69\x64", $bargain_id)->find(); goto LPybS; HqRBD: if ($act["\141\x6c\154\137\163\145\154\x6c"] < $is_buy || $act["\141\154\x6c\x5f\163\145\x6c\x6c"] == $is_buy) { goto NQYRe; } goto BDG0z; JzgSh: $where = ["\141\x63\164\151\166\x69\164\x79\x5f\157\x72\x64\145\x72\137\x74\x79\160\x65" => 3, "\157\x72\x64\145\x72\137\163\x74\x61\x74\165\x73" => ["\151\156", [1, 2, 3]], "\x70\x61\171\137\x73\164\x61\x74\x75\163" => 1, "\x69\163\x5f\144\145\154\145\164\145\144" => 0, "\142\141\162\147\x61\x69\156\137\151\x64" => $bargain_id]; goto GIm45; pE_AJ: return 0; goto bzTcY; GIm45: $is_buy = Db::name("\171\142\x73\143\137\141\x63\x74\151\x76\151\164\171\x5f\x6f\x72\144\145\162")->where($where)->count(); goto HqRBD; fORgy: return 1; goto qG8l7; PjDWp: Lbm2h: goto fORgy; T1Myp: $rs = Db::name("\171\x62\163\x63\x5f\141\143\x74\x69\x76\151\164\x79\137\x6f\x72\x64\145\x72")->where("\142\x75\171\x65\x72\x5f\x69\144", $buyer_id)->where("\142\141\162\x67\141\x69\x6e\x5f\x69\144", $bargain_id)->where("\x61\x63\164\x69\166\151\164\171\x5f\x6f\162\x64\x65\162\137\x74\171\160\x65", 3)->where("\x6f\162\144\x65\162\x5f\x73\x74\x61\x74\165\x73", "\74\x3e", -1)->count(); goto aQc2g; QGUSK: NQYRe: goto BPIkb; BDG0z: return 0; goto eez3u; bzTcY: bXbKT: goto T1Myp; eez3u: goto ndIix; goto QGUSK; BPIkb: return -1; goto mKkxp; gJa0o: } public function orderInfo($data) { goto kGa2I; x89Fw: $pro = Db::name("\x79\x62\x73\x63\137\x61\162\x65\141")->where("\151\144", $city["\x70\x69\x64"])->find(); goto ZNRkE; DfKwN: $rs["\144\x69\x73\164\162\151\143\x74"] = $res["\156\x61\155\145"]; goto cfKFT; ZNRkE: $rs["\160\x72\x6f\x76\151\x6e\143\145"] = $pro["\156\x61\155\145"]; goto KBKZl; cfKFT: $info["\141\x64\144\x72\x65\x73\163"] = $rs; goto l_Hx9; Dr9LG: $city = Db::name("\171\x62\x73\143\137\141\x72\145\x61")->where("\x69\144", $res["\x70\x69\x64"])->find(); goto x89Fw; kGa2I: $info = Db::name("\171\x62\163\143\x5f\x61\143\x74\151\x76\x69\164\171\137\157\x72\x64\145\162")->where($data)->find(); goto Yjuwu; KBKZl: $rs["\143\x69\x74\171"] = $city["\x6e\141\155\x65"]; goto DfKwN; l_Hx9: return $info; goto i0F2N; Yjuwu: $res = Db::name("\x79\142\x73\143\x5f\141\162\x65\141")->where("\151\x64", $info["\x72\145\x63\x65\x69\x76\145\x72\x5f\x61\162\145\x61"])->find(); goto Dr9LG; i0F2N: } public function orderPay($data) { goto zklP1; uT2h_: if (!empty($info)) { goto DvJlX; } goto XW5HK; NJb0I: $GLOBALS["\x6d\x63\x68\x5f\151\144"] = $data["\x6d\143\150\x5f\x69\144"]; goto czsnQ; SxWki: if (!($unifiedorder["\x72\145\163\165\x6c\x74\137\x63\157\x64\145"] == "\106\x41\111\114")) { goto msSe1; } goto syWBJ; XW5HK: $rs["\143\157\144\145"] = 1; goto ycBTk; YPJDV: $rs["\x6d\163\x67"] = $unifiedorder["\x72\145\x74\x75\x72\x6e\x5f\x6d\x73\147"]; goto O6ZeS; XKhKp: $rs["\x6d\163\147"] = $unifiedorder["\x65\162\162\x5f\x63\x6f\x64\x65\137\x64\145\163"]; goto W_Ppn; JWMef: $input->SetOut_trade_no($data["\x6f\x75\x74\137\x74\x72\141\144\x65\137\156\157"]); goto ZjoTo; ycBTk: $rs["\155\x73\147"] = "\350\256\xa2\345\215\x95\344\xb8\215\345\xad\x98\xe5\234\250"; goto gaMjo; UXPqO: return $rs; goto ProEx; gaMjo: return $rs; goto ulbgi; wtgGf: $info = Db::name("\x79\142\163\x63\x5f\x61\143\164\151\166\151\164\171\x5f\x6f\162\x64\x65\162\137\x70\141\x79\155\x65\156\x74")->where("\157\165\164\137\x74\x72\x61\144\x65\137\156\157", $data["\x6f\165\164\137\164\x72\x61\144\145\137\x6e\x6f"])->find(); goto uT2h_; Nj0be: $rs["\x63\x6f\x64\145"] = 1; goto Cdfet; czsnQ: $GLOBALS["\153\x65\171"] = "\x6d\x69\141\x6f\x73\x68\141"; goto MQ7Vf; P_iMF: return $rs; goto hEMFs; ulbgi: DvJlX: goto vnHGt; ZjoTo: $input->SetTrade_type("\112\x53\x41\120\111"); goto G2EMs; vnHGt: if (!($info["\160\x61\171\137\x73\x74\x61\164\x75\x73"] != 0)) { goto Tq0RY; } goto Nj0be; O6ZeS: return $rs; goto rLZY1; mwkZi: if (!($unifiedorder["\x72\145\164\x75\162\156\137\143\x6f\144\x65"] == "\106\x41\x49\x4c")) { goto YCDqh; } goto aTRn0; dHB6p: $res = $this->weixinapp($unifiedorder); goto eHrJ1; ou09Z: $input->SetDetail($info["\160\x61\x79\x5f\144\x65\x74\x61\151\154"]); goto kQBtT; rYuMh: $input->SetOpenid($data["\157\x70\145\x6e\151\144"]); goto ou09Z; MQ7Vf: $input = new \WxPayUnifiedOrder(); goto ll6Dd; aTRn0: $rs["\143\x6f\144\x65"] = 1; goto YPJDV; Cdfet: $rs["\155\x73\x67"] = "\xe8\xae\242\345\x8d\x95\344\xb8\273\351\242\230\345\267\xb2\346\x94\xb9\xe5\217\x98"; goto UXPqO; rLZY1: YCDqh: goto SxWki; wOPk2: msSe1: goto dHB6p; kQBtT: $input->SetTotal_fee($info["\x70\x61\x79\x5f\155\157\156\x65\x79"] * 100); goto JWMef; ll6Dd: $input->SetBody($info["\x70\141\171\x5f\142\x6f\144\x79"]); goto rYuMh; zklP1: $rs = array("\143\x6f\x64\145" => 0, "\151\156\x66\157" => array()); goto wtgGf; syWBJ: $rs["\143\157\144\x65"] = 1; goto XKhKp; eHrJ1: $rs["\151\156\x66\x6f"] = $res; goto P_iMF; W_Ppn: return $rs; goto wOPk2; ProEx: Tq0RY: goto NJb0I; G2EMs: $unifiedorder = \WxPayApi::unifiedOrder($input); goto mwkZi; hEMFs: } public function orderPaywap($data) { goto NG97d; nKxu6: if (!empty($info)) { goto NCPd8; } goto wP82i; wP82i: $rs["\143\x6f\x64\x65"] = 1; goto B0Xvk; Ejdxc: $input->SetTrade_type("\115\127\105\x42"); goto DUvhT; tpSe0: $rs["\x63\x6f\x64\145"] = 1; goto AGvqy; NhGNZ: return $unifiedorder; goto fVm7x; gmE4W: $input->SetBody($info["\x70\141\x79\137\x64\x65\x74\x61\x69\x6c"]); goto TCtgE; t22zG: $unifiedorder = \WxPayApi::unifiedOrder($input); goto fC0Kl; jNz0V: ug020: goto ZBhIA; cD3xs: $GLOBALS["\x6d\143\x68\x5f\151\x64"] = $data["\155\x63\x68\x5f\x69\x64"]; goto zy6Bn; NG97d: $rs = array("\x63\157\144\x65" => 0, "\x69\x6e\x66\x6f" => array()); goto mJxvy; FnWyb: $rs["\x6d\163\x67"] = $unifiedorder["\145\x72\162\x5f\x63\x6f\144\x65\x5f\x64\145\x73"]; goto JxKrB; TCtgE: $input->SetOut_trade_no($info["\x6f\x75\164\x5f\164\x72\141\144\145\137\156\157"]); goto zqrF3; DUvhT: $input->SetScene_info("\173\42\x68\65\x5f\151\x6e\x66\x6f\x22\x3a\40\x7b\x22\x74\x79\160\145\x22\72\42\127\x61\x70\42\x2c\x22\x77\x61\160\x5f\165\x72\x6c\x22\72\x20\x22\150\164\164\x70\x73\72\134\x2f\x5c\57\x77\x71\56\x73\x73\x73\x76\151\160\x2e\156\145\164\x22\x2c\42\x77\141\x70\137\x6e\141\155\x65\42\72\x20\x22\345\xa3\xb9\344\275\260\345\225\x86\345\x9f\216\42\175\175"); goto t22zG; zqrF3: $input->SetTotal_fee($info["\x70\141\x79\137\155\x6f\x6e\x65\171"] * 100); goto uqFDX; e8BuW: $rs["\x6d\x73\147"] = "\xe8\256\xa2\345\215\225\344\270\xbb\xe9\242\x98\xe5\267\262\xe6\224\xb9\xe5\x8f\230"; goto rKA80; uqFDX: $input->SetSpbill_create_ip($spbill_create_ip); goto Ejdxc; MKb1k: EhrIY: goto cD3xs; EWTiM: NCPd8: goto SvO1u; GL1Fx: $GLOBALS["\x6b\x65\x79"] = "\x6d\x69\141\157\x73\x68\x61"; goto wynBS; zy6Bn: $spbill_create_ip = get_client_ip($type = 0, $adv = true); goto GL1Fx; lgVn1: $rs["\x63\157\144\145"] = 1; goto FnWyb; DUJ1S: Hn5Z6: goto NhGNZ; mJxvy: $info = Db::name("\x79\x62\163\x63\137\x61\x63\x74\x69\x76\x69\x74\171\137\x6f\x72\x64\145\162\x5f\160\141\171\x6d\145\x6e\x74")->where("\157\165\164\137\x74\162\x61\144\145\x5f\156\157", $data["\157\165\x74\x5f\x74\x72\141\x64\x65\137\156\x6f"])->find(); goto nKxu6; rKA80: return $rs; goto MKb1k; SvO1u: if (!($info["\160\x61\171\137\x73\164\x61\x74\x75\163"] != 0)) { goto EhrIY; } goto pvpkP; B0Xvk: $rs["\x6d\x73\x67"] = "\350\256\xa2\345\215\225\xe4\xb8\x8d\xe5\xad\x98\345\x9c\xa8"; goto zbDOG; JxKrB: return $rs; goto DUJ1S; xF6fb: return $rs; goto jNz0V; zbDOG: return $rs; goto EWTiM; ZBhIA: if (!($unifiedorder["\162\x65\163\165\x6c\x74\137\143\x6f\144\145"] == "\x46\101\111\x4c")) { goto Hn5Z6; } goto lgVn1; pvpkP: $rs["\x63\157\144\x65"] = 1; goto e8BuW; wynBS: $input = new \WxPayUnifiedOrder(); goto gmE4W; fC0Kl: if (!($unifiedorder["\162\x65\x74\x75\x72\x6e\137\143\157\144\x65"] == "\x46\x41\111\114")) { goto ug020; } goto tpSe0; AGvqy: $rs["\155\163\147"] = $unifiedorder["\x72\x65\x74\x75\x72\156\137\x6d\x73\x67"]; goto xF6fb; fVm7x: } private function weixinapp($unifiedorder) { goto aVHOx; F6QeC: $input->SetTimeStamp('' . time() . ''); goto hoEdh; A0Mg9: $input->SetSign(); goto vmoQb; aVHOx: $param = Db::name("\x79\142\x73\x63\x5f\x63\x6f\x6e\x66\x69\147")->where("\x6b\145\x79", "\x57\130\120\x41\131")->where("\x6d\143\150\137\x69\144", $GLOBALS["\155\143\150\x5f\151\144"])->where("\151\163\x5f\165\x73\145", 1)->value("\x76\x61\x6c\x75\145"); goto qXqRg; qgXvN: $input->SetPackage("\x70\162\x65\x70\141\x79\137\x69\144\x3d" . $unifiedorder["\x70\162\x65\x70\141\x79\137\151\144"]); goto uvX4r; uvX4r: $input->SetSignType("\x4d\x44\65"); goto A0Mg9; qXqRg: $param = json_decode($param, true); goto quQOL; quQOL: $input = new \WxPayJsApiPay(); goto ZKe98; ZKe98: $input->SetAppid($param["\101\x50\x50\x5f\111\x44"]); goto F6QeC; vmoQb: return $input; goto FC42I; hoEdh: $input->SetNonceStr($this->createNoncestr()); goto qgXvN; FC42I: } private function createNoncestr($length = 32) { goto xsaRU; h_j5O: goto bV1tq; goto PVyzM; SdNOB: $str .= substr($chars, mt_rand(0, strlen($chars) - 1), 1); goto dwJYw; PVyzM: tf2YW: goto pNuMq; pNuMq: return $str; goto skPHw; F_iIF: if (!($i < $length)) { goto tf2YW; } goto SdNOB; zmxVY: $i++; goto h_j5O; Iihqq: bV1tq: goto F_iIF; dwJYw: SgEBi: goto zmxVY; bVxqz: $str = ''; goto TpMnh; TpMnh: $i = 0; goto Iihqq; xsaRU: $chars = "\x61\x62\143\144\145\146\147\150\x69\x6a\153\x6c\155\x6e\157\160\161\162\x73\x74\x75\166\x77\x78\171\172\60\x31\62\63\64\x35\66\67\70\71"; goto bVxqz; skPHw: } }
