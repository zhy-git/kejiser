<?php
 namespace app\api\service; use think\Db; require_once BASE_ROOT . "\x63\x6f\162\145\57\x61\x70\160\154\151\143\141\x74\151\x6f\156\57\143\x6f\155\155\x6f\156\x2e\160\x68\x70"; require_once BASE_ROOT . "\143\x6f\x72\145\x2f\145\x78\164\145\156\x64\57\127\170\160\x61\x79\57\x57\x78\120\141\x79\x2e\x41\x70\151\56\x70\150\160"; class MarketService { private $hd = "\171\142\x73\x63\x5f\142\x75\x73\x69\156\x65\x73\x73\137\141\x63\x74\151\x76\151\x74\x79"; private $bus = "\171\142\x73\x63\x5f\x62\x75\163\151\x6e\x65\x73\163"; private $uc = "\171\142\x73\x63\137\165\163\145\162\x5f\143\157\165\160\x6f\156"; private $bc = "\171\142\x73\143\x5f\x62\165\163\x69\156\145\x73\x73\x5f\143\157\165\x70\x6f\156"; private $rt = "\x79\142\x73\143\137\162\145\163\x65\162\166\x65\x5f\x74\x68\151\x6e\147"; public function get_UserFee($data, $area_id, $goods_price) { goto NcANx; yckSk: $type = 2; goto XUDWI; DwO69: $frist_num = $fee_list[$index]->frist_num; goto jlALk; qyAfx: $goods = Db::name("\171\x62\163\143\137\x67\x6f\x6f\x64\x73")->where(["\147\157\157\144\163\x5f\x69\x64" => $data["\147\x6f\157\x64\x73\137\151\x64"], "\x6d\x63\150\137\x69\x64" => $data["\x6d\143\x68\x5f\x69\x64"]])->field("\x67\x6f\157\144\163\137\156\141\x6d\145\54\x73\150\151\x70\160\x69\x6e\x67\137\x66\145\145\x2c\163\150\x69\160\x70\x69\x6e\147\x5f\146\x65\x65\x5f\151\144\x2c\x77\x65\151\147\x68\x74")->find(); goto q_VYA; bfKES: $num = ceil((intval($data["\x6e\165\x6d"]) - intval($frist_num)) / intval($add_num)); goto Y_sHf; EHgdi: OgwW5: goto BivVB; y6BwE: $frist_price = $fee_old["\x62\171\x6e\x75\x6d\x5f\x73\160\x72\151\x63\x65"]; goto eI3PZ; pipP2: $rs["\x69\x6e\x66\157"] = floatval($rs["\x69\156\x66\x6f"]) + $num * floatval($add_price); goto hO6yx; d1NOW: $rs["\151\x6e\146\x6f"] = floatval($frist_price); goto AkP3x; qhVoW: gHIn2: goto XuRSJ; RYO0z: $exemptions_info = Db::name("\171\x62\x73\143\137\145\x78\160\162\x65\x73\x73\137\x65\x78\145\x6d\160\164\x69\x6f\x6e")->field("\x76\x61\154\165\x65\x73\x2c\160\162\151\x63\x65")->where(["\155\x63\x68\137\x69\144" => $data["\x6d\x63\150\x5f\x69\x64"], "\151\x73\137\x64\x65\154" => 1])->select(); goto r2Y_7; QX33W: $rs["\x63\x6f\144\x65"] = 1; goto dnkJa; SisSL: foreach ($exemptions_info as $k => $v) { goto sQrrh; QCsof: foreach ($city_info as $k1 => $v1) { goto PVne0; c7k25: LXyp8: goto DXqFx; PVne0: foreach ($v1["\143\x69\164\x79"] as $k2 => $v2) { goto RNPpI; beA53: Zk86M: goto yTMOR; f5Bhl: return json_encode($rs); goto YthzJ; RNPpI: if (!($area_info["\160\x69\144"] == $k2)) { goto AMfRk; } goto f5Bhl; YthzJ: AMfRk: goto beA53; yTMOR: } goto OgtZA; OgtZA: dVW9L: goto c7k25; DXqFx: } goto mQkPC; Ss5zo: yngmO: goto Z3DnS; mQkPC: h27iD: goto Ss5zo; sQrrh: $city_info = json_decode($v["\166\x61\154\165\x65\163"], true); goto QCsof; Z3DnS: } goto NXYgh; eI3PZ: $frist_num = $fee_old["\142\171\156\165\155\137\x73\156\x75\155"]; goto iGnHk; v5ZFD: EEMM3: goto JNvdC; xH5Xq: zi5GP: goto Dv1wA; qbKWe: $fee_old = Db::name("\x79\x62\x73\143\x5f\145\x78\x70\x72\x65\x73\x73\x5f\x73\x68\151\160\160\x69\156\147")->where(["\x73\150\x69\160\x70\x69\156\147\x5f\146\x65\x65\137\x69\x64" => $goods["\x73\150\x69\x70\160\x69\x6e\147\137\146\x65\x65\x5f\x69\144"]])->field("\163\x68\151\160\160\151\x6e\147\137\x66\x65\x65\137\x69\x64\x2c\142\x79\x6e\x75\155\x5f\163\x70\162\151\143\145\x2c\x62\x79\x6e\x75\x6d\x5f\x73\x6e\x75\155\x2c\142\x79\x6e\x75\x6d\137\170\x70\x72\x69\x63\x65\x2c\142\x79\156\165\155\137\x78\156\165\155")->find(); goto vXOfS; r2Y_7: $area_info = Db::name("\171\x62\163\x63\137\x61\x72\x65\141")->field("\x70\151\144")->where(["\x69\144" => $area_id])->find(); goto SvikY; DQ5xn: SWwFV: goto t1u63; Dv1wA: goto EEMM3; goto z6BLc; XuRSJ: if (!($index != -1)) { goto zAtge; } goto rr2c8; ZJL4y: if (!($type_fee == 2)) { goto ddk9w; } goto a2C2y; ADhAq: if ($goods["\x73\150\151\x70\x70\151\x6e\147\x5f\x66\x65\x65"] == "\60\x2e\60\60" || $goods["\x73\x68\x69\160\x70\151\x6e\147\x5f\146\x65\145\137\x69\144"] == 0) { goto Lieiy; } goto qbKWe; w3N19: if (!(empty($goods) || empty($city))) { goto RL40f; } goto q9HzU; q_VYA: $city = Db::name("\x79\142\163\143\x5f\141\x72\145\x61")->where("\x69\144", $data["\141\162\x65\x61\137\151\144"])->value("\160\151\144"); goto wAiCL; LhKm1: $add_num = $fee_old["\x62\x79\156\x75\x6d\x5f\170\156\x75\155"]; goto xlDwq; wAiCL: $city_name = Db::name("\x79\x62\x73\x63\137\x61\162\145\x61")->where("\x69\x64", $city)->value("\x6e\x61\155\x65"); goto uJGbg; Auw37: $pro_name = Db::name("\x79\142\x73\x63\137\x61\162\145\x61")->where("\151\144", $pro)->value("\x6e\x61\155\145"); goto LQBlE; NXYgh: iR0Tt: goto O2FNw; r2Q4j: if (!($city_name == "\xe5\xb8\202\350\276\x96\345\214\272" || $city_name == "\345\x8e\277")) { goto ZQCpS; } goto C61dp; PKFDH: Mw8rG: goto MiWDo; z6BLc: aav1V: goto r2Q4j; AkP3x: if (!($data["\156\165\x6d"] > $frist_num)) { goto zi5GP; } goto bfKES; JNvdC: return json_encode($rs); goto cNg63; P2z3d: bXnyu: goto Egu4y; n6pVG: FAFLv: goto w3N19; xlDwq: $rs["\x69\156\x66\x6f"] = floatval($frist_price); goto VBjTv; BivVB: if ($index == -1) { goto aav1V; } goto Y4XIi; hO6yx: VHuS7: goto ZYbLo; Y4XIi: $frist_price = $fee_list[$index]->frist_price; goto DwO69; Egu4y: if ($type == 2) { goto GqOfO; } goto xas2j; mXxWS: $fee = Db::name("\x79\142\x73\x63\x5f\145\x78\160\x72\145\x73\163\x5f\x72\165\x6c\145\x73")->where(["\x6d\x63\150\137\x69\x64" => $data["\155\x63\x68\x5f\x69\x64"], "\151\x64" => $goods["\163\x68\x69\160\160\151\x6e\x67\137\x66\145\145\x5f\151\x64"]])->field("\x69\144\x2c\x76\x61\154\x75\145\163\54\164\x79\160\145\137\x66\x65\145")->find(); goto Ks8sJ; C61dp: $pro = Db::name("\171\x62\163\x63\x5f\141\x72\145\x61")->where("\x69\144", $city)->value("\160\151\144"); goto Auw37; UoRA8: goto YyEA9; goto EHgdi; xas2j: $index = -1; goto d0k9q; BUYOr: zAtge: goto RDqBO; wXskX: if (!($area_id > 0 && $goods_price > 0)) { goto dfQ8x; } goto RYO0z; dnkJa: $rs["\x6d\x73\147"] = $goods["\147\x6f\x6f\144\x73\x5f\156\x61\155\145"] . "\346\227\240\346\263\x95\351\205\215\351\x80\201\345\210\xb0" . $city_name . "\xe8\xaf\267\xe8\x81\x94\xe7\xb3\xbb\345\215\226\345\xae\266\xe5\220\216\xe5\206\x8d\344\xb8\213\xe5\215\225\xef\274\x81"; goto v5ZFD; LQBlE: $city_name = $pro_name . $city_name; goto wDgKy; d0k9q: $type_fee = $fee["\x74\171\x70\x65\137\x66\x65\x65"]; goto ZJL4y; I7UB2: $fee_list = json_decode($fee["\x76\x61\x6c\x75\145\163"]); goto xUtZ0; ZYbLo: return json_encode($rs); goto Qrk1i; C9HOr: ddk9w: goto I7UB2; Ks8sJ: if (!empty($fee)) { goto bXnyu; } goto ADhAq; VBjTv: if (!($data["\156\165\x6d"] > $frist_num)) { goto VHuS7; } goto G6haR; rr2c8: goto OgwW5; goto BUYOr; iGnHk: $add_price = $fee_old["\x62\171\156\x75\155\137\x78\160\162\x69\143\145"]; goto LhKm1; eKx5v: $add_num = $fee_list[$index]->add_num; goto d1NOW; O2FNw: Bb1wu: goto t4zNq; q9HzU: $type = 2; goto B30C7; P4FJO: return json_encode($rs); goto DQ5xn; RDqBO: P2X72: goto xU1h7; Yjruf: Lieiy: goto yckSk; Qrk1i: goto Mw8rG; goto JGgwv; NcANx: $rs = array("\x63\x6f\x64\x65" => 0, "\151\156\146\157" => 0); goto wXskX; xUtZ0: $i = 0; goto g7QHt; SvikY: if (!($goods_price >= $exemptions_info["\x70\x72\x69\x63\x65"])) { goto Bb1wu; } goto SisSL; B30C7: RL40f: goto mXxWS; M37sI: $type = 1; goto qyAfx; SnJcP: foreach ($fee_city as $k => $v) { goto SVx3k; SVx3k: if (!($city == $k)) { goto xW_BH; } goto fTb8a; fTb8a: $index = $i; goto jVU6x; y2FlM: Irn8e: goto PrWSJ; ETjBF: xW_BH: goto y2FlM; jVU6x: goto gHIn2; goto ETjBF; PrWSJ: } goto qhVoW; vXOfS: if (empty($fee_old)) { goto O8YPh; } goto y6BwE; jpssh: GqOfO: goto P4FJO; Y_sHf: $rs["\x69\x6e\x66\x6f"] = floatval($rs["\x69\156\x66\157"]) + $num * floatval($add_price); goto xH5Xq; oH4ws: if (!($i < count($fee_list))) { goto OgwW5; } goto hQ9Vo; wDgKy: ZQCpS: goto QX33W; t4zNq: dfQ8x: goto M37sI; JGgwv: O8YPh: goto DbwgA; G6haR: $num = ceil((intval($data["\x6e\x75\x6d"]) - intval($frist_num)) / intval($add_num)); goto pipP2; jlALk: $add_price = $fee_list[$index]->add_price; goto eKx5v; a2C2y: $data["\156\165\155"] = intval($goods["\167\x65\x69\x67\x68\164"]) * intval($data["\156\165\x6d"]); goto C9HOr; kYEOR: $type = 2; goto n6pVG; uJGbg: if (!($goods && ($goods["\163\x68\151\x70\160\151\x6e\147\137\x66\x65\145\x5f\151\x64"] == 0 || $goods["\x73\x68\x69\160\160\x69\156\x67\137\146\x65\145"] == "\x30\56\x30\60"))) { goto FAFLv; } goto kYEOR; hQ9Vo: $fee_city = $fee_list[$i]->city; goto SnJcP; xU1h7: $i++; goto UoRA8; MiWDo: goto jPz6m; goto Yjruf; g7QHt: YyEA9: goto oH4ws; cNg63: goto SWwFV; goto jpssh; XUDWI: jPz6m: goto P2z3d; DbwgA: $type = 2; goto PKFDH; t1u63: } public function ManJian($mch_id) { goto cjQk8; qWuaq: foreach ($info as $act_k => $act_v) { goto uUKzK; uUKzK: $act_v["\x73\164\x61\x72\137\x74\x69\155\145"] = date("\131\x2d\155\x2d\x64\40\110\x3a\151\x3a\163", $act_v["\x73\x74\141\162\x5f\x74\x69\155\145"]); goto O65HB; O65HB: $act_v["\145\156\x64\x5f\164\x69\x6d\x65"] = date("\131\55\155\55\144\x20\110\72\x69\72\163", $act_v["\x65\x6e\x64\137\x74\x69\x6d\145"]); goto UhX3G; UhX3G: oJmF9: goto aRSXS; aRSXS: } goto eJNkC; eJNkC: rd7Fj: goto Hk5hq; cjQk8: $info = Db::name($this->hd)->where("\155\x63\150\x5f\x69\x64", $mch_id)->where("\151\x73\x5f\165\x73\145", 1)->order("\163\141\x74\x69\163\146\x79\137\x6d\x6f\156\145\x79", "\x64\x65\x73\x63")->where("\163\x74\141\x72\x5f\x74\151\x6d\x65", "\74", time())->where("\145\156\144\137\164\151\155\145", "\x3e", time())->select(); goto qWuaq; Hk5hq: return $info; goto n22QF; n22QF: } public function mchInfo($mch_id) { $info = Db::name($this->bus)->field("\x69\x64\54\156\151\x63\153\137\156\141\155\x65\54\156\x61\x6d\145\54\x70\x68\157\156\145\54\x6d\157\x64\x5f\143\x6c\141\x73\x73\x5f\x69\144\54\x70\x61\x79\x6d\x65\x6e\164\137\155\145\x74\x68\157\144")->where("\x69\144", $mch_id)->where("\151\x73\137\144\145\154", 1)->find(); return $info; } public function BusCoupon($data, $page) { goto Htubj; Htubj: $info = Db::name($this->bc)->where("\x6d\x63\x68\x5f\151\x64", $data["\x6d\x63\x68\x5f\x69\144"])->where("\x69\163\x5f\165\163\x65", 1)->page($page, PAGE_NUM)->order("\151\x64", "\x64\x65\163\x63")->where("\163\164\141\x72\137\x74\x69\155\145", "\74", time())->where("\145\x6e\144\137\x74\x69\155\145", "\76", time())->select(); goto lqB3u; WIfcQ: P1yR_: goto pRLqf; lqB3u: foreach ($info as $act_k => $act_v) { goto iBpTu; FPS_l: $count = Db::name($this->uc)->where($user_data)->count(); goto c5eM5; c5eM5: $info[$act_k]["\151\x73\x5f\147\x65\x74"] = $count == 0 ? 0 : 1; goto e43Cu; YiIOu: $info[$act_k]["\145\156\144\x74\151\x6d\145"] = date("\x59\55\155\55\144", $act_v["\x65\156\144\137\x74\x69\x6d\x65"]); goto lVlpV; iBpTu: $user_data = ["\x75\163\145\x72\137\x69\x64" => $data["\x75\x73\145\162\x5f\151\x64"], "\x63\157\x75\x70\x6f\156\137\x69\x64" => $act_v["\151\144"]]; goto FPS_l; e43Cu: $info[$act_k]["\163\x61\164\151\x73\x66\171\x5f\155\157\156\x65\x79"] = intval($act_v["\163\x61\x74\151\163\x66\x79\137\155\x6f\156\145\171"]); goto o8NaV; lVlpV: Mzur7: goto FelWo; V82Sy: $info[$act_k]["\x73\164\141\162\x5f\164\x69\155\145"] = __TIME($act_v["\163\x74\x61\x72\137\164\151\155\x65"]); goto YiIOu; o8NaV: $info[$act_k]["\144\x69\163\143\x6f\x75\156\164\137\x6d\x6f\x6e\145\171"] = intval($act_v["\x64\x69\163\x63\x6f\165\156\164\137\155\157\x6e\x65\x79"]); goto V82Sy; FelWo: } goto WIfcQ; pRLqf: return $info; goto CNDej; CNDej: } public function booklist($data, $page) { $info = Db::name($this->rt)->where("\155\143\x68\137\151\x64", $data["\155\x63\150\137\x69\144"])->page($page, PAGE_NUM)->order("\151\144", "\x64\145\x73\143")->select(); return $info; } public function bookinfo($data) { $info = Db::name($this->rt)->where($data)->find(); return $info; } function in_form($form, $name) { goto VSIMx; ymbGl: $i++; goto EM2ri; xbrir: goto R2grA; goto yc_TH; yY5eU: XtR0J: goto P3gK7; HTLOF: fUuSm: goto ymbGl; Vs2W2: if (!($form[$i]["\x6e\141\155\145"] == $name)) { goto K1iEH; } goto ft6uV; P3gK7: if (!($i < count($form))) { goto R2grA; } goto Vs2W2; ft6uV: $title = $form[$i]["\164\x69\164\x6c\x65"]; goto xbrir; dK1KX: $i = 0; goto yY5eU; j814w: return $title; goto vlGus; VSIMx: $title = ''; goto dK1KX; OXCoq: R2grA: goto j814w; EM2ri: goto XtR0J; goto OXCoq; yc_TH: K1iEH: goto HTLOF; vlGus: } public function UserBook($data, $page) { goto lc2q1; eLNLM: return $list; goto cAUOQ; i_g0A: return $list; goto RVHJB; cAUOQ: LAe0w: goto nM6jJ; nM6jJ: foreach ($list as $k => $v) { goto ROV0F; n5Gk7: JWC2y: goto PJY7T; PJY7T: FXGyH: goto yOMJa; at9i_: $list[$k]["\x70\141\162\x61\155"] = str_replace("\x5c\156", "\74\142\162\x3e", $list[$k]["\x70\x61\162\141\x6d"]); goto rBr4N; AURjA: EZUZH: goto at9i_; xnGso: $u = Db::name("\x79\x62\163\x63\137\162\x65\x73\145\162\166\145\137\164\x68\151\x6e\147")->where("\x69\x64", $list[$k]["\x74\x68\x69\x6e\x67\137\x69\144"])->find(); goto EA3JO; JP5xv: foreach ($list[$k]["\x70\x61\x72\141\x6d"] as $k1 => $v1) { goto i8g7G; bOTJZ: $list[$k]["\x70\141\x72\141\x6d"][$k1]["\153\x65\171"] = $string_arr[1]; goto PDRRH; i8g7G: $string_arr = explode("\55", $list[$k]["\160\141\162\141\155"][$k1]["\156\141\155\x65"]); goto bOTJZ; PDRRH: Px38e: goto xTVft; xTVft: } goto n5Gk7; NGlN3: $list[$k]["\156\141\155\145"] = $u["\156\x61\x6d\x65"]; goto S9Eee; ROV0F: $list[$k]["\x63\162\145\141\x74\x65\x5f\x74\x69\x6d\x65"] = date("\x59\x2d\155\55\144\x20\x48\x3a\x69\72\163", $list[$k]["\x63\x72\x65\x61\x74\145\137\x74\151\x6d\x65"]); goto xnGso; EA3JO: if (!$u) { goto EZUZH; } goto NGlN3; rBr4N: $list[$k]["\x70\x61\x72\x61\155"] = json_decode($list[$k]["\160\141\162\141\x6d"], true); goto JP5xv; S9Eee: $list[$k]["\151\x6d\147"] = $u["\x69\155\x67"]; goto AURjA; yOMJa: } goto qbuYp; qbuYp: N4BEv: goto i_g0A; lc2q1: $list = Db::name("\x79\x62\163\x63\x5f\162\x65\163\145\162\x76\x65\137\x70\157\x69\156\x74")->where($data)->where(["\163\x74\141\164\x75\163" => ["\x69\x6e", "\x30\54\62"]])->page($page, PAGE_NUM)->order("\x69\x64", "\144\x65\x73\143")->select(); goto gsF59; gsF59: if (!empty($list)) { goto LAe0w; } goto eLNLM; RVHJB: } public function submit_form($data, $bus_form_id) { goto LMSqX; irFuE: Db::name("\171\142\x73\143\x5f\x72\x65\x73\145\x72\166\x65\x5f\160\157\x69\x6e\164")->where("\x69\x64", $point_id)->update(["\x73\164\141\x74\x75\x73" => 1]); goto mtHUF; LMSqX: $time = time(); goto V4n98; FkmjF: $point_id = Db::name("\x79\142\x73\143\x5f\x72\x65\163\x65\162\x76\x65\x5f\160\x6f\x69\156\164")->insertGetId($where); goto hll1X; UVTN0: $where["\x63\x72\145\x61\164\x65\x5f\164\x69\x6d\x65"] = $time; goto FkmjF; xzSta: $param = json_decode($data["\160\141\162\141\155"], true); goto Funzj; zecRN: $where["\163\164\141\164\x75\163"] = 0; goto UVTN0; rKWJ0: $a = Db::name("\x79\x62\163\x63\x5f\x72\x65\163\x65\162\166\x65\x5f\160\x6f\151\x6e\164")->where(["\x74\x68\x69\156\147\x5f\151\144" => $data["\x74\150\151\x6e\147\x5f\151\x64"], "\x75\x73\145\162\137\x69\144" => $data["\x75\163\x65\x72\137\x69\x64"], "\155\143\x68\x5f\151\x64" => $data["\x6d\143\150\137\151\x64"], "\160\x61\162\141\x6d" => json_encode($arr), "\x73\x74\x61\164\165\163" => 2])->count(); goto dnPTc; z04JS: Vqj92: goto oJz18; FH2tg: return -1; goto Kntgg; H5luy: if (empty($reserve_thing)) { goto FnHYL; } goto G8WF0; meByx: $arr = array(); goto QITXp; kt0GE: if (!($a > $limit_num && $limit_num != 0)) { goto pswPr; } goto FH2tg; mK_0i: Kk7Nd: goto meByx; GYNvC: $pay_data = array("\x6f\x75\164\x5f\164\x72\x61\x64\x65\x5f\156\x6f" => $this->createOutTradeNo(), "\160\141\171\137\164\171\160\x65" => 1, "\x74\x79\160\x65\137\141\x6c\x69\163\137\x69\x64" => $point_id, "\160\141\171\137\x62\x6f\x64\171" => "\347\x94\250\346\210\267\xe9\242\204\347\272\246\xe8\xa1\xa8\345\x8d\225\346\x94\257\344\xbb\230", "\x70\x61\171\x5f\144\145\164\x61\x69\x6c" => "\xe7\224\250\xe6\210\xb7\xe9\242\204\xe7\xba\246", "\x70\141\171\137\155\x6f\x6e\145\171" => $reserve_thing["\x6d\157\x6e\145\171"], "\x70\141\x79\x5f\x73\164\x61\x74\x75\163" => 0, "\160\x61\x79\137\x74\x69\x6d\145" => 0, "\143\162\145\x61\x74\145\137\164\x69\155\x65" => time()); goto irFuE; NLS35: foreach ($param as $k => $v) { goto p_nyU; tscJ1: sDf6s: goto j7V2O; zyDiG: $arr[$n]["\164\151\164\154\145"] = $this->in_form($form, $k); goto Bjovr; Bjovr: $n++; goto tscJ1; p_nyU: $arr[$n]["\x6e\141\x6d\x65"] = $k; goto tPEDn; tPEDn: $arr[$n]["\x76\141\x6c\165\145"] = $v; goto zyDiG; j7V2O: } goto fBzvP; QITXp: $n = 0; goto NLS35; dnPTc: $limit_num = Db::name("\x79\142\163\x63\x5f\x62\165\x73\x5f\146\x6f\162\155")->where("\151\x64", $bus_form_id)->value("\x6c\x69\x6d\151\x74\x5f\156\x75\155"); goto kt0GE; hll1X: $reserve_thing = Db::name("\171\142\163\143\x5f\x72\145\x73\x65\x72\166\145\137\164\150\x69\x6e\x67")->where(["\155\x63\x68\x5f\x69\x64" => $data["\x6d\143\x68\137\x69\x64"], "\151\x64" => $data["\x74\150\x69\x6e\x67\x5f\151\144"]])->find(); goto H5luy; Kntgg: pswPr: goto zecRN; G8WF0: if (!($reserve_thing["\151\163\x5f\x70\x61\171"] == 1)) { goto Vqj92; } goto GYNvC; fBzvP: bBrt_: goto QiIw3; QiIw3: $where = ["\164\150\151\x6e\x67\x5f\151\144" => $data["\164\x68\151\x6e\x67\137\x69\144"], "\x75\163\145\x72\137\x69\144" => $data["\165\163\145\x72\137\x69\x64"], "\x6d\x63\x68\137\151\144" => $data["\x6d\143\x68\x5f\x69\x64"], "\160\x61\162\141\155" => json_encode($arr)]; goto rKWJ0; mtHUF: Db::name("\171\142\163\x63\x5f\x72\145\x73\x65\162\x76\x65\x5f\x70\x61\x79\155\145\x6e\164")->insert($pay_data); goto z04JS; KA8XZ: return null; goto mK_0i; V4n98: $form = json_decode($data["\146\x6f\x72\x6d"], true); goto xzSta; Funzj: if (!(count($param) == 0)) { goto Kk7Nd; } goto KA8XZ; H8sx2: return $point_id; goto Ha8la; oJz18: FnHYL: goto H8sx2; Ha8la: } public function reservePay($data) { goto muz0D; AxRF3: if (!($unifiedorder["\x72\145\x74\x75\x72\x6e\x5f\x63\157\144\145"] == "\106\x41\x49\x4c")) { goto s6css; } goto NJbSy; GdrmB: if (!($unifiedorder["\162\145\163\165\154\164\x5f\x63\157\144\145"] == "\106\101\x49\114")) { goto wZZX2; } goto yvvBd; ZXjoC: return $rs; goto q4zcX; TFisC: $rs["\155\x73\x67"] = "\xe8\256\xa2\345\x8d\x95\344\270\xbb\351\xa2\230\xe5\xb7\262\xe6\x94\271\345\x8f\230"; goto ZXjoC; ebwuN: $input->SetTrade_type("\x4a\123\101\x50\x49"); goto ZzowC; JrOlH: $rs["\151\x6e\x66\x6f"] = $res; goto qcOSc; dcB2v: $rs["\x63\x6f\x64\145"] = 1; goto fGZ6l; UTh0A: AVMky: goto nHQeL; muz0D: $rs = array("\x63\x6f\x64\x65" => 0, "\x69\156\x66\x6f" => array()); goto NcZyW; ZzowC: $unifiedorder = \WxPayApi::unifiedOrder($input); goto AxRF3; eJ05l: $rs["\x6d\x73\x67"] = $unifiedorder["\x65\162\162\x5f\x63\157\144\x65\137\144\x65\x73"]; goto ETTOi; GWNBQ: s6css: goto GdrmB; rxWUA: Db::name("\x79\142\163\143\137\162\x65\163\145\x72\x76\145\137\x70\141\x79\155\x65\x6e\x74")->where("\x74\171\160\x65\x5f\141\154\x69\163\x5f\x69\x64", $data["\x70\x6f\151\x6e\164\137\151\144"])->update(["\x70\x72\x65\x70\x61\171\137\x69\144" => $unifiedorder["\x70\x72\x65\x70\141\171\137\151\x64"]]); goto W4vgo; fv6nC: $input->SetDetail($info["\160\141\171\137\x64\x65\164\x61\x69\154"]); goto JwArJ; HhPk0: $input = new \WxPayUnifiedOrder(); goto BEhmt; ETTOi: return $rs; goto xBFiQ; q4zcX: EKE3V: goto azG2g; vGMDv: $rs["\x6d\x73\x67"] = $unifiedorder["\162\145\x74\165\x72\156\137\x6d\x73\x67"]; goto tKkHw; tKkHw: return $rs; goto GWNBQ; BEhmt: $input->SetBody($info["\160\141\171\x5f\x62\157\144\171"]); goto nF5Do; NcZyW: $info = Db::name("\171\142\x73\143\x5f\x72\145\x73\x65\x72\x76\145\137\x70\x61\171\155\x65\x6e\x74")->where("\x74\x79\160\145\137\x61\x6c\x69\x73\137\151\x64", $data["\160\157\151\x6e\x74\x5f\151\x64"])->find(); goto gjLiT; gjLiT: if (!empty($info)) { goto AVMky; } goto dcB2v; qcOSc: return $rs; goto KRhmq; imfiL: $GLOBALS["\153\x65\x79"] = "\162\145\x73\x65\x72\166\145"; goto HhPk0; NJbSy: $rs["\x63\x6f\x64\145"] = 1; goto vGMDv; nF5Do: $input->SetOpenid($data["\157\160\145\156\x69\x64"]); goto fv6nC; W4vgo: $res = $this->weixinapp($unifiedorder); goto JrOlH; yvvBd: $rs["\143\157\x64\145"] = 1; goto eJ05l; nHQeL: if (!($info["\x70\141\x79\137\x73\164\x61\164\x75\163"] != 0)) { goto EKE3V; } goto VooLQ; fGZ6l: $rs["\155\163\147"] = "\xe8\xae\xa2\xe5\x8d\x95\xe4\xb8\x8d\xe5\255\x98\345\x9c\xa8"; goto VYCKr; FkDqV: $input->SetOut_trade_no($info["\x6f\165\164\137\x74\x72\x61\x64\x65\137\x6e\x6f"]); goto ebwuN; azG2g: $GLOBALS["\x6d\143\x68\x5f\151\144"] = $data["\155\x63\x68\137\x69\x64"]; goto imfiL; VooLQ: $rs["\x63\157\144\x65"] = 1; goto TFisC; xBFiQ: wZZX2: goto rxWUA; VYCKr: return $rs; goto UTh0A; JwArJ: $input->SetTotal_fee($info["\x70\x61\x79\x5f\155\157\x6e\145\171"] * 100); goto FkDqV; KRhmq: } private function weixinapp($unifiedorder) { goto O2Nh9; GiV3n: $input->SetSign(); goto j8w86; ZM3m7: $input = new \WxPayJsApiPay(); goto Kcqiz; K_NKR: $input->SetNonceStr($this->createNoncestr()); goto ALYW4; ALYW4: $input->SetPackage("\x70\162\145\160\x61\x79\137\x69\144\75" . $unifiedorder["\160\x72\x65\160\x61\x79\x5f\x69\144"]); goto ww3wY; ww3wY: $input->SetSignType("\x4d\x44\x35"); goto GiV3n; j8w86: return $input; goto agU1B; r3zs7: $input->SetTimeStamp('' . time() . ''); goto K_NKR; O2Nh9: $param = Db::name("\171\x62\x73\143\137\143\157\156\146\151\147")->where("\x6b\x65\171", "\127\x58\x50\101\131")->where("\155\x63\x68\137\x69\144", $GLOBALS["\155\x63\x68\137\x69\x64"])->where("\x69\x73\x5f\165\x73\x65", 1)->value("\x76\141\154\x75\x65"); goto Mi2m9; Mi2m9: $param = json_decode($param, true); goto ZM3m7; Kcqiz: $input->SetAppid($param["\101\120\x50\x5f\111\x44"]); goto r3zs7; agU1B: } private function createNoncestr($length = 32) { goto rJdnL; L1hD2: fxaCJ: goto JjykR; unU1p: if (!($i < $length)) { goto Zoj2V; } goto pXmCY; D0nqX: goto QuVUw; goto wJmSz; pXmCY: $str .= substr($chars, mt_rand(0, strlen($chars) - 1), 1); goto L1hD2; M5xVz: $str = ''; goto Y0fgb; Y0fgb: $i = 0; goto N33ij; LxqN3: return $str; goto jZDj_; wJmSz: Zoj2V: goto LxqN3; JjykR: $i++; goto D0nqX; rJdnL: $chars = "\141\x62\x63\x64\x65\x66\147\x68\151\152\153\154\x6d\x6e\x6f\x70\x71\162\163\164\165\x76\167\170\x79\x7a\x30\x31\62\63\64\x35\x36\67\70\x39"; goto M5xVz; N33ij: QuVUw: goto unU1p; jZDj_: } public function createOutTradeNo() { goto iE8lN; kZ_dY: $order_no = $time_str . time() . rand(111, 999); goto mb1x0; iE8lN: $time_str = date("\131\x6d\144"); goto kZ_dY; mb1x0: return $order_no; goto Z_dFk; Z_dFk: } public function getCoupon($data) { goto JNjgE; PaCkE: return "\x65\170\x69\163\164"; goto ol3O3; Z8mJA: if ($count > 0) { goto nrgp5; } goto Q0wEs; JNjgE: $count = Db::name($this->uc)->where("\x63\x6f\165\160\x6f\x6e\x5f\151\144", $data["\143\x6f\x75\160\157\156\x5f\x69\x64"])->where("\x75\163\145\162\137\151\x64", $data["\165\x73\x65\x72\137\151\144"])->count(); goto Z8mJA; tSWcE: $info = Db::name($this->uc)->insert($data); goto SeJJ1; P2mFL: goto ui8uJ; goto q2svz; ol3O3: LxivY: goto I07BE; vyv59: return "\x65\155\x70\x74\171"; goto P2mFL; Ivssj: goto LxivY; goto X4tvD; j9srk: ui8uJ: goto Ivssj; SeJJ1: return $info; goto j9srk; rh0CZ: Db::name($this->bc)->where("\151\144", $data["\x63\x6f\165\x70\x6f\x6e\x5f\x69\x64"])->setDec("\162\x65\x6d\137\143\157\x75\x6e\164", 1); goto tSWcE; oLw5F: if ($as["\x72\145\155\x5f\x63\157\165\x6e\164"] > 0) { goto gDIII; } goto vyv59; q2svz: gDIII: goto rh0CZ; Q0wEs: $as = Db::name($this->bc)->where("\x69\144", $data["\x63\157\165\x70\x6f\x6e\137\151\144"])->find(); goto oLw5F; X4tvD: nrgp5: goto PaCkE; I07BE: } public function UserCoupon($data, $page) { goto pdiLp; tq2hV: foreach ($info as $act_k => $act_v) { goto dsGz1; Un5ot: $info[$act_k]["\163\x61\x74\151\x73\x66\x79\x5f\x6d\x6f\156\x65\x79"] = intval($a["\x73\x61\x74\x69\163\x66\x79\137\155\x6f\156\145\x79"]); goto Ys0Cy; dsGz1: $a = Db::name($this->bc)->where("\x69\x64", $act_v["\x63\x6f\165\160\157\x6e\137\x69\144"])->find(); goto GJ6MY; Ys0Cy: $info[$act_k]["\144\x69\x73\143\157\165\x6e\164\x5f\x6d\157\156\x65\x79"] = intval($a["\x64\x69\163\143\x6f\165\156\x74\137\x6d\x6f\x6e\145\x79"]); goto OGyjj; TRjt0: mDO1O: goto SOoey; oaBvk: B0PqC: goto hWnn3; SOoey: $info[$act_k]["\x67\x65\164\137\164\151\x6d\x65"] = date("\131\x2d\155\55\x64\40\110\72\151\72\x73", $act_v["\147\145\x74\137\x74\x69\x6d\145"]); goto oaBvk; EJxI2: $info[$act_k]["\145\156\144\164\151\x6d\x65"] = date("\x59\55\x6d\x2d\144", $a["\x65\x6e\144\137\x74\x69\x6d\145"]); goto Jtl6m; GJ6MY: if (!$a) { goto mDO1O; } goto Un5ot; OGyjj: $info[$act_k]["\164\157\x67\145\x74\150\x65\x72"] = $a["\x74\157\147\145\164\x68\x65\x72"]; goto EJxI2; Jtl6m: $info[$act_k]["\x65\x6e\144\137\x74\x69\155\145"] = $a["\145\156\x64\x5f\164\x69\x6d\x65"]; goto TRjt0; hWnn3: } goto uial9; uial9: MKxJB: goto zPR5t; zPR5t: return $info; goto TU3Gb; pdiLp: $info = Db::name($this->uc)->where($data)->where("\151\x73\137\144\x65\154", 0)->page($page, PAGE_NUM)->order("\151\x64", "\144\145\x73\x63")->order("\x73\164\141\x74\165\x73", "\144\145\163\143")->select(); goto tq2hV; TU3Gb: } public function getFormid($data) { goto I3XiD; UZy0A: $info = $formid->save($data); goto dYNPZ; dYNPZ: return $info; goto a3ma1; I3XiD: $formid = new UserFormid(); goto UZy0A; a3ma1: } }
