<?php
 namespace app\api\service; use think\Db; require_once BASE_ROOT . "\143\157\162\x65\57\x61\x70\160\x6c\x69\143\141\x74\151\x6f\x6e\x2f\x63\157\155\x6d\x6f\x6e\56\160\x68\x70"; class UserService { protected $wa = ''; protected $d = 1; protected $now = ''; protected $config = array("\165\x72\154" => "\x68\164\164\160\x73\72\57\x2f\x61\160\x69\x2e\167\x65\151\x78\151\156\56\x71\161\56\143\x6f\155\x2f\163\x6e\163\57\152\163\143\157\144\x65\62\x73\x65\163\163\x69\157\156", "\x61\x70\x70\x69\144" => "\x79\x6f\x75\162\40\x61\160\160\111\144", "\x73\x65\143\x72\145\164" => "\x79\157\x75\x72\40\x73\x65\x63\162\145\164", "\147\x72\x61\x6e\164\x5f\164\171\x70\x65" => "\141\165\164\x68\157\162\151\x7a\x61\x74\151\x6f\156\x5f\x63\157\x64\x65"); public function __construct() { goto GQ8Pb; dN3KI: $param = Db::name("\171\x62\163\x63\x5f\x63\x6f\156\146\x69\x67")->where("\x6b\x65\171", "\x57\130\x50\101\131")->where("\x6d\143\150\137\151\x64", $GLOBALS["\x6d\x63\x68\137\x69\x64"])->value("\x76\x61\x6c\x75\x65"); goto o4X7t; PznHf: $key = $_W["\x61\x63\143\157\165\x6e\x74"]["\153\x65\x79"]; goto hcUV2; pIbKi: $secret = $param["\101\120\120\x5f\123\x45\x43\x52\105\124"]; goto tmY9_; tmY9_: NrA0x: goto ijGaZ; hcUV2: $secret = $_W["\x61\x63\143\157\165\156\x74"]["\163\145\x63\x72\x65\164"]; goto TdbM5; ijGaZ: $this->config["\141\160\x70\x69\x64"] = $key; goto k5sz5; GQ8Pb: global $_W; goto PznHf; TdbM5: if (!(empty($key) || empty($secret))) { goto NrA0x; } goto dN3KI; k5sz5: $this->config["\163\145\143\162\x65\x74"] = $secret; goto S83QL; o4X7t: $param = json_decode($param, true); goto Otpru; Otpru: $key = $param["\101\120\x50\137\x49\x44"]; goto pIbKi; S83QL: } public function checkUser($appId, $pid, $mch_id) { goto t6jnf; x7opB: if (!(!empty($rs) && $pid != 0 && $rs["\160\x69\x64"] == 0 && $pid != $rs["\x75\x69\144"] && $rs["\x69\x73\137\144\151\x73\164\x72\x69\x62\x75\x74\157\162"] == 0 && $this->d == 0)) { goto iusiG; } goto QU5Xi; VN2vN: goto swsEu; goto cvWIp; bMlEu: aZsMl: goto VN2vN; txXky: OxJp3: goto Cmmnv; wkni5: if (!($this->wa == $this->now)) { goto gZEyI; } goto CiYj4; LkNAc: goto inKF4; goto jFX_8; gfmUk: if ($this->now == $this->wa) { goto AuASA; } goto d3eUH; H9B3h: iusiG: goto UdVQ0; CiYj4: $this->d = 2; goto pe8dm; FpaSb: inKF4: goto lCW7V; sK86D: $this->d = 2; goto M1iEC; RS8QS: $this->d = 0; goto ABdBv; qtg0Z: if (!in_array($this->wa, $arr)) { goto aZsMl; } goto sK86D; zXdD3: return $rs["\x75\x69\x64"]; goto gm9ZA; qYpII: $this->wa = Db::name("\x79\142\163\143\x5f\165\x73\x65\x72")->where("\165\x69\144", $this->wa)->value("\x70\151\144"); goto wkni5; VLkPJ: goto dT0P9; goto bMlEu; m4NGK: return null; goto a0Vg2; UdVQ0: if (!empty($rs) && $rs["\165\x69\144"]) { goto ph4r9; } goto m4NGK; ABdBv: goto dT0P9; goto FpaSb; w21Zb: $this->wa = Db::name("\x79\x62\163\143\x5f\165\163\145\x72")->where("\x75\x69\144", $pid)->value("\160\x69\x64"); goto Tlmg9; hXSBt: swsEu: goto LkNAc; chTsm: $this->d = 1; goto qYpII; Cmmnv: if ($this->wa == 0 || $pid == 0) { goto jcvSF; } goto gfmUk; nB158: $this->d = 2; goto XMd_o; jFX_8: jcvSF: goto RS8QS; d3eUH: array_push($arr, $this->wa); goto chTsm; gm9ZA: r25Ww: goto HNwpu; t6jnf: Db::name("\x79\x62\163\x63\x5f\165\163\145\162")->where(["\167\170\x5f\x6f\160\x65\x6e\151\x64" => $appId, "\155\143\150\x5f\151\x64" => ["\74\x3e", $mch_id]])->delete(); goto w21Zb; a0Vg2: goto r25Ww; goto CbS48; HvDf3: gZEyI: goto qtg0Z; pe8dm: goto dT0P9; goto HvDf3; XMd_o: goto dT0P9; goto hXSBt; CbS48: ph4r9: goto zXdD3; POtcl: dT0P9: goto x7opB; y6PKz: $this->now = $rs["\x75\x69\x64"]; goto Fw1ER; lCW7V: if ($this->d == 1) { goto OxJp3; } goto POtcl; cvWIp: AuASA: goto nB158; mznjf: Db::name("\x79\x62\x73\143\x5f\x75\163\145\162")->where("\165\151\x64", $arr[0])->update(["\160\x69\x64" => 0]); goto VLkPJ; Tlmg9: $rs = Db::name("\x79\x62\163\143\x5f\x75\x73\x65\162")->where(["\x77\170\137\x6f\160\x65\x6e\151\144" => $appId, "\x6d\x63\150\137\x69\144" => $mch_id])->find(); goto y6PKz; QU5Xi: Db::name("\x79\142\163\143\137\165\163\x65\x72")->where(["\167\170\x5f\157\x70\x65\x6e\x69\144" => $appId, "\155\143\x68\x5f\151\x64" => $mch_id])->update(["\160\151\x64" => $pid]); goto H9B3h; M1iEC: sort($arr); goto mznjf; Fw1ER: $arr = array(); goto txXky; HNwpu: } public function addUser($data) { goto zDIXR; vdfX2: $data["\160\151\144"] = 0; goto flDGc; d8Kub: $rs = Db::name("\x79\142\x73\143\x5f\x75\x73\145\162")->insertGetId($data); goto bF4pn; flDGc: pQFUT: goto d8Kub; zDIXR: $info = Db::name("\171\x62\163\x63\137\x75\x73\x65\x72\x5f\x73\150\x61\162\145\x5f\x73\x65\x74\164\151\x6e\147")->where("\155\x63\150\137\151\144", $data["\x6d\x63\x68\x5f\x69\144"])->find(); goto QpRTW; QpRTW: if (!(empty($info) || $info["\154\x65\x76\x65\154"] == 0)) { goto pQFUT; } goto vdfX2; bF4pn: return $rs; goto cO7Mk; cO7Mk: } public function getUser($uid) { $result = Db::name("\171\142\x73\143\137\x75\x73\145\x72")->where("\165\x69\144", $uid)->find(); return $result; } public function checkLogin($code, $encryptedData, $iv) { goto BbgyQ; Onw4X: if (!($encryptedData && $iv)) { goto lIruc; } goto OrgSv; BbgyQ: $params = array("\x61\160\x70\x69\144" => $this->config["\141\x70\160\151\144"], "\x73\x65\x63\x72\145\164" => $this->config["\x73\x65\x63\x72\x65\164"], "\152\163\x5f\143\157\144\145" => $code, "\x67\x72\141\x6e\164\x5f\x74\x79\160\145" => $this->config["\x67\162\141\156\x74\137\164\x79\x70\x65"]); goto QCG1y; flMPj: $info = json_decode(json_encode($data), true); goto HHXH4; yiDo2: return $a; goto aPh1a; HHXH4: $a["\x75\x6e\151\157\156\111\x64"] = $info["\165\x6e\151\157\x6e\x49\x64"] ? $info["\165\x6e\x69\x6f\156\111\144"] : null; goto Y2Xhs; Y2Xhs: lIruc: goto yiDo2; QCG1y: $res = $this->makeRequest($this->config["\x75\x72\x6c"], $params); goto GIJ16; GIJ16: $a = json_decode($res["\162\145\x73\x75\154\164"], true); goto AHax8; OrgSv: $data = $this->decryptData($encryptedData, $a["\x73\145\x73\163\x69\157\x6e\x5f\153\x65\x79"], $this->config["\141\160\160\151\x64"], $iv); goto flMPj; AHax8: $a["\165\156\x69\157\x6e\x49\144"] = null; goto Onw4X; aPh1a: } protected function makeRequest($url, $params = array(), $expire = 0, $extend = array(), $hostIp = '') { goto HI7Gu; aU0fo: z91fu: goto EEdVb; EEdVb: if (empty($params)) { goto rQ6QD; } goto J9FRm; Dkmm0: $result["\x63\157\x64\145"] = curl_getinfo($_curl, CURLINFO_HTTP_CODE); goto rSFn6; PqZ0F: $result["\143\157\144\145"] = -curl_errno($_curl); goto haiUM; ZscNp: curl_setopt_array($_curl, $extend); goto qzC56; KlyAB: curl_close($_curl); goto Bl4to; SUExV: return array("\x63\x6f\x64\x65" => "\x31\x30\x30"); goto NNa2Q; HBLKL: $url = "\x68\164\x74\x70\x3a\x2f\x2f{$hostIp}{$url}"; goto DKwT2; X70bu: $result["\162\145\163\x75\154\x74"] = curl_exec($_curl); goto Dkmm0; zCh3p: $urlInfo = parse_url($url); goto Ukuf2; dar71: if (!($result["\162\x65\x73\x75\x6c\164"] === false)) { goto cdD5z; } goto qovU8; rJllQ: curl_setopt($_curl, CURLOPT_TIMEOUT, $expire); goto Y_wiW; rui9n: eZwnp: goto i0uZd; qovU8: $result["\x72\145\163\165\x6c\164"] = curl_error($_curl); goto PqZ0F; qzC56: GIvBE: goto X70bu; pFJOz: curl_setopt($_curl, CURLOPT_SSL_VERIFYHOST, FALSE); goto y06vS; i0uZd: $urlInfo["\150\x6f\x73\164"] = substr(DOMAIN, 7, -1); goto HBLKL; xvgt8: $url = str_replace($urlInfo["\150\x6f\163\x74"], $hostIp, $url); goto KkV22; Ukuf2: if (empty($urlInfo["\x68\157\x73\164"])) { goto eZwnp; } goto xvgt8; dxt0n: curl_setopt($_curl, CURLOPT_POST, true); goto SohUr; dEL3Y: lh413: goto wYbdD; Bl4to: return $result; goto f_QnA; NNa2Q: fxY9r: goto sRPII; sejXS: $_header = array("\x41\x63\x63\x65\x70\164\55\114\141\156\x67\x75\x61\x67\x65\72\40\172\x68\x2d\103\116", "\103\157\156\156\145\x63\164\x69\x6f\156\x3a\40\113\145\x65\160\55\x41\x6c\151\166\x65", "\x43\x61\143\x68\x65\x2d\103\x6f\156\164\x72\157\154\72\40\x6e\x6f\x2d\143\141\143\150\x65"); goto r3uO4; KkV22: goto oX22w; goto rui9n; cy7mX: curl_setopt($_curl, CURLOPT_USERAGENT, "\101\120\111\x20\x50\x48\120\x20\x43\x55\x52\114"); goto h1EzS; SohUr: rQ6QD: goto Mj3JP; HI7Gu: if (!empty($url)) { goto fxY9r; } goto SUExV; Mj3JP: if (!(substr($url, 0, 8) == "\x68\164\x74\x70\x73\x3a\57\57")) { goto pumcd; } goto qAXZ3; X6O_d: curl_setopt($_curl, CURLOPT_RETURNTRANSFER, true); goto cy7mX; sRPII: $_curl = curl_init(); goto sejXS; y06vS: pumcd: goto kDmqs; r3uO4: if (empty($hostIp)) { goto z91fu; } goto zCh3p; Rctl_: if (!($expire > 0)) { goto lh413; } goto rJllQ; FVd2B: $_header[] = "\110\157\163\164\72\40{$urlInfo["\x68\x6f\x73\164"]}"; goto aU0fo; J9FRm: curl_setopt($_curl, CURLOPT_POSTFIELDS, http_build_query($params)); goto dxt0n; DKwT2: oX22w: goto FVd2B; qAXZ3: curl_setopt($_curl, CURLOPT_SSL_VERIFYPEER, FALSE); goto pFJOz; kDmqs: curl_setopt($_curl, CURLOPT_URL, $url); goto X6O_d; wYbdD: if (empty($extend)) { goto GIvBE; } goto ZscNp; rSFn6: $result["\x69\156\146\x6f"] = curl_getinfo($_curl); goto dar71; h1EzS: curl_setopt($_curl, CURLOPT_HTTPHEADER, $_header); goto Rctl_; haiUM: cdD5z: goto KlyAB; Y_wiW: curl_setopt($_curl, CURLOPT_CONNECTTIMEOUT, $expire); goto dEL3Y; f_QnA: } public function get_userinfo($data) { $u = Db::name("\x79\x62\163\x63\137\x75\x73\145\x72")->where("\165\x69\x64", $data["\x75\151\x64"])->find(); return $u; } public function orderCount($data) { goto qLDg4; fTT_Q: $copy = file_get_contents(VIPAPI . "\x61\x70\x69\57\151\x6e\x64\x65\x78\x2f\151\163\x5f\x73\x68\x6f\167\x5f\x63\157\160\x79\x72\151\147\150\x74\x3f\x75\156\151\141\x63\x69\144\75" . $data["\141\x70\x70\x5f\x69\144"] . "\x26\x79\165\155\151\156\x67\75" . $_SERVER["\x48\124\x54\120\137\110\117\x53\124"]); goto Flh5o; hC3yx: if (empty($copyright)) { goto v_Pwb; } goto Gh7fx; nJeMk: $rs["\143\157\x70\x79\x72\x69\147\x68\x74"] = ''; goto nyb3w; ctNUO: v_Pwb: goto yv1oh; FI2ie: lXIYv: goto IKrNR; pH0iU: $rs["\x66\141\x76\x6f\x72\151\164\145\x73"] = Db::name("\171\142\163\x63\x5f\x75\x73\145\x72\137\146\x61\166\x6f\162\151\164\145\163")->where("\x75\151\x64", $data["\x75\151\144"])->count(); goto xr_q1; jx_wx: $a = Db::name("\171\142\x73\143\x5f\x75\x73\145\x72\137\x6c\x65\166\x65\154")->where(["\151\144" => $u["\x6c\145\166\145\154\137\151\x64"], "\x6d\x63\x68\x5f\151\x64" => $data["\155\x63\150\x5f\x69\144"]])->find(); goto C0QMe; yv1oh: yEdMH: goto s0T_c; bjkjk: return $rs; goto MXYX_; IKrNR: if (!empty($u["\x6e\x69\x63\153\137\156\x61\155\145\x20"])) { goto N5NmQ; } goto emb01; C0QMe: $rs["\154\145\x76\145\x6c\137\156\141\x6d\145"] = $a["\x6c\145\x76\145\x6c\137\156\x61\x6d\x65"]; goto FI2ie; Flh5o: if (!empty($copy)) { goto Gw8Qz; } goto nJeMk; x_NPz: wnKR0: goto bjkjk; HM9jz: goto wnKR0; goto e7Qgm; nIHek: N5NmQ: goto CmzFh; qLDg4: $rs = array(); goto EdPxF; CmzFh: $rs["\x70\145\156\144\151\x6e\x67\137\160\x61\x79\155\x65\156\164"] = Db::name("\171\142\163\143\x5f\157\162\x64\x65\162")->where("\142\165\x79\145\162\137\151\x64", $data["\x75\x69\144"])->where("\151\163\137\144\x65\x6c\x65\164\145\x64", 0)->where("\155\143\x68\x5f\151\144", $data["\155\x63\150\137\151\144"])->where("\157\x72\x64\x65\162\137\163\164\141\x74\x75\163", 0)->count(); goto U1_jm; TKhur: if (!($u["\154\145\x76\145\x6c\137\x69\144"] != 0)) { goto lXIYv; } goto jx_wx; JwjLG: jt2Ut: goto KWVo8; DxiZb: $rs["\143\x6f\x70\171\x72\x69\147\x68\164"] = "\xe6\x8a\200\xe6\234\xaf\346\x94\xaf\xe6\214\x81"; goto zeQyj; U1_jm: $rs["\160\145\156\144\x69\x6e\147\137\x73\150\151\160\x6d\x65\x6e\x74"] = Db::name("\x79\x62\163\x63\137\x6f\162\x64\145\162")->where("\x62\x75\x79\145\x72\x5f\151\144", $data["\165\x69\144"])->where("\151\x73\137\144\145\154\145\x74\145\144", 0)->where("\x6d\143\150\137\151\144", $data["\155\x63\150\x5f\x69\x64"])->where("\x6f\162\144\145\x72\x5f\x73\x74\x61\x74\x75\163", 1)->count(); goto nu6Qj; nyb3w: goto oC8dH; goto DX0TA; EdPxF: $u = Db::name("\x79\x62\163\x63\x5f\165\x73\x65\162")->where("\165\151\144", $data["\165\x69\x64"])->find(); goto U0jDa; xr_q1: $cop = Db::name("\x79\x62\x73\143\137\165\x73\x65\x72\137\x70\145\162\x6d\151\163\163\x69\x6f\156")->alias("\x70")->join("\165\x6e\151\x5f\x61\143\x63\x6f\165\156\x74\x5f\x75\x73\x65\162\x73\x20\x75", "\160\56\165\x73\145\162\x5f\x69\x64\x20\75\40\165\56\165\x69\x64")->where("\165\56\x75\x6e\x69\x61\x63\x69\144", $data["\x6d\143\150\x5f\151\144"])->where("\x75\x2e\162\157\154\145", "\157\167\x6e\145\x72")->value("\160\56\151\163\x5f\x73\150\x6f\167\137\x63\x6f\x70\x79\162\x69\147\150\x74"); goto pV3EF; oqWFM: $rs["\143\157\160\x79\x72\151\147\150\164"] = ''; goto x_NPz; PqHqe: if ($copy["\143\x6f\x64\x65"] == 0) { goto jt2Ut; } goto DxiZb; emb01: $rs["\156\x69\143\153\116\141\x6d\x65"] = $u["\x6e\151\x63\153\137\156\x61\155\x65\x20"]; goto nIHek; pV3EF: if (!empty($cop) && $cop == 1) { goto iseGT; } goto fTT_Q; Gh7fx: $rs["\143\157\x70\171\x72\x69\147\x68\x74"] = $copyright["\x63\x6f\156\164\145\x6e\164"]; goto ctNUO; TTFG9: $rs["\x69\163\x5f\x77\162\151\x74\145\x6f\x66\x66"] = $u["\x69\163\x5f\167\x72\151\164\x65\157\146\x66"]; goto TKhur; zeQyj: goto yEdMH; goto JwjLG; pk7hI: $rs["\x72\145\146\165\156\x64"] = Db::name("\171\x62\163\x63\137\157\162\144\x65\x72")->where("\x62\x75\x79\x65\162\137\x69\x64", $data["\x75\151\x64"])->where("\151\163\137\x64\145\x6c\145\164\x65\144", 0)->where("\x6d\x63\x68\x5f\x69\144", $data["\155\x63\x68\x5f\151\x64"])->where("\x6f\x72\144\145\162\x5f\x73\x74\141\164\165\163", 4)->count(); goto pH0iU; DX0TA: Gw8Qz: goto PqHqe; KWVo8: $copyright = Db::name("\x79\142\x73\143\137\x63\157\x70\171\162\151\147\150\x74")->where("\x69\x64", 1)->find(); goto hC3yx; s0T_c: oC8dH: goto HM9jz; U0jDa: $rs["\165\x73\x65\162\137\x6c\x65\166\145\154"] = $u["\154\145\x76\x65\154\x5f\x69\x64"]; goto TTFG9; nu6Qj: $rs["\x70\x65\156\144\151\x6e\147\x5f\x72\x65\143\x65\x69\160\x74"] = Db::name("\171\x62\x73\143\137\157\x72\144\145\x72")->where("\142\x75\x79\x65\x72\137\151\144", $data["\x75\151\x64"])->where("\151\163\x5f\x64\145\154\x65\164\x65\x64", 0)->where("\x6d\143\x68\x5f\x69\x64", $data["\x6d\143\150\x5f\x69\x64"])->where("\x6f\x72\x64\x65\162\137\x73\x74\x61\164\165\163", 2)->count(); goto pk7hI; e7Qgm: iseGT: goto oqWFM; MXYX_: } public function about($data) { goto mY085; bRJPW: $u = Db::name("\x79\x62\x73\x63\x5f\x75\x73\145\x72")->where($data)->find(); goto Dr7CZ; CIh71: return $rs; goto PD8nB; DBJG8: tDK01: goto BLyA7; U6wPY: $a = Db::name("\171\x62\163\x63\137\x75\x73\145\x72\x5f\x6c\x65\166\x65\154")->where(["\x69\144" => $u["\x6c\x65\x76\x65\154\137\151\x64"], "\155\x63\150\137\x69\144" => $data["\155\x63\150\137\151\x64"]])->find(); goto yff3p; BLyA7: p6mgG: goto AZW6m; tek7V: if (!($u["\x6c\x65\x76\145\154\x5f\x69\144"] != 0)) { goto p6mgG; } goto U6wPY; yff3p: if (!$a) { goto tDK01; } goto sPTG6; iaLb9: $rs["\x75\163\145\x72\137\162\x65\142\141\164\x65"] = 10.0; goto tek7V; Dr7CZ: $rs["\x75\x73\145\162\x5f\154\145\x76\x65\x6c"] = $u["\154\x65\x76\145\154\x5f\x69\144"]; goto iaLb9; mY085: $rs = Db::name("\x79\142\163\x63\x5f\x62\165\163\x69\156\145\163\163\137\141\142\157\165\x74")->where("\155\143\x68\x5f\151\x64", $data["\x6d\x63\x68\137\x69\x64"])->find(); goto aNEpE; AZW6m: uzWMf: goto CIh71; sPTG6: $rs["\x75\163\x65\162\x5f\x72\x65\x62\x61\164\x65"] = $a["\x72\145\142\141\x74\145"]; goto DBJG8; aNEpE: $rs["\154\157\x67\157"] = __IMG($rs["\x6c\x6f\147\x6f"]); goto umaCl; umaCl: if (!($data["\x75\151\144"] != 0)) { goto uzWMf; } goto bRJPW; PD8nB: } public static $OK = 0; public static $IllegalAesKey = -41001; public static $IllegalIv = -41002; public static $IllegalBuffer = -41003; public static $DecodeBase64Error = -41004; public function decryptData($encryptedData, $sessionKey, $app_id, $iv) { goto n9bhQ; rllS7: return self::$IllegalIv; goto jS3ju; QVfHq: $aesIV = base64_decode($iv); goto cfPIF; PcsrX: X5rCY: goto d1COy; sRQ6e: scOls: goto KXP8k; PQEZP: $result = openssl_decrypt($aesCipher, "\101\105\x53\x2d\61\62\x38\x2d\x43\102\x43", $aesKey, 1, $aesIV); goto WQBBp; VrSyG: if (!(strlen($iv) != 24)) { goto ZLFzD; } goto rllS7; PENBG: return self::$IllegalAesKey; goto sRQ6e; d1COy: if (!($dataObj->watermark->appid != $app_id)) { goto tGkP_; } goto ntGCX; cfPIF: $aesCipher = base64_decode($encryptedData); goto PQEZP; VgMFy: return self::$IllegalBuffer; goto PcsrX; ntGCX: return self::$IllegalBuffer; goto eP1SH; WQBBp: $dataObj = json_decode($result); goto RaZx3; RaZx3: if (!($dataObj == NULL)) { goto X5rCY; } goto VgMFy; eP1SH: tGkP_: goto P0Faz; KXP8k: $aesKey = base64_decode($sessionKey); goto VrSyG; P0Faz: return $dataObj; goto h0M2m; jS3ju: ZLFzD: goto QVfHq; n9bhQ: if (!(strlen($sessionKey) != 24)) { goto scOls; } goto PENBG; h0M2m: } }
