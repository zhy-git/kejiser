<?php
 namespace app\api\service; use think\Cache; use think\Db; require_once BASE_ROOT . "\143\157\162\x65\57\x65\170\x74\145\x6e\x64\x2f\105\170\160\x72\x65\163\163\57\x4b\144\156\x69\x61\157\x2e\101\x70\151\56\x70\150\x70"; class ArlikiService { private $ali_id = ''; private $ali_token = ''; private $ali_name = ''; private $ali_code = ''; private $phone = ''; private $status = "\62"; private $bus_id2 = ''; function __construct($mch_id) { goto EaC4u; c6yh3: $re = Db::name("\171\x62\163\x63\x5f\x73\x6d\163\x63\x6f\156\x66")->where("\x6d\x63\x68\x5f\151\144", $mch_id)->find(); goto eEfeB; VhGvh: $this->ali_code = $re["\141\x6c\151\x5f\143\157\144\x65"]; goto tVVjp; eEfeB: $this->ali_id = $re["\141\x6c\151\137\151\144"]; goto SDnZk; EaC4u: $this->bus_id2 = $mch_id; goto c6yh3; tVVjp: $this->phone = $re["\x70\x68\157\156\145"]; goto r5fnK; r5fnK: $this->status = $re["\163\164\141\x74\x75\x73"]; goto hK5Yj; SDnZk: $this->ali_token = $re["\141\154\x69\x5f\x74\157\153\145\156"]; goto KT3op; KT3op: $this->ali_name = $re["\141\x6c\x69\x5f\x6e\x61\155\x65"]; goto VhGvh; hK5Yj: } public function exp_load($no, $from = '') { goto OMKt2; JntjB: goto hWlUA; goto emymZ; eWH2i: Cache::set("\x74\x72\141\143\x65\163\x5f\151\x6e\x66\157" . $no, $res, 300); goto l5tvV; m5fqG: $kdniao = new \KdniaoApi($this->bus_id2); goto dnlNU; UIkJA: return $res; goto Q7It0; l5tvV: syUnX: goto JntjB; S3mrh: $res = Cache::get("\164\162\141\x63\145\163\137\x69\x6e\x66\157" . $no); goto XFaHo; dnlNU: $res = $kdniao->getOrderTracesByJson($no); goto KvI3p; XFaHo: hWlUA: goto UIkJA; emymZ: spxNv: goto S3mrh; OMKt2: if (Cache::get("\164\162\141\x63\x65\x73\137\x69\x6e\146\x6f" . $no)) { goto spxNv; } goto m5fqG; KvI3p: if (!($res["\143\x6f\x64\x65"] == 0)) { goto syUnX; } goto eWH2i; Q7It0: } public function exp_from($no) { goto e0gUU; e0gUU: $url = "\x68\x74\164\x70\72\x2f\57\155\x2e\x6b\165\141\x69\144\x69\x31\x30\x30\x2e\x63\x6f\x6d\57\x61\165\x74\157\x6e\165\155\142\145\x72\57\x61\x75\164\x6f\77\156\165\155\x3d" . $no; goto sTu33; fT_k0: EeSgG: goto UUgbc; HILJi: $re[$i] = $res[$i]["\143\x6f\x6d\103\157\144\x65"]; goto fT_k0; sTu33: $res = json_decode(get_url_content($url), true); goto xWpLk; IlDDU: $i = 0; goto jgDvA; jgDvA: ZI2qV: goto IZSpT; jrdUK: return $re; goto H1gTt; K023g: goto ZI2qV; goto NuSji; UUgbc: $i++; goto K023g; NuSji: XGuhN: goto jrdUK; IZSpT: if (!($i < count($res))) { goto XGuhN; } goto HILJi; xWpLk: $re = array(); goto IlDDU; H1gTt: } private function exp_query($no, $from) { goto MZNjJ; U2vsb: $msg["\x73\x74\x61\x74\x65"] = $state[$res["\x73\164\141\164\145"]]; goto BVo73; MZNjJ: $state = array(0 => "\345\x9c\250\351\x80\x94\344\xb8\255", 1 => "\xe5\xb7\xb2\xe6\x8f\xbd\346\224\266", 2 => "\xe7\x96\x91\351\x9a\276", 3 => "\345\267\262\xe7\255\xbe\346\x94\266", 4 => "\xe9\200\200\xe7\255\276", 5 => "\345\220\214\xe5\x9f\216\346\264\276\351\200\201\344\xb8\xad", 6 => "\xe9\x80\x80\xe5\233\x9e", 7 => "\xe8\275\xac\345\x8d\225"); goto hUiM7; BVo73: if ($res["\155\145\163\163\x61\x67\145"] == "\157\x6b") { goto r2xCM; } goto M0P4i; hUiM7: $url = "\x68\x74\x74\160\x3a\57\x2f\155\x2e\153\165\x61\151\144\151\61\60\x30\x2e\143\x6f\155\57\161\165\145\x72\171\77\164\171\160\x65\x3d" . $from . "\x26\160\x6f\x73\x74\x69\x64\75" . $no . "\x26\x69\x64\75\x31\46\x76\x61\154\x69\143\x6f\144\145\75\x26\164\x65\x6d\160\75\x30\x2e\x37\x32\x32\71\71\x30\x36\63\x31\x39\x37\65" . rand(100, 999); goto TpdzQ; nr3nG: Yckg7: goto lv7B9; wgRPC: goto Yckg7; goto Bwrz_; TpdzQ: $res = json_decode(get_url_content($url), true); goto NoBCe; w7MGh: $msg["\143\x6f\144\x65"] = 1; goto nr3nG; M0P4i: $msg["\144\x61\164\x61"] = "\xe8\x8e\267\345\x8f\x96\xe5\xa4\xb1\350\xb4\xa5\x2c\xe8\xaf\267\347\xa8\215\345\x90\x8e\xe5\x86\215\350\257\x95\56"; goto DedaA; DedaA: $msg["\x63\157\x64\145"] = 0; goto wgRPC; NoBCe: $msg["\x73\164\141\x74\145"] = $res["\x73\x74\x61\164\x65"]; goto U2vsb; Bwrz_: r2xCM: goto MUj4T; lv7B9: return $msg; goto PcZkX; MUj4T: $msg["\144\141\164\x61"] = $res["\144\141\x74\141"]; goto w7MGh; PcZkX: } public function send_sms($data, $type = 1, $phone = '', $return = false) { goto ISw3z; SLHnX: rE96y: goto KByaJ; XvtOj: qBI6i: goto aSZUt; V68dy: $this->ali_token = $re["\141\x6c\151\x5f\164\x6f\x6b\x65\x6e"]; goto o1pnH; FuI43: if (!(!empty($params["\124\x65\155\160\x6c\x61\164\x65\x50\x61\x72\x61\155"]) && is_array($params["\x54\145\155\x70\x6c\x61\x74\x65\120\141\162\141\x6d"]))) { goto Mi2O7; } goto JvHYL; XKS3M: $this->ali_id = $re["\141\154\x69\137\151\144"]; goto V68dy; NGc92: $phone = array($phone); goto Fn8sF; uhSsC: $params["\120\150\157\x6e\x65\116\x75\x6d\x62\x65\x72\163"] = $phone[$i]; goto EY6gW; wQEWE: if (empty($phone)) { goto GAl3n; } goto NGc92; WfyEV: if (!(empty($this->ali_id) || empty($this->ali_token))) { goto oLWHO; } goto sgCtm; g6dbA: goto qBI6i; goto SLHnX; o1pnH: $this->ali_name = $re["\141\x6c\151\137\x6e\x61\155\x65"]; goto WDmT3; SbKpI: OvpYt: goto WfyEV; aae7g: $d["\115\x65\x73\x73\x61\x67\145"] = "\346\234\xaa\xe5\xbc\200\xe5\220\257\xe7\237\xad\xe4\xbf\xa1\xe9\x80\232\xe7\237\245"; goto QT3Ws; H7cOu: $pa = $data; goto g6dbA; kbB4u: A1ev6: goto RWxj0; oMntK: $this->status = $re["\163\x74\x61\x74\165\163"]; goto SbKpI; YGX2I: $re = Db::name("\x79\x62\163\x63\137\163\155\163\x63\157\x6e\x66")->where("\155\x63\150\137\151\x64", $this->bus_id2)->where("\x74\171\160\x65", 2)->find(); goto XKS3M; OBuBy: Mi2O7: goto fj4VA; RWxj0: Plqng: goto G3zEh; V7l7D: sb0p_: goto j94Ip; G3zEh: $i++; goto sxrtz; WDmT3: $this->ali_code = $re["\x61\154\151\137\x63\157\144\145"]; goto AdIDf; IHC2Q: $params["\124\145\x6d\160\154\141\164\x65\103\157\144\x65"] = $this->ali_code; goto RIk9U; EY6gW: $params["\123\151\x67\156\116\141\155\x65"] = $this->ali_name; goto IHC2Q; LErPe: u1DW0: goto wQEWE; sgCtm: $d["\x43\x6f\x64\x65"] = "\60"; goto M3Etc; RIk9U: $params["\x54\x65\x6d\160\x6c\x61\164\145\x50\141\162\141\x6d"] = $pa; goto FuI43; AdIDf: $this->phone = $re["\160\150\x6f\x6e\145"]; goto oMntK; Fn8sF: goto CtDei; goto HBl7q; yEriN: B9oQK: goto ZxaoY; M3Etc: $d["\x4d\145\x73\163\x61\x67\145"] = "\xe5\x8f\x82\346\x95\xb0\344\270\x8d\345\256\x8c\xe6\225\xb4"; goto SoC5Y; BM9Ge: if (!is_array($data)) { goto rE96y; } goto H7cOu; QT3Ws: return $d; goto LErPe; fj4VA: $res[$i] = $this->aliyun_send($params); goto RUClp; SoC5Y: return $d; goto TDcDe; RUClp: Db::name("\171\x62\x73\x63\x5f\x73\155\x73\x63\x6f\156\146")->where("\155\x63\150\137\x69\x64", $this->bus_id2)->setInc("\157\x6b\137\165\163\x65"); goto kbB4u; uDJjp: $params = array(); goto uhSsC; aSZUt: $i = 0; goto ZFY5T; HBl7q: GAl3n: goto G1_9g; P6nCI: if (!(strlen($phone[$i]) > 5)) { goto A1ev6; } goto uDJjp; j94Ip: if (!$return) { goto B9oQK; } goto ttUw5; ISw3z: if (!($type == 2)) { goto OvpYt; } goto YGX2I; lo1bo: if (!($this->status == 2)) { goto u1DW0; } goto jvAHj; TDcDe: oLWHO: goto lo1bo; jvAHj: $d["\103\157\x64\145"] = "\60"; goto aae7g; sxrtz: goto Byoqi; goto V7l7D; ttUw5: return $res; goto yEriN; G1_9g: $phone = explode("\x2c", $this->phone); goto HLC6c; OSfuu: if (!($i < count($phone))) { goto sb0p_; } goto P6nCI; KByaJ: $pa["\157\162\x64\145\162"] = $data; goto XvtOj; ZFY5T: Byoqi: goto OSfuu; HLC6c: CtDei: goto BM9Ge; JvHYL: $params["\x54\x65\x6d\160\154\141\164\x65\120\x61\x72\x61\155"] = json_encode($params["\x54\145\155\160\154\x61\x74\145\120\x61\162\x61\155"], JSON_UNESCAPED_UNICODE); goto OBuBy; ZxaoY: } public function send_test($ali_id, $ali_token, $ali_name, $ali_code, $phone) { goto zgIhC; e93U5: $res = $this->aliyun_send($params, $ali_id, $ali_token); goto fvX0f; MFo2l: $params["\124\x65\155\x70\154\141\164\145\x43\x6f\144\145"] = $ali_code; goto ZKVY2; xBpUt: qqjQC: goto e93U5; fvX0f: return $res; goto nr1Kv; rcG_g: $params["\120\x68\x6f\x6e\x65\x4e\x75\x6d\x62\x65\162\x73"] = $phone; goto tyG05; gmJNy: if (!(!empty($params["\x54\145\x6d\160\x6c\x61\164\145\120\x61\162\141\x6d"]) && is_array($params["\124\x65\x6d\160\x6c\x61\x74\x65\x50\x61\162\x61\155"]))) { goto qqjQC; } goto k3V8f; k3V8f: $params["\124\145\x6d\x70\x6c\x61\164\145\x50\141\x72\141\x6d"] = json_encode($params["\x54\x65\x6d\160\x6c\x61\x74\x65\x50\141\x72\x61\155"], JSON_UNESCAPED_UNICODE); goto xBpUt; tyG05: $params["\123\151\x67\156\116\x61\155\x65"] = $ali_name; goto MFo2l; ZKVY2: $params["\124\145\x6d\x70\154\141\164\x65\120\141\x72\x61\155"] = array("\157\162\x64\x65\162" => "\x41\x42\103\x44\105\x46"); goto gmJNy; zgIhC: $params = array(); goto rcG_g; nr1Kv: } private function aliyun_send($params, $ali_id = '', $ali_token = '') { goto yqcuw; KL1so: O8gjo: goto Zy8zB; yqcuw: $accessKeyId = $this->ali_id; goto XSse2; WYu9G: $accessKeyId = $ali_id; goto Xw2nr; bP_e5: $content = $this->request($accessKeyId, $accessKeySecret, "\144\171\163\x6d\x73\141\x70\151\x2e\141\154\x69\x79\x75\156\143\x73\56\143\x6f\155", array_merge($params, array("\122\x65\147\x69\157\x6e\x49\x64" => "\143\x6e\55\150\141\x6e\x67\x7a\150\157\x75", "\x41\x63\164\x69\x6f\x6e" => "\x53\145\x6e\144\123\x6d\x73", "\126\145\x72\163\151\x6f\156" => "\x32\x30\x31\x37\55\60\65\x2d\x32\65")), $security); goto ppVD7; y2u5I: if (!(!empty($ali_id) && !empty($ali_token))) { goto O8gjo; } goto WYu9G; XSse2: $accessKeySecret = $this->ali_token; goto y2u5I; Xw2nr: $accessKeySecret = $ali_token; goto KL1so; ppVD7: return $content; goto mTFAj; Zy8zB: $security = false; goto bP_e5; mTFAj: } public function request($accessKeyId, $accessKeySecret, $domain, $params, $security = false, $method = "\120\117\x53\x54") { goto wXtv6; x3rjV: $stringToSign = "{$method}\46\x25\x32\x46\x26" . $this->encode(substr($sortedQueryStringTmp, 1)); goto MHdQ0; m09rw: foreach ($apiParams as $key => $value) { $sortedQueryStringTmp .= "\46" . $this->encode($key) . "\x3d" . $this->encode($value); XwK8O: } goto WKZRd; ruElm: $signature = $this->encode($sign); goto Ca4Tk; WKZRd: j2dgp: goto x3rjV; MHdQ0: $sign = base64_encode(hash_hmac("\x73\x68\x61\61", $stringToSign, $accessKeySecret . "\46", true)); goto ruElm; Ca4Tk: $url = ($security ? "\150\x74\164\x70\163" : "\150\x74\x74\x70") . "\72\57\x2f{$domain}\x2f"; goto DsxEE; wXtv6: $apiParams = array_merge(array("\123\151\x67\x6e\x61\x74\165\162\145\x4d\145\x74\x68\x6f\x64" => "\110\x4d\101\103\55\123\x48\101\61", "\123\x69\147\156\x61\x74\165\x72\x65\x4e\157\156\x63\145" => uniqid(mt_rand(0, 0xffff), true), "\123\x69\x67\156\141\x74\165\162\x65\x56\145\x72\163\x69\157\x6e" => "\61\56\60", "\x41\x63\x63\x65\163\x73\x4b\145\x79\111\144" => $accessKeyId, "\124\x69\155\145\x73\164\141\x6d\160" => gmdate("\x59\55\155\x2d\x64\x5c\124\110\72\x69\72\163\x5c\x5a"), "\106\157\162\155\141\x74" => "\112\123\117\116"), $params); goto kjhuG; kjhuG: ksort($apiParams); goto CXBE8; CXBE8: $sortedQueryStringTmp = ''; goto m09rw; DsxEE: try { $content = $this->fetchContent($url, $method, "\123\x69\147\x6e\x61\164\x75\x72\x65\75{$signature}{$sortedQueryStringTmp}"); return json_decode($content); } catch (\Exception $e) { return false; } goto zAH93; zAH93: } private function encode($str) { goto KYdkB; Fqp5q: $res = preg_replace("\x2f\134\52\57", "\x25\x32\101", $res); goto U2ORI; U2ORI: $res = preg_replace("\57\x25\67\105\x2f", "\x7e", $res); goto fsYxn; fsYxn: return $res; goto DZpw6; ahRAm: $res = preg_replace("\x2f\134\53\x2f", "\45\62\x30", $res); goto Fqp5q; KYdkB: $res = urlencode($str); goto ahRAm; DZpw6: } private function fetchContent($url, $method, $body) { goto Pu9Mc; Pu9Mc: $ch = curl_init(); goto pisHY; VoRgc: hNJF6: goto nBboS; AHITi: curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, false); goto axSia; mO1Mv: return $rtn; goto WyyIY; Jaxsj: Ko7zK: goto shsfl; axSia: D3kXv: goto oLqXY; qGPPu: if (!($rtn === false)) { goto hNJF6; } goto KdNU0; Y5LC6: $url .= "\x3f" . $body; goto NXMYB; uL_lP: curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1); goto ORl_W; ERrYs: curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false); goto AHITi; KdNU0: trigger_error("\133\x43\125\x52\x4c\x5f" . curl_errno($ch) . "\x5d\x3a\x20" . curl_error($ch), E_USER_ERROR); goto VoRgc; ORl_W: curl_setopt($ch, CURLOPT_HTTPHEADER, array("\x78\x2d\163\x64\153\55\x63\154\x69\145\x6e\164" => "\x70\x68\160\57\62\56\60\x2e\60")); goto RwjCr; jA7sd: curl_setopt($ch, CURLOPT_URL, $url); goto bDWEa; nBboS: curl_close($ch); goto mO1Mv; pisHY: if ($method == "\120\117\x53\x54") { goto Ko7zK; } goto Y5LC6; bDWEa: curl_setopt($ch, CURLOPT_TIMEOUT, 5); goto uL_lP; nkiO1: curl_setopt($ch, CURLOPT_POSTFIELDS, $body); goto mgUno; oLqXY: $rtn = curl_exec($ch); goto qGPPu; mgUno: Oo0R0: goto jA7sd; shsfl: curl_setopt($ch, CURLOPT_POST, 1); goto nkiO1; RwjCr: if (!(substr($url, 0, 5) == "\150\x74\164\x70\163")) { goto D3kXv; } goto ERrYs; NXMYB: goto Oo0R0; goto Jaxsj; WyyIY: } }
