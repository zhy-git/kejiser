<?php
 namespace app\api\service; require_once BASE_ROOT . "\x63\x6f\x72\145\57\x61\160\x70\154\151\x63\x61\x74\151\157\156\x2f\141\144\155\x69\x6e\x2f\163\145\x72\x76\151\143\x65\x2f\120\162\151\156\164\x65\162\123\145\162\166\x69\x63\145\56\x70\x68\160"; use app\admin\service\PrinterService; use think\Db; use think\Exception; use think\log; require_once BASE_ROOT . "\x63\157\x72\145\57\x65\170\164\x65\156\x64\57\127\170\160\x61\x79\57\x57\x78\x50\141\171\x2e\101\160\x69\x2e\x70\x68\160"; class PayService { private $o = "\x79\142\x73\x63\137\157\x72\144\x65\162"; private $og = "\x79\x62\x73\x63\137\157\162\144\x65\162\x5f\147\157\x6f\144\x73"; private $uc = "\x79\x62\x73\x63\137\165\163\145\x72\x5f\143\157\165\x70\157\156"; private $s = "\171\142\163\143\137\147\x6f\x6f\x64\163\137\163\x6b\x75"; private $g = "\x79\x62\x73\x63\x5f\x67\x6f\x6f\144\x73"; private $op = "\x79\x62\x73\x63\x5f\157\162\144\x65\x72\x5f\x70\141\x79\155\145\156\164"; private $i = "\x79\142\163\x63\x5f\x69\155\141\x67\145\163"; private $dq = "\x79\142\163\143\137\141\x72\145\x61"; private $cf = "\171\x62\x73\143\137\x63\157\156\146\x69\x67"; public function to_cardpay($out_trade_no, $mch_id, $form_id) { goto f8U4W; QM_T3: $rs["\x63\157\x64\145"] = 1; goto xV0r3; NKHWq: if (!(floatval($a["\160\x61\171\x5f\155\157\156\x65\171"]) > floatval($card["\155\x6f\156\145\171"]))) { goto nJEIk; } goto kxS8p; Mpe6m: try { goto IjhN0; G9h6j: if (!($b["\143\157\156\163\137\x73\x74\x61\x74\x75\x73"] == 1)) { goto oOvvW; } goto UK5LA; gaORv: $data_jf["\x69\156\x74\x65\147\162\141\154"] = $jifen; goto Kl77y; UK5LA: $order_money = $a1["\157\162\x64\x65\162\137\155\157\x6e\x65\x79"]; goto liMcx; qSpp8: sTKBr: goto rjEh8; P6nHo: $new_data1["\x6c\x65\x76\x65\x6c\x5f\x69\144"] = $d[$i]["\x69\144"]; goto kzCz9; sb_dG: return json_encode($rs); goto rga73; ilRnl: $i = 0; goto T1DKJ; htaKS: goto Env2l; goto W9rzY; kzCz9: $new_data1["\143\x6f\x6e\x73\165\x6d\x65"] = $jf_all; goto Xg9w3; bwNjG: IJx3k: goto IO55b; kk77H: $data_jf["\155\x63\150\x5f\151\144"] = $a1["\x6d\x63\x68\x5f\151\144"]; goto jezAP; rd27V: $b = json_decode($b, true); goto G9h6j; gQxMt: if (!($jf_all >= $d[$i]["\x68\151\145\x72\141\x72\x63\x68\x79"])) { goto F83t4; } goto P6nHo; U4cQV: throw new Exception("\xe6\224\xaf\344\xbb\x98\345\244\xb1\350\xb4\245"); goto qSpp8; nkBzI: $test = Db::name("\x79\142\163\x63\x5f\151\156\x74\x65\147\x72\x61\x6c\137\144\145\164\141\x69\154")->insert($data_jf); goto htaKS; pn4IU: $test1 = Db::name("\171\x62\163\143\x5f\x75\x73\x65\x72")->where(["\x75\151\144" => $a1["\142\x75\171\x65\162\x5f\x69\x64"]])->update($new_data1); goto KWxyx; Vm0nS: $res = Db::name("\x79\142\x73\x63\137\x6f\x72\x64\x65\162")->where(["\x6f\165\164\x5f\164\x72\x61\144\145\x5f\x6e\157" => $out_trade_no, "\157\162\x64\x65\162\x5f\163\x74\141\164\165\163" => 0])->update($data); goto a3HLT; qwjW3: if (!$a1) { goto PZaP7; } goto HXBsC; bxOw0: $d = Db::name("\171\142\163\143\x5f\x75\x73\145\x72\x5f\x6c\x65\166\145\x6c")->where("\155\143\150\137\151\144", $a1["\x6d\143\150\137\x69\x64"])->order("\150\151\145\x72\x61\x72\143\150\x79", "\144\145\x73\x63")->select(); goto OWq1N; bqahX: $jifen = 0; goto E5qT2; OWq1N: if (!$d) { goto QkpTq; } goto ilRnl; CXWWI: Db::commit(); goto nX7BQ; OfCK8: Env2l: goto vjEuH; N2WXy: $data_jf = array("\164\151\x6d\145" => time(), "\x69\x74\x79\160\x65" => 1, "\143\x74\x79\x70\x65" => 1, "\x65\170\x70\154\x61\151\x6e" => "\346\xb6\x88\xe8\xb4\271"); goto qwjW3; rjEh8: Db::name("\171\142\x73\143\137\x6f\x72\144\145\162\137\x70\x61\x79\155\145\156\x74")->where(["\157\x75\x74\x5f\x74\x72\x61\144\145\137\156\x6f" => $out_trade_no, "\x70\x61\171\x5f\163\x74\x61\x74\165\x73" => 0])->update($data_pay); goto CXWWI; EY28g: if (!($i < count($d))) { goto Env2l; } goto gQxMt; x8dEK: dFsPW: goto oiyQV; jezAP: $data_jf["\x6f\x72\x64\x65\162\137\x69\x64"] = $a1["\x6f\x72\144\x65\x72\137\151\144"]; goto nkBzI; Xg9w3: $new_data1["\x69\x6e\x74\145\x67\x72\x61\154"] = round($jifen) + intval($c["\151\156\x74\145\x67\x72\141\x6c"]); goto pn4IU; BbvdO: goto EKt71; goto OfCK8; oiyQV: PZaP7: goto VCLJq; HXBsC: $b = Db::name("\x79\x62\x73\x63\x5f\x69\156\164\145\x67\162\x61\x6c\137\x72\x75\154\145")->where("\x6d\143\150\x5f\151\x64", $a1["\155\143\150\x5f\151\x64"])->value("\x64\x61\164\x61"); goto bqahX; udh7F: oOvvW: goto x8dEK; Ltkm2: $c = Db::name("\x79\x62\x73\143\x5f\x75\163\x65\x72")->where("\x75\x69\x64", $a1["\x62\165\171\x65\x72\137\x69\x64"])->find(); goto hPMZV; Kl77y: $data_jf["\143\157\156\163\165\155\145"] = $jifen; goto kk77H; T1DKJ: EKt71: goto EY28g; a3HLT: if (!empty($res)) { goto sTKBr; } goto U4cQV; vjEuH: QkpTq: goto udh7F; hPMZV: $jf_all = round($jifen) + intval($c["\x63\157\156\x73\165\155\x65"]); goto bxOw0; W9rzY: F83t4: goto bwNjG; liMcx: $jifen = floor(floatval($order_money) / floatval($b["\x63\x6f\x6e\163\137\x6d\x6f\156\x65\171"])) * floatval($b["\x63\x6f\x6e\163\x5f\x69\x6e\x74\x65\147\162\141\x6c"]); goto Ltkm2; bhutA: $a1 = Db::name("\171\x62\163\x63\137\x6f\x72\x64\x65\162")->where(["\157\x75\x74\x5f\x74\162\141\x64\x65\137\156\x6f" => $out_trade_no, "\157\162\144\145\x72\x5f\x73\164\x61\x74\x75\163" => 1])->find(); goto N2WXy; nX7BQ: Log::write($out_trade_no . "\54\346\224\257\344\xbb\x98\xe7\x8a\xb6\xe6\x80\x81\346\233\xb4\346\x94\271\346\x88\220\xe5\212\x9f", "\143\141\162\144\137\x70\x61\x79\137\x73\x74\141\164\x65\x5f\x63\x68\141\x6e\147\x65\137\x73\165\x63\x63\145\x73\163"); goto bhutA; IjhN0: Db::name("\x79\x62\x73\x63\137\165\x73\145\162\137\x63\x61\162\x64")->where(["\151\x73\137\144\145\154" => 1, "\165\x73\x65\x72\x5f\151\x64" => $a["\142\x75\171\x65\162\137\151\144"]])->setDec("\155\157\156\x65\171", floatval($a["\160\x61\171\x5f\155\157\x6e\x65\x79"])); goto Vm0nS; KWxyx: $data_jf["\165\x73\145\162\137\151\144"] = $a1["\142\165\171\x65\162\137\151\144"]; goto gaORv; E5qT2: if (!$b) { goto dFsPW; } goto rd27V; VCLJq: $rs["\151\156\146\x6f"] = $res; goto sb_dG; IO55b: $i++; goto BbvdO; rga73: } catch (\Exception $e) { goto EDscS; yZFh8: $rs["\143\157\x64\145"] = 1; goto GOLAL; GOLAL: $rs["\x6d\163\x67"] = "\346\x94\xaf\344\273\x98\xe5\244\xb1\350\264\xa5"; goto kkeWD; d54xS: return json_encode($rs); goto pXXhW; kkeWD: Log::write($out_trade_no . "\x2c\xe6\224\257\xe4\xbb\x98\xe7\212\266\xe6\200\x81\346\233\xb4\346\x94\xb9\xe5\xa4\261\350\264\245" . $e, "\143\x61\x72\144\x5f\x70\x61\171\x5f\163\164\141\164\145\137\143\x68\141\x6e\147\x65\137\x66\141\151\x6c"); goto d54xS; EDscS: Db::rollback(); goto yZFh8; pXXhW: } goto pO_X5; H_h5d: return json_encode($rs); goto ydeik; bD03e: return json_encode($rs); goto qHhlp; Guk7L: if (!(empty($setting) || $setting["\151\x73\137\x6f\160\145\156"] == 0)) { goto DNncM; } goto OrL73; ovEVB: return json_encode($rs); goto nl8LA; wuoLW: IPPQO: goto evIJV; gad5p: $pp = new PrinterService($a["\x6d\143\150\137\151\x64"], $a["\157\x72\144\145\162\137\151\x64"], "\x70\x61\171", 0); goto cdJwq; HIsPU: DNncM: goto EAzBj; f1Co2: $rs["\x6d\x73\147"] = "\xe4\274\x9a\xe5\221\230\345\215\241\xe5\212\237\xe8\x83\xbd\346\232\x82\346\x9c\252\345\xbc\200\xe5\x90\xaf"; goto Ho_hp; kWbRX: uPvHP: goto gad5p; nl8LA: nJEIk: goto mAzaS; tYsb7: $rs["\143\x6f\x64\145"] = 1; goto YqsnZ; ydeik: goto IPPQO; goto kWbRX; kxS8p: $rs["\x63\x6f\144\145"] = 1; goto sSm19; I8rzt: $new_data["\160\141\171\x5f\x74\171\160\145"] = 2; goto n0aVK; qHhlp: hLWc5: goto NKHWq; z9Z1Z: $a = Db::name("\x79\x62\x73\x63\x5f\x6f\162\144\145\162")->where(["\157\x75\164\x5f\x74\x72\141\144\x65\137\x6e\157" => $out_trade_no, "\x6f\162\144\145\x72\137\x73\164\x61\164\165\163" => 0])->find(); goto N5XBg; luGXf: if (!empty($card)) { goto hLWc5; } goto QM_T3; evIJV: $res = null; goto BizQG; OrL73: $rs["\x63\x6f\144\x65"] = 1; goto f1Co2; mAzaS: Db::startTrans(); goto Mpe6m; cdJwq: $pp->print_order(); goto wuoLW; appAl: $data_pay = array("\160\x61\171\x5f\x74\171\x70\x65" => 2, "\x70\141\171\137\x73\x74\x61\164\x75\x73" => 1, "\x70\x61\x79\137\x74\x69\155\145" => time()); goto z9Z1Z; N5XBg: if ($a) { goto uPvHP; } goto tYsb7; YqsnZ: $rs["\155\x73\147"] = "\xe8\xae\242\xe5\x8d\x95\xe4\xb8\215\xe5\xad\230\345\x9c\xa8\346\x88\226\xe8\200\205\xe7\212\xb6\346\x80\x81\xe5\267\262\346\233\264\xe6\x94\xb9"; goto H_h5d; xV0r3: $rs["\x6d\x73\147"] = "\344\xbc\232\345\x91\230\xe5\x8d\241\xe6\234\xaa\xe6\277\200\xe6\264\xbb"; goto bD03e; EAzBj: $card = Db::name("\x79\x62\x73\x63\137\x75\163\145\162\x5f\x63\x61\x72\x64")->where(["\x69\x73\137\144\x65\x6c" => 1, "\x75\163\x65\x72\137\x69\x64" => $a["\142\x75\171\145\162\137\151\x64"]])->find(); goto luGXf; Ho_hp: return json_encode($rs); goto HIsPU; n0aVK: $data = array("\157\x72\x64\x65\162\x5f\x73\164\x61\164\165\163" => 1, "\160\x61\x79\x5f\x73\164\141\164\165\163" => 1, "\160\141\x79\137\x74\171\160\x65" => 2, "\160\141\x79\137\x74\x69\x6d\x65" => time(), "\160\x72\x65\160\x61\x79\x5f\x69\144" => $form_id); goto appAl; BizQG: $setting = Db::name("\171\142\x73\143\x5f\x75\163\145\162\x5f\x63\141\162\x64\137\163\x65\164\x74\x69\156\x67")->where(["\155\143\x68\137\x69\x64" => $mch_id])->find(); goto Guk7L; f8U4W: $rs = array("\x63\x6f\144\145" => 0, "\x69\156\x66\x6f" => array()); goto I8rzt; sSm19: $rs["\x6d\163\147"] = "\344\xbc\232\345\221\230\345\215\241\xe4\275\x99\351\242\x9d\344\270\215\350\266\xb3"; goto ovEVB; pO_X5: } public function orderInfo($data, $mch_id) { goto PYxJb; PYxJb: $info = Db::name($this->o)->where($data)->find(); goto yDooy; McDWC: $rs["\143\151\164\x79"] = $city["\156\x61\155\x65"]; goto y8zUA; UqX17: $info["\141\144\144\x72\x65\163\163"] = $rs; goto AiQR2; yDooy: $res = Db::name($this->dq)->where("\x69\x64", $info["\x72\145\x63\x65\151\166\x65\x72\x5f\x61\x72\145\141"])->find(); goto b0F3s; y8zUA: $rs["\144\x69\x73\164\x72\151\x63\164"] = $res["\x6e\141\x6d\145"]; goto UqX17; iAqfl: $pro = Db::name($this->dq)->where("\x69\144", $city["\160\151\x64"])->find(); goto S1qwN; b0F3s: $city = Db::name($this->dq)->where("\151\144", $res["\160\151\144"])->find(); goto iAqfl; hM3Q1: return $info; goto vGfgo; S1qwN: $rs["\160\162\x6f\166\x69\156\x63\145"] = $pro["\156\x61\155\x65"]; goto McDWC; AiQR2: $info["\143\141\162\x64\137\x73\x65\164"] = Db::name("\171\142\163\143\x5f\165\163\x65\162\137\x63\x61\162\x64\x5f\x73\x65\x74\164\x69\156\x67")->where(["\155\143\x68\137\151\144" => $mch_id])->find(); goto hM3Q1; vGfgo: } public function orderPay($data) { goto AyEa7; GbCFo: $info = Db::name($this->op)->where("\x6f\165\x74\137\164\162\x61\144\145\x5f\x6e\157", $data["\157\x75\164\x5f\164\162\141\x64\145\137\x6e\157"])->find(); goto nyd_P; a4Ha9: $input->SetTrade_type("\x4a\123\x41\x50\x49"); goto R_CbI; sTbcb: $input->SetBody($info["\x70\x61\171\x5f\x62\157\144\x79"]); goto JXyl9; xIIcd: $rs["\x6d\163\147"] = "\350\256\242\345\215\x95\344\270\xbb\351\xa2\x98\345\xb7\262\346\224\xb9\345\x8f\x98"; goto Xll60; onFiT: if (!($unifiedorder["\x72\145\163\x75\x6c\x74\x5f\x63\x6f\144\145"] == "\x46\101\x49\114")) { goto coSBY; } goto eplMv; cLAdA: $rs["\x6d\163\147"] = $unifiedorder["\x65\x72\x72\137\x63\157\144\x65\137\x64\145\163"]; goto ep62X; JnYH6: nMhht: goto NpcDr; NlNEU: $input = new \WxPayUnifiedOrder(); goto sTbcb; UxVf5: $rs["\143\157\x64\145"] = 1; goto yj2ZE; JXyl9: $input->SetOpenid($data["\x6f\160\145\x6e\151\144"]); goto XzYNL; wmmsk: $rs["\151\x6e\146\157"] = $res; goto pHXu2; eplMv: $rs["\143\x6f\144\x65"] = 1; goto cLAdA; NpcDr: $GLOBALS["\x6d\x63\x68\137\x69\144"] = $data["\x6d\143\x68\x5f\x69\x64"]; goto NlNEU; niQYF: $res = $this->weixinapp($unifiedorder); goto wmmsk; lhFV4: if (!($info->pay_status != 0)) { goto nMhht; } goto k5PMv; GXppC: return $rs; goto dtFVi; Xll60: return $rs; goto JnYH6; OpzFB: coSBY: goto fgdvU; KBzQS: $rs["\143\157\144\x65"] = 1; goto U5IEX; nyd_P: if (!empty($info)) { goto LnBSy; } goto UxVf5; dtFVi: LnBSy: goto lhFV4; mwCme: nNctr: goto onFiT; W5Vzu: return $rs; goto mwCme; yj2ZE: $rs["\155\x73\x67"] = "\xe8\256\242\345\215\225\344\xb8\x8d\345\xad\x98\xe5\234\250"; goto GXppC; pHXu2: return $rs; goto BbMiZ; bgBHL: $input->SetTotal_fee($info["\160\141\171\137\x6d\157\x6e\x65\x79"] * 100); goto CruvD; U5IEX: $rs["\x6d\x73\x67"] = $unifiedorder["\162\145\164\165\162\156\137\155\163\147"]; goto W5Vzu; R_CbI: $unifiedorder = \WxPayApi::unifiedOrder($input); goto MM5L2; AyEa7: $rs = array("\x63\x6f\144\145" => 0, "\x69\x6e\146\x6f" => array()); goto GbCFo; k5PMv: $rs["\x63\x6f\x64\145"] = 1; goto xIIcd; MM5L2: if (!($unifiedorder["\x72\x65\x74\165\162\x6e\x5f\143\x6f\x64\x65"] == "\106\101\x49\x4c")) { goto nNctr; } goto KBzQS; ep62X: return $rs; goto OpzFB; fgdvU: Db::name($this->o)->where("\x6f\x75\x74\137\164\x72\141\144\145\137\156\157", $data["\x6f\165\164\x5f\164\x72\x61\144\145\137\156\x6f"])->update(["\160\x72\145\x70\141\x79\x5f\151\144" => $unifiedorder["\x70\x72\145\160\141\x79\x5f\151\144"]]); goto niQYF; XzYNL: $input->SetDetail($info["\160\141\171\x5f\x64\145\x74\141\151\154"]); goto bgBHL; CruvD: $input->SetOut_trade_no($data["\x6f\165\x74\137\164\x72\x61\144\x65\x5f\x6e\x6f"]); goto a4Ha9; BbMiZ: } public function orderPaywap($data) { goto jMgAO; HIPio: $rs["\x6d\x73\x67"] = "\350\xae\xa2\345\x8d\225\xe4\xb8\xbb\xe9\xa2\230\xe5\xb7\262\xe6\224\271\345\217\230"; goto SFsb2; BWVcJ: $input->SetOut_trade_no($info["\157\x75\x74\137\164\162\x61\x64\145\137\x6e\157"]); goto Yc4pG; iu9Xv: DrvVg: goto jtE40; r3xeY: $rs["\143\x6f\x64\145"] = 1; goto vXQLo; tTxiI: if (!($info->pay_status != 0)) { goto YIUJ8; } goto vD0ZX; fo8_Q: return $rs; goto Vw1KS; AQlKW: return $rs; goto iu9Xv; CHKIz: $GLOBALS["\x6d\143\x68\x5f\x69\144"] = $data["\155\x63\150\x5f\x69\144"]; goto ANOyL; clb5O: $input = new \WxPayUnifiedOrder(); goto mNF05; HaBsG: Duf14: goto S6qXB; GVH8_: return $rs; goto HaBsG; zlvXz: YIUJ8: goto CHKIz; jMgAO: $rs = array("\143\x6f\144\x65" => 0, "\151\156\146\157" => array()); goto xL7FK; xL7FK: $info = Db::name($this->op)->where("\157\x75\x74\137\164\x72\x61\144\145\x5f\156\157", $data["\x6f\165\164\137\164\x72\x61\x64\x65\x5f\x6e\x6f"])->find(); goto hWxlk; Yc4pG: $input->SetTotal_fee($info["\160\141\171\x5f\155\157\x6e\x65\171"] * 100); goto T2gZJ; G3K7T: $rs["\155\163\x67"] = $unifiedorder["\x72\x65\x74\165\x72\156\x5f\x6d\163\x67"]; goto AQlKW; vXQLo: $rs["\x6d\x73\x67"] = "\xe8\256\xa2\345\215\225\xe4\270\x8d\xe5\255\x98\345\234\250"; goto fo8_Q; LppZN: $unifiedorder = \WxPayApi::unifiedOrder($input); goto zJpRa; mNF05: $input->SetBody($info["\x70\141\x79\137\144\145\x74\x61\x69\x6c"]); goto BWVcJ; ANOyL: $spbill_create_ip = get_client_ip($type = 0, $adv = true); goto clb5O; SFsb2: return $rs; goto zlvXz; T2gZJ: $input->SetSpbill_create_ip($spbill_create_ip); goto aFcfe; Lv07A: return $unifiedorder; goto nOa5B; jtE40: if (!($unifiedorder["\162\x65\x73\165\154\164\137\143\157\x64\145"] == "\x46\x41\x49\x4c")) { goto Duf14; } goto MvJk4; hWxlk: if (!empty($info)) { goto FkLyu; } goto r3xeY; Vw1KS: FkLyu: goto tTxiI; hI3Vl: $rs["\155\163\147"] = $unifiedorder["\x65\162\x72\137\x63\157\x64\145\x5f\144\145\163"]; goto GVH8_; vD0ZX: $rs["\143\157\x64\x65"] = 1; goto HIPio; S6qXB: Db::name($this->o)->where("\x6f\165\164\x5f\164\x72\x61\144\x65\x5f\x6e\x6f", $data["\157\165\164\137\164\x72\141\x64\x65\x5f\156\157"])->update(["\x70\162\x65\160\141\x79\x5f\151\144" => $unifiedorder["\x70\162\145\160\x61\x79\x5f\x69\x64"]]); goto Lv07A; DRaNR: $input->SetScene_info("\173\x22\150\x35\137\151\x6e\x66\x6f\42\72\x20\173\x22\164\x79\x70\x65\42\72\x22\127\141\x70\x22\x2c\42\x77\141\x70\x5f\x75\x72\154\x22\x3a\x20\42\150\x74\x74\x70\163\x3a\x5c\57\x5c\x2f\167\x71\56\163\163\x73\166\151\160\56\156\145\164\x22\54\x22\x77\x61\160\x5f\156\x61\155\x65\42\x3a\40\x22\xe5\243\271\xe4\275\xb0\345\225\x86\345\237\216\x22\175\x7d"); goto LppZN; zJpRa: if (!($unifiedorder["\162\145\x74\x75\x72\156\137\x63\x6f\144\145"] == "\106\101\x49\114")) { goto DrvVg; } goto FMli5; MvJk4: $rs["\x63\157\144\x65"] = 1; goto hI3Vl; aFcfe: $input->SetTrade_type("\115\x57\x45\102"); goto DRaNR; FMli5: $rs["\x63\x6f\x64\145"] = 1; goto G3K7T; nOa5B: } private function weixinapp($unifiedorder) { goto IBh7r; FxgAx: return $input; goto b2r2M; Y8P7q: $input = new \WxPayJsApiPay(); goto HfSpW; HfSpW: $input->SetAppid($param["\101\120\120\137\x49\x44"]); goto cW83l; eZBkC: $input->SetNonceStr($this->createNoncestr()); goto z3tuQ; cW83l: $input->SetTimeStamp('' . time() . ''); goto eZBkC; G_l6t: $input->SetSignType("\x4d\x44\x35"); goto nmjEi; nmjEi: $input->SetSign(); goto FxgAx; rbWri: $param = json_decode($param, true); goto Y8P7q; IBh7r: $param = Db::name($this->cf)->where("\x6b\145\x79", "\x57\x58\x50\101\131")->where("\x6d\143\x68\x5f\x69\x64", $GLOBALS["\155\x63\x68\x5f\x69\144"])->where("\x69\x73\x5f\x75\x73\145", 1)->value("\x76\141\x6c\165\x65"); goto rbWri; z3tuQ: $input->SetPackage("\160\x72\145\160\x61\x79\x5f\151\x64\75" . $unifiedorder["\160\162\x65\160\x61\x79\137\151\144"]); goto G_l6t; b2r2M: } private function createNoncestr($length = 32) { goto dkTXZ; HlhD5: $i++; goto E59dR; MeCcu: y1e6Y: goto HlhD5; JtAy1: $str .= substr($chars, mt_rand(0, strlen($chars) - 1), 1); goto MeCcu; QXkST: $i = 0; goto sa7kb; dkTXZ: $chars = "\141\142\x63\144\x65\146\147\150\x69\152\x6b\x6c\155\x6e\x6f\160\161\x72\x73\x74\x75\166\x77\x78\171\x7a\60\x31\62\63\x34\x35\x36\67\70\x39"; goto XovvX; E59dR: goto oXy0J; goto ZCqBV; oRl96: return $str; goto V8rCP; sa7kb: oXy0J: goto JxsKB; XovvX: $str = ''; goto QXkST; ZCqBV: qE170: goto oRl96; JxsKB: if (!($i < $length)) { goto qE170; } goto JtAy1; V8rCP: } public function payCallback($out_trade_no, $pay_type) { goto hUeWZ; BNrSG: $data_pay = array("\x70\x61\171\137\163\164\x61\x74\165\x73" => 1, "\x70\x61\171\137\164\x69\x6d\x65" => time()); goto S3dw0; S3dw0: Db::startTrans(); goto aLDQ2; aLDQ2: try { goto vAToi; ZmBxm: Db::name($this->op)->where(["\x6f\x75\164\x5f\x74\162\x61\x64\145\x5f\156\x6f" => $out_trade_no])->update($data_pay); goto oMANt; oMANt: Db::commit(); goto b7o2U; vAToi: Db::name($this->o)->where(["\x6f\x75\x74\137\164\162\141\144\145\137\x6e\157" => $out_trade_no])->update($data); goto ZmBxm; b7o2U: } catch (\Exception $e) { Db::rollback(); return null; } goto mD9dd; mD9dd: return "\x73\x75\143\143\145\163\x73"; goto yuThh; hUeWZ: $data = array("\157\x72\x64\x65\x72\137\x73\x74\141\x74\165\x73" => 1, "\160\x61\171\x5f\x73\164\x61\164\x75\163" => 1, "\160\x61\x79\137\x74\171\160\x65" => $pay_type, "\160\x61\171\137\x74\x69\x6d\145" => time()); goto BNrSG; yuThh: } public function updPayStatus($order_id) { goto Y32lS; jZMOw: $data_jf["\157\x72\144\x65\x72\137\151\x64"] = $a["\157\162\144\145\162\137\x69\x64"]; goto e3UJn; Ojk24: $pp->print_order(); goto Uo_Qw; w0NtH: dzdN9: goto pdbZU; W_gZE: Db::name("\171\142\x73\143\137\x75\163\145\162")->where("\165\151\x64", $a["\x62\x75\171\145\x72\137\151\144"])->update($new_data); goto mnsXO; ihb8K: $d = Db::name("\171\x62\x73\x63\137\x75\163\145\162\137\154\x65\166\x65\154")->where("\x6d\143\x68\x5f\151\144", $a["\x6d\143\150\x5f\x69\x64"])->order("\x68\151\x65\162\141\x72\143\x68\171", "\144\145\x73\143")->select(); goto VSlC9; V9a_I: Xg_OE: goto w0NtH; AWpIT: goto V8iOd; goto V9a_I; By4UT: V8iOd: goto qwGfW; dwE0U: $data_jf = array("\x74\x69\155\145" => time(), "\151\164\171\x70\145" => 1, "\143\x74\171\160\145" => 1, "\145\x78\x70\x6c\x61\151\156" => "\xe6\266\x88\xe8\264\271"); goto grXcF; ERy_M: if (!($jf_all >= $d[$i]["\150\151\145\162\x61\162\x63\150\x79"])) { goto dOQWU; } goto DgFGm; AcxlF: return $rs; goto bJmNF; foffp: $data = array("\x6f\x72\x64\145\x72\x5f\x73\x74\x61\164\165\x73" => 1, "\160\x61\x79\x5f\x73\164\141\x74\165\x73" => 1, "\x70\141\x79\137\164\x79\160\x65" => 1, "\160\x61\x79\137\164\151\155\x65" => time()); goto wNdaC; pdbZU: W3FVh: goto ZlCK6; yjElB: if (!$a) { goto QF5PG; } goto FvFpO; tBnCi: $jf_all = round($jifen) + intval($c["\143\x6f\x6e\x73\165\x6d\x65"]); goto ihb8K; pv44g: if (!($a["\160\x61\x79\x5f\x6d\157\156\x65\171"] != 0)) { goto UvbiC; } goto AcxlF; Y32lS: $rs = array("\x63\157\x64\145" => 1, "\151\x6e\x66\x6f" => array()); goto foffp; VSlC9: if (!$d) { goto dzdN9; } goto olnQj; QGtlF: $new_data["\143\157\x6e\x73\165\155\x65"] = $jf_all; goto U2oXn; wNdaC: $data_pay = array("\160\141\171\x5f\x73\164\141\x74\165\x73" => 1, "\160\141\x79\x5f\164\x69\x6d\145" => time()); goto dwE0U; bJmNF: UvbiC: goto yjElB; u2Et1: $i++; goto AWpIT; Lmy0n: $order_money = $a["\157\x72\x64\x65\x72\x5f\155\x6f\156\x65\x79"]; goto Ooaez; qwGfW: if (!($i < count($d))) { goto Xg_OE; } goto ERy_M; ZlCK6: WjErX: goto kBZn_; U2oXn: $new_data["\151\x6e\164\145\x67\x72\x61\x6c"] = round($jifen) + intval($c["\151\156\x74\x65\147\162\x61\x6c"]); goto W_gZE; FvFpO: $pp = new PrinterService($a["\155\x63\150\137\x69\x64"], $a["\157\x72\144\145\x72\x5f\x69\x64"], "\160\x61\171", 0); goto Ojk24; P1QCu: goto Xg_OE; goto jlDwO; kBZn_: QF5PG: goto HOg2K; D_6_5: try { goto BpmyY; fwbW0: $un_data["\x75\x72\154"] = $_SERVER["\110\124\x54\120\137\x48\x4f\x53\124"]; goto UeSnz; FJTgI: $data["\165\x72\x6c"] = $un_url[0]; goto n0Tgf; GFHGB: Db::name("\171\142\x73\143\137\157\162\x64\x65\x72\x5f\160\141\x79\155\145\156\164")->where(["\x6f\165\164\137\164\x72\x61\x64\x65\x5f\x6e\157" => $res["\x6f\165\164\x5f\x74\162\141\144\x65\137\156\x6f"], "\160\x61\171\x5f\x73\x74\x61\164\x75\163" => 0])->update($data_pay); goto HFMG7; P4HMx: $r = $sms->send_sms($a["\157\162\x64\145\162\x5f\156\157"], 2); goto emu_9; b2HWs: $order = Db::name("\x79\x62\x73\143\x5f\157\162\x64\x65\162")->where(["\157\165\x74\137\164\x72\x61\x64\x65\x5f\156\x6f" => $res["\157\165\164\x5f\164\x72\x61\144\x65\137\156\x6f"]])->find(); goto WYfC8; obrDX: $alias = md5($data["\165\162\x6c"] . $data["\x75\x73\x65\162\x6e\141\x6d\x65"] . $data["\x75\156\x69\x61\143\x69\144"]); goto T4Nnd; sdPUM: $user = Db::name("\x79\142\163\x63\137\x62\165\x73\x69\x6e\x65\x73\x73")->where(["\151\144" => $mid])->find(); goto fwbW0; rAqGl: $rs = array("\143\157\x64\145" => 0, "\151\156\146\x6f" => array()); goto Cftn6; pH5xU: if (!(!empty($res) && $res > 0)) { goto U2bzN; } goto b2HWs; n0Tgf: $data["\165\x73\x65\162\x6e\141\x6d\145"] = $user["\x6e\141\155\145"]; goto Sr8aH; T4Nnd: $sms = new ArlikiService($a["\155\x63\x68\x5f\151\144"]); goto P4HMx; WYfC8: $mid = $order["\155\143\x68\x5f\x69\x64"]; goto sdPUM; BpmyY: $res = Db::name("\x79\142\x73\x63\x5f\157\162\x64\x65\162")->where(["\x6f\x72\144\x65\162\137\151\x64" => $order_id, "\x6f\x72\144\145\x72\x5f\x73\164\x61\x74\165\x73" => 0])->update($data); goto GFHGB; emu_9: U2bzN: goto rAqGl; UeSnz: $un_url = explode("\72", $un_data["\x75\x72\x6c"]); goto FJTgI; HFMG7: Db::commit(); goto pH5xU; Sr8aH: $data["\165\156\151\x61\x63\x69\x64"] = $user["\165\x6e\x69\x61\x63\151\x64"]; goto obrDX; Cftn6: } catch (\Exception $e) { Db::rollback(); } goto A_61u; DgFGm: $new_data["\x6c\x65\x76\x65\x6c\137\151\x64"] = $d[$i]["\x69\144"]; goto QGtlF; e3UJn: Db::name("\x79\142\x73\143\x5f\151\x6e\164\x65\147\x72\x61\x6c\x5f\144\x65\x74\x61\x69\x6c")->insert($data_jf); goto P1QCu; UDeKz: if (!($b["\143\157\x6e\163\137\x73\164\x61\164\165\163"] == 1)) { goto W3FVh; } goto Lmy0n; MhFY1: $c = Db::name("\x79\x62\x73\143\x5f\x75\163\145\x72")->where("\165\151\144", $a["\142\165\x79\x65\x72\x5f\151\144"])->find(); goto tBnCi; XjOBg: $data_jf["\x69\156\164\x65\147\x72\141\x6c"] = $jifen; goto I501T; grXcF: $a = Db::name("\171\142\x73\143\x5f\157\162\144\145\162")->where(["\157\x72\144\145\x72\137\x69\144" => $order_id, "\157\x72\x64\145\x72\137\163\164\x61\164\165\x73" => 0])->find(); goto pv44g; A_61u: return $rs; goto ogbqX; jlDwO: dOQWU: goto lDDzM; olnQj: $i = 0; goto By4UT; O6G49: if (!$b) { goto WjErX; } goto A_nwx; mnsXO: $data_jf["\165\x73\145\x72\x5f\x69\x64"] = $a["\142\165\x79\x65\162\x5f\151\x64"]; goto XjOBg; Uo_Qw: $b = Db::name("\x79\142\x73\143\x5f\151\x6e\164\x65\147\162\x61\154\137\162\x75\154\x65")->where("\155\143\150\x5f\x69\144", $a["\x6d\143\x68\137\x69\x64"])->value("\x64\141\164\141"); goto O6G49; lDDzM: x7uLZ: goto u2Et1; Ooaez: $jifen = floor(floatval($order_money) / floatval($b["\143\157\156\x73\137\x6d\157\x6e\145\x79"])) * floatval($b["\x63\x6f\156\x73\137\151\x6e\164\145\x67\162\141\x6c"]); goto MhFY1; A_nwx: $b = json_decode($b, true); goto UDeKz; vfEKa: $data_jf["\155\143\150\x5f\x69\x64"] = $a["\155\143\x68\x5f\x69\x64"]; goto jZMOw; I501T: $data_jf["\143\157\156\163\165\x6d\x65"] = $jifen; goto vfEKa; HOg2K: Db::startTrans(); goto D_6_5; ogbqX: } public function upPtPay($order_id) { goto jHS0V; AR1Hf: $data = array("\157\x72\x64\x65\x72\137\163\x74\141\164\x75\163" => 2, "\151\163\x50\141\171" => 1, "\160\141\171\x54\x69\155\x65" => time()); goto WLQ2n; tBqu3: if (!$info) { goto jPOLN; } goto KjFc2; KjFc2: $out_trade_no = $info["\x6f\x72\x64\x65\162\116\x75\x6d"]; goto turtD; ZHL3U: jPOLN: goto xeHx0; meLhn: try { goto X_Z8D; yPM9F: iss3L: goto H0aTU; O_YnU: DICzA: goto WBvwy; xmfFu: $rs["\x6d\x73\x67"] = "\346\224\257\xe4\273\x98\347\212\xb6\346\x80\x81\xe6\x9b\xb4\xe6\224\271\346\210\220\xe5\212\x9f"; goto YH6Nc; dgze1: e7IHt: goto Hl_7X; FuhRl: return $rs; goto ELI0T; Od1BT: tuYY1: goto wjNiB; KLREj: if (!$aa) { goto rUkHj; } goto NGhAD; nTFie: AA0jY: goto BEkNF; xM89R: $rs["\x63\157\144\x65"] = 1; goto OX1Us; WOpa4: $res = Db::name("\171\142\x73\x63\x5f\160\x74\x5f\157\x72\x64\x65\162\163")->where(["\157\162\x64\x65\162\x4e\x75\x6d" => $out_trade_no, "\x6f\162\144\145\162\x5f\163\164\x61\164\x75\163" => 1, "\151\x73\120\x61\171" => 0])->update($data); goto YICFm; wjNiB: Db::commit(); goto FuhRl; YICFm: if (!$res) { goto MFTTo; } goto xM89R; ymA4_: $count = Db::name("\x79\x62\x73\x63\137\x70\x74\137\157\x72\x64\x65\x72\x73")->where(["\160\x69\x64" => $info["\x70\151\x64"], "\x69\x73\120\x61\171" => 1])->count(); goto vvoE7; X_Z8D: Db::name("\x79\x62\163\x63\x5f\160\x74\x5f\x6f\162\x64\145\162\137\160\x61\x79\x6d\145\156\164")->where(["\157\x75\x74\x5f\164\162\141\x64\x65\x5f\x6e\157" => $out_trade_no, "\160\x61\x79\137\163\x74\141\164\x75\x73" => 0])->update($data_pay); goto B1WHr; BEkNF: $groupNum = Db::name("\x79\142\x73\143\x5f\160\164\x5f\147\x6f\157\144\163")->where("\x69\x64", $info["\147\x69\x64"])->value("\147\x72\157\x75\x70\x4e\x75\x6d"); goto wBSR7; OX1Us: $rs["\155\x73\x67"] = "\xe6\x94\xaf\344\273\230\347\212\xb6\xe6\200\x81\xe6\233\xb4\346\x94\271\xe6\210\220\xe5\212\x9f"; goto yfGFj; H0aTU: goto tuYY1; goto O_YnU; bSuzW: rUkHj: goto dgze1; B1WHr: if ($info["\x69\x73\107\162\x6f\x75\160"] == 0) { goto DICzA; } goto mUMf9; WI799: $rs["\155\x73\147"] = "\346\213\274\345\x9b\xa2\xe7\212\266\346\x80\x81\346\233\xb4\346\224\271"; goto bSuzW; YH6Nc: YAgjM: goto PEvY0; PEvY0: goto iss3L; goto nTFie; dPIe9: if (!$res) { goto YAgjM; } goto UBLaf; UBLaf: $rs["\x63\157\144\x65"] = 1; goto xmfFu; mUMf9: if ($info["\x70\x69\x64"] != 0) { goto AA0jY; } goto cpNQn; nJRvr: $rs["\x63\x6f\144\145"] = 1; goto Lf6Hh; vvoE7: if ($groupNum == $count + 2) { goto R4Sim; } goto AJ8C8; glbq_: R4Sim: goto zOXl2; NGhAD: $rs["\143\157\144\x65"] = 1; goto WI799; cpNQn: $res = Db::name("\171\x62\163\143\137\x70\164\x5f\157\x72\x64\145\x72\163")->where(["\157\162\x64\145\x72\116\165\155" => $out_trade_no, "\x6f\162\x64\x65\x72\x5f\x73\164\x61\x74\x75\x73" => 1, "\151\x73\120\x61\x79" => 0])->update($data); goto dPIe9; Lf6Hh: $rs["\x6d\163\x67"] = "\346\x94\xaf\xe4\xbb\x98\347\212\266\346\200\x81\346\233\xb4\346\x94\xb9\xe6\x88\220\345\212\x9f"; goto kjHiz; csRf9: if (!$res) { goto SdSMA; } goto nJRvr; AJ8C8: $res = Db::name("\171\x62\x73\143\x5f\x70\x74\137\x6f\162\144\145\x72\x73")->where(["\157\x72\x64\x65\x72\116\165\155" => $out_trade_no, "\157\x72\144\145\162\x5f\x73\x74\x61\x74\x75\163" => 1, "\151\163\120\141\171" => 0])->update($data); goto csRf9; oUaPX: goto e7IHt; goto glbq_; zOXl2: $aa = Db::name("\171\142\163\143\x5f\160\x74\137\x6f\162\144\x65\162\x73")->where("\x69\144", $info["\160\151\144"])->whereOr("\160\x69\144", $info["\x70\151\144"])->update(["\x6f\162\144\145\x72\x5f\163\x74\x61\164\165\163" => 3, "\147\162\157\x75\x70\124\151\x6d\145" => time(), "\151\x73\120\x61\x79" => 1]); goto KLREj; kjHiz: SdSMA: goto oUaPX; wBSR7: if (!($info["\160\x69\144"] != 0 && $info["\151\163\x47\x72\157\x75\x70"] == 1)) { goto Mo881; } goto ymA4_; Hl_7X: Mo881: goto yPM9F; yfGFj: MFTTo: goto Od1BT; WBvwy: $data["\x6f\162\x64\x65\162\x5f\163\x74\x61\x74\165\x73"] = 3; goto WOpa4; ELI0T: } catch (\Exception $e) { Db::rollback(); } goto IuraE; IuraE: return $rs; goto ZHL3U; l4of3: $info = Db::name("\x79\x62\x73\143\137\160\x74\137\157\162\x64\145\x72\163")->where(["\151\x64" => $order_id, "\x69\163\120\x61\x79" => 0])->find(); goto tBqu3; jHS0V: $rs = array("\143\157\x64\x65" => 1, "\151\156\x66\x6f" => array()); goto AR1Hf; turtD: Db::startTrans(); goto meLhn; WLQ2n: $data_pay = array("\x70\141\171\x5f\163\164\x61\164\x75\163" => 1, "\160\141\x79\x5f\x74\x69\155\x65" => time()); goto l4of3; xeHx0: } public function upMsPay($order_id) { goto cH4l_; Flh07: return $rs; goto iyu5O; cH4l_: $res = array("\143\157\x64\x65" => 1, "\x69\x6e\x66\157" => array()); goto LzBmX; t2eau: try { goto KVO_q; xahih: Db::commit(); goto GTkOL; cJ35H: Db::name("\171\x62\x73\x63\x5f\x61\143\x74\x69\166\x69\x74\171\137\x6f\x72\x64\145\162\137\x70\x61\x79\155\145\156\x74")->where(["\157\x75\x74\x5f\x74\x72\x61\144\x65\137\156\x6f" => $order_id, "\x70\x61\x79\x5f\163\164\141\164\165\x73" => 0])->update($data_pay); goto xahih; GTkOL: $rs["\143\157\144\x65"] = 1; goto H2BX_; KVO_q: $res = Db::name("\x79\142\x73\143\x5f\x61\143\x74\x69\x76\x69\x74\x79\137\157\x72\x64\145\162")->where(["\157\162\x64\x65\162\x5f\x69\144" => $order_id, "\157\162\144\x65\x72\x5f\163\x74\141\x74\x75\x73" => 0])->update($data); goto cJ35H; H2BX_: $rs["\x6d\163\147"] = "\346\224\257\344\xbb\230\347\212\xb6\346\x80\201\346\x9b\264\346\224\271\xe6\x88\x90\345\212\237"; goto tYiMX; tYiMX: } catch (\Exception $e) { goto mJSj5; mJSj5: Db::rollback(); goto S4mzl; S4mzl: $rs["\143\x6f\144\x65"] = 0; goto Qllg0; Qllg0: $rs["\x6d\x73\x67"] = "\xe6\224\xaf\xe4\273\x98\347\212\xb6\xe6\200\201\346\233\264\346\224\xb9\xe5\xa4\261\xe8\264\xa5"; goto pISZd; pISZd: } goto Flh07; Bm2N7: Db::startTrans(); goto t2eau; LzBmX: $data = array("\x6f\x72\144\x65\162\137\x73\x74\x61\164\165\x73" => 1, "\x70\141\x79\x5f\163\164\x61\x74\165\163" => 1, "\x70\x61\x79\x5f\x74\x79\x70\145" => 3, "\160\141\x79\137\164\151\x6d\x65" => time()); goto cOl6K; cOl6K: $data_pay = array("\160\x61\171\137\163\164\x61\164\x75\163" => 1, "\160\x61\171\x5f\x74\x69\155\145" => time()); goto Bm2N7; iyu5O: } public function upCardPay($order_id) { goto gTxgG; P1cVw: $user_id = Db::name("\x79\x62\x73\143\137\165\x73\145\162\137\x63\x61\x72\144")->where(["\151\x64" => $info["\x63\x61\x72\x64\137\x69\x64"]])->value("\165\163\145\x72\x5f\x69\x64"); goto o5Ipv; WW_Jk: $data_pay = array("\x70\141\171\x5f\163\164\x61\x74\165\163" => 1, "\x70\x61\x79\x5f\x74\151\x6d\145" => time()); goto OsT7n; rzBnN: $data = array("\151\163\x70\x61\171" => 1, "\160\141\x79\164\x69\155\x65" => time()); goto WW_Jk; gTxgG: $rs = array("\x63\x6f\x64\145" => 1, "\x69\x6e\x66\157" => array()); goto rzBnN; o5Ipv: if (!$info) { goto sOCMZ; } goto vQWC4; vQWC4: $out_trade_no = $info["\x6f\x75\164\x5f\164\x72\x61\x64\145\137\156\157"]; goto KZoSb; d90Hz: return $rs; goto xR_14; xR_14: sOCMZ: goto UuEAC; sJ2K3: $info = Db::name("\171\142\x73\x63\x5f\x75\x73\145\162\137\x63\x61\x72\144\x5f\157\162\x64\x65\162\163")->where(["\151\x64" => $order_id, "\151\163\x70\141\x79" => 0])->find(); goto P1cVw; OsT7n: $data_jf = array("\x74\151\x6d\145" => time(), "\151\164\171\x70\x65" => 1, "\143\x74\x79\160\145" => 1, "\145\170\160\154\x61\151\156" => "\xe4\274\232\345\221\230\xe5\205\x85\xe5\200\274"); goto sJ2K3; XUAfP: try { goto MAv3u; dMgmj: $new_data = ["\x74\151\155\145" => time(), "\151\x74\171\160\145" => 1, "\143\164\171\160\x65" => 1, "\156\x75\x6d\x5f\x71\x64" => 5, "\x6f\162\144\x65\x72\x5f\x69\144" => 0, "\x75\x73\x65\x72\x5f\x69\144" => $user_id, "\x6d\143\x68\x5f\x69\x64" => $data["\x6d\143\x68\x5f\x69\144"], "\151\156\x74\x65\x67\x72\141\x6c" => intval($info["\151\x6e\x74\145\147\x72\141\154"]), "\143\157\x6e\163\x75\155\145" => $level == 1 ? intval($info["\151\x6e\164\x65\147\162\141\154"]) : 0, "\x74\171\160\x65\x5f\x6c\170\x6d" => 1, "\145\170\160\x6c\x61\x69\x6e" => "\344\xbc\232\345\221\230\345\x85\205\345\200\274"]; goto oVlW_; kALww: $level_id = $d[$i]["\x69\x64"]; goto X4DRH; FT_Lx: pqyyH: goto yCao6; dy9Dn: if (!($level == 1)) { goto YyuUp; } goto TLirQ; rSM0u: if (!$d) { goto pqyyH; } goto XfZ3e; g2Vmd: if (!($i < count($d))) { goto nuImw; } goto iB7R6; qFwpB: if (!($level == 1)) { goto cfa0d; } goto KLwfZ; TLirQ: $user_data["\143\157\156\x73\x75\x6d\x65"] = intval($c["\x63\x6f\x6e\163\x75\155\145"]) + intval($new_data["\143\157\156\x73\165\155\145"]); goto cGPvr; kz1q1: $res = Db::name("\x79\x62\x73\x63\x5f\165\163\145\162\x5f\x63\x61\162\144\137\x6f\x72\x64\145\x72\163")->where(["\x6f\165\x74\x5f\x74\x72\141\x64\x65\137\x6e\x6f" => $out_trade_no, "\151\163\160\141\x79" => 0])->update($data); goto bIQg5; MAv3u: Db::name("\171\x62\163\x63\137\165\x73\145\162\137\143\x61\162\x64\x5f\x70\x61\x79\155\x65\156\164")->where(["\x6f\165\164\x5f\164\162\141\144\x65\x5f\156\157" => $out_trade_no, "\x70\141\171\137\163\x74\x61\164\x75\163" => 0])->update($data_pay); goto kz1q1; fSzor: goto nuImw; goto zk4P2; jdPIz: XA5mA: goto FW8_S; B13gu: $level = Db::name("\171\142\x73\x63\137\165\163\x65\162\x5f\x63\141\x72\x64\137\163\145\164\164\151\x6e\147")->where(["\155\143\x68\137\x69\144" => $info["\155\x63\x68\137\x69\144"]])->value("\154\145\x76\x65\154"); goto bxUht; T77Ca: $c = Db::name("\x79\x62\x73\143\x5f\x75\x73\x65\162")->where("\165\x69\144", $data["\165\x69\144"])->find(); goto WrnJ7; cGPvr: YyuUp: goto O5SEl; rHOyn: goto wRtlJ; goto c4I7G; K_XzS: $i++; goto rHOyn; L73bK: return $rs; goto Ksali; c4I7G: nuImw: goto FT_Lx; KLwfZ: $d = Db::name("\x79\142\163\x63\137\x75\x73\x65\x72\x5f\x6c\145\166\145\154")->where("\155\143\x68\x5f\151\144", $data["\x6d\x63\150\x5f\151\144"])->order("\x68\x69\x65\x72\x61\162\x63\x68\x79", "\144\x65\163\143")->select(); goto rSM0u; O5SEl: $lxm2 = Db::name("\x79\142\163\143\x5f\x75\x73\145\162")->where("\x75\151\x64", $user_id)->update($user_data); goto qFwpB; FW8_S: Db::commit(); goto L73bK; bIQg5: $money = floatval($info["\x70\141\171\160\162\151\x63\145"]) + floatval($info["\147\x69\x76\145\x70\162\151\143\x65"]); goto JOgIV; rHfdB: wRtlJ: goto g2Vmd; XfZ3e: $i = 0; goto rHfdB; bxUht: if (!($info["\x69\156\x74\145\147\x72\x61\154"] && intval($info["\x69\156\x74\145\x67\162\141\154"]) > 0)) { goto XA5mA; } goto dMgmj; JTrhH: GpP5p: goto K_XzS; JOgIV: Db::name("\171\142\163\x63\137\x75\163\x65\162\x5f\x63\141\x72\x64")->where(["\x69\144" => $info["\x63\x61\x72\x64\137\151\144"], "\151\x73\137\x64\x65\x6c" => 1])->setInc("\155\x6f\x6e\145\171", $money); goto B13gu; iB7R6: if (!($user_data["\143\x6f\x6e\x73\x75\x6d\x65"] >= $d[$i]["\x68\x69\145\x72\x61\x72\x63\x68\171"])) { goto AL0v0; } goto kALww; yCao6: cfa0d: goto jdPIz; X4DRH: Db::name("\171\x62\x73\x63\137\x75\163\145\162")->where("\x75\x69\144", $data["\165\x69\144"])->update(["\x6c\x65\166\145\x6c\x5f\x69\x64" => $level_id]); goto fSzor; WrnJ7: $user_data["\151\x6e\x74\145\x67\162\x61\x6c"] = intval($c["\x69\156\164\145\147\162\x61\154"]) + intval($new_data["\x69\156\164\x65\x67\x72\141\x6c"]); goto dy9Dn; zk4P2: AL0v0: goto JTrhH; oVlW_: $lxm1 = Db::name("\171\142\x73\143\x5f\x69\x6e\x74\145\x67\162\141\x6c\137\x64\x65\164\141\x69\154")->insert($new_data); goto T77Ca; Ksali: } catch (\Exception $e) { goto U5mNe; rOIV1: $rs["\x63\x6f\x64\x65"] = 0; goto MLFy8; U5mNe: Db::rollback(); goto rOIV1; MLFy8: $rs["\x6d\163\x67"] = "\xe6\224\xaf\344\273\230\xe7\x8a\xb6\xe6\200\201\xe6\x9b\264\xe6\224\271\xe5\xa4\261\350\264\245"; goto RYfnk; RYfnk: } goto d90Hz; KZoSb: Db::startTrans(); goto XUAfP; UuEAC: } public function upBdPay($order_id) { goto uhiR2; U0cgK: if (!$d) { goto aBuiX; } goto P78Fi; lfmVK: Db::startTrans(); goto wn6UB; ZH6up: QJt36: goto lfmVK; Ox2c9: if (!($i < count($d))) { goto sCRUq; } goto FDiiI; GS2MZ: $jifen = 0; goto BTE5m; JsL0o: GH4OX: goto L7CgO; wn6UB: try { goto epUmS; epUmS: $res = Db::name("\171\142\163\143\x5f\x6f\162\x64\x65\x72")->where(["\157\162\x64\145\x72\137\x69\x64" => $order_id, "\157\x72\x64\145\x72\x5f\163\x74\141\164\165\163" => 0])->update($data); goto As6PA; oPz1p: $un_data["\x75\x72\x6c"] = $_SERVER["\x48\124\124\x50\x5f\x48\117\x53\x54"]; goto HMrE3; MRwG8: $order = Db::name("\x79\142\x73\143\x5f\157\x72\x64\145\162")->where(["\x6f\x75\x74\x5f\164\x72\141\144\x65\137\x6e\x6f" => $out_trade_no])->find(); goto lidMT; ihKHq: Log::write($out_trade_no . "\x2c\346\224\257\xe4\xbb\x98\347\x8a\266\xe6\x80\201\xe6\x9b\xb4\xe6\x94\271\xe6\210\220\xe5\212\237", "\x73\150\x6f\160\x5f\x70\x61\171\137\163\164\141\164\145\x5f\143\x68\141\x6e\x67\x65\x5f\163\165\143\143\145\x73\163"); goto MVzod; MurLg: Db::name("\171\x62\x73\x63\x5f\157\x72\x64\x65\162\137\160\141\171\155\x65\x6e\164")->where(["\x6f\165\x74\137\164\162\x61\x64\x65\137\x6e\x6f" => $out_trade_no, "\x70\x61\171\137\x73\164\141\164\x75\163" => 0])->update($data_pay); goto ShSGJ; HMrE3: $un_url = explode("\x3a", $un_data["\165\x72\154"]); goto IMoUi; afamm: $rr["\155\163\x67"] = "\163\165\x63\143\x65\x73\163"; goto A91rr; CCEty: exit(json_encode($rr, true)); goto dHkD3; raSNj: $data["\165\x6e\x69\x61\x63\x69\144"] = $user["\165\x6e\x69\141\143\151\144"]; goto JZq1O; UvoZP: $user = Db::name("\171\x62\163\x63\x5f\142\165\x73\x69\156\145\x73\163")->where(["\151\x64" => $mid])->find(); goto oPz1p; lidMT: $mid = $order["\155\x63\150\x5f\151\144"]; goto UvoZP; t1sTu: if (!(!empty($res) && $res > 0)) { goto nyCjI; } goto MRwG8; qaxwN: $data["\165\163\145\162\156\x61\x6d\145"] = $user["\156\x61\155\x65"]; goto raSNj; dHkD3: nyCjI: goto Nt7Rr; ShSGJ: Db::commit(); goto t1sTu; As6PA: $out_trade_no = $res["\157\x75\x74\x5f\x74\x72\141\x64\x65\x5f\x6e\x6f"]; goto MurLg; IMoUi: $data["\165\162\154"] = $un_url[0]; goto qaxwN; JZq1O: $alias = md5($data["\x75\162\x6c"] . $data["\165\x73\x65\162\156\x61\155\x65"] . $data["\x75\156\x69\x61\x63\151\x64"]); goto ihKHq; MVzod: $rr["\145\162\x72\156\x6f"] = 0; goto afamm; A91rr: $rr["\144\x61\164\x61"] = ["\x69\163\103\157\x6e\x73\165\x6d\x65\x64" => 2]; goto CCEty; Nt7Rr: } catch (\Exception $e) { goto gxuLj; konBJ: $rs["\143\157\x64\x65"] = 0; goto aZ8mT; aZ8mT: $rs["\x6d\x73\x67"] = "\xe6\x94\257\344\xbb\230\347\212\266\346\200\x81\346\x9b\264\346\224\271\345\244\xb1\350\xb4\xa5"; goto kXgog; gxuLj: Db::rollback(); goto konBJ; kXgog: } goto PFONf; MFsyD: $d = Db::name("\x79\x62\163\x63\137\x75\x73\145\x72\137\154\145\x76\x65\x6c")->where("\155\x63\x68\x5f\151\144", $a["\x6d\x63\x68\x5f\151\144"])->order("\150\151\145\x72\141\162\x63\150\171", "\x64\x65\163\143")->select(); goto U0cgK; M9NBp: $data = array("\x6f\x72\x64\145\162\137\x73\x74\141\164\x75\x73" => 1, "\x70\141\x79\x5f\x73\164\141\x74\165\163" => 1, "\x70\141\171\x5f\164\171\160\145" => 1, "\x70\x61\171\137\x74\151\x6d\145" => time()); goto X05we; xYvT9: $c = Db::name("\x79\142\x73\143\x5f\x75\163\145\x72")->where("\165\151\x64", $a["\x62\165\171\x65\x72\137\x69\144"])->find(); goto IaZwT; BTE5m: if (!$b) { goto QJt36; } goto DydC0; eu4vM: Db::name("\x79\x62\x73\143\x5f\151\156\x74\x65\x67\162\141\x6c\x5f\144\x65\164\141\151\x6c")->insert($data_jf); goto MRa5R; lqpxx: Db::name("\x79\x62\163\x63\137\x75\x73\145\162")->where("\x75\x69\144", $a["\142\x75\x79\x65\162\137\151\x64"])->update($new_data); goto oFb0q; ivyy8: $pp = new PrinterService($a["\x6d\x63\x68\137\151\144"], $a["\x6f\162\x64\145\x72\137\151\x64"], "\x70\x61\171", 0); goto lAvXv; XdfXF: $order_money = $a["\157\162\x64\145\162\x5f\155\x6f\x6e\x65\171"]; goto TQ9i8; RVFNv: $new_data["\143\x6f\x6e\x73\165\155\145"] = $jf_all; goto C5M5t; dbu82: if (!empty($a)) { goto UsnXB; } goto g1CTj; P78Fi: $i = 0; goto ClD4f; f1EvI: sCRUq: goto OnumB; oFb0q: $data_jf["\165\163\145\x72\137\151\144"] = $a["\142\x75\171\x65\162\137\x69\144"]; goto UDi38; lAvXv: $pp->print_order(); goto nLi2a; X05we: $data_pay = array("\x70\141\171\137\163\x74\141\x74\x75\163" => 1, "\160\x61\x79\x5f\x74\151\155\x65" => time()); goto ZnPcH; uhiR2: $rs = array("\143\x6f\144\145" => 1, "\x69\x6e\x66\x6f" => array()); goto M9NBp; fEMB6: $a = Db::name("\x79\x62\x73\143\137\x6f\x72\144\x65\x72")->where(["\x6f\x72\x64\145\x72\137\x69\144" => $order_id])->find(); goto dbu82; ClD4f: ywgO6: goto Ox2c9; GJv7e: l5jiK: goto oumQt; oHyyS: goto ywgO6; goto f1EvI; PFONf: return $rs; goto GJv7e; OnumB: aBuiX: goto y2LZ1; L7CgO: Ybcuy: goto GgDxZ; C5M5t: $new_data["\151\x6e\164\145\x67\162\x61\x6c"] = round($jifen) + intval($c["\151\x6e\x74\145\147\162\x61\x6c"]); goto lqpxx; GgDxZ: $i++; goto oHyyS; TQ9i8: $jifen = floor(floatval($order_money) / floatval($b["\143\x6f\156\163\137\x6d\x6f\156\145\171"])) * floatval($b["\143\x6f\x6e\163\137\151\156\x74\x65\147\162\x61\154"]); goto xYvT9; nLi2a: $b = Db::name("\x79\x62\163\x63\137\151\156\164\x65\147\162\x61\x6c\x5f\162\165\154\x65")->where("\x6d\143\x68\137\151\144", $a["\155\x63\150\137\x69\144"])->value("\x64\x61\164\141"); goto GS2MZ; UDi38: $data_jf["\151\156\x74\x65\x67\162\x61\x6c"] = $jifen; goto QLjpr; kdYPC: UsnXB: goto oMjzS; DydC0: $b = json_decode($b, true); goto bfuM7; y2LZ1: pdCyX: goto ZH6up; QLjpr: $data_jf["\x63\157\x6e\163\165\x6d\145"] = $jifen; goto F1Uuo; MRa5R: goto sCRUq; goto JsL0o; g1CTj: exit; goto kdYPC; n_VNV: $new_data["\154\145\166\x65\154\x5f\x69\x64"] = $d[$i]["\151\144"]; goto RVFNv; ZnPcH: $data_jf = array("\164\151\x6d\145" => time(), "\x69\164\x79\160\145" => 1, "\x63\x74\171\x70\x65" => 1, "\x65\170\x70\x6c\141\x69\156" => "\xe6\266\210\xe8\xb4\xb9"); goto fEMB6; bfuM7: if (!($b["\x63\x6f\156\x73\137\x73\164\x61\x74\165\163"] == 1)) { goto pdCyX; } goto XdfXF; F1Uuo: $data_jf["\155\x63\x68\137\x69\144"] = $a["\155\x63\x68\137\x69\144"]; goto H6B8X; oMjzS: if (!($a["\x6f\162\x64\145\x72\x5f\163\164\x61\164\x75\163"] == 0)) { goto l5jiK; } goto ivyy8; IaZwT: $jf_all = round($jifen) + intval($c["\x63\x6f\156\163\165\x6d\x65"]); goto MFsyD; FDiiI: if (!($jf_all >= $d[$i]["\150\x69\x65\x72\141\162\x63\x68\171"])) { goto GH4OX; } goto n_VNV; H6B8X: $data_jf["\x6f\162\x64\145\162\x5f\x69\x64"] = $a["\x6f\162\x64\x65\x72\137\x69\144"]; goto eu4vM; oumQt: } public function upContentPay($order_id) { goto EDiXO; ImdWN: return $rs; goto T6tvd; meVT5: Db::startTrans(); goto q2Cf2; CpQhZ: if (!$info) { goto xFURk; } goto JcCLV; EDiXO: $rs = array("\143\157\x64\x65" => 1, "\x69\156\146\x6f" => array()); goto L2E1m; vvVES: $data_pay = array("\160\x61\x79\x5f\163\164\x61\164\x75\163" => 1, "\160\141\x79\137\x74\151\x6d\145" => time()); goto VJ33n; VJ33n: $info = Db::name("\x79\x62\163\x63\x5f\160\x61\171\x63\x6f\156\x74\145\x6e\164\x5f\x6f\162\144\145\162\x73")->where(["\151\144" => $order_id, "\x69\163\120\141\171" => 0])->find(); goto CpQhZ; SVDAM: xFURk: goto ImdWN; L2E1m: $data = array("\x69\163\x50\x61\x79" => 1, "\160\x61\171\x54\151\x6d\x65" => time()); goto vvVES; q2Cf2: try { goto ekdkj; clnFX: $res = Db::name("\x79\142\163\143\137\x70\141\171\143\x6f\156\x74\145\156\164\x5f\x6f\x72\x64\x65\x72\x73")->where(["\157\165\164\137\164\x72\141\x64\x65\137\156\157" => $out_trade_no, "\151\163\120\x61\x79" => 0])->update($data); goto Lx1ik; Vep0N: goto PyZEH; goto gT0ku; IVB2A: $expire = $user["\145\170\x70\x69\x72\x65"] + $info["\144\141\171"] * 24 * 60 * 60 * $info["\156\x75\155"]; goto M3a6O; BHMmj: $udata["\165\x69\144"] = $info["\x75\x69\144"]; goto WXlnm; aqlDV: $user = Db::name("\x79\x62\163\143\x5f\x70\141\171\x63\157\x6e\x74\145\156\164\137\165\x73\x65\x72")->where(["\165\151\144" => $info["\165\x69\x64"], "\x6d\143\x68\x5f\151\x64" => $info["\155\x63\150\x5f\x69\144"]])->find(); goto HrNkz; HrNkz: $time = time(); goto A5Wwm; M3a6O: Db::name("\171\x62\x73\x63\137\x70\141\171\143\x6f\156\164\x65\x6e\x74\137\x75\x73\x65\162")->where(["\165\x69\x64" => $info["\165\151\x64"], "\155\143\x68\137\x69\x64" => $info["\155\x63\150\x5f\151\x64"]])->update(["\145\x78\160\x69\x72\x65" => $expire]); goto Vep0N; A5Wwm: if (empty($user)) { goto X6sHH; } goto u0vYa; gT0ku: X6sHH: goto BHMmj; u0vYa: $user["\x65\x78\160\x69\162\x65"] = $user["\145\x78\x70\x69\162\145"] < $time ? $time : $user["\145\x78\160\151\162\x65"]; goto IVB2A; qMRki: return $rs; goto vwY8G; Lx1ik: if (!($info["\x70\x72\151\143\x65\137\x69\144"] > 0)) { goto Vt84c; } goto aqlDV; A8oD3: PyZEH: goto wHbsL; wHbsL: Vt84c: goto Jphgs; TE7zW: $udata["\x65\170\x70\151\162\x65"] = $time + $info["\x64\x61\171"] * 24 * 60 * 60 * $info["\x6e\x75\x6d"]; goto H6EtO; aVT3g: Db::commit(); goto tMYfk; tMYfk: $rs["\143\157\144\145"] = 1; goto E4FOI; Jphgs: Db::name("\x79\142\x73\x63\x5f\160\141\x79\143\x6f\156\164\x65\156\x74")->where(["\151\144" => $info["\x63\x6f\x6e\164\145\156\x74\x5f\x69\x64"], "\155\143\150\137\x69\144" => $info["\155\143\150\137\151\144"]])->setInc("\142\x75\171\x5f\x63\157\x75\x6e\164\x5f\x72\x65\x61\154"); goto aVT3g; H6EtO: Db::name("\171\x62\163\143\137\160\141\171\143\157\156\164\145\x6e\164\x5f\x75\x73\145\x72")->insert($udata); goto A8oD3; E4FOI: $rs["\155\163\x67"] = "\xe6\224\257\xe4\273\x98\xe7\212\266\346\x80\201\xe6\x9b\xb4\xe6\x94\271\346\x88\x90\345\212\237"; goto qMRki; WXlnm: $udata["\155\143\150\137\x69\x64"] = $info["\155\143\x68\x5f\151\144"]; goto TE7zW; ekdkj: Db::name("\171\142\163\143\x5f\160\141\171\143\x6f\x6e\164\145\156\x74\x5f\160\x61\x79\155\x65\156\x74")->where(["\x6f\x75\x74\137\x74\162\x61\x64\x65\137\156\x6f" => $out_trade_no, "\160\x61\171\x5f\163\x74\x61\164\x75\x73" => 0])->update($data_pay); goto clnFX; vwY8G: } catch (\Exception $e) { Db::rollback(); } goto SVDAM; JcCLV: $out_trade_no = $info["\157\165\x74\x5f\164\162\141\x64\145\x5f\x6e\157"]; goto meVT5; T6tvd: } public function upBargainPay($order_id) { goto A3kVY; ZNrnH: try { goto h7e1F; KbIZF: $rs["\155\x73\x67"] = "\346\224\257\344\273\x98\347\x8a\266\346\x80\x81\346\x9b\xb4\xe6\x94\271\346\210\220\xe5\212\x9f"; goto C5mI_; C5mI_: return $rs; goto QZh2V; QIs9X: $rs["\143\x6f\144\x65"] = 1; goto KbIZF; arLoX: Db::commit(); goto QIs9X; h7e1F: $res = Db::name("\x79\x62\x73\143\x5f\x62\x61\162\147\141\151\156\x5f\x6f\x72\144\145\x72")->where(["\157\x75\164\x5f\x74\162\x61\144\145\x5f\x6e\157" => $out_trade_no, "\x6f\162\144\145\162\x5f\163\x74\141\164\x75\x73" => 0])->update($data); goto Qd8rD; Qd8rD: Db::name("\x79\x62\x73\x63\137\142\141\162\x67\141\x69\156\137\157\x72\x64\x65\162\x5f\160\x61\x79\x6d\145\x6e\x74")->where(["\x6f\165\164\137\164\162\141\144\145\137\156\x6f" => $out_trade_no, "\x70\x61\x79\137\x73\x74\x61\x74\165\163" => 0])->update($data_pay); goto arLoX; QZh2V: } catch (\Exception $e) { goto LF8aO; LF8aO: Db::rollback(); goto zmLhk; gpM6Q: $rs["\155\163\147"] = "\xe6\x94\257\344\xbb\230\347\212\266\xe6\200\x81\346\x9b\264\xe6\x94\xb9\345\244\xb1\350\264\xa5"; goto mGQcx; zmLhk: $rs["\143\157\144\145"] = 0; goto gpM6Q; mGQcx: } goto mun2m; CxIPI: $data_pay = array("\160\141\171\137\x73\x74\x61\x74\x75\163" => 1, "\160\141\171\x5f\x74\x69\x6d\x65" => time()); goto Xb1dZ; lfV4o: $pp->print_order(); goto fi9Fa; NqcGN: $data = array("\157\x72\x64\x65\x72\x5f\163\164\141\x74\165\163" => 1, "\160\x61\x79\x5f\163\x74\x61\x74\165\x73" => 1, "\x70\141\x79\137\164\x79\160\x65" => 1, "\x70\x61\171\x5f\164\151\x6d\x65" => time()); goto CxIPI; bynTZ: $pp = new PrinterService($a["\155\143\x68\x5f\151\144"], $a["\x6f\x72\x64\x65\162\x5f\x69\144"], "\x70\x61\171", 1); goto lfV4o; A3kVY: $rs = array("\x63\x6f\x64\145" => 1, "\151\156\x66\157" => array()); goto NqcGN; Xb1dZ: $a = Db::name("\171\x62\x73\x63\x5f\142\141\162\147\141\x69\x6e\x5f\x6f\162\x64\145\162")->where(["\x6f\x72\x64\145\x72\137\x69\144" => $order_id, "\157\162\144\x65\162\x5f\163\x74\x61\164\x75\163" => 0])->find(); goto t8bRi; fi9Fa: Db::startTrans(); goto ZNrnH; mun2m: UmiM5: goto N7iR5; vWMWG: $out_trade_no = $a["\x6f\x75\x74\137\x74\x72\141\144\145\x5f\x6e\157"]; goto bynTZ; t8bRi: if (!$a) { goto UmiM5; } goto vWMWG; N7iR5: return $rs; goto MgE_j; MgE_j: } }
