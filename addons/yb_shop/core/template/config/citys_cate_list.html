{extend name="base"/}
{block name="main"}
<style>
    .table>tbody>tr>td {text-align: center;}
</style>
<div class="Hui-article">
    <article class="cl pd-20">
        <div id="tab_demo2" class="HuiTab" style="margin-bottom: 15px; position:relative;">
            <div class="tabBar clearfix">
                <span onclick="window.location.href='__CONF_SITE__admin/config/citysCategoryList'" class="current">城市列表页面设置</span>
                <div onclick="window.location.href='__CONF_SITE__admin/config/citys_add_cate'" class="n_tab_add"><i class="Hui-iconfont">&#xe600;</i>添加分类
                </div>
            </div>
        </div>
        <table class="table table-border table-bordered table-bg">
            <thead>
            <tr class="text-c">
                <th><i class="Hui-iconfont">&#xe6f5;</i></th>
                <th>分类名称</th>
                <!--<th>操作</th>-->
            </tr>
            </thead>
            <tbody>
            {foreach name="category_list" item="v1"}
            <tr class="pid_0" style="height: 30px;">
                <td style="text-align: center;">
                    <a href="javascript:;"  onclick="tab_switch({$v1['id']})" class="tab_jia_{$v1['id']}" style="display: block;"><i class="Hui-iconfont">&#xe600;</i></a>
                    <a href="javascript:;" onclick="tab_switch({$v1['id']})" class="tab_jian_{$v1['id']}" style="display: none;"><i class="Hui-iconfont">&#xe6a1;</i></a>
                </td>
                <td style="text-align: center;"><input class="input-common" type="text" fieldid="{$v1['id']}" fieldname="cate_name" value="{$v1['name']}" style="width: 150px;" disabled="disabled"></td>
                <td style="text-align: center;">
                    <a style="text-decoration:none;color:#0066cc;" title="编辑" onclick="goods_cate_edit('类型编辑','__CONF_SITE__admin/config/updateCitysCate&id={$v1.id}','1000','400')" href="javascript:;">
                        编辑
                    </a>
                    <!--<a style="text-decoration:none;color:#0066cc;" title="删除" href="javascript:void(0);" onclick="delCategory({$v1['cate_id']})">-->
                        <!--删除-->
                    <!--</a>-->
                </td>
            </tr>
                {foreach name="v1['child_list']" item="v2"}
                <tr class="pid_{$v1['id']}" style="height: 30px;display: none;">
                    <td>
                        <a href="javascript:;" onclick="tab_switch1({$v2['id']})" class="tab_jia_{$v2['id']}" style="display: block;"><i class="Hui-iconfont">&#xe600;</i></a>
                        <a href="javascript:;" onclick="tab_switch1({$v2['id']})" class="tab_jian_1{$v2['id']}" style="display: none;"><i class="Hui-iconfont">&#xe6a1;</i></a>
                    </td>
                    <td style="text-align: center;"><span style="color:#ccc;">|——</span><input class="input-common" type="text" fieldid="{$v2['id']}" fieldname="cate_name" value="{$v2['name']}" style="width: 150px;" disabled="disabled"></td>
                    <td style="text-align: center;">
                    <a style="text-decoration:none;color:#0066cc;" title="编辑" onclick="goods_cate_edit('类型编辑','__CONF_SITE__admin/config/updateCitysCate&id={$v2.id}','1000','400')" href="javascript:;">
                        编辑
                    </a>
                    </td>
                </tr>
                    {foreach name="v2['child_list']" item="v3"}
                    <tr class="pid_1{$v2['id']} " style="height: 30px;display: none;">
                        <td>
                        </td>
                        <td style="text-align: center;"><span style="color:#ccc;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|——</span><input class="input-common" type="text" fieldid="{$v3['id']}" fieldname="cate_name" value="{$v3['name']}" style="width: 150px;" disabled="disabled"></td>
                        <td style="text-align: center;">
                            <a style="text-decoration:none;color:#0066cc;" title="编辑" onclick="goods_cate_edit('类型编辑','__CONF_SITE__admin/config/updateCitysCate&id={$v3.id}','1000','400')" href="javascript:;">
                                编辑
                            </a>
                        </td>
                    </tr>
                    {/foreach}
                {/foreach}
           {/foreach}
            </tbody>
        </table>
    </article>
    <div class="n_page_no">
    </div>
</div>
{/block}
{block name="script"}
<script type="text/javascript">
    /*
     参数解释：
     title	标题
     url		请求的url
     id		需要操作的数据id
     w		弹出层宽度（缺省调默认值）
     h		弹出层高度（缺省调默认值）
     */
    /*分类-编辑*/
    function goods_cate_edit(title,url,w,h){
        layer_show(title,url,w,h);
    }
    $(".table input").change(function(){
        var fieldid = $(this).attr('fieldid');
        var fieldname = $(this).attr('fieldname');
        var fieldvalue = $(this).val();
        if(fieldvalue == ''){
            layer.msg('不能为空！', {icon: 2, time: 1000});
        }else{
            $.ajax({
                type:"post",
                url:"{:url('config/modifyGoodsCategoryField')}",
                data:{'fieldid':fieldid,'fieldname':fieldname,'fieldvalue':fieldvalue},
                success: function (data) {
                    if(data>0){
                        layer.msg('操作成功', {icon: 1, time: 1000},function () {
                            window.location.reload();
                        });
                    }else{
                        layer.msg('操作失败', {icon: 2, time: 1000});
                    }
                }
            });
        }
    });
    //三级菜单
    function tab_switch(module_id){
        if($(".pid_"+module_id).css('display') != 'none'){
            $(".tab_jian_"+module_id).hide();
            $(".tab_jia_"+module_id).show();
            $(".pid_"+module_id).hide(300);
        }else{
            $(".tab_jian_"+module_id).show();
            $(".tab_jia_"+module_id).hide();
            $(".pid_"+module_id).show(500);
        }
    }
    function tab_switch1(module_id){
        if($(".pid_1"+module_id).css('display') != 'none'){
            $(".tab_jian_1"+module_id).hide();
            $(".tab_jia_"+module_id).show();
            $(".pid_1"+module_id).hide(300);
        }else{
            $(".tab_jian_1"+module_id).show();
            $(".tab_jia_"+module_id).hide();
            $(".pid_1"+module_id).show(500);
        }
    }
    function delCategory(cate_id) {
        layer.confirm('确认要删除吗？',function(index){
            //后台处理
            $.ajax({
                type : "post",
                url : "{:url('config/deleteGoodsCategory')}",
                data : {
                    'cate_id' : cate_id,
                },
                dataType : "json",
                success : function(data) {
                    if(data['code'] > 0){
                        layer.msg('操作成功', {icon: 1, time: 1000},function () {
                            window.location.reload();
                        });
                    }else{
                        layer.msg(data['msg'], {icon: 2, time: 1000});
                    }
                }
            });
        });
    }
</script>
{/block}