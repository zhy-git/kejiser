{block name="resources"/}
<style>
    .nav-tabs > li > a:hover {
        border-color: #eee #eee #20a0ff #eee;
    }

    .nav-tabs > li.active > a, .nav-tabs > li.active > a:hover, .nav-tabs > li.active > a:focus {
        background-color: #20a0ff;
        border-color: #20a0ff;
    }

    .nav-tabs > li > a {
        border-radius: 0 0 0 0;
    }

    .nav-tabs > li.active > a, .nav-tabs > li.active > a:hover, .nav-tabs > li.active > a:focus {
        color: #FFF;
        background-color: #20a0ff;
        border-color: #20a0ff;
    }

    .navbar-nav > li > a {
        padding-top: 10px;
        padding-bottom: 10px;
        line-height: 40px
    }

    .navbar-inverse .navbar-nav > li > a:hover, .navbar-inverse .navbar-nav > li > a:focus {
        color: #777;
        background-color: #eee;
    }

    .therji > li:nth-child(1) {
        margin-top: 20px;
    }

    .big-menu .panel .list-group-item {
        border: none;
        overflow: hidden;
        white-space: normal;
        text-overflow: clip;
        font-size: 13px;
        height: 50px;
        padding: 0px 15px;
    }

    .panel > .list-group .list-group-item {
        padding-left: 34px;
    }

    .big-menu .panel .list-group-item:hover {
        background-color: #edf6ff;
        color: #00aeff;
    }

    .big-menu .panel .panel-heading .panel-title {
        width: 100px;
        float: left;
        font-size: 14px;
    }

    .big-menu .panel .panel-heading .panel-title .fa {
        font-size: 16px;
    }

    .navbar-inverse .navbar-nav > .active > a, .navbar-inverse .navbar-nav > .active > a:hover, .navbar-inverse .navbar-nav > .active > a:focus {
        color: #f60;
        background-color: #e7e7e7;
        border-bottom: 2px solid transparent;
        border-color: #f60;
    }

    button {
        outline: none;
    }

    a {
        text-decoration: none;
    }

    a:hover {
        text-decoration: none;
    }

    ul, li {
        list-style: none;
    }

    ul {
        margin-bottom: 0px;
    }

    body {
        font-size: 14px;
        font-family: "微软雅黑";
    }

    .header_right > li > a:hover {
        color: #666;
    }

    .header_right > li {
        float: left;
        padding: 0px 20px;
        border-right: 1px solid #eee;
        line-height: 33px;
    }

    .yyhome:hover .fanhuihome {
        display: block;
    }

    .panel-default > .navtitle {
        background-color: #24303C;
        color: white;
        border: none;
    }

    .big-menu .panel .panel-heading .wytitle {
        height: 50px;
        padding: 15px 15px;
        width: 130px;
    }

    .yg_login > img {
        margin: 0px auto;
        width: 60px;
        height: 60px;
        background-color: #5CB85C;
        border-radius: 50%;
        border: none;
        margin-bottom: 10px;
    }

    .nav-tabs > li > a:hover {
        color: #fff;
        border-color: #44ABF7;
        background-color: #44ABF7;
    }

    .nav-tabs > li {
        margin-right: 10px;
    }

    .nav-tabs > li.active > a, .nav-tabs > li.active > a:hover {
        background-color: #44ABF7;
        color: #fff;
        border-color: #44ABF7;
    }

    .nav > li > a {
        padding: 6px 20px;
        border-radius: 4px;
        border: 1px solid #44ABF7;
        color: #44ABF7;
    }

    input[type="radio"] + label::before {
        content: "\a0"; /*不换行空格*/
        display: inline-block;
        vertical-align: middle;
        font-size: 16px;
        width: 1em;
        height: 1em;
        margin-right: .4em;
        border-radius: 50%;
        border: 2px solid #ddd;
        text-indent: .15em;
        line-height: 1;
    }

    input[type="radio"]:checked + label::before {
        background-color: #44ABF7;
        background-clip: content-box;
        padding: .1em;
        border: 2px solid #44ABF7;
    }

    input[type="radio"] {
        position: absolute;
        clip: rect(0, 0, 0, 0);
    }

    /*#frame-11{display: block;visibility: visible;}*/
    .panel-default > .wyheader {
        font-weight: bold;
        background-color: #F3F3F3;
    }

    .chongzhi {
        margin-bottom: 10px;
        height: 35px;
    }

    .ygminp, .man4, .man2, .man, .man3, .money, .money2, .titleinp {
        float: left;
        border: 1px solid #eee;
        height: 35px;
        line-height: 35px;
        margin-left: 0px;
        margin-right: 0px;
    }

    .man {
        padding: 0px 12px;
        text-align: center;
    }

    .man3 {
        padding: 0px 12px;
        text-align: center;
    }

    .man2 {
        width: 130px;
        padding: 0px 12px;
        text-align: center;
    }

    .man4 {
        width: 160px;
        padding: 0px 12px;
        text-align: center;
    }

    .money2 {
        width: 42%;
        text-indent: 1em;
    }

    .ygminp {
        width: 42%;
        text-indent: 1em;
    }

    .titleinp2 > .row {
        width: 260px;
        margin: 0px;
    }

    .titleinp2 > .row > .col-sm-8 {
        width: 100%;
        padding-left: 0px;
    }

    .shanchu {
        color: white;
        background-color: #ED5565;
        cursor: pointer;
    }

    .fa-plus {
        margin-right: 5px;
    }

    .tianj1 {
        height: 35px;
        text-align: center;
        line-height: 35px;
        border: 1px solid #EFEFEF;
        background-color: #ddd;
        cursor: pointer;
    }

    .ygtime {
        padding: 0px;
    }

    @media (min-width: 1592px) {
        .titleinp {
            width: 39%;
            text-indent: 1em;
            float: left;
            border: 1px solid #eee;
            height: 35px;
            line-height: 35px;
            margin-left: 0px;
            margin-right: 20px;
        }

        .titleinp3 {
            width: 15%;
            text-indent: 1em;
            float: left;
            border: 1px solid #eee;
            height: 35px;
            line-height: 35px;
            margin-left: 0px;
        }
    }

    @media (max-width: 1591px) {
        .titleinp {
            width: 10%;
            padding-left: 5px;
            float: left;
            border: 1px solid #eee;
            height: 35px;
            line-height: 35px;
            margin-left: 0px;
            margin-right: 10px;
        }

        .titleinp3 {
            width: 10%;
            padding-left: 5px;
            float: left;
            border: 1px solid #eee;
            height: 35px;
            line-height: 35px;
            margin-left: 0px;
        }
    }

    .panel-body {
        font-size: 12px;
    }

    @media screen and (min-width: 700px) and (max-width: 1400px) {
        /*.panel-body {background-color:#fcc;}*/
        .col-sm-11 {
            width: 850px;
        }

        .col-sm-1 {
            font-size: 10px;
            width: 120px;
            height: 15px;
            line-height: 15px;
            text-align: center;
        }

        .man4 {
            width: 100px;
            height: 30px;
            font-size: 10px;
            line-height: 30px;
            text-align: center;
        }

        .tianj1 {
            width: 390px;
            height: 35px;
            margin-left: -100px;
            line-height: 35px;
            text-align: center
        }

        .datetimepicker {
            width: 100px;
            height: 30px;
            font-size: 10px;
            line-height: 30px;
            text-align: center
        }

        .col-md-10 {
            margin-left: 70px;
            width: 400px
        }
    }

    @media screen and (min-width: 700px) and (max-width: 1100px) {
        /*.panel-body {background-color:#f60;}*/
        .col-sm-11 {
            margin-top: 20px
        }
    }

    @media screen and (min-width: 1200px) and (max-width: 1300px) {
        /*.panel-body {background-color:cadetblue;}*/
        .col-sm-11 {
            margin-top: 20px
        }

        .col-md-10 {
            margin-left: 100px;
            display: inline-block;
        }
    }

    @media screen and (min-width: 1000px) and (max-width: 1200px) {
        /*.panel-body {background-color:yellow;}*/
        .col-sm-11 {
            margin-top: 20px
        }

        .tianj1 {
            margin-left: 100px
        }
    }

    @media screen and (min-width: 700px) and (max-width: 1000px) {
        /*.panel-body {background-color:#fcc;}*/
        .tianj1 {
            margin-left: 100px;
        }

        .datetimepicker {
            width: 100px;
            height: 30px;
            font-size: 10px;
            line-height: 30px;
            text-align: center;
            display: inline-block;
            position: absolute;
        }

        .col-md-10 {
            width: 400px
        }

        .ygminp inp1 {
            width: 300px;
        }
    }
</style>
{/block}
{extend name="base"/}
{block name="main"}
<article class="cl pd-20">
    <div class="panel-body" id="main" style="display: none" v-show="show">
        <form class="form-horizontal" action="" method="POST">
            <div class="form-group col-md-12">
                <label class="col-sm-1 control-label">开启签到功能</label>
                <div class="col-sm-11">
                    <div class="col-md-12">
                        <label class="radio-inline">
                            <input type="radio" id="emailwy1" class="kaiqi1" :checked="is_open==1" name="is_open"
                                   v-model="is_open" value="1">
                            <label for="emailwy1">开启</label>
                        </label>
                        <label class="radio-inline">
                            <input type="radio" id="emailwy2" class="kaiqi2" name="is_open" :checked="is_open==0"
                                   v-model="is_open" value="0">
                            <label for="emailwy2">关闭</label>
                        </label>
                    </div>
                </div>
            </div>
            <div class="form-group col-md-12">
                <label class="col-sm-1 control-label">关联会员等级</label>
                <div class="col-sm-11" style="width: 200px">
                    <div class="col-md-12" style="width: 200px">
                        <label class="radio-inline">
                            <input type="radio" class="kaiqi1" id="emailwy3" :checked="level==1" name="level"
                                   v-model="level" value="1">
                            <label for="emailwy3">开启</label>
                        </label>
                        <label class="radio-inline">
                            <input type="radio" class="kaiqi2" id="emailwy4" name="level" :checked="level==0"
                                   v-model="level" value="0">
                            <label for="emailwy4">关闭</label>
                        </label>
                    </div>
                </div>
                <div><span
                        style="width: 400px;height: 35px;border: 1px solid #ddd;display: inline-block;line-height: 35px;text-align: center;background: #eeeeee;border-radius: 5px">开启关联会员等级,签到所获取的积分可用于会员等级升级！</span>
                </div>
            </div>
            <div class="form-group col-md-12">
                <label for="inputEmail3" class="col-sm-1 control-label">首次奖励</label>
                <div class="col-sm-11">
                    <div class="col-md-5 chongzhi">
                        <div class="man4">首次奖励</div>
                        <input type="number" name="oneintegral" min="1" v-model="frist_reward" class="ygminp inp1">
                        <div class="man">积分</div>
                    </div>
                    <div class="col-md-7 chongzhi">
                        <div class="man2">日常奖励</div>
                        <input type="number" name="sintegral" min="1" v-model="day_reward" class="money2 inp2">
                        <div class="man">积分</div>
                    </div>
                </div>
            </div>
            <div class="form-group col-md-12">
                <label for="inputEmail3" class="col-sm-1 control-label">连签奖励</label>
                <div class="col-sm-11">
                    <div v-if="cont_reward.length>0">
                        <div class="col-md-12 yginter yginter2" v-for="(v,k) in cont_reward" style="padding: 0px;">
                            <div class="col-md-5 chongzhi">
                                <div class="man4">签到</div>
                                <input type="number" name="day" min="2" v-model="v.date" class="ygminp inp1">
                                <div class="man">天</div>
                            </div>
                            <div class="col-md-7 chongzhi">
                                <div class="man2">奖励</div>
                                <input type="number" name="integral" min="1" v-model="v.reward" class="money2 inp2">
                                <div class="man" style="position: fixed;">积分</div>
                                <div id="del6" data-id="6" @click="del_cont(k)" class="man shanchu shanchu6"><span
                                        class="fa fa-times"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="tianj1 special2 col-md-6 col-md-push-3" @click="add_cont"
                             style="margin-left: -200px"><span class="fa fa-plus"></span>添加一个连签奖励规则
                        </div>
                    </div>

                </div>
            </div>

            <div class="form-group col-md-12">
                <label for="inputEmail3" class="col-sm-1 control-label">特殊奖励</label>
                <div class="col-sm-11">
                    <div class="col-md-12 yginter" id="addhang">

                        <div class="col-md-2 ygtime">
                            <div class="input-group datetime">
                                            <span class="input-group-btn">
                                                <span class="btn btn-default">日期</span>
                                            </span>
                                <input type="text" id="datetimepicker" onfocus="WdatePicker()" :value="other.date"
                                       placeholder="请选择日期时间" name="star_time" readonly="readonly"
                                       class="datetimepicker form-control"
                                       style="padding-left:12px; margin-left: 20px;height: 35px;line-height: 35px;text-align: center;">
                            </div>
                        </div>

                        <div class="col-md-10 chongzhi" style="width: 400px;margin-left: 23px;margin-top: 2px">
                            <div class="man3">标题</div>
                            <input type="text" name="" v-model="other.title" placeholder="非必填" class="titleinp">
                            <div class="man3">奖励</div>
                            <input type="number" name="integral2" v-model="other.reward" class="titleinp3 inp2">
                            <div class="man">积分</div>
                        </div>
                    </div>


                </div>
            </div>
            <div class="col-md-12"></div>
            <div class="form-group col-md-12">
                <input type="button" name="button" onclick="integral_add()" value="提交"
                       class="btn col-lg-3 col-lg-offset-3" style="color: white;background-color: #44ABF7;">
            </div>

        </form>
    </div>
</article>
{/block}
{block name="script"}
<script type="text/javascript">
    var flag = false;//防止重复提交1
    function verify(frist_reward, day_reward) {
        if (parseInt(frist_reward) < 1) {
            layer.msg('首签奖励不小于1', {icon: 5, time: 1000});
            return false;
        }
        if (parseInt(day_reward) < 1) {
            layer.msg('日常奖励不小于1', {icon: 5, time: 1000});
            return false;
        }
        return true;
    }

    function integral_add() {
        if (verify(vm.frist_reward, vm.day_reward) && !flag) {
            flag = true;
            var date_val = $('#datetimepicker').val();
            console.log(date_val)
            if (date_val) {
                Vue.set(vm.other, "date", date_val);
            }
            console.log(vm.other);
            $.ajax({
                type: "post",
                url: "{:url('integral/attendance')}",
                data: {
                    'cont_reward': JSON.stringify(vm.cont_reward),
                    'is_open': vm.is_open,
                    'level': vm.level,
                    'frist_reward': vm.frist_reward,
                    'day_reward': vm.day_reward,
                    'other': JSON.stringify(vm.other),
                },
                success: function (data) {
                    flag = false;
                    if (data > 0) {
                        layer.msg('操作成功', {icon: 1, time: 1000}, function () {
                            //window.location.reload();
                        });
                    } else {
                        layer.msg('操作失败', {icon: 2, time: 1000});
                    }
                }
            });
        }
    }

    var vm = new Vue({
        el: '#main',
        data: {
            is_open: 0,
            level: 0,
            frist_reward: 1,
            day_reward: 1,
            cont_reward: [],
            other: {'date': '', 'title': '', 'reward': 0},
            show: false
        },
        created: function () {
            var that = this;
            that.show = true;
            if ('{$info.cont_reward}'.length > 0) {
                that.cont_reward = JSON.parse('{$info.cont_reward}');
            }
            that.day_reward = '{$info.day_reward|default=1}';
            that.frist_reward = '{$info.frist_reward|default=1}';
            that.is_open = '{$info.is_open|default=0}';
            that.level = '{$info.level|default=0}';
            if ('{$info.other}') {
                that.other = JSON.parse('{$info.other}');
                console.log(that.other)
            }
        },
        methods: {
            add_cont: function () {
                var that = this;
                console.log(that.cont_reward);
                console.log(that.other);
                that.cont_reward = that.cont_reward.concat([{'date': 2, 'reward': 1}]);
            },
            del_cont: function (index) {
                var that = this, arr = that.cont_reward, new_arr = [];
                for (var s = 0; s < arr.length; s++) {
                    if (s != index) {
                        new_arr.push(arr[s]);
                    }
                }
                that.cont_reward = new_arr;
            }

        }
    });

</script>
{/block}