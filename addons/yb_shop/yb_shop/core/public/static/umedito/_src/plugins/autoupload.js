UM.plugins["autoupload"]=function(){function getPasteImage(a){return a.clipboardData&&a.clipboardData.items&&1==a.clipboardData.items.length&&/^image\//.test(a.clipboardData.items[0].type)?a.clipboardData.items:null}function getDropImage(a){return a.dataTransfer&&a.dataTransfer.files?a.dataTransfer.files:null}var sendAndInsertImage,me=this;me.setOpt("pasteImageEnabled",!0),me.setOpt("dropFileEnabled",!0),sendAndInsertImage=function(file,editor){var xhr,fd=new FormData;fd.append(editor.options.imageFieldName||"upfile",file,file.name||"blob."+file.type.substr("image/".length)),fd.append("type","ajax"),xhr=new XMLHttpRequest,xhr.open("post",me.options.imageUrl,!0),xhr.setRequestHeader("X-Requested-With","XMLHttpRequest"),xhr.addEventListener("load",function(e){try{var json=eval("("+e.target.response+")"),link=json.url,picLink=me.options.imagePath+link;editor.execCommand("insertimage",{src:picLink,_src:picLink})}catch(er){}}),xhr.send(fd)},me.addListener("ready",function(){if(window.FormData&&window.FileReader){var a=function(a){var e,d,b=!1,c="paste"==a.type?getPasteImage(a.originalEvent):getDropImage(a.originalEvent);if(c){for(d=c.length;d--;)e=c[d],e.getAsFile&&(e=e.getAsFile()),e&&e.size>0&&/image\/\w+/i.test(e.type)&&(sendAndInsertImage(e,me),b=!0);if(b)return!1}};me.getOpt("pasteImageEnabled")&&me.$body.on("paste",a),me.getOpt("dropFileEnabled")&&me.$body.on("drop",a),me.$body.on("dragover",function(a){return"Files"==a.originalEvent.dataTransfer.types[0]?!1:void 0})}})};