UM.plugins["enterkey"]=function(){var a,b=this,c=b.options.enterTag;b.addListener("keyup",function(c,d){var h,f,g,i,k,j,l,e=d.keyCode||d.which;if(13==e)if(f=b.selection.getRange(),g=f.startContainer,browser.ie)b.fireEvent("saveScene",!0,!0);else{if(/h\d/i.test(a)){if(browser.gecko)i=domUtils.findParentByTagName(g,["h1","h2","h3","h4","h5","h6","blockquote","caption","table"],!0),i||(b.document.execCommand("formatBlock",!1,"<p>"),h=1);else if(1==g.nodeType){if(j=b.document.createTextNode(""),f.insertNode(j),k=domUtils.findParentByTagName(j,"div",!0)){for(l=b.document.createElement("p");k.firstChild;)l.appendChild(k.firstChild);k.parentNode.insertBefore(l,k),domUtils.remove(k),f.setStartBefore(j).setCursor(),h=1}domUtils.remove(j)}b.undoManger&&h&&b.undoManger.save()}browser.opera&&f.select()}}),b.addListener("keydown",function(d,e){var g,h,i,j,k,f=e.keyCode||e.which;if(13==f){if(b.fireEvent("beforeenterkeydown"))return domUtils.preventDefault(e),void 0;if(b.fireEvent("saveScene",!0,!0),a="",g=b.selection.getRange(),!g.collapsed&&(h=g.startContainer,i=g.endContainer,j=domUtils.findParentByTagName(h,"td",!0),k=domUtils.findParentByTagName(i,"td",!0),j&&k&&j!==k||!j&&k||j&&!k))return e.preventDefault?e.preventDefault():e.returnValue=!1,void 0;"p"==c&&(browser.ie||(h=domUtils.findParentByTagName(g.startContainer,["ol","ul","p","h1","h2","h3","h4","h5","h6","blockquote","caption"],!0),h||browser.opera?(a=h.tagName,"p"==h.tagName.toLowerCase()&&browser.gecko&&domUtils.removeDirtyAttr(h)):(b.document.execCommand("formatBlock",!1,"<p>"),browser.gecko&&(g=b.selection.getRange(),h=domUtils.findParentByTagName(g.startContainer,"p",!0),h&&domUtils.removeDirtyAttr(h)))))}}),browser.ie&&b.addListener("setDisabled",function(){$(b.body).find("p").each(function(a,b){domUtils.isEmptyBlock(b)&&(b.innerHTML="&nbsp;")})})};