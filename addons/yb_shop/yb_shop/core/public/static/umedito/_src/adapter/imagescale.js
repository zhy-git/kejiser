UM.registerUI("imagescale",function(){var b,a=this;a.setOpt("imageScaleEnabled",!0),browser.webkit&&a.getOpt("imageScaleEnabled")&&(a.addListener("click",function(c,d){var j,h,i,e=a.selection.getRange(),f=e.getClosedNode(),g=d.target;f&&"IMG"==f.tagName&&g==f?(b||(b=$.eduiscale({$wrap:a.$container}).css("zIndex",a.options.zIndex),a.$container.append(b),h=function(){b.edui().hide()},i=function(a){var b=a.target||a.srcElement;b&&-1==b.className.indexOf("edui-scale")&&h(a)},b.edui().on("aftershow",function(){$(document).bind("keydown",h),$(document).bind("mousedown",i),a.selection.getNative().removeAllRanges()}).on("afterhide",function(){$(document).unbind("keydown",h),$(document).unbind("mousedown",i);var c=b.edui().getScaleTarget();c.parentNode&&a.selection.getRange().selectNode(c).select()}).on("mousedown",function(c){a.selection.getNative().removeAllRanges();var d=c.target||c.srcElement;d&&-1==d.className.indexOf("edui-scale-hand")&&(j=setTimeout(function(){b.edui().hide()},200))}).on("mouseup",function(a){var b=a.target||a.srcElement;b&&-1==b.className.indexOf("edui-scale-hand")&&clearTimeout(j)})),b.edui().show($(f))):b&&"none"!=b.css("display")&&b.edui().hide()}),a.addListener("click",function(b,c){if("IMG"==c.target.tagName){var d=new dom.Range(a.document,a.body);d.selectNode(c.target).select()}}))});