UM.plugins["autosave"]=function(){function f(f){var g=null;if(!(new Date-b<c)){if(!f.hasContents())return d&&e.removeItem(d),void 0;b=new Date,f._saveFlag=null,g=a.body.innerHTML,f.fireEvent("beforeautosave",{content:g})!==!1&&(e.saveLocalData(d,g),f.fireEvent("afterautosave",{content:g}))}}var e,a=this,b=new Date,c=20,d=null;a.setOpt("saveInterval",500),e=UM.LocalStorage=function(){function c(){var a=document.createElement("div");return a.style.display="none",a.addBehavior?(a.addBehavior("#default#userdata"),{getItem:function(c){var d=null;try{document.body.appendChild(a),a.load(b),d=a.getAttribute(c),document.body.removeChild(a)}catch(e){}return d},setItem:function(c,d){document.body.appendChild(a),a.setAttribute(c,d),a.save(b),document.body.removeChild(a)},removeItem:function(c){document.body.appendChild(a),a.removeAttribute(c),a.save(b),document.body.removeChild(a)}}):null}var a=window.localStorage||c()||null,b="localStorage";return{saveLocalData:function(b,c){return a&&c?(a.setItem(b,c),!0):!1},getLocalData:function(b){return a?a.getItem(b):null},removeItem:function(b){a&&a.removeItem(b)}}}(),a.addListener("ready",function(){var b="-drafts-data",c=null;c=a.key?a.key+b:(a.container.parentNode.id||"ue-common")+b,d=(location.protocol+location.host+location.pathname).replace(/[.:\/]/g,"_")+c}),a.addListener("contentchange",function(){d&&(a._saveFlag&&window.clearTimeout(a._saveFlag),a.options.saveInterval>0?a._saveFlag=window.setTimeout(function(){f(a)},a.options.saveInterval):f(a))}),a.commands["clearlocaldata"]={execCommand:function(){d&&e.getLocalData(d)&&e.removeItem(d)},notNeedUndo:!0,ignoreContentChange:!0},a.commands["getlocaldata"]={execCommand:function(){return d?e.getLocalData(d)||"":""},notNeedUndo:!0,ignoreContentChange:!0},a.commands["drafts"]={execCommand:function(){d&&(a.body.innerHTML=e.getLocalData(d)||"<p>"+(browser.ie?"&nbsp;":"<br/>")+"</p>",a.focus(!0))},queryCommandState:function(){return d?null===e.getLocalData(d)?-1:0:-1},notNeedUndo:!0,ignoreContentChange:!0}};