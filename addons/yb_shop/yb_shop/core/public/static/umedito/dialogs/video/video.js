!function(){var a=UM.dom.domUtils,b="video";UM.registerWidget(b,{tpl:'<link rel="stylesheet" type="text/css" href="<%=video_url%>video.css" /><div class="edui-video-wrapper"><div id="eduiVideoTab"><div id="eduiVideoTabHeads" class="edui-video-tabhead"><span tabSrc="video" class="edui-video-focus"><%=lang_tab_insertV%></span></div><div id="eduiVideoTabBodys" class="edui-video-tabbody"><div id="eduiVideoPanel" class="edui-video-panel"><table><tr><td><label for="eduiVideoUrl" class="edui-video-url"><%=lang_video_url%></label></td><td><input id="eduiVideoUrl" type="text"></td></tr></table><div id="eduiVideoPreview"></div><div id="eduiVideoInfo"><fieldset><legend><%=lang_video_size%></legend><table><tr><td><label for="eduiVideoWidth"><%=lang_videoW%></label></td><td><input class="edui-video-txt" id="eduiVideoWidth" type="text"/></td></tr><tr><td><label for="eduiVideoHeight"><%=lang_videoH%></label></td><td><input class="edui-video-txt" id="eduiVideoHeight" type="text"/></td></tr></table></fieldset><fieldset><legend><%=lang_alignment%></legend><div id="eduiVideoFloat"></div></fieldset></div></div></div></div></div>',initContent:function(a,c){var d=this,e=a.getLang(b),f=UMEDITOR_CONFIG.UMEDITOR_HOME_URL+"dialogs/video/";d.lang=e,d.editor=a,d.$widget=c,d.root().html($.parseTmpl(d.tpl,$.extend({video_url:f},e["static"]))),d.initController(e)},initEvent:function(){var a=this,b=$("#eduiVideoUrl",a.$widget)[0];"oninput"in b?b.oninput=function(){a.createPreviewVideo(this.value)}:b.onpropertychange=function(){a.createPreviewVideo(this.value)}},initController:function(){var e,f,g,c=this,d=c.editor.selection.getRange().getClosedNode();c.createAlignButton(["eduiVideoFloat"]),d&&"edui-faked-video"==d.className&&($("#eduiVideoUrl",c.$widget)[0].value=e=d.getAttribute("_url"),$("#eduiVideoWidth",c.$widget)[0].value=d.width,$("#eduiVideoHeight",c.$widget)[0].value=d.height,f=a.getComputedStyle(d,"float"),g=a.getComputedStyle(d.parentNode,"text-align"),c.updateAlignButton("center"===g?"center":f)),c.createPreviewVideo(e)},createPreviewVideo:function(a){if(a){var b=this,c=b.lang,d=b.convert_url(a);return b.endWith(d,[".swf",".flv",".wmv"])?($("#eduiVideoPreview",b.$widget)[0].innerHTML='<embed type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" src="'+a+'"'+' width="'+420+'"'+' height="'+280+'"'+' wmode="transparent" play="true" loop="false" menu="false" allowscriptaccess="never" allowfullscreen="true" ></embed>',void 0):($("#eduiVideoPreview",b.$widget).html(c.urlError),void 0)}},insertSingle:function(){var a=this,b=$("#eduiVideoWidth",a.$widget)[0],c=$("#eduiVideoHeight",a.$widget)[0],d=$("#eduiVideoUrl",a.$widget)[0].value,e=this.findFocus("eduiVideoFloat","name");return d?a.checkNum([b,c])?(this.editor.execCommand("insertvideo",{url:a.convert_url(d),width:b.value,height:c.value,align:e}),void 0):!1:!1},convert_url:function(a){if(!a)return"";var b=a.match(/youtu.be\/(\w+)$/)||a.match(/youtube\.com\/watch\?v=(\w+)/)||a.match(/youtube.com\/v\/(\w+)/),c=a.match(/youku\.com\/v_show\/id_(\w+)/),d=/player\.youku\.com/gi.test(a);return a=d?a.replace(/\?f=.*/,""):b?"https://www.youtube.com/v/"+b[1]+"?version=3&feature=player_embedded":c?"http://player.youku.com/player.php/sid/"+c[1]+"/v.swf":a.replace(/http:\/\/www\.tudou\.com\/programs\/view\/([\w\-]+)\/?/i,"http://www.tudou.com/v/$1").replace(/http:\/\/www\.youtube\.com\/watch\?v=([\w\-]+)/i,"http://www.youtube.com/v/$1").replace(/http:\/\/v\.youku\.com\/v_show\/id_([\w\-=]+)\.html/i,"http://player.youku.com/player.php/sid/$1").replace(/http:\/\/www\.56\.com\/u\d+\/v_([\w\-]+)\.html/i,"http://player.56.com/v_$1.swf").replace(/http:\/\/www.56.com\/w\d+\/play_album\-aid\-\d+_vid\-([^.]+)\.html/i,"http://player.56.com/v_$1.swf").replace(/http:\/\/v\.ku6\.com\/.+\/([^.]+)\.html/i,"http://player.ku6.com/refer/$1/v.swf").replace(/\?f=.*/,"")},checkNum:function(a){var d,c,e,b=this;for(c=0;d=a[c++];)if(e=d.value,!b.isNumber(e)&&e)return alert(b.lang.numError),d.value="",d.focus(),!1;return!0},isNumber:function(a){return/(0|^[1-9]\d*$)/.test(a)},updateAlignButton:function(a){var d,c,b=$("#eduiVideoFloat",this.$widget)[0].children;for(c=0;d=b[c++];)d.getAttribute("name")==a?"edui-video-focus"!=d.className&&(d.className="edui-video-focus"):"edui-video-focus"==d.className&&(d.className="")},createAlignButton:function(a){var e,d,f,g,h,i,b=this.lang,c=UMEDITOR_CONFIG.UMEDITOR_HOME_URL+"dialogs/video/";for(d=0;e=a[d++];){f=$("#"+e,this.$widget)[0],g={none:b["default"],left:b.floatLeft,right:b.floatRight};for(h in g)i=document.createElement("div"),i.setAttribute("name",h),"none"==h&&(i.className="edui-video-focus"),i.style.cssText="background:url("+c+"images/"+h+"_focus.jpg);",i.setAttribute("title",g[h]),f.appendChild(i);this.switchSelect(e)}},switchSelect:function(a){var d,c,b=$("#"+a,this.$widget)[0].children;for(c=0;d=b[c++];)$(d).on("click",function(){for(var c,a=0;c=b[a++];)c.className="",c.removeAttribute&&c.removeAttribute("class");this.className="edui-video-focus"})},findFocus:function(a,b){var d,f,e,c=$("#"+a,this.$widget)[0].children;for(e=0;f=c[e++];)if("edui-video-focus"==f.className){d=f.getAttribute(b);break}return d},endWith:function(a,b){var c,d,e;for(c=0,d=b.length;d>c;c++){if(e=b[c],a.length-e.length<0)return!1;if(a.substring(a.length-e.length)==e)return!0}return!1},width:610,height:498,buttons:{ok:{exec:function(a,c){$("#eduiVideoPreview",c).html(""),a.getWidgetData(b).insertSingle()}},cancel:{exec:function(){$("#eduiVideoPreview").html("")}}}})}();