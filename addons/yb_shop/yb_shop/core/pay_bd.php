<?php
 error_reporting(0); define("\x49\x4e\x5f\x49\101", ''); define("\111\x41\137\x52\117\117\x54", ''); date_default_timezone_set("\x41\x73\x69\141\x2f\143\x68\x6f\x6e\147\161\151\x6e\x67"); define("\x41\x50\x50\x5f\x50\101\124\x48", __DIR__ . "\x2f\x61\x70\160\154\151\x63\x61\x74\151\157\156\x2f"); define("\103\x4f\x4e\x46\x5f\x50\101\124\x48", APP_PATH); require __DIR__ . "\x2f\164\150\x69\156\x6b\160\x68\160\x2f\142\141\163\x65\56\x70\x68\160"; require __DIR__ . "\57\141\x70\160\x6c\151\143\141\164\x69\157\x6e\57\x61\x64\155\x69\156\57\163\x65\x72\x76\x69\x63\145\57\101\x6c\151\x79\x75\156\x53\145\162\x76\x69\x63\145\x2e\x70\x68\x70"; require __DIR__ . "\57\141\160\160\154\x69\143\141\x74\151\x6f\156\x2f\141\x64\155\151\x6e\57\x73\x65\x72\x76\x69\x63\145\57\x50\x72\151\156\x74\145\x72\x53\145\162\166\x69\143\145\56\160\150\x70"; use app\admin\service\PrinterService; use app\admin\service\AliyunService; use think\config; use think\Db; use think\Log; goto gfctM; gRky2: Db::startTrans(); goto yV_F3; e7TLA: $data_jf["\151\156\x74\145\x67\x72\x61\154"] = $jifen; goto JQAcJ; gPEBn: $b = json_decode($b, true); goto J8MY2; o6Fhv: $data = array("\x6f\162\x64\145\162\x5f\x73\x74\x61\164\165\163" => 1, "\x70\x61\x79\x5f\163\164\x61\164\165\x73" => 1, "\x70\x61\x79\x5f\x74\x79\160\x65" => 1, "\160\141\x79\137\164\151\155\x65" => time()); goto DXOAO; sL1zB: Db::name("\x79\142\163\143\x5f\151\x6e\x74\x65\147\162\x61\x6c\x5f\x64\145\x74\141\x69\154")->insert($data_jf); goto zyf5f; OhLNe: $jf_all = round($jifen) + intval($c["\x63\157\156\x73\165\x6d\145"]); goto Up8HJ; YVpJP: $new_data["\x63\x6f\156\x73\165\155\145"] = $jf_all; goto Co3b4; QHla7: $data_jf["\x6d\x63\x68\137\151\144"] = $a["\x6d\x63\x68\x5f\151\x64"]; goto fkGkZ; Co3b4: $new_data["\x69\156\164\x65\x67\x72\x61\154"] = round($jifen) + intval($c["\x69\156\x74\x65\x67\x72\x61\154"]); goto LjrD5; gEa11: error_reporting(0); goto mOxnG; DXOAO: $data_pay = array("\x70\x61\x79\x5f\163\164\141\164\x75\163" => 1, "\160\x61\171\x5f\164\x69\155\x65" => time()); goto AhK5O; fcPCB: $new_data["\154\145\166\145\154\x5f\151\144"] = $d[$i]["\x69\144"]; goto YVpJP; rbV_w: $data_jf["\x75\163\x65\x72\137\x69\144"] = $a["\142\165\x79\x65\162\137\x69\144"]; goto e7TLA; Up8HJ: $d = Db::name("\171\x62\x73\x63\x5f\x75\x73\145\162\137\x6c\145\166\x65\x6c")->where("\x6d\143\x68\137\x69\x64", $a["\x6d\x63\150\x5f\x69\144"])->order("\x68\151\x65\x72\x61\x72\x63\150\171", "\144\x65\163\143")->select(); goto WbKTi; iuz6x: if (!$a) { goto VcTtj; } goto s6zpX; p2s3F: $jifen = floor(floatval($order_money) / floatval($b["\143\157\156\x73\x5f\155\x6f\x6e\145\x79"])) * floatval($b["\x63\157\156\163\x5f\151\x6e\164\x65\x67\162\141\154"]); goto N4cG7; s6zpX: $pp = new PrinterService($a["\155\143\150\x5f\151\144"], $a["\157\162\144\x65\x72\x5f\x69\x64"], "\160\x61\x79", 0); goto gQA_F; zroyX: $i = 0; goto TByf3; wPw8h: if (!($i < count($d))) { goto zz1XC; } goto oWbkl; THcwu: $b = Db::name("\171\142\163\143\137\151\x6e\164\145\147\x72\141\154\x5f\162\165\154\145")->where("\x6d\x63\150\137\x69\144", $a["\155\x63\150\137\x69\x64"])->value("\144\x61\x74\141"); goto niKlK; gfctM: $filename = APP_PATH . "\144\141\164\x61\142\x61\163\x65\x2e\160\150\160"; goto uVo8j; mtLAz: if (!$b) { goto cDrmz; } goto gPEBn; gQA_F: $pp->print_order(); goto THcwu; fkGkZ: $data_jf["\157\x72\144\145\162\137\151\x64"] = $a["\x6f\x72\x64\x65\162\137\151\144"]; goto sL1zB; mOxnG: $out_trade_no = $_POST["\x6f\162\144\145\162\111\144"]; goto Umk3U; eKdiY: zz1XC: goto VgKCJ; lhNMB: $push_config = array("\141\x70\160\x69\x64" => "\114\x54\101\x49\x41\x36\145\161\x75\x77\123\x79\153\123\103\x4b", "\163\x65\x63\x72\145\x74" => "\62\x4f\124\161\x6f\x59\123\x55\62\130\x56\132\x65\62\x38\143\146\151\x4a\x70\152\153\x31\x46\x44\x33\102\x45\x71\131", "\x61\160\160\x6b\145\x79" => "\62\x34\71\x36\65\71\63\64"); goto gEa11; f5AhE: vOYai: goto F_rxx; ROvEp: goto zUuKR; goto eKdiY; mm82V: $a = Db::name("\171\142\163\x63\x5f\x6f\x72\x64\x65\162")->where(["\x6f\165\164\x5f\x74\162\x61\x64\145\x5f\x6e\157" => $out_trade_no, "\x6f\x72\x64\x65\162\x5f\163\x74\x61\x74\x75\163" => 0])->find(); goto iuz6x; JQAcJ: $data_jf["\143\x6f\156\x73\165\x6d\x65"] = $jifen; goto QHla7; J8MY2: if (!($b["\143\157\x6e\x73\x5f\x73\164\141\x74\165\163"] == 1)) { goto YFEct; } goto OPvdg; VgKCJ: zC5Sf: goto xLSRS; niKlK: $jifen = 0; goto mtLAz; WbKTi: if (!$d) { goto zC5Sf; } goto zroyX; FdWo2: VcTtj: goto gRky2; ON0IC: cDrmz: goto FdWo2; VlrLi: exit; goto cSFf4; OPvdg: $order_money = $a["\x6f\x72\144\x65\162\137\155\x6f\156\145\171"]; goto p2s3F; TByf3: zUuKR: goto wPw8h; cSFf4: wXwn2: goto o6Fhv; oWbkl: if (!($jf_all >= $d[$i]["\150\151\x65\162\141\x72\x63\x68\x79"])) { goto vOYai; } goto fcPCB; LjrD5: Db::name("\x79\142\x73\143\137\x75\163\145\x72")->where("\x75\151\144", $a["\142\165\171\x65\x72\137\151\x64"])->update($new_data); goto rbV_w; UjdnM: $i++; goto ROvEp; uVo8j: Config::load($filename, "\x64\141\x74\141\x62\141\x73\x65"); goto lhNMB; Umk3U: if (!empty($out_trade_no)) { goto wXwn2; } goto VlrLi; zyf5f: goto zz1XC; goto f5AhE; F_rxx: kzbYp: goto UjdnM; N4cG7: $c = Db::name("\171\x62\163\143\137\x75\x73\x65\x72")->where("\x75\x69\144", $a["\x62\165\171\x65\x72\x5f\x69\x64"])->find(); goto OhLNe; xLSRS: YFEct: goto ON0IC; AhK5O: $data_jf = array("\x74\151\x6d\x65" => time(), "\x69\x74\x79\x70\x65" => 1, "\143\x74\x79\x70\145" => 1, "\x65\x78\160\x6c\x61\151\x6e" => "\xe6\xb6\x88\xe8\xb4\271"); goto mm82V; yV_F3: try { goto RLJPi; Ue7im: Db::name("\x79\142\x73\143\x5f\157\162\144\x65\162\x5f\x70\x61\171\x6d\x65\x6e\x74")->where(["\x6f\165\x74\x5f\164\162\141\144\x65\x5f\156\157" => $out_trade_no, "\160\141\171\137\163\164\141\164\x75\163" => 0])->update($data_pay); goto sg0mx; XimhO: if (!(!empty($res) && $res > 0)) { goto d7mIQ; } goto rb4wx; jBb3l: $aliyun = new AliyunService(); goto AROQq; sg0mx: Db::commit(); goto XimhO; CzoIG: $alias = md5($data["\165\x72\x6c"] . $data["\165\x73\x65\162\156\x61\x6d\x65"] . $data["\165\x6e\151\141\x63\151\x64"]); goto jBb3l; lzBDT: Log::write($out_trade_no . "\54\xe6\224\257\xe4\xbb\230\xe7\212\266\346\200\x81\xe6\x9b\264\346\x94\271\xe6\x88\x90\345\x8a\237", "\163\150\x6f\160\137\x70\x61\x79\x5f\163\164\141\164\x65\137\x63\x68\x61\x6e\x67\x65\137\163\x75\x63\143\x65\x73\x73"); goto apPdq; KIdA6: $data["\165\156\151\141\143\151\144"] = $user["\165\x6e\151\x61\x63\151\x64"]; goto CzoIG; AROQq: $aliyun->push($push_config, $alias); goto lzBDT; F9jxW: $mid = $order["\x6d\x63\x68\137\x69\144"]; goto SEDmb; SEDmb: $user = Db::name("\x79\142\x73\143\x5f\142\x75\163\151\x6e\145\163\163")->where(["\x69\144" => $mid])->find(); goto PV8D2; rHAlf: $un_url = explode("\72", $un_data["\x75\162\154"]); goto HfUOs; HfUOs: $data["\165\162\x6c"] = $un_url[0]; goto RuCMl; apPdq: d7mIQ: goto t93e4; rb4wx: $order = Db::name("\x79\142\163\143\x5f\x6f\x72\144\x65\x72")->where(["\157\x75\x74\x5f\164\162\x61\144\145\137\x6e\157" => $out_trade_no])->find(); goto F9jxW; RuCMl: $data["\x75\163\145\162\x6e\141\155\145"] = $user["\x6e\x61\x6d\x65"]; goto KIdA6; RLJPi: $res = Db::name("\171\x62\163\x63\x5f\157\x72\144\x65\x72")->where(["\157\x75\164\x5f\x74\162\x61\x64\x65\137\156\x6f" => $out_trade_no, "\157\x72\x64\145\x72\x5f\163\164\141\164\165\163" => 0])->update($data); goto Ue7im; PV8D2: $un_data["\165\162\x6c"] = $_SERVER["\110\124\x54\x50\137\x48\117\x53\x54"]; goto rHAlf; t93e4: } catch (\Exception $e) { Db::rollback(); Log::write($out_trade_no . "\x2c\xe6\224\257\xe4\273\230\xe7\x8a\xb6\346\x80\x81\xe6\x9b\264\346\224\271\xe5\xa4\xb1\xe8\xb4\xa5" . $e, "\x73\x68\x6f\x70\137\160\x61\171\137\163\x74\x61\x74\x65\x5f\x63\150\141\156\x67\x65\x5f\x66\x61\x69\x6c"); }
