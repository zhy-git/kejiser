<?php
 namespace app\common\model; use think\Model; use think\Db; use think\Validate; use think\Loader; class Base extends Model { protected $error = 0; protected $name; protected $rule = array(); protected $msg = array(); protected $Validate; public function __construct($data = array()) { goto pmdLc; Whivu: $this->Validate = new Validate($this->rule, $this->msg); goto tHltC; pmdLc: parent::__construct($data); goto Whivu; tHltC: $this->Validate->extend("\156\157\x5f\x68\x74\155\154\137\160\x61\x72\163\x65", function ($value, $rule) { return true; }); goto eO0Cy; eO0Cy: } public function getEModel($names) { goto CwLDd; udWdM: CNjQK: goto rIl6n; rIl6n: e5TW2: goto Zu62D; hyVX7: if (!$rs) { goto e5TW2; } goto Jbpvm; Zu62D: return $obj; goto UpZYB; Eej06: $obj = []; goto hyVX7; CwLDd: $rs = Db::query("\163\150\157\x77\x20\x63\157\x6c\165\x6d\x6e\x73\x20\106\122\117\115\40\x60" . config("\x64\141\164\x61\142\141\163\145\x2e\160\x72\x65\146\151\x78") . $names . "\140"); goto Eej06; Jbpvm: foreach ($rs as $key => $v) { goto j3aVJ; mw5De: CuJYq: goto MkL46; s6M6j: if (!($v["\x4b\x65\171"] == "\120\122\x49")) { goto aBans; } goto A935h; j3aVJ: $obj[$v["\106\151\145\154\144"]] = $v["\x44\x65\146\141\165\154\164"]; goto s6M6j; c8tPh: aBans: goto mw5De; A935h: $obj[$v["\x46\x69\145\x6c\x64"]] = 0; goto c8tPh; MkL46: } goto udWdM; UpZYB: } public function save($data = array(), $where = array(), $sequence = null) { goto tFNsm; dPSwB: Ih5Yh: goto XRAb0; T_Nlu: $retval = 1; goto AVvmR; OJgTL: $retval = parent::save($data, $where, $sequence); goto fh_pv; bpXPq: if (!($retval == 0)) { goto Ih5Yh; } goto fF4D7; fF4D7: if (!($retval !== false)) { goto rrDy9; } goto T_Nlu; FjjW_: return $retval; goto krJF7; tFNsm: $data = $this->htmlClear($data); goto OJgTL; AVvmR: rrDy9: goto dPSwB; fh_pv: if (empty($where)) { goto dMnMq; } goto bpXPq; XRAb0: dMnMq: goto FjjW_; krJF7: } public function ihtmlspecialchars($string) { goto fQ04c; kMkJX: foreach ($string as $key => $val) { $string[$key] = $this->ihtmlspecialchars($val); p40vF: } goto xrCeU; xrCeU: RUxYj: goto AIotv; fQ04c: if (is_array($string)) { goto de3Vj; } goto Shr7f; EK4f0: return $string; goto xjFXD; tK7gn: de3Vj: goto kMkJX; mpqkA: goto DbWOb; goto tK7gn; Shr7f: $string = preg_replace("\x2f\x26\x61\155\160\x3b\50\x28\43\50\x64\173\x33\x2c\x35\x7d\x7c\x78\133\x61\x2d\x66\141\x2d\x66\60\x2d\71\135\x7b\x34\175\x29\174\x5b\x61\55\x7a\x61\55\x7a\135\133\x61\x2d\x7a\60\x2d\x39\135\x7b\62\54\x35\175\51\73\x29\57", "\46\x5c\x31", str_replace(array("\46", "\x22", "\x3c", "\76"), array("\x26\141\x6d\160\73", "\x26\x71\x75\157\x74\x3b", "\46\154\164\73", "\46\147\x74\73"), $string)); goto mpqkA; AIotv: DbWOb: goto EK4f0; xjFXD: } protected function htmlClear($data) { goto x9XZ5; sAeVj: $info = empty($rule) ? $this->Validate : $rule; goto KENc_; KENc_: foreach ($data as $k => $v) { goto R31Ba; EuSyC: goto TVP1N; goto ZiFHw; VwKu2: if (is_array($info)) { goto YKgB8; } goto EuSyC; jEeQX: $data[$k] = $v; goto fNbXi; fNbXi: goto S7a40; goto kzDHZ; kzDHZ: N2YTG: goto Ljxu9; Ljxu9: $data[$k] = $this->ihtmlspecialchars($v); goto jNggP; Dni91: phStR: goto pim7F; JQJea: T13DW: goto Dni91; vekno: if ($is_Specialchars) { goto N2YTG; } goto jEeQX; DF3Fk: TVP1N: goto JQJea; ZiFHw: YKgB8: goto xTCYO; R31Ba: if (empty($info)) { goto T13DW; } goto VwKu2; xTCYO: $is_Specialchars = $this->is_Specialchars($info, $k); goto vekno; jNggP: S7a40: goto DF3Fk; pim7F: } goto ltqKO; ltqKO: Q81q4: goto OTRVm; OTRVm: return $data; goto FqO5D; x9XZ5: $rule = $this->rule; goto sAeVj; FqO5D: } protected function is_Specialchars($rule, $k) { goto VMWNo; VMWNo: $is_have = true; goto M5S_A; hNO_e: vqhJp: goto g7bvV; g7bvV: return $is_have; goto IQXtW; M5S_A: foreach ($rule as $key => $value) { goto HCEzf; z_edB: $is_have = false; goto n_wdd; n_wdd: goto XtOAM; goto JsIcB; X9olE: XtOAM: goto uGGfW; uGGfW: tNIjX: goto E8BnN; E8BnN: iIFcP: goto GR9p6; HCEzf: if (!($key == $k)) { goto tNIjX; } goto bofP2; bofP2: if (strcasecmp($value, "\x6e\157\x5f\x68\x74\155\x6c\137\x70\x61\x72\x73\145") != 0) { goto cRKmk; } goto z_edB; JsIcB: cRKmk: goto WCEaN; WCEaN: $is_have = true; goto X9olE; GR9p6: } goto hNO_e; IQXtW: } public function startTrans() { Db::startTrans(); } public function commit() { Db::commit(); } public function rollback() { Db::rollback(); } public function pageQuery($page_index, $page_size, $condition, $order, $field) { goto Vdzvo; Vdzvo: $count = $this->where($condition)->count(); goto Vp7LS; LR1ml: return array("\144\141\164\141" => $list, "\x74\157\164\x61\x6c\x5f\143\157\x75\156\164" => $count, "\x70\x61\147\145\x5f\x63\x6f\165\x6e\x74" => $page_count); goto mArDY; Z8iSB: if ($count % $page_size == 0) { goto CzZmP; } goto BqKLg; dEtDW: goto CxBzi; goto BKrsY; yFddk: $start_row = $page_size * ($page_index - 1); goto m5f3o; BqKLg: $page_count = (int) ($count / $page_size) + 1; goto o2sDM; EUzXe: $page_count = 1; goto k_YVx; RK832: CKryZ: goto dEtDW; m5f3o: $list = $this->field($field)->where($condition)->order($order)->limit($start_row . "\x2c" . $page_size)->select(); goto Z8iSB; BKrsY: BYbAV: goto MPG99; aJlnX: $page_count = $count / $page_size; goto RK832; o2sDM: goto CKryZ; goto kkuq3; k_YVx: CxBzi: goto LR1ml; MPG99: $list = $this->field($field)->where($condition)->order($order)->select(); goto EUzXe; Vp7LS: if ($page_size == 0) { goto BYbAV; } goto yFddk; kkuq3: CzZmP: goto aJlnX; mArDY: } public function getQuerys($condition, $field, $order) { $list = $this->field($field)->where($condition)->order($order)->select(); return $list; } public function getAdminLisy($condition, $search_text) { $list = $this->alias("\x61")->join("\x79\142\164\x63\137\x61\x64\155\x69\156\x5f\x72\x6f\154\x65\40\x72", "\x61\x2e\x72\157\154\x65\137\x69\x64\x5f\141\x72\162\x61\171\x3d\x72\56\162\x6f\154\145\x5f\x69\144")->field("\x61\56\x75\x73\145\162\x5f\156\x61\x6d\x65\54\141\56\151\x64\x2c\141\x2e\x69\x73\x5f\141\x64\x6d\x69\x6e\x2c\141\x2e\141\x64\155\151\156\137\163\x74\x61\x74\165\163\54\141\x2e\x69\156\x66\157\x2c\x61\56\143\162\145\x61\x74\145\x5f\x74\151\x6d\x65\54\x72\x2e\162\x6f\x6c\145\137\156\141\155\x65")->where($condition)->paginate(20, false, $config = ["\x71\165\145\162\x79" => ["\x73\145\x61\162\x63\150\x5f\x74\x65\x78\164" => $search_text]]); return $list; } public function getPageLisy($condition, $search_text, $order = '') { goto Eep_Z; uU0tL: if ($order == '') { goto L2ztD; } goto bHh52; mqN62: $url = explode("\75\57", $url); goto djFnd; uhZdA: $list = $this->where($condition)->paginate(20, false, $config = ["\x71\x75\x65\x72\x79" => ["\163" => $url, "\x73\145\x61\162\x63\150\137\x74\145\x78\164" => $search_text]]); goto kiiyc; Eep_Z: $url = request()->query(); goto mqN62; zbacQ: L2ztD: goto uhZdA; rz2SZ: return $list; goto eso8h; rowsQ: goto KZFpY; goto zbacQ; kiiyc: KZFpY: goto rz2SZ; ttlkT: $url = "\x2f" . $url[0]; goto uU0tL; djFnd: $url = explode("\x26", $url[1]); goto ttlkT; bHh52: $list = $this->where($condition)->order($order)->paginate(20, false, $config = ["\161\165\145\162\171" => ["\x73" => $url, "\x73\145\141\x72\x63\x68\137\x74\x65\170\x74" => $search_text]]); goto rowsQ; eso8h: } public function viewPageQuery($viewObj, $page_index, $page_size, $condition, $order) { goto upcSO; FjoBV: $list = $viewObj->where($condition)->order($order)->limit($start_row . "\x2c" . $page_size)->select(); goto Cwdg5; MjQxW: mJjCI: goto O3_C9; upcSO: if ($page_size == 0) { goto OMx79; } goto weNDi; Ik2D4: $list = $viewObj->where($condition)->order($order)->select(); goto MjQxW; O3_C9: return $list; goto Zk9QD; Cwdg5: goto mJjCI; goto tGBwZ; weNDi: $start_row = $page_size * ($page_index - 1); goto FjoBV; tGBwZ: OMx79: goto Ik2D4; Zk9QD: } public function viewCount($viewObj, $condition) { $count = $viewObj->where($condition)->count(); return $count; } public function setReturnList($list, $count, $page_size) { goto LXz3S; Estqz: PSUqX: goto W0D27; UkoTU: goto gLtk9; goto Estqz; T0U0M: if ($count % $page_size == 0) { goto PSUqX; } goto ymnw0; PbQN5: return array("\144\141\164\141" => $list, "\164\157\164\x61\154\x5f\143\x6f\x75\156\164" => $count, "\x70\141\x67\x65\137\x63\x6f\x75\156\164" => $page_count); goto oO2wx; P3Tzd: QgGYX: goto rCaB9; cO3LZ: BRDqT: goto PbQN5; LXz3S: if ($page_size == 0) { goto QgGYX; } goto T0U0M; W0D27: $page_count = $count / $page_size; goto ZCaQO; TJCvF: goto BRDqT; goto P3Tzd; ZCaQO: gLtk9: goto TJCvF; rCaB9: $page_count = 1; goto cO3LZ; ymnw0: $page_count = (int) ($count / $page_size) + 1; goto UkoTU; oO2wx: } public function getInfo($condition = '', $field = "\x2a") { $info = Db::name($this->name)->where($condition)->field($field)->find(); return $info; } public function getCount($condition) { $count = Db::name($this->name)->where($condition)->count(); return $count; } public function getSum($condition, $field) { goto P9D97; M68B0: b22HE: goto YhzmR; P9D97: $sum = Db::name($this->name)->where($condition)->sum($field); goto pEvQH; bYzHX: return $sum; goto q2lW1; In_BO: return 0; goto M68B0; CgnaZ: bcZLq: goto In_BO; q2lW1: goto b22HE; goto CgnaZ; pEvQH: if (empty($sum)) { goto bcZLq; } goto bYzHX; YhzmR: } public function getMax($condition, $field) { goto bGRab; ACKrp: return $max; goto VK4en; bGRab: $max = Db::name($this->name)->where($condition)->max($field); goto A6tWr; xYOFj: return 0; goto lviFT; A6tWr: if (empty($max)) { goto kFH8b; } goto ACKrp; VK4en: goto EEjBD; goto rULNC; lviFT: EEjBD: goto XduzK; rULNC: kFH8b: goto xYOFj; XduzK: } public function getMin($condition, $field) { goto gfreC; F3Soc: KORYk: goto c2mc3; gfreC: $min = Db::name($this->name)->where($condition)->min($field); goto KnpEa; UGmj5: return $min; goto MTHK1; MTHK1: goto gFtlp; goto F3Soc; cGQ_Z: gFtlp: goto MOJGJ; c2mc3: return 0; goto cGQ_Z; KnpEa: if (empty($min)) { goto KORYk; } goto UGmj5; MOJGJ: } public function getAvg($condition, $field) { goto KI6oe; KI6oe: $avg = Db::name($this->name)->where($condition)->avg($field); goto qWt6_; CMV8U: goto QH2Vw; goto JL0TC; nOpJd: QH2Vw: goto yJWny; LB2bQ: return $avg; goto CMV8U; qWt6_: if (empty($avg)) { goto BI0cE; } goto LB2bQ; JL0TC: BI0cE: goto E0X_7; E0X_7: return 0; goto nOpJd; yJWny: } public function getFirstData($condition, $order) { goto N50E_; gT35M: LQ3tx: goto uBM78; eFuHX: return $data[0]; goto gT35M; XMMvP: InZeO: goto eFuHX; FECNr: return ''; goto z9i2F; N50E_: $data = Db::name($this->name)->where($condition)->order($order)->limit(1)->select(); goto vRQZJ; vRQZJ: if (!empty($data)) { goto InZeO; } goto FECNr; z9i2F: goto LQ3tx; goto XMMvP; uBM78: } public function ModifyTableField($pk_name, $pk_id, $field_name, $field_value) { goto SiUmg; V7mUk: $res = $this->save($data, [$pk_name => $pk_id]); goto iRndb; SiUmg: $data = array($field_name => $field_value); goto V7mUk; iRndb: return $res; goto jH742; jH742: } }
