<?php
 namespace app\web\service; use think\Controller; use think\session; use think\Db; class Wechat extends Controller { protected $appid = "\x77\x78\x30\60\x37\x38\63\x35\143\x33\x63\x38\63\141\65\x37\70\65"; protected $appsecret = "\x63\141\71\x61\145\x34\60\145\67\x31\x39\x65\61\x61\61\62\66\142\x63\x66\146\x38\70\x35\x38\x64\144\145\x61\x62\x34\67"; public function __construct() { goto C5G5O; fjSOj: if (empty($account_wechats)) { goto uQnzq; } goto H3w9i; dyt20: $wechats = Db::name("\171\142\x73\x63\x5f\167\x65\x63\150\x61\x74\x73")->where("\x6d\143\150\x5f\151\x64", $mch_id)->find(); goto fl3Dr; UMONY: uQnzq: goto eFuIA; H3w9i: $this->appid = $account_wechats["\153\x65\x79"]; goto uYD8v; fl3Dr: if (empty($wechats)) { goto Wf1Wc; } goto eRfTm; C5G5O: $mch_id = Session::get("\x6d\143\150\x5f\x69\144"); goto dyt20; eFuIA: Wf1Wc: goto p9C5G; eRfTm: $account_wechats = Db::name("\x61\143\143\157\165\156\164\x5f\x77\145\143\x68\141\x74\x73")->where("\x75\x6e\x69\x61\143\x69\x64", $wechats["\x61\x63\x63\x6f\165\x6e\x74\x5f\x77\145\143\150\x61\x74\163\x5f\x75\x6e\151\x61\143\x69\x64"])->find(); goto fjSOj; uYD8v: $this->appsecret = $account_wechats["\x73\x65\143\162\x65\x74"]; goto UMONY; p9C5G: } public function accredit($redirect_url) { goto rv16W; rv16W: $redirect_url = urlencode($redirect_url); goto KaYgC; KaYgC: $url = "\150\164\164\x70\x73\72\x2f\57\157\160\x65\x6e\x2e\167\145\151\170\x69\156\x2e\x71\161\56\143\x6f\155\x2f\143\x6f\x6e\x6e\x65\x63\164\x2f\x6f\x61\165\164\150\62\57\x61\x75\x74\x68\157\162\x69\x7a\145\77\141\160\160\x69\x64\75{$this->appid}\46\x72\x65\144\151\162\x65\x63\x74\137\165\x72\x69\x3d{$redirect_url}\46\x72\145\x73\x70\157\x6e\x73\145\x5f\164\171\x70\145\x3d\x63\157\x64\x65\46\x73\143\x6f\160\x65\75\163\156\x73\x61\160\151\137\x75\163\145\162\x69\156\146\x6f\x26\163\x74\x61\x74\x65\75\60\43\167\x65\x63\150\141\164\x5f\x72\145\x64\151\x72\x65\143\x74"; goto buzUR; buzUR: header("\x4c\x6f\143\141\164\x69\157\156\72{$url}"); goto dYtyG; dYtyG: } public function getAccessToken($code) { goto T0qIn; a2DmV: $res = file_get_contents($url); goto kTXz0; kTXz0: $access_token = json_decode($res, true); goto y0_xq; T0qIn: $url = "\x68\x74\x74\160\x73\72\57\57\141\160\151\x2e\x77\x65\x69\x78\151\156\x2e\x71\161\x2e\x63\x6f\155\x2f\x73\156\x73\57\157\141\165\x74\x68\62\x2f\x61\143\143\145\163\x73\x5f\164\157\153\x65\156\77\x61\x70\x70\151\144\x3d{$this->appid}\46\163\145\143\x72\x65\164\75{$this->appsecret}\46\x63\x6f\x64\145\x3d{$code}\x26\147\x72\141\156\164\137\x74\x79\160\145\75\141\165\x74\x68\157\162\x69\x7a\141\164\x69\x6f\x6e\137\x63\x6f\144\x65"; goto a2DmV; y0_xq: return $access_token; goto qjINi; qjINi: } public function getWeChatUserInfo($access_token, $openid) { goto MfCdP; uRUah: $output = file_get_contents($url); goto x5weg; x5weg: $weChatUserInfo = json_decode($output, true); goto yhsSY; MfCdP: $url = "\150\x74\x74\x70\163\x3a\57\x2f\141\x70\151\x2e\167\x65\x69\x78\x69\x6e\x2e\161\161\56\143\x6f\x6d\57\x73\156\163\x2f\165\x73\145\x72\151\156\x66\157\77\x61\143\143\145\163\x73\137\164\x6f\x6b\x65\156\75{$access_token}\x26\157\x70\x65\156\151\x64\75{$openid}\46\x6c\x61\x6e\147\75\172\x68\137\103\116"; goto uRUah; yhsSY: return $weChatUserInfo; goto IXiFR; IXiFR: } }
