<?php
 namespace app\admin\service; use app\common\model\Hooks; class Addons extends Base { function __construct() { parent::__construct(); $this->addons = new \app\common\model\Addons(); } public function getAddonsList($condition = '', $order = '', $field = "\52") { goto dWi47; E32nM: foreach ($list as $key => $value) { $list[$key] = $value->toArray(); x2Kxp: } goto zsC7C; zwHJD: $dirs = array_map("\142\141\163\x65\x6e\141\x6d\145", glob($addon_dir . "\52", GLOB_ONLYDIR)); goto S1U89; HY1z2: $list = $sys_addons->getQuerys($where, "\52", "\143\x72\x65\x61\x74\145\x5f\x74\151\x6d\x65\x20\x64\x65\163\x63"); goto E32nM; H3ZJB: $this->error = "\346\217\222\344\xbb\xb6\xe7\233\xae\xe5\xbd\225\xe4\xb8\215\xe5\x8f\257\xe8\xaf\273\xe6\210\x96\350\200\205\344\xb8\215\xe5\xad\x98\345\x9c\250"; goto in9pR; in9pR: return FALSE; goto sr2WZ; kB3bB: foreach ($list as $addon) { goto JGbEU; JGbEU: $addon["\x75\x6e\151\156\x73\164\x61\154\154"] = 0; goto WYvlR; WYvlR: $addons[$addon["\156\x61\155\145"]] = $addon; goto W3haE; W3haE: j3dO4: goto on15N; on15N: } goto Ipd8f; UflQi: lWGhi: goto zwHJD; cdvCs: if ($addon_dir) { goto lWGhi; } goto mhLKC; dWi47: $sys_addons = new \app\common\model\Addons(); goto cdvCs; zsC7C: yhdxI: goto kB3bB; Mg5eB: $where["\x6e\x61\x6d\x65"] = array("\151\156", $dirs); goto HY1z2; mhLKC: $addon_dir = ADDON_PATH; goto UflQi; qoDQX: $addons = array(); goto Mg5eB; jUQkx: return $addons; goto Pk3Vr; czMn1: foreach ($dirs as $value) { goto gs2EO; U1ulp: goto dlpzj; goto AUq6J; GABE7: if (!$addons[$value]) { goto iDV0R; } goto aFyPE; gs2EO: if (isset($addons[$value])) { goto h14b3; } goto LmAMn; mi2Dy: $obj = new $class(); goto kf3Lx; QfoDI: unset($addons[$value]["\163\164\141\164\165\x73"]); goto hYzwi; kBJJ7: if (class_exists($class)) { goto UAazQ; } goto qaTIC; nF_p0: \think\Log::record("\xe6\217\x92\344\273\xb6" . $value . "\xe7\232\x84\345\205\245\345\x8f\243\xe6\x96\207\344\273\xb6\xe4\xb8\x8d\xe5\255\230\345\234\xa8\xef\xbc\x81"); goto U1ulp; LmAMn: $class = get_addon_class($value); goto kBJJ7; KGLXI: dlpzj: goto hieG7; kf3Lx: $addons[$value] = $obj->info; goto GABE7; hYzwi: iDV0R: goto feSqc; AUq6J: UAazQ: goto mi2Dy; qaTIC: trace($class); goto nF_p0; aFyPE: $addons[$value]["\x75\x6e\151\156\163\x74\x61\x6c\154"] = 1; goto QfoDI; feSqc: h14b3: goto KGLXI; hieG7: } goto aagC0; sr2WZ: brN9Q: goto qoDQX; Ipd8f: LH90J: goto czMn1; S1U89: if (!($dirs === FALSE || !file_exists($addon_dir))) { goto brN9Q; } goto H3ZJB; aagC0: g6PTR: goto jUQkx; Pk3Vr: } public function addAddons($name, $title, $description, $status, $config, $author, $version, $content) { goto uksiw; sOAZl: $res = $sys_addons->save($data); goto qIsK6; Zyz7T: $data = array("\156\x61\155\x65" => $name, "\x74\151\x74\154\145" => $title, "\144\x65\163\x63" => $description, "\163\x74\141\x74\x75\163" => $status, "\143\x6f\156\x66\x69\147" => $config, "\141\165\x74\x68\x6f\162" => $author, "\x76\x65\162\x73\x69\157\156" => $version, "\x63\x6f\x6e\x74\145\156\x74" => $content, "\x63\162\x65\141\x74\x65\x5f\164\x69\155\x65" => time()); goto sOAZl; qIsK6: return $sys_addons->id; goto nMd_N; uksiw: $sys_addons = new \app\common\model\Addons(); goto Zyz7T; nMd_N: } public function updateHooks($addons_name) { goto aqe2y; aW3yI: QdxhH: goto qc_JN; DeHIS: $methods = get_class_methods($addons_class); goto QDVcq; qoE9u: HkFFT: goto DeHIS; NMMzO: if (empty($common)) { goto QdxhH; } goto LVOhe; TDAK0: $common = array_intersect($hooks, $methods); goto NMMzO; eB1tA: return false; goto qoE9u; Tc9M5: X9bUQ: goto aW3yI; plwKe: $this->error = "\346\234\252\xe5\256\x9e\xe7\x8e\260{$addons_name}\xe6\x8f\x92\344\273\266\347\x9a\204\xe5\x85\xa5\345\217\xa3\346\x96\x87\xe4\273\xb6"; goto eB1tA; aqe2y: $sys_hooks = new Hooks(); goto w3aId; qc_JN: return true; goto QLaZY; hXsGe: if (class_exists($addons_class)) { goto HkFFT; } goto plwKe; w3aId: $addons_class = get_addon_class($addons_name); goto hXsGe; QDVcq: $hooks = $sys_hooks->column("\156\x61\x6d\x65"); goto TDAK0; LVOhe: foreach ($common as $hook) { goto VXc6W; BMeQo: return false; goto Oa9zv; nf04Y: $this->removeHooks($addons_name); goto BMeQo; wDjGZ: Bd7Ps: goto SFxdK; Ck7Uq: if (!(false === $flag)) { goto u610R; } goto nf04Y; VXc6W: $flag = $this->updateAddons($hook, array($addons_name)); goto Ck7Uq; Oa9zv: u610R: goto wDjGZ; SFxdK: } goto Tc9M5; QLaZY: } public function updateAddons($hook_name, $addons_name) { goto Ldfc5; dy0V7: klujh: goto SuRRe; SuRRe: $addons = array_merge($o_addons, $addons_name); goto nUGrI; EkBFf: return $res; goto h41a8; sqj7w: goto uY91Y; goto dy0V7; raF7V: E6XC_: goto W9xyT; r2c63: $o_addons = $hooks_info["\x61\x64\x64\157\156\163"]; goto OhT1g; n39FW: if ($o_addons) { goto klujh; } goto YxkV7; u3oVy: LERsK: goto n39FW; PKJF4: uY91Y: goto mija_; mija_: $addons = implode("\54", $addons); goto M8m6v; UzzjA: $o_addons = explode("\54", $o_addons); goto u3oVy; yamOi: if (!(false === $res)) { goto VVmeB; } goto FfDl1; YxkV7: $addons = $addons_name; goto sqj7w; nUGrI: $addons = array_unique($addons); goto PKJF4; W9xyT: $res = $sys_hooks->save(["\x61\x64\x64\157\x6e\x73" => $addons], ["\156\x61\155\x65" => $hook_name]); goto yamOi; UGjEk: VVmeB: goto EkBFf; FfDl1: $sys_hooks->save(["\x61\x64\144\157\156\x73" => $o_addons], ["\156\x61\x6d\145" => $hook_name]); goto UGjEk; OhT1g: if (!$o_addons) { goto LERsK; } goto UzzjA; msn7d: $hooks_info = $sys_hooks->getInfo(["\156\x61\155\145" => $hook_name], "\141\144\x64\157\x6e\163"); goto r2c63; Ox3Np: $o_addons = implode("\x2c", $o_addons); goto raF7V; Ldfc5: $sys_hooks = new Hooks(); goto msn7d; M8m6v: if (!$o_addons) { goto E6XC_; } goto Ox3Np; h41a8: } public function removeHooks($addons_name) { goto J9YTo; IoWAL: Vkwzp: goto IAmY1; N9ke4: $addons_class = get_addon_class($addons_name); goto N59eC; O0CBU: $hooks = $sys_hooks->column("\156\x61\155\x65"); goto ENw_k; GsvnS: AXeRn: goto KMp_x; uqPGd: foreach ($common as $hook) { goto kkmp2; ARPjH: HgHer: goto Doy5O; i12wJ: return false; goto s5GTd; s5GTd: Sk7z7: goto ARPjH; F9I2P: if (!(false === $flag)) { goto Sk7z7; } goto i12wJ; kkmp2: $flag = $this->removeAddons($hook, array($addons_name)); goto F9I2P; Doy5O: } goto NYhV1; N59eC: if (class_exists($addons_class)) { goto Vkwzp; } goto JliTs; ENw_k: $common = array_intersect($hooks, $methods); goto SZW_q; J9YTo: $sys_hooks = new Hooks(); goto N9ke4; KMp_x: return true; goto e4OCW; SZW_q: if (!$common) { goto AXeRn; } goto uqPGd; NYhV1: SyVuh: goto GsvnS; IAmY1: $methods = get_class_methods($addons_class); goto O0CBU; JliTs: return false; goto IoWAL; e4OCW: } public function removeAddons($hook_name, $addons_name) { goto RnWYi; Z07ZF: return true; goto Kh5Fu; ap0jG: if (!(false === $flag)) { goto H5ZFt; } goto sf7w1; Kh5Fu: goto IdCs6; goto f1iEg; RnWYi: $sys_hooks = new Hooks(); goto CRTL0; neNLL: $o_addons = explode("\x2c", $hooks_info["\x61\x64\144\x6f\x6e\x73"]); goto sLWDU; anyjB: IdCs6: goto qOlkv; sLWDU: if ($o_addons) { goto i6cd1; } goto Z07ZF; IDNci: return $flag; goto BWfZr; qOlkv: $addons = implode("\x2c", $addons); goto KeLA2; mYWgk: H5ZFt: goto IDNci; by8Am: $addons = array_diff($o_addons, $addons_name); goto anyjB; f1iEg: i6cd1: goto by8Am; Ohvzv: $flag = $sys_hooks->save(["\141\144\144\157\156\x73" => $addons], ["\x6e\x61\155\145" => $hook_name]); goto ap0jG; sf7w1: $sys_hooks->save(["\141\144\144\157\156\163" => $o_addons], ["\156\x61\155\145" => $hook_name]); goto mYWgk; CRTL0: $hooks_info = $sys_hooks->getInfo(["\x6e\141\x6d\145" => $hook_name], "\x61\144\x64\x6f\156\x73"); goto neNLL; KeLA2: $o_addons = implode("\x2c", $o_addons); goto Ohvzv; BWfZr: } public function getAddonsInfo($condition, $field = "\x2a") { $sys_addons = new \app\common\model\Addons(); return $sys_addons->getInfo($condition, $field); } public function deleteAddons($condition) { $sys_addons = new \app\common\model\Addons(); return $sys_addons->destroy($condition); } }
