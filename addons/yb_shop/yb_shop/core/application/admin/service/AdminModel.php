<?php
 namespace app\admin\service; use app\common\model\AdminModule; use think\Request; use think\Session; class AdminModel extends Base { private $admin_model; function __construct() { parent::__construct(); $this->admin_model = new AdminModule(); } public function addSytemModule($module_name, $controller, $method, $pid = 0, $url, $is_menu, $sort, $logo, $info, $is_control_auth) { goto Tqq2q; c13ez: if (!empty($sort)) { goto AcKOY; } goto eIthF; Tqq2q: if (!empty($pid)) { goto knnoY; } goto bjtZX; k9RaE: rsOX6: goto gLK5d; bjtZX: $pid = 0; goto wzjYe; jviyw: $mod = new AdminModule(); goto FKZIt; xAH1L: HyhTK: goto ndUrd; FKZIt: $res = $mod->save($data); goto P5w52; puYnb: return $res; goto PIcKw; ndUrd: $level = 1; goto k9RaE; pq4qe: goto rsOX6; goto xAH1L; gLK5d: $data = array("\x6d\157\144\x75\154\x65\x5f\156\x61\x6d\x65" => $module_name, "\x63\157\156\x74\x72\x6f\154\154\x65\x72" => $controller, "\155\145\164\150\x6f\x64" => $method, "\160\151\x64" => $pid, "\154\145\x76\145\x6c" => $level, "\165\162\154" => $url, "\x69\163\x5f\x6d\145\156\165" => $is_menu, "\x69\163\x5f\143\x6f\x6e\164\x72\x6f\x6c\137\141\x75\164\150" => $is_control_auth, "\163\157\162\164" => $sort, "\x69\x6e\x66\x6f" => $info, "\x6c\157\147\x6f" => $logo, "\143\x72\145\141\x74\x65\x5f\164\x69\155\145" => time()); goto jviyw; P5w52: $this->updateUserModule(); goto puYnb; wzjYe: knnoY: goto c13ez; cB6f8: AcKOY: goto tO0fp; tO0fp: if ($pid == 0) { goto HyhTK; } goto toECu; eIthF: $sort = 0; goto cB6f8; toECu: $level = $this->getSystemModuleInfo($pid, $field = "\x6c\x65\x76\x65\154")["\x6c\x65\x76\145\x6c"] + 1; goto pq4qe; PIcKw: } public function updateSystemModule($module_id, $module_name, $controller, $method, $pid, $url, $is_menu, $sort, $logo, $info, $is_control_auth) { goto ianO9; FiLdA: $res = $mod->allowField(true)->save($data, ["\155\157\x64\165\154\145\137\x69\x64" => $module_id]); goto QcPOE; kMApH: return $res; goto g1Lbr; JPwm_: $level = $this->getSystemModuleInfo($pid, $field = "\154\145\x76\145\x6c")["\x6c\x65\x76\x65\154"] + 1; goto iCOlk; iCOlk: goto CB3yw; goto y4qd4; PUMay: $mod = new AdminModule(); goto FiLdA; y4qd4: zskGB: goto Hiz9A; QcPOE: $this->updateUserModule(); goto kMApH; Hiz9A: $level = 1; goto gFI9o; gFI9o: CB3yw: goto d5Ojp; d5Ojp: $data = array("\155\x6f\x64\x75\x6c\x65\137\x69\x64" => $module_id, "\x6d\157\x64\x75\x6c\x65\137\x6e\x61\155\x65" => $module_name, "\x63\157\x6e\x74\162\157\154\x6c\145\x72" => $controller, "\155\145\164\150\157\x64" => $method, "\x70\151\144" => $pid, "\x6c\x65\x76\x65\x6c" => $level, "\x75\162\x6c" => $url, "\x69\163\x5f\x6d\x65\x6e\165" => $is_menu, "\x69\x73\137\143\x6f\156\x74\162\157\x6c\x5f\x61\165\x74\x68" => $is_control_auth, "\163\x6f\162\x74" => $sort, "\154\x6f\147\157" => $logo, "\x69\156\146\157" => $info, "\165\160\144\141\x74\145\x5f\x74\151\155\x65" => time()); goto PUMay; ianO9: if ($pid == 0) { goto zskGB; } goto JPwm_; g1Lbr: } public function deleteSystemModule($module_id_array) { goto Yb5mG; TTQSq: return $res; goto YfmFk; SYti2: goto gnBcG; goto QJqy4; kV2p9: gnBcG: goto TTQSq; Z0Nwu: if (!empty($sub_list)) { goto nUwXy; } goto m1450; m1450: $res = $this->admin_model->destroy($module_id_array); goto SYti2; QJqy4: nUwXy: goto Vcx0X; Vcx0X: $res = 2; goto kV2p9; Yb5mG: $sub_list = $this->getModuleListByParentId($module_id_array); goto Z0Nwu; YfmFk: } public function getModuleListByParentId($pid) { $list = $this->getSystemModuleList("\160\151\144\x3d" . $pid); return $list; } public function getSystemModuleInfo($module_id, $field = "\x2a") { $res = $this->admin_model->getInfo(array("\x6d\x6f\144\x75\x6c\145\137\151\x64" => $module_id), $field); return $res; } public function getSystemModuleList($condition = '', $order = '', $field = "\x2a") { $res = $this->admin_model->getQuerys($condition, $field, $order); return $res; } private function updateUserModule() { goto NaMc3; nS1aB: $module_id_list = $mod->getQuerys('', "\155\x6f\144\165\154\x65\x5f\151\144", ''); goto iN76a; Evjt2: $mod = new AdminModule(); goto nS1aB; iN76a: foreach ($module_id_list as $k => $v) { Session::set("\x6d\x6f\x64\x75\154\145\137\154\151\x73\164\56" . $module . "\155\x6f\x64\x75\x6c\x65\137\154\x69\163\164\137" . $v["\x6d\x6f\144\x75\x6c\x65\x5f\151\x64"], ''); NceOQ: } goto qb_AJ; qb_AJ: ycZUI: goto uzG0T; NaMc3: $module = request()->module(); goto V8esa; V8esa: Session::set("\155\157\x64\165\154\145\x5f\154\x69\x73\x74\56" . $module . "\155\x6f\144\165\x6c\145\x5f\154\x69\x73\164\137\x30", ''); goto Evjt2; uzG0T: } }
