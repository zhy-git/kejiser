<?php
 namespace app\admin\service; use app\common\model\GoodsAttr; use app\common\model\GoodsAttrDel; use app\common\model\GoodsAttrModule; use app\common\model\GoodsAttrValue; use app\common\model\GoodsDeleted; use app\common\model\GoodsSku; use app\common\model\GoodsSkuDeleted; use app\common\model\GoodsSpec; use app\common\model\GoodsSpecFormat; use app\common\model\GoodsSpecValue; use app\common\model\GoodsSupplier; use think\Db; class Goods extends Base { function __construct() { parent::__construct(); $this->goods = new \app\common\model\Goods(); } public function getSupplierList($condition = '', $search_text) { $supplier = new GoodsSupplier(); return $supplier->getPageLisy($condition, $search_text); } public function getGoodsList($condition = '') { $list = $this->getGoodsViewQueryField($condition, "\x2a", ''); return $list; } public function ModifyGoodsOnline($condition) { goto w8Jrl; vW2F6: vm67m: goto KVDpR; K8CUH: if ($result > 0) { goto vm67m; } goto F8XCm; SYMfc: SpeJF: goto Yoruh; Heent: $result = $this->goods->save($data, "\x67\157\x6f\x64\163\137\x69\144\40\x20\x69\x6e\50{$condition}\51"); goto K8CUH; KVDpR: return SUCCESS; goto SYMfc; F8XCm: return UPDATA_FAIL; goto D9Fc6; D9Fc6: goto SpeJF; goto vW2F6; w8Jrl: $data = array("\163\x74\141\164\145" => 1, "\x75\160\x64\x61\164\x65\137\164\151\155\x65" => time()); goto Heent; Yoruh: } public function deleteGoods($goods_id) { $this->goods->startTrans(); try { goto k2OWU; gklEb: return SUCCESS; goto Yfhpi; W_1yU: $this->goods->commit(); goto gklEb; FR6OH: return DELETE_FAIL; goto iR069; qYDWe: $res = $this->goods->save($data, "\147\x6f\157\144\x73\x5f\151\x64\x20\40\x69\x6e\50{$goods_id}\51"); goto RhSlX; iR069: goto SvwFN; goto OGw2Y; k2OWU: $data = array("\151\163\x5f\x64\x65\154" => 1, "\x75\x70\144\141\x74\145\x5f\164\151\155\145" => time()); goto qYDWe; Yfhpi: SvwFN: goto rFsNA; RhSlX: if ($res > 0) { goto aMn1e; } goto FR6OH; OGw2Y: aMn1e: goto W_1yU; rFsNA: } catch (\Exception $e) { $this->goods->rollback(); return DELETE_FAIL; } } private function addGoodsDeleted($goods_ids) { $this->goods->startTrans(); try { goto xlbo1; f0i3D: K_0sE: goto FzhsW; vPIMG: foreach ($goods_id_array as $k => $v) { goto hoeMp; ORN1F: okNC6: goto d4sb2; hoeMp: $goods_info = $this->goods->get($v); goto sfiDA; X3zNU: if (!empty($goods_delete_obj)) { goto okNC6; } goto Y96wa; vVGal: $goods_info = json_decode(json_encode($goods_info), true); goto CXwAf; TZ88v: RB0Mc: goto rBDUc; ok6nN: $goods_sku_model = new GoodsSku(); goto UAEaE; kRA6n: foreach ($goods_attribute_list as $goods_attribute_obj) { goto zRMHV; GHTiA: D1eJV: goto iG0nt; EQo3i: $goods_attribute_delete_model->save($goods_attribute_obj); goto GHTiA; BbHdC: $goods_attribute_obj = json_decode(json_encode($goods_attribute_obj), true); goto EQo3i; zRMHV: $goods_attribute_delete_model = new GoodsAttrDel(); goto BbHdC; iG0nt: } goto pQnT1; pQnT1: sJv2v: goto ORN1F; ZwM_z: $goods_attribute_list = $goods_attribute_model->getQuerys(["\x67\157\x6f\144\163\x5f\x69\144" => $v], "\52", ''); goto kRA6n; sfiDA: $goods_delete_model = new GoodsDeleted(); goto vVGal; Y96wa: $goods_info["\165\160\144\141\x74\x65\137\164\151\155\145"] = time(); goto leW9_; UAEaE: $goods_sku_list = $goods_sku_model->getQuerys(["\x67\157\x6f\144\163\137\x69\144" => $v], "\52", ''); goto SQQaN; rBDUc: $goods_attribute_model = new GoodsAttr(); goto ZwM_z; d4sb2: MirMm: goto OvgHZ; SQQaN: foreach ($goods_sku_list as $goods_sku_obj) { goto jzpV2; jzpV2: $goods_sku_deleted_model = new GoodsSkuDeleted(); goto KqStE; KqStE: $goods_sku_obj = json_decode(json_encode($goods_sku_obj), true); goto QI_t7; QI_t7: $goods_sku_obj["\165\x70\x64\141\x74\x65\x5f\x64\141\x74\145"] = time(); goto q50tS; QvJjX: gZPcc: goto m9GK4; q50tS: $goods_sku_deleted_model->save($goods_sku_obj); goto QvJjX; m9GK4: } goto TZ88v; CXwAf: $goods_delete_obj = $goods_delete_model->getInfo(["\147\157\157\x64\x73\x5f\x69\144" => $v]); goto X3zNU; leW9_: $goods_delete_model->save($goods_info); goto ok6nN; OvgHZ: } goto f0i3D; iAkcF: return 1; goto nrnUw; FzhsW: $this->goods->commit(); goto iAkcF; xlbo1: $goods_id_array = explode("\x2c", $goods_ids); goto vPIMG; nrnUw: } catch (\Exception $e) { $this->goods->rollback(); return $e->getMessage(); } } public function ModifyGoodsOffline($condition) { goto L1MgM; XRVdq: J88vJ: goto B6WN1; GVgD0: if ($result > 0) { goto J88vJ; } goto HZmss; aKT8y: Aerzg: goto oX13R; B6WN1: return SUCCESS; goto aKT8y; HZmss: return UPDATA_FAIL; goto Haqca; Haqca: goto Aerzg; goto XRVdq; vW0rL: $result = $this->goods->save($data, "\147\157\x6f\x64\x73\137\151\144\x20\40\151\x6e\x28{$condition}\x29"); goto GVgD0; L1MgM: $data = array("\163\164\x61\164\145" => 0, "\x75\160\x64\141\x74\145\137\x74\x69\155\x65" => time()); goto vW0rL; oX13R: } public function getGoodsViewQueryField($condition, $field, $order = '') { goto jf0Na; gKUzo: $url = explode("\46\x70\x61\x67\x65", $url[1]); goto j9HbN; D0P2F: $url = explode("\75\57", $url); goto gKUzo; jf0Na: $url = request()->query(); goto D0P2F; j9HbN: $url = "\x2f" . $url[0]; goto YVQPX; qg1Be: return $list; goto MPDSM; L2HAF: $list = $goods_view->alias("\156\x67")->join("\171\142\163\x63\x5f\151\155\141\147\145\x73\x20\x69\x6d\x61\147\x65\x73", "\156\147\x2e\151\155\141\x67\x65\163\40\75\x20\151\x6d\x61\x67\145\x73\x2e\x69\x6d\x67\137\x69\144", "\154\x65\146\x74")->order("\x6e\147\56\163\x6f\x72\x74\40\144\x65\x73\143\x2c\156\147\56\143\x72\x65\x61\164\x65\x5f\x74\x69\x6d\x65\x20\144\145\163\143")->field($field)->where($condition)->paginate(20, false, ["\x71\x75\x65\x72\171" => ["\163" => $url]]); goto qg1Be; YVQPX: $goods_view = new \app\common\model\Goods(); goto L2HAF; MPDSM: } public function addSupplier($supplier_name, $name, $tel, $address, $info, $logo, $mch_id) { goto ARkK0; QiZf9: $res = $supplier->save($data); goto drJYU; ARkK0: $supplier = new GoodsSupplier(); goto tdJly; drJYU: return $res; goto UvQpH; tdJly: $data = array("\x73\x75\x70\160\x6c\x69\x65\x72\x5f\x6e\x61\x6d\145" => $supplier_name, "\156\141\x6d\x65" => $name, "\164\145\154" => $tel, "\x61\144\x64\162\145\x73\163" => $address, "\x69\x6e\146\157" => $info, "\x6c\x6f\147\x6f" => $logo, "\x63\x72\x65\x61\x74\145\137\164\151\155\145" => time(), "\x6d\x63\150\x5f\x69\x64" => $mch_id); goto QiZf9; UvQpH: } public function updateSupplier($supplier_id, $supplier_name, $name, $tel, $address, $info, $logo, $bus_id) { goto U3UOC; JCk51: $data = array("\163\165\160\x70\x6c\x69\145\162\137\x6e\141\x6d\x65" => $supplier_name, "\156\x61\155\145" => $name, "\164\x65\x6c" => $tel, "\x61\144\x64\162\145\x73\x73" => $address, "\151\156\x66\157" => $info, "\x6c\x6f\x67\157" => $logo, "\155\143\x68\x5f\x69\144" => $bus_id); goto PWDHA; U3UOC: $supplier = new GoodsSupplier(); goto JCk51; PWDHA: return $supplier->save($data, ["\163\x75\x70\160\x6c\151\x65\x72\x5f\x69\144" => $supplier_id]); goto lgJ7h; lgJ7h: } public function getSupplierInfo($supplier_id) { $supplier = new GoodsSupplier(); return $supplier->get($supplier_id); } public function deleteSupplier($supplier_id_array) { goto vLUv8; Hv2ii: return $res; goto Yo3uh; vLUv8: $supplier = new GoodsSupplier(); goto iozTU; iozTU: $res = $supplier->destroy($supplier_id_array); goto Hv2ii; Yo3uh: } protected function checkSupplierIsUse($supplier_id) { goto rKd98; h1izl: $count += $goods_deleted->getCount(["\163\165\x70\x70\154\151\x65\162\137\x69\144" => $supplier_id]); goto eGbr6; RYypK: $goods_deleted = new GoodsDeleted(); goto ddfGm; rKd98: $goods = new \app\common\model\Goods(); goto RYypK; eGbr6: return $count; goto jLdvy; ddfGm: $count = $goods->getCount(["\163\165\x70\x70\154\x69\x65\162\x5f\x69\144" => $supplier_id]); goto h1izl; jLdvy: } public function addGoodsSpecService($spec_name, $show_type, $is_visible, $sort, $spec_value_str, $attr_id = 0, $is_screen, $cate_id, $mch_id) { goto dQSf6; dQSf6: $goods_spec = new GoodsSpec(); goto W5XDS; W5XDS: $goods_spec->startTrans(); goto CaVJr; CaVJr: try { goto HZzFG; F43Uc: rEtgC: goto JudvW; JudvW: JsZN8: goto K5djG; FZRUA: OzSp9: goto AOJEU; BHWHd: return $spec_id; goto A2hD1; DQ9ZS: foreach ($spec_value_array as $k => $v) { goto GOpnu; SZvGt: goto PkW6R; goto HLrK6; zMwCo: if ($show_type == 2) { goto IyQgB; } goto Nzhd0; HLrK6: IyQgB: goto bo3U8; Nzhd0: $this->addGoodsSpecValueService($spec_id, $v, 1, 255); goto SZvGt; zzilG: WbFpy: goto G8UCk; bo3U8: $spec_value = explode("\x3a", $v); goto PivUc; zSuaL: PkW6R: goto zzilG; GOpnu: $spec_value = array(); goto zMwCo; PivUc: $this->addGoodsSpecValueService($spec_id, $spec_value[0], 1, 255); goto zSuaL; G8UCk: } goto FZRUA; iBGnR: $attribute = new GoodsAttrModule(); goto MZe31; Ou8Wj: if (!($attr_id > 0)) { goto JsZN8; } goto iBGnR; sZ1Un: $attribute->save(["\163\x70\145\x63\x5f\x69\x64\x5f\x61\x72\x72\x61\171" => $attribute_info["\163\x70\x65\x63\137\x69\x64\x5f\141\162\162\x61\x79"] . "\x2c" . $spec_id], ["\x61\x74\164\162\137\x69\x64" => $attr_id]); goto gPR8N; gPR8N: goto rEtgC; goto ca3TW; HZzFG: $data = array("\163\x70\145\x63\x5f\156\141\155\145" => $spec_name, "\163\x68\x6f\x77\x5f\x74\171\160\x65" => 0, "\151\163\x5f\166\x69\x73\x69\142\x6c\145" => $is_visible, "\x73\157\162\164" => $sort, "\143\162\x65\x61\x74\x65\137\x74\151\x6d\x65" => time(), "\143\x61\x74\x65\x5f\151\144" => $cate_id, "\x6d\143\x68\137\151\x64" => $mch_id); goto BOI5i; jIhkW: $spec_id = $goods_spec->spec_id; goto Ou8Wj; TJZhZ: $spec_value_array = array_filter($spec_value_array); goto MqOc3; MqOc3: $spec_value_array = array_unique($spec_value_array); goto DQ9ZS; K5djG: $spec_value_array = explode("\x2c", $spec_value_str); goto TJZhZ; AOJEU: $goods_spec->commit(); goto BHWHd; ca3TW: cKPRC: goto Erlon; MZe31: $attribute_info = $attribute->getInfo(["\x61\x74\x74\162\137\151\144" => $attr_id], "\52"); goto OfV4a; OfV4a: if ($attribute_info["\163\160\x65\x63\x5f\151\x64\x5f\141\162\162\x61\x79"] == '') { goto cKPRC; } goto sZ1Un; BOI5i: $goods_spec->save($data); goto jIhkW; Erlon: $attribute->save(["\163\160\145\143\137\x69\144\x5f\x61\x72\x72\141\171" => $spec_id], ["\x61\x74\164\x72\x5f\x69\144" => $attr_id]); goto F43Uc; A2hD1: } catch (\Exception $e) { goto H5Ier; DE58_: dump($e->getMessage()); goto nFtS2; nFtS2: return $e->getMessage(); goto wkC85; H5Ier: $goods_spec->rollback(); goto DE58_; wkC85: } goto gz0zy; gz0zy: } public function addGoodsSpecValueService($spec_id, $spec_value_name, $is_visible, $sort = "\x30") { goto SZGhd; Ow3Jc: return $goods_spec_value->spec_value_id; goto UKi28; Rxs1k: $goods_spec_value->save($data); goto Ow3Jc; SZGhd: $goods_spec_value = new GoodsSpecValue(); goto c1hg4; c1hg4: $data = array("\163\x70\145\143\137\151\144" => $spec_id, "\163\160\145\143\x5f\166\x61\154\165\x65\x5f\x6e\141\155\145" => $spec_value_name, "\151\x73\x5f\166\x69\x73\151\x62\154\145" => $is_visible, "\163\157\x72\164" => $sort, "\143\162\145\x61\164\145\137\164\x69\x6d\x65" => time()); goto Rxs1k; UKi28: } public function getGoodsSpecList($condition = '', $search_text) { goto gaARW; gaARW: $goods_spec = new GoodsSpec(); goto Oelyl; uAar1: foreach ($goods_spec_list as $ks => $vs) { goto h0YTD; PfW4a: $goods_spec_list[$ks]["\x73\x70\x65\143\x5f\166\141\x6c\x75\145\137\x6e\x61\x6d\x65\x5f\x6c\151\x73\164"] = $goods_spec_value_name; goto bRjSO; Ey3Rq: $goods_spec_value_name = $goods_spec_value_name == '' ? '' : substr($goods_spec_value_name, 1); goto PfW4a; jEGLI: $spec_value_list = $goods_spec_value->getQuerys(["\163\160\145\143\137\x69\144" => $vs["\163\x70\x65\143\x5f\x69\144"]], "\x2a", ''); goto KfbLY; N9Kdt: yPPw2: goto kVxap; KfbLY: foreach ($spec_value_list as $kv => $vv) { $goods_spec_value_name = $goods_spec_value_name . "\54" . $vv["\x73\x70\145\x63\x5f\x76\x61\x6c\x75\145\137\156\141\x6d\145"]; mgyFJ: } goto N9Kdt; kVxap: $goods_spec_list[$ks]["\163\160\145\x63\x5f\166\x61\x6c\x75\x65\137\x6c\x69\163\x74"] = $spec_value_list; goto Ey3Rq; h0YTD: $goods_spec_value_name = ''; goto jEGLI; bRjSO: CgVQB: goto xd_QG; xd_QG: } goto os5Bt; os5Bt: uaJ6g: goto SPanG; nlnDD: $goods_spec_list = $goods_spec->getPageLisy($condition, $search_text); goto dU4Ip; Oelyl: $goods_spec_value = new GoodsSpecValue(); goto nlnDD; zTXgC: return $goods_spec_list; goto S96ri; SPanG: UW6h7: goto zTXgC; dU4Ip: if (empty($goods_spec_list)) { goto UW6h7; } goto uAar1; S96ri: } public function getGoodsSpecAll($condition = '', $field = "\x2a", $order = '') { goto A9kYO; gYvSG: if (empty($goods_spec_list)) { goto g8Ege; } goto pUNpf; A9kYO: $goods_spec = new GoodsSpec(); goto PupHE; wZZwz: $goods_spec_list = $goods_spec->getQuerys($condition, $field, $order); goto gYvSG; pUNpf: foreach ($goods_spec_list as $ks => $vs) { goto MQ0Xf; cRC_f: $goods_spec_list[$ks]["\x73\160\x65\143\x5f\166\141\x6c\165\145\x5f\154\x69\163\x74"] = $spec_value_list; goto oScD_; uYIcC: $goods_spec_list[$ks]["\x73\x70\x65\143\137\166\141\154\165\145\137\x6e\141\155\x65\x5f\x6c\x69\x73\x74"] = $goods_spec_value_name; goto mw_bm; Sv9a5: S8CPe: goto cRC_f; oScD_: $goods_spec_value_name = $goods_spec_value_name == '' ? '' : substr($goods_spec_value_name, 1); goto uYIcC; h1opH: $spec_value_list = $goods_spec_value->getQuerys(["\163\x70\145\143\137\151\144" => $vs["\163\x70\x65\143\137\x69\x64"]], "\x2a", ''); goto XyxF1; XyxF1: foreach ($spec_value_list as $kv => $vv) { $goods_spec_value_name = $goods_spec_value_name . "\x2c" . $vv["\163\x70\x65\143\137\166\141\154\x75\x65\137\x6e\x61\x6d\145"]; pHcrl: } goto Sv9a5; mw_bm: Hmqse: goto YMlr_; MQ0Xf: $goods_spec_value_name = ''; goto h1opH; YMlr_: } goto gNba3; uxDMC: return $goods_spec_list; goto W6O06; gNba3: hudgE: goto E3qlN; PupHE: $goods_spec_value = new GoodsSpecValue(); goto wZZwz; E3qlN: g8Ege: goto uxDMC; W6O06: } public function getAttrValueAll($condition = '', $field = "\x2a", $order = '') { goto yH_IJ; UN0tP: $attr_value_list = $attr_value->getQuerys($condition, $field, $order); goto EMxEw; EMxEw: return $attr_value_list; goto w7swQ; yH_IJ: $attr_value = new GoodsAttrValue(); goto UN0tP; w7swQ: } public function getGoodsSpecDetail($spec_id) { goto j2KJa; h0CAC: $info["\163\x70\x65\x63\137\166\141\x6c\x75\145\x5f\x6e\x61\x6d\145\x5f\x6c\x69\x73\x74"] = substr($goods_spec_value_name, 1); goto yj1hg; gEIrD: $spec_value_list = $goods_spec_value->getQuerys(["\163\x70\145\143\137\x69\144" => $info["\163\160\145\x63\137\x69\144"]], "\x2a", ''); goto pLh2f; GTzk_: eIGe1: goto HX_TJ; t1xej: $info = $goods_spec->getInfo(["\x73\x70\x65\x63\x5f\x69\x64" => $spec_id], "\52"); goto h95o2; bxflS: $goods_spec_value = new GoodsSpecValue(); goto t1xej; j2KJa: $goods_spec = new GoodsSpec(); goto bxflS; HX_TJ: hGR2u: goto h0CAC; wq7Mr: if (empty($info)) { goto hGR2u; } goto TzRSL; pLh2f: foreach ($spec_value_list as $kv => $vv) { $goods_spec_value_name = $goods_spec_value_name . "\54" . $vv["\163\160\x65\143\x5f\166\x61\154\165\x65\x5f\x6e\x61\155\x65"]; HR8o3: } goto GTzk_; TzRSL: $goods_spec_value->destroy(["\x73\x70\x65\x63\137\x69\x64" => $info["\x73\160\145\143\137\151\x64"], "\163\160\x65\143\x5f\166\141\x6c\165\x65\137\x6e\141\155\x65" => '']); goto gEIrD; ztTAI: return $info; goto OiUCz; h95o2: $goods_spec_value_name = ''; goto wq7Mr; yj1hg: $info["\163\160\145\143\x5f\166\141\x6c\165\145\x5f\x6c\x69\x73\164"] = $spec_value_list; goto ztTAI; OiUCz: } public function updateGoodsSpecService($spec_id, $spec_name, $is_visible, $sort, $spec_value_str, $cate_id, $bus_id) { goto t1r4G; t1r4G: $goods_spec = new GoodsSpec(); goto NeJEG; mA01g: try { goto OrQs5; F_MmJ: $res = $goods_spec->save($data, ["\163\160\145\x63\x5f\151\144" => $spec_id]); goto MggYa; e5vM1: $goods_spec->commit(); goto c4Ia_; gO9FJ: $spec_value_array = explode("\x2c", $spec_value_str); goto MbsgR; c4Ia_: return $res; goto tELGC; XB20C: IY3Ek: goto I3qcr; I3qcr: hjl0F: goto e5vM1; MbsgR: $spec_value_array = array_filter($spec_value_array); goto R6CLN; MggYa: if (empty($spec_value_str)) { goto hjl0F; } goto gO9FJ; RZ5ct: foreach ($spec_value_array as $k => $v) { $this->addGoodsSpecValueService($spec_id, $v, 1, 255); GMTys: } goto XB20C; OrQs5: $data = array("\x73\160\145\x63\x5f\156\x61\x6d\x65" => $spec_name, "\151\x73\137\166\x69\163\x69\x62\x6c\145" => $is_visible, "\x73\x6f\162\x74" => $sort, "\x63\141\x74\145\x5f\151\144" => $cate_id, "\155\143\x68\137\x69\x64" => $bus_id); goto F_MmJ; R6CLN: $spec_value_array = array_unique($spec_value_array); goto RZ5ct; tELGC: } catch (\Exception $e) { $goods_spec->rollback(); return $e->getMessage(); } goto tLwd7; NeJEG: $goods_spec->startTrans(); goto mA01g; tLwd7: } public function addAttrModule($attr_mod_id, $attr_name, $spec_id, $attr_value_id, $is_use, $sort, $mch_id) { goto bdhuY; infac: $attr_module->startTrans(); goto tGWFX; tGWFX: try { goto sKsW9; dFvkK: $attr_module_id = $attr_module->attr_id; goto rlCe3; ih3p7: $attr_module->save($data); goto dFvkK; ZhWTE: if ($attr_mod_id == 0) { goto y6Bi6; } goto dza7J; zm0g2: return $attr_module_id; goto rXLi5; krwI1: y6Bi6: goto ih3p7; dza7J: $attr_module->save($data, ["\141\164\x74\x72\137\151\144" => $attr_mod_id]); goto Teys6; Teys6: $attr_module_id = $attr_mod_id; goto z3JYM; sKsW9: $data = array("\x61\x74\164\162\137\x6e\x61\x6d\145" => $attr_name, "\151\x73\137\165\163\x65" => $is_use, "\x73\x6f\162\164" => $sort, "\163\160\x65\143\137\x69\x64\x5f\x61\162\162\141\x79" => $spec_id, "\x61\x74\x74\162\x5f\x76\x61\154\x75\145\x5f\x69\144" => $attr_value_id, "\143\x72\145\141\164\x65\x5f\164\151\x6d\145" => time(), "\x6d\143\150\137\151\x64" => $mch_id); goto ZhWTE; oNpn0: $attr_module->commit(); goto zm0g2; wKiD6: teKIh: goto oNpn0; z3JYM: goto teKIh; goto krwI1; rlCe3: $values = array("\x61\164\164\x72\x5f\151\x64" => $attr_module_id); goto wKiD6; rXLi5: } catch (\Exception $e) { $attr_module->rollback(); return $e->getMessage(); } goto UH84d; bdhuY: $attr_module = new GoodsAttrModule(); goto infac; UH84d: } public function modifyGoodsSpecValueField($spec_value_id, $field_name, $field_value) { $goods_spec_value = new GoodsSpecValue(); return $goods_spec_value->save(["{$field_name}" => $field_value], ["\163\x70\x65\x63\137\x76\x61\154\165\x65\x5f\x69\x64" => $spec_value_id]); } public function deleteGoodsSpecValue($spec_id, $spec_value_id) { goto u9oar; XwjoY: goto rlSFa; goto q1rQ_; qfehH: rlSFa: goto pQugS; yMGDQ: return -2; goto qfehH; v2ua1: $goods_spec_value = new GoodsSpecValue(); goto p0atZ; p0atZ: return $goods_spec_value->destroy($spec_value_id); goto XwjoY; u9oar: $result = $this->getGoodsSpecValueCount(["\x73\160\145\143\x5f\151\144" => $spec_id]); goto i4grr; q1rQ_: fFGWY: goto yMGDQ; i4grr: if ($result == 1) { goto fFGWY; } goto v2ua1; pQugS: } public function getGoodsSpecValueCount($condition) { goto TOnLe; bfKdA: return $count; goto UfeEX; TOnLe: $spec_value = new GoodsSpecValue(); goto qsfg1; qsfg1: $count = $spec_value->where($condition)->count(); goto bfKdA; UfeEX: } public function checkGoodsSpecValueIsUse($spec_id, $spec_value_id) { goto I7kGl; rh6RZ: qNvhk: goto kayl5; iKXrq: seYzV: goto dLRJr; I7kGl: $check_str = $spec_id . "\72" . $spec_value_id . "\x3b"; goto U12Br; Accoh: return false; goto iFRc1; SuxqX: $goods_sku_delete = new GoodsSkuDeleted(); goto gC49n; n88Cd: $res_delete = $goods_sku_delete->where("\40\x43\117\116\103\101\x54\x28\141\x74\x74\x72\x5f\x76\x61\x6c\x75\x65\137\x69\x74\145\x6d\x73\x2c\40\47\x3b\x27\51\40\x6c\151\153\145\x20\x27\45" . $check_str . "\x25\x27")->count(); goto kaRe0; gC49n: $res = $goods_sku->where("\x20\103\117\x4e\103\101\x54\x28\x61\164\164\162\x5f\x76\141\154\165\x65\x5f\x69\164\145\155\x73\54\x20\x27\73\47\x29\x20\x6c\x69\x6b\145\x20\47\x25" . $check_str . "\45\x27")->count(); goto n88Cd; kayl5: return true; goto iKXrq; U12Br: $goods_sku = new GoodsSku(); goto SuxqX; iFRc1: goto seYzV; goto rh6RZ; kaRe0: if ($res + $res_delete > 0) { goto qNvhk; } goto Accoh; dLRJr: } public function modifyGoodsSpecField($spec_id, $field_name, $field_value) { goto XUFVp; mMYvH: $res = $goods_spec->save($data, ["\x73\x70\145\143\137\x69\144" => $spec_id]); goto pkfBS; XUFVp: $goods_spec = new GoodsSpec(); goto bLh5F; bLh5F: $data = array("{$field_name}" => $field_value); goto mMYvH; pkfBS: return $res; goto o3DE1; o3DE1: } public function modifyAttributeFieldService($attr_id, $field_name, $field_value) { $attribute = new GoodsAttrValue(); return $attribute->save(["{$field_name}" => $field_value], ["\x61\x74\164\x72\137\x76\141\154\165\145\x5f\151\144" => $attr_id]); } public function getAttrModuleInfo($mod_id, $condition = '', $field = "\52", $order = '') { goto AdXEJ; qtiLY: $attr_mod_list = $attr_mod->getInfo($where); goto F9kTs; F9kTs: $spec_id_array = explode("\54", $attr_mod_list["\x73\160\145\x63\x5f\151\x64\137\141\x72\x72\141\171"]); goto e_LEw; AVORk: $condition["\x61\x74\164\x72\x5f\x76\x61\154\165\x65\137\x69\144"] = array("\x69\156", $attr_mod_list["\141\x74\164\x72\x5f\166\141\x6c\165\x65\137\x69\144"]); goto wEOJO; xjRlZ: $attr_val = new GoodsAttrValue(); goto rDwNw; N5E4U: return $attr_mod_list; goto p28uC; mWrj6: $attr_val_list = $attr_val->getQuerys($condition, $field, $order); goto EJQJh; EJQJh: $attr_mod_list["\141\164\x74\x72\137\x76\141\154\x75\x65\x73"] = $attr_val_list; goto N5E4U; Vmqw2: $where["\141\164\x74\162\x5f\x69\x64"] = array("\145\161", $mod_id); goto qtiLY; rDwNw: if (!(!empty($attr_mod_list["\x61\x74\x74\162\x5f\166\141\x6c\x75\145\x5f\x69\x64"]) && $attr_mod_list["\141\164\x74\162\137\166\141\154\x75\x65\137\x69\144"] == '')) { goto CvObl; } goto AVORk; AdXEJ: $attr_mod = new GoodsAttrModule(); goto Vmqw2; e_LEw: $attr_mod_list["\x73\160\x65\x63\x5f\151\144\137\x61\x72\162\x61\x79"] = $spec_id_array; goto xjRlZ; wEOJO: CvObl: goto mWrj6; p28uC: } public function deleteGoodsSpec($spec_id) { goto wOh7l; wOh7l: $goods_spec = new GoodsSpec(); goto JBRI1; JBRI1: $spec_value = new GoodsSpecValue(); goto b8WB0; b8WB0: $goods_spec->startTrans(); goto M4S7h; M4S7h: try { goto iemlS; BxCKO: return 1; goto CoY5b; iemlS: $spec_id_array = explode("\54", $spec_id); goto ugVJU; ugVJU: foreach ($spec_id_array as $k => $v) { goto Vsk8K; RLOo2: fhfZE: goto qYlAS; Rk4Cu: $goods_spec->destroy($v); goto tS3GQ; qYlAS: sgss4: goto eRE5Q; Ons1U: return -1; goto w7xYm; B6uAa: if ($res) { goto Exbdf; } goto Rk4Cu; w7xYm: $goods_spec->rollback(); goto RLOo2; Vsk8K: $res = $this->checkGoodsSpecIsUse($v); goto B6uAa; TdjCw: Exbdf: goto Ons1U; Dp0sd: goto fhfZE; goto TdjCw; tS3GQ: $spec_value->destroy(["\x73\x70\x65\x63\137\x69\144" => $v]); goto Dp0sd; eRE5Q: } goto IxbEp; IxbEp: naIIH: goto zy16Q; zy16Q: $goods_spec->commit(); goto BxCKO; CoY5b: } catch (\Exception $e) { $goods_spec->rollback(); return $e->getMessage(); } goto Kw7l4; Kw7l4: } public function checkGoodsSpecIsUse($spec_id) { goto lRtsE; DyPDW: goto ZWCEr; goto J9FOv; J9FOv: hoo6d: goto cvyJB; z5Dxl: ZWCEr: goto bIyCK; oyTXT: $spec_value_list = $goods_spec_value->getQuerys(["\x73\160\x65\143\x5f\x69\144" => $spec_id], "\x2a", ''); goto GGtXQ; MBbsX: $goods_sku = new GoodsSku(); goto oyTXT; RxNIM: G7Xor: goto uYeo2; uBKGq: return false; goto DyPDW; GGtXQ: if (!empty($spec_value_list)) { goto hoo6d; } goto uBKGq; uYeo2: if (!($res == 0)) { goto HkcVQ; } goto mn3EW; nSaMW: foreach ($spec_value_list as $k => $v) { goto ibE4X; uXc30: pXvI7: goto lunBT; ySm9E: goto G7Xor; goto uXc30; ibE4X: $check_str = $spec_id . "\72" . $v["\x73\x70\x65\143\137\x76\141\x6c\x75\x65\137\151\144"] . "\x3b"; goto oNJqN; UAR4p: if (!($res > 0)) { goto pXvI7; } goto uKi82; oNJqN: $res += $goods_sku->where("\40\x43\117\x4e\103\101\x54\x28\x61\164\x74\x72\137\166\141\154\165\145\x5f\151\x74\x65\x6d\x73\x2c\x20\x27\x3b\47\x29\x20\154\x69\153\145\x20\x27\45" . $check_str . "\x25\47")->count(); goto UAR4p; uKi82: return true; goto ySm9E; lunBT: gCGRI: goto M2yL5; M2yL5: } goto RxNIM; gkoqU: HkcVQ: goto z5Dxl; lRtsE: $goods_spec_value = new GoodsSpecValue(); goto MBbsX; cvyJB: $check_str = ''; goto R2Rar; R2Rar: $res = 0; goto nSaMW; mn3EW: return false; goto gkoqU; bIyCK: } public function addAttributeService($attr_name, $is_use, $sort, $value_string, $cate_id, $mch_id) { goto vVw1H; v0Hm9: try { goto Dv4aG; ETSns: $attribute->commit(); goto PPneh; Dv4aG: $data = array("\x61\164\164\162\x5f\166\x61\x6c\x75\145\x5f\156\141\155\x65" => $attr_name, "\151\163\137\x75\163\x65" => $is_use, "\163\x6f\162\x74" => $sort, "\141\x74\x74\x72\x5f\151\144" => 0, "\x76\141\154\x75\145" => $value_string, "\x63\x61\164\145\x5f\x69\144" => $cate_id, "\155\x63\x68\x5f\151\x64" => $mch_id); goto XNlkC; PPneh: return $attr_value_id; goto wSOox; XNlkC: $attribute->save($data); goto piPSj; piPSj: $attr_value_id = $attribute->attr_value_id; goto ETSns; wSOox: } catch (\Exception $e) { $attribute->rollback(); return $e->getMessage(); } goto hHxgk; To2fq: $attribute->startTrans(); goto v0Hm9; vVw1H: $attribute = new GoodsAttrValue(); goto To2fq; hHxgk: } public function updateAttributeService($attr_id, $attr_name, $is_use, $attr_value_str, $sort, $cate_id) { goto g_C2r; g_C2r: $attribute = new GoodsAttrValue(); goto TEEG_; JOfy2: try { goto wC5Q5; USLtz: $attribute->commit(); goto JdK1q; JdK1q: return $res; goto rX3ns; q8Elh: $res = $attribute->save($data, ["\x61\x74\x74\x72\137\166\x61\154\165\x65\137\x69\144" => $attr_id]); goto USLtz; wC5Q5: $data = array("\141\164\x74\x72\x5f\x76\x61\x6c\165\x65\x5f\156\141\x6d\x65" => $attr_name, "\x69\163\137\x75\x73\x65" => $is_use, "\x76\141\x6c\165\x65" => $attr_value_str, "\x73\x6f\x72\x74" => $sort, "\143\141\x74\145\x5f\x69\144" => $cate_id); goto q8Elh; rX3ns: } catch (\Exception $e) { $attribute->rollback(); return $e->getMessage(); } goto ytp4B; TEEG_: $attribute->startTrans(); goto JOfy2; ytp4B: } public function addAttributeValueService($attr_id, $attr_value_name, $sort, $value) { goto A0baE; A0baE: $attribute_value = new GoodsAttrValue(); goto igwiU; ZEu5M: $attribute_value->save($data); goto mBUyj; mBUyj: return $attribute_value->attr_value_id; goto EzlH8; igwiU: $data = array("\141\x74\164\162\137\x69\x64" => $attr_id, "\141\164\164\162\x5f\166\x61\154\x75\x65\137\x6e\x61\155\x65" => $attr_value_name, "\x74\171\x70\x65" => 3, "\163\157\162\x74" => $sort, "\166\x61\154\165\x65" => $value); goto ZEu5M; EzlH8: } public function getAttributeModServiceList($condition = '', $field = "\x2a", $order = '') { goto OCV9Y; OCV9Y: $attribute = new GoodsAttrModule(); goto CcXGg; dJ_8K: if (empty($list)) { goto wBtf6; } goto uFFhj; fBbwB: wBtf6: goto jmDjl; uFFhj: foreach ($list as $k => $v) { goto niD1h; oHnNS: $value_str = substr($value_str, 1); goto OJu64; cu6Ai: pYH6o: goto fbE8A; EtId4: foreach ($new_array as $kn => $vn) { $value_str = $value_str . "\x2c" . $vn["\x61\164\x74\162\x5f\x76\x61\154\x75\145\x5f\x6e\141\155\x65"]; EiJLE: } goto J07nx; OJu64: $list[$k]["\x76\141\x6c\x75\x65\137\x73\x74\162"] = $value_str; goto cu6Ai; SzEH6: $value_str = ''; goto EtId4; niD1h: $new_array = $attribute_value->getQuerys(["\x61\164\x74\162\x5f\151\x64" => $v["\x61\164\x74\x72\137\x69\x64"]], "\x61\164\x74\162\137\x76\x61\x6c\x75\x65\x5f\156\x61\x6d\145", ''); goto SzEH6; J07nx: XWtXa: goto oHnNS; fbE8A: } goto kNCM4; kNCM4: rtcQ1: goto fBbwB; jmDjl: return $list; goto yZu9I; IVcwk: $list = $attribute->getQuerys($condition, $field, $order); goto dJ_8K; CcXGg: $attribute_value = new GoodsAttrValue(); goto IVcwk; yZu9I: } public function getAttributeServiceList($condition = '', $search_text = '') { goto oyB_w; oyB_w: $attribute_value = new GoodsAttrValue(); goto pUQdB; pUQdB: $list = $attribute_value->getPageLisy($condition, $search_text); goto sX0MP; sX0MP: return $list; goto tk8Th; tk8Th: } public function getAttributeServiceAll($condition = '', $field = "\x2a", $order = '') { goto XSVnD; XSVnD: $attribute_value = new GoodsAttrValue(); goto sSUoS; eqSnP: return $list; goto StOxk; sSUoS: $list = $attribute_value->getQuerys($condition, $field, $order); goto eqSnP; StOxk: } public function getAttributeServiceListSelect($condition = '', $search_text = '', $order = '') { goto MJiXW; p2bAV: ryAtg: goto t8PME; thRKW: if (empty($list)) { goto ryAtg; } goto ANVIq; ZkGLo: foreach ($list as $k => $v) { goto d0a5P; D33wD: $spec_str = substr($spec_str, 1); goto zvptr; LMVIj: $spec_str = ''; goto MX4L5; zvptr: $list[$k]["\x73\x70\145\143\x5f\x76\141\x6c\165\145\137\x73\164\x72"] = $spec_str; goto nFh94; nFh94: LPgMA: goto IjA71; d0a5P: $spec_value_array = explode("\x2c", $v["\163\x70\145\143\x5f\x69\x64\x5f\141\162\162\x61\171"]); goto LMVIj; BClnR: CZYfj: goto D33wD; MX4L5: foreach ($spec_value_array as $key => $value) { goto NE3i_; fRX56: $spec_str = $spec_str . "\x2c" . $spec_array["\x73\x70\145\143\x5f\156\141\155\x65"]; goto zFNPj; zFNPj: FVLX9: goto pUfHU; NE3i_: $spec_array = $spec->getInfo(["\x73\x70\145\143\137\151\x64" => $value], "\x73\x70\x65\x63\137\156\x61\155\x65", ''); goto fRX56; pUfHU: } goto BClnR; IjA71: } goto y3Z7P; y3Z7P: kxK3q: goto p2bAV; aP2QF: $list = $attribute->getPageLisy($condition, $search_text, $order = ''); goto thRKW; t8PME: return $list; goto v7fcG; NVpzY: aT4_P: goto ZkGLo; jUbKF: $attribute_value = new GoodsAttrValue(); goto hqZnf; MJiXW: $attribute = new GoodsAttrModule(); goto jUbKF; ANVIq: foreach ($list as $k => $v) { goto OQYHz; K4cFO: $list[$k]["\x76\x61\x6c\165\145\137\163\x74\x72"] = $value_str; goto FLJyN; JOnt2: foreach ($attr_value_array as $kn => $vn) { goto kE5V6; kE5V6: $attr_array = $attribute_value->getInfo(["\141\164\x74\162\x5f\166\141\x6c\x75\x65\137\x69\x64" => $vn], "\141\164\x74\162\137\166\x61\x6c\165\x65\x5f\x6e\141\x6d\145", ''); goto jOafa; jOafa: $value_str = $value_str . "\x2c" . $attr_array["\x61\164\x74\162\137\x76\141\x6c\165\x65\x5f\156\x61\x6d\145"]; goto RzOgQ; RzOgQ: q4AxW: goto zWq3H; zWq3H: } goto UElZT; UElZT: d018Y: goto wKA99; wKA99: $value_str = substr($value_str, 1); goto K4cFO; svEh7: $value_str = ''; goto JOnt2; FLJyN: TU2oq: goto wRoVx; OQYHz: $attr_value_array = explode("\54", $v["\141\x74\x74\162\x5f\166\x61\154\x75\145\137\x69\x64"]); goto svEh7; wRoVx: } goto NVpzY; hqZnf: $spec = new GoodsSpec(); goto aP2QF; v7fcG: } public function getAttributeServiceDetail($attr_id, $condition = '') { goto pW0p2; wINZ4: $exp = explode("\54", $info["\166\141\x6c\165\x65"]); goto b2qGH; b2qGH: $info["\x65\x78\160"] = $exp; goto T7pqy; T7pqy: return $info; goto srPRy; pW0p2: $attribute = new GoodsAttrValue(); goto jvKgw; jvKgw: $info = $attribute->get($attr_id); goto wINZ4; srPRy: } public function deleteAttributeValueService($attr_id, $attr_value_id) { goto LS13K; y6Rqo: return -2; goto y3le3; Zy3NS: return $attribute_value->destroy($attr_value_id); goto bqu9F; LS13K: $attribute_value = new GoodsAttrValue(); goto uSffU; i7uxL: if ($result == 1) { goto sSRRF; } goto Zy3NS; uSffU: $result = $this->getGoodsAttrValueCount(["\x61\x74\164\x72\x5f\x69\144" => $attr_id]); goto i7uxL; mY7Cm: sSRRF: goto y6Rqo; bqu9F: goto V0ryI; goto mY7Cm; y3le3: V0ryI: goto yMCWJ; yMCWJ: } public function deleteAttributeService($attr_id) { goto qYi84; Dqv7z: $res = $attribute_value->destroy(["\x61\164\x74\x72\x5f\166\x61\154\165\x65\137\151\x64" => $attr_id]); goto BjArt; BjArt: return $res; goto U124Z; qYi84: $attribute_value = new GoodsAttrValue(); goto Dqv7z; U124Z: } public function getGoodsAttrValueCount($condition) { goto iHldU; EYylR: $count = $attr_value->where($condition)->count(); goto ahtx4; iHldU: $attr_value = new GoodsAttrValue(); goto EYylR; ahtx4: return $count; goto scfRq; scfRq: } public function getAttributeValueServiceList($condition = '', $field = "\x2a", $order = '') { $attribute_value = new GoodsAttrValue(); return $attribute_value->getQuerys($condition, $field, $order); } public function getAttributeInfo($condition) { goto dONup; MxoTD: return $info; goto qb6qM; dONup: $attribute = new GoodsAttrModule(); goto kTmLF; kTmLF: $info = $attribute->getInfo($condition, "\52"); goto MxoTD; qb6qM: } public function getSpecInfo($condition) { goto gLTa0; g2RFt: $info = $attribute->getInfo($condition, "\x2a"); goto LLsJx; LLsJx: return $info; goto laJWQ; gLTa0: $attribute = new GoodsSpecValue(); goto g2RFt; laJWQ: } public function getGoodsSpecQuery($condition) { goto CwkvC; M5TSa: $goods_spec_query = $goods_spec->getQuerys($condition, "\x2a", "\163\x6f\162\x74"); goto a9Vrz; l_cz9: return $goods_spec_query; goto cyOIu; CwkvC: $goods_spec = new GoodsSpec(); goto M5TSa; YEGGh: GaDSK: goto l_cz9; a9Vrz: foreach ($goods_spec_query as $k => $v) { goto KF0_n; A6F_R: eQXzV: goto rfYd_; KF0_n: $goods_spec_value = new GoodsSpecValue(); goto WtB4T; WtB4T: $goods_spec_value_query = $goods_spec_value->getQuerys(["\x73\x70\145\x63\137\151\144" => $v["\163\x70\145\143\x5f\151\144"]], "\52", ''); goto yJV6y; yJV6y: $goods_spec_query[$k]["\x76\x61\154\165\145\163"] = $goods_spec_value_query; goto A6F_R; rfYd_: } goto YEGGh; cyOIu: } public function addGoodsSpecValue($spec_id, $spec_value, $sort = 0) { goto MCIA0; vWmFJ: return $find_id["\x73\x70\x65\x63\x5f\166\141\154\x75\145\137\151\144"]; goto b440w; Mvhpc: $find_id = $spec_value_model->get(["\163\160\145\143\x5f\x76\141\154\x75\145\137\x6e\x61\155\x65" => $spec_value, "\x73\x70\145\143\x5f\151\144" => $spec_id]); goto CamFU; b440w: NpJ3m: goto WujB8; XzGqo: $data = array("\163\x70\x65\x63\137\x69\144" => $spec_id, "\x73\x70\x65\x63\x5f\x76\x61\154\x75\x65\x5f\x6e\141\x6d\x65" => $spec_value, "\x73\x6f\x72\164" => $sort, "\143\162\145\141\x74\x65\137\164\151\155\145" => time()); goto Mvhpc; CamFU: if (!empty($find_id)) { goto Pmakm; } goto fBnVf; NfhAN: return $spec_value_model->spec_value_id; goto uwIM9; fBnVf: $res = $spec_value_model->save($data); goto NfhAN; ARSEh: Pmakm: goto vWmFJ; uwIM9: goto NpJ3m; goto ARSEh; MCIA0: $spec_value_model = new GoodsSpecValue(); goto XzGqo; WujB8: } public function getGoodsAttrSpecQuery($condition) { goto xSZLu; xSZLu: if (!($condition["\141\x74\x74\x72\x5f\151\144"] == 0)) { goto Is0yQ; } goto GysRP; uL2Z6: $attribute_list = $attribute_detail["\166\141\x6c\165\x65\137\x6c\151\163\x74"]; goto xJcmI; Ecwac: $list["\163\160\x65\143\137\x6c\x69\x73\x74"] = $spec_list; goto ohUUh; pQeRM: return $list; goto kXLm3; MWMP1: $spec_list = $this->getGoodsSpecQuery($condition_spec); goto KCKcZ; GysRP: return -1; goto oVK0W; KCKcZ: $attribute_detail = $this->getAttributeServiceInfo($condition["\141\164\x74\x72\x5f\x69\x64"], ["\x69\163\x5f\x73\x65\x61\x72\x63\150" => 1]); goto uL2Z6; DDnK9: $condition_spec["\x73\160\145\x63\137\x69\x64"] = array("\x69\x6e", $goods_attribute["\x73\x70\145\x63\137\x69\x64\x5f\x61\x72\x72\x61\x79"]); goto do1Be; V4n9u: $goods_attribute = $this->getAttributeInfo($condition); goto DDnK9; xJcmI: foreach ($attribute_list as $k => $v) { goto zLXnp; wGsqG: uaXIy: goto n_SVw; zLXnp: $value_items = explode("\x2c", $v["\x76\x61\154\165\x65"]); goto up4GO; up4GO: $attribute_list[$k]["\166\141\x6c\165\145\x5f\151\164\145\x6d\163"] = $value_items; goto wGsqG; n_SVw: } goto jWgky; oVK0W: Is0yQ: goto V4n9u; jWgky: d9KZY: goto Ecwac; ohUUh: $list["\x61\164\164\162\151\142\165\164\x65\137\154\151\x73\x74"] = $attribute_list; goto pQeRM; do1Be: $condition_spec["\x69\163\x5f\166\151\163\151\x62\x6c\145"] = 1; goto MWMP1; kXLm3: } public function getAttributeServiceInfo($attr_id, $condition = '') { goto Bu58h; kl73d: $array = $this->getAttributeValueServiceList($condition, $field = "\x2a", $order = ''); goto bgmfw; Bu58h: $attribute = new GoodsAttrModule(); goto KBnA3; KBnA3: $info = $attribute->get($attr_id); goto rP8sL; o4AAZ: IP5Ql: goto cp2pY; NPuLZ: $condition["\141\x74\x74\162\x5f\x76\141\x6c\x75\x65\x5f\151\144"] = array("\x69\x6e", $info["\x61\164\164\x72\x5f\166\141\154\x75\145\137\151\144"]); goto kl73d; rP8sL: $array = array(); goto EYBFC; Yp1Ph: if (empty($info)) { goto IP5Ql; } goto NPuLZ; cp2pY: return $info; goto Df4c2; bgmfw: $info["\166\x61\x6c\x75\145\137\x6c\x69\x73\x74"] = $array; goto o4AAZ; EYBFC: $condition = array(); goto Yp1Ph; Df4c2: } private function getGoodsCategoryId($category_id) { goto im4dC; iU_8X: return array($info_parent["\x70\151\144"], $info["\160\x69\144"], $category_id); goto CyYi0; E1_iF: if (!($info["\154\x65\166\145\x6c"] == 3)) { goto UOjS4; } goto kbcoZ; HlLQO: return array($info["\160\x69\144"], $category_id, 0); goto wrqB1; GQ0Fq: ur8pM: goto iEVLd; qgRBO: if (!($info["\154\145\166\145\x6c"] == 1)) { goto ur8pM; } goto zZqXM; wrqB1: pvyYu: goto E1_iF; zZqXM: return array($category_id, 0, 0); goto GQ0Fq; im4dC: $goods_category = new \app\common\model\GoodsCate(); goto IVNyw; CyYi0: UOjS4: goto GpSgh; IVNyw: $info = $goods_category->get($category_id); goto qgRBO; iEVLd: if (!($info["\154\145\166\145\154"] == 2)) { goto pvyYu; } goto HlLQO; kbcoZ: $info_parent = $goods_category->get($info["\160\x69\144"]); goto iU_8X; GpSgh: } public function addOrEditGoods($this_lib, $mch_id, $goods_id, $goods_name, $category_id, $supplier_id, $brand_id, $market_price, $price, $cost_price, $shipping_fee, $shipping_fee_id, $stock, $min_buy, $clicks, $sales, $picture, $keywords, $introduction, $description, $sort, $image_array, $sku_array, $state, $goods_attribute_id, $goods_attribute, $goods_spec_format, $sku_picture_values, $barcode) { goto woT2T; N868n: $this->goods->startTrans(); goto E2Qqc; woT2T: $error = 0; goto N868n; E2Qqc: try { goto nBOHF; aYcw3: return $goods_id; goto KxHge; AZkZN: $ismain_id = ''; goto CldSb; fbL2j: $goods_id = $this->goods->goods_id; goto p3WXA; aa1QC: if (!($this_lib == 1 && $goods_id != 0)) { goto NYO73; } goto IUsv_; ENzfz: $this->spec_format($goods_id, $spce); goto w4Iwk; PsPjy: $res = $goods_sku->save($sku_data); goto Q4279; WinRq: ouxGo: goto p9h0o; r_YO3: $this->goods->rollback(); goto WM3u0; lFKxA: if ($res) { goto Ba16y; } goto C5SPz; C5SPz: $error = 1; goto qKiAe; S5hiU: ypQ38: goto toa1I; IUsv_: $data_goods["\x63\x72\145\141\x74\145\137\164\151\x6d\x65"] = time(); goto t8Dtz; GliSW: if ($error == 0) { goto jVQbI; } goto r_YO3; b19eM: goto DKZdV; goto LhWrF; y8h0T: $this->spec_format($goods_id, $spce); goto jcxJW; kdvy0: goto Dqr32; goto QkAbU; DLLLX: $res = $this->goods->save($data_goods, ["\147\157\x6f\x64\x73\x5f\151\144" => $goods_id]); goto y8h0T; N1Xrk: if (!empty($sku_array)) { goto Bmdzx; } goto kRGDB; Ld3bj: NYO73: goto Y3H3y; Q4279: if ($res) { goto nDy_X; } goto orY7z; LhWrF: RZ5pF: goto Y9_Ov; t8Dtz: $data_goods["\163\141\154\x65\137\x64\x61\x74\x65"] = time(); goto T1MSU; iXFq6: $this->goods->commit(); goto aYcw3; GVhV2: Bmdzx: goto mb2L7; xKaAi: $count = $goods_sku->getCount(["\147\157\x6f\144\163\137\151\144" => $goods_id]); goto cwc4v; FjOoi: W3jnL: goto OmbKX; sH7iX: if (!($goods_id > 0 && $this_lib == 0)) { goto CRngg; } goto qyP0e; cOSb7: nDy_X: goto Vc9IN; w4Iwk: if (!empty($sku_array)) { goto ypQ38; } goto ovlA9; w9cse: foreach ($sku_picture_array as $sku_img) { goto JOmvQ; PtV7n: $sku_imgs[$img_k] = $sku_img["\x69\155\x67\137\151\144\x73"]; goto u1T9x; u1T9x: jMcKa: goto HrXm0; tXsO2: $img_k = $sku_img["\x73\x70\x65\143\137\x69\x64"] . "\x3a" . $sku_img["\163\160\x65\143\137\x76\x61\x6c\x75\145\137\151\x64"]; goto PtV7n; JOmvQ: $ismain_id = $sku_img["\x73\160\145\x63\x5f\151\144"]; goto tXsO2; HrXm0: } goto HGOxU; uG_Cb: $sku_data = array("\x67\157\157\x64\x73\137\x69\x64" => $goods_id, "\x73\153\x75\x5f\156\x61\x6d\x65" => '', "\x6d\x61\162\153\x65\x74\x5f\160\162\x69\143\x65" => $market_price, "\x70\162\151\x63\145" => $price, "\160\162\157\155\x6f\x74\x65\x5f\160\x72\151\143\145" => $price, "\143\x6f\x73\164\x5f\x70\162\x69\x63\x65" => $cost_price, "\163\x74\x6f\x63\153" => $stock, "\x69\x6d\141\x67\145\163" => 0, "\165\x70\x64\141\x74\x65\137\144\x61\164\x65" => time()); goto Kuajc; UFzPo: gYAX3: goto FjOoi; OvZhc: foreach ($sku_list_array as $k => $v) { goto V2UIS; Ff3qc: $res = $this->addOrUpdateGoodsSkuItem($goods_id, $v, $img_ids, $sku_picture_array); goto LpmoX; OwJv2: uBQCv: goto Ff3qc; qsayk: D8Fi6: goto WfOmY; jrH2L: $error = 1; goto vIFGx; LpmoX: if ($res) { goto coM1g; } goto jrH2L; vIFGx: coM1g: goto qsayk; ZrV5I: foreach ($sku_imgs as $img_k => $img_v) { goto pFJUJ; HGdDY: $img_ids = $img_v; goto hAZEm; rBw0v: PfQ_N: goto c2SHJ; Fcp92: YKPMy: goto rBw0v; pFJUJ: if (!strpos($v, $img_k)) { goto YKPMy; } goto HGdDY; hAZEm: goto uBQCv; goto Fcp92; c2SHJ: } goto OwJv2; V2UIS: $img_ids = ''; goto ZrV5I; WfOmY: } goto isINs; O502j: jGxGa: goto z2C7g; z2C7g: $data_goods["\x67\x6f\x6f\144\x73\x5f\x73\160\145\x63\x5f\x66\157\162\x6d\141\x74"] = json_encode($spce, true); goto aa1QC; BVoPh: $sku_data = array("\147\x6f\x6f\144\x73\x5f\151\144" => $goods_id, "\x73\153\x75\137\156\141\155\145" => '', "\155\x61\162\153\145\x74\137\160\162\151\143\145" => $market_price, "\x70\x72\x69\143\x65" => $price, "\160\162\157\x6d\157\x74\145\137\x70\x72\x69\x63\145" => $price, "\143\157\163\164\x5f\160\162\151\143\x65" => $cost_price, "\x73\164\x6f\143\x6b" => $stock, "\x69\155\x61\x67\x65\163" => 0, "\143\162\x65\141\164\x65\137\144\141\164\x65" => time()); goto Gh_4A; Llgon: $goods_id = $this->goods->goods_id; goto ENzfz; OmbKX: CRngg: goto GliSW; gsQVk: IO6Pa: goto l0GmJ; cwc4v: if ($count > 0) { goto RZ5pF; } goto Kig9H; boGaw: DKZdV: goto yVGAs; XdMDD: goto ouxGo; goto GVhV2; LSfK0: $spce = json_decode($goods_spec_format, true); goto wIJma; orY7z: $error = 1; goto cOSb7; l0GmJ: $sku_list_array = explode("\xc2\247", $sku_array); goto xCgkb; Gh_4A: $res = $goods_sku->save($sku_data); goto lFKxA; ovlA9: $goods_sku = new GoodsSku(); goto vqGyK; qKiAe: Ba16y: goto XdMDD; NaItU: AJ8TA: goto WinRq; kRGDB: $goods_sku = new GoodsSku(); goto BVoPh; UXAaV: foreach ($sku_list_array as $k => $v) { goto jThg6; aqVMA: qhnnk: goto hi62O; Lim5a: $error = 1; goto h2oXk; fm70b: if ($res) { goto qrIUp; } goto Lim5a; h2oXk: qrIUp: goto AtHcT; AtHcT: RG5wp: goto e3Ndw; hi62O: $res = $this->addOrUpdateGoodsSkuItem($goods_id, $v, $img_ids, $sku_picture_array); goto fm70b; jThg6: $img_ids = ''; goto DjdGg; DjdGg: foreach ($sku_imgs as $img_k => $img_v) { goto hY0MO; m9BnH: goto qhnnk; goto o90ue; hY0MO: if (!strpos($v, $img_k)) { goto jyNgh; } goto QLE3y; o90ue: jyNgh: goto qEvBC; QLE3y: $img_ids = $img_v; goto m9BnH; qEvBC: myYGI: goto Xyl0z; Xyl0z: } goto aqVMA; e3Ndw: } goto UFzPo; CsRhD: $data_goods["\163\x61\x6c\x65\x5f\144\x61\x74\x65"] = time(); goto Myy4O; qyP0e: $data_goods["\x75\x70\x64\x61\x74\x65\x5f\x74\151\155\145"] = time(); goto DLLLX; xCgkb: $this->deleteSkuItem($goods_id, $sku_list_array); goto UXAaV; KxHge: Dqr32: goto tBNkG; Vc9IN: goto FLJUF; goto S5hiU; QkAbU: jVQbI: goto iXFq6; T1MSU: $this->goods->save($data_goods); goto Llgon; wIJma: $sku_picture_array = json_decode($sku_picture_values, true); goto AZkZN; vqGyK: $sku_data = array("\x67\x6f\157\x64\163\x5f\151\144" => $goods_id, "\163\x6b\165\x5f\156\141\x6d\145" => '', "\x6d\141\x72\x6b\145\x74\137\x70\162\x69\x63\145" => $market_price, "\160\162\x69\x63\145" => $price, "\x70\162\x6f\x6d\157\x74\145\137\160\x72\151\143\x65" => $price, "\143\157\x73\164\137\x70\x72\151\143\x65" => $cost_price, "\x73\164\x6f\x63\x6b" => $stock, "\x69\155\141\147\145\163" => 0, "\x63\162\145\x61\x74\145\137\x64\x61\x74\145" => time()); goto PsPjy; Myy4O: $this->goods->save($data_goods); goto fbL2j; isINs: nTJVY: goto B2kGk; ReEd7: $data_goods["\x63\162\x65\x61\x74\x65\137\x74\151\x6d\145"] = time(); goto CsRhD; Y9_Ov: $retval = $goods_sku->destroy(["\147\157\x6f\144\163\137\151\x64" => $goods_id, "\x61\164\164\x72\x5f\166\141\154\165\145\137\151\x74\145\155\163" => array("\x4e\105\121", '')]); goto KBcNz; Kig9H: $res = $goods_sku->save($sku_data); goto b19eM; JTQw8: foreach ($spce as &$sku_item) { goto FrjW1; ss4RT: goto xwOkx; goto g3HEa; JbhN_: unset($sku_item["\151\x73\x6d\141\151\156"]); goto ss4RT; ZJTAP: TWJgJ: goto Ltq9N; g3HEa: TeDH4: goto bQCm9; bQCm9: $sku_item["\151\163\155\141\x69\x6e"] = true; goto YNIEi; caQom: foreach ($sku_item["\166\x61\154\165\145"] as &$sku_value) { goto UC5Yd; hXFl1: goto WZ7lH; goto fVKaI; N_JBL: if (isset($sku_imgs[$sk])) { goto F5LQK; } goto K018A; BptJ8: WZ7lH: goto aZREx; aZREx: ZzDVu: goto wlhl3; UC5Yd: $sk = $sku_value["\x73\x70\145\x63\x5f\151\x64"] . "\x3a" . $sku_value["\x73\160\x65\x63\137\x76\141\x6c\165\145\137\151\x64"]; goto N_JBL; K018A: unset($sku_value["\151\x6d\141\147\145\163"]); goto hXFl1; fVKaI: F5LQK: goto TMKXr; TMKXr: $sku_value["\151\155\x61\147\x65\163"] = $sku_imgs[$sk]; goto BptJ8; wlhl3: } goto oB5pr; oB5pr: C98rO: goto ZJTAP; FrjW1: if ($sku_item["\x73\160\x65\x63\137\x69\x64"] == $ismain_id) { goto TeDH4; } goto JbhN_; YNIEi: xwOkx: goto caQom; Ltq9N: } goto O502j; HGOxU: lE7bz: goto JTQw8; yVGAs: goto W3jnL; goto gsQVk; p3WXA: $this->spec_format($goods_id, $spce); goto N1Xrk; dBSmN: foreach ($sku_list_array as $k => $v) { goto IFnxd; IFnxd: $img_ids = ''; goto vHZ4T; eDaJD: UAgC_: goto kc2cz; Y4mJN: if ($res) { goto UAgC_; } goto fjYsO; vHZ4T: foreach ($sku_imgs as $img_k => $img_v) { goto Bwkb5; FhhqD: goto aVm1O; goto dXDPO; kh_1Y: ukQUw: goto LYABH; lkun_: $img_ids = $img_v; goto FhhqD; dXDPO: djOcn: goto kh_1Y; Bwkb5: if (!strpos($v, $img_k)) { goto djOcn; } goto lkun_; LYABH: } goto O2CxM; fjYsO: $error = 1; goto eDaJD; mXtc3: $res = $this->addOrUpdateGoodsSkuItem($goods_id, $v, $img_ids, $sku_picture_array); goto Y4mJN; O2CxM: aVm1O: goto mXtc3; kc2cz: axnQa: goto kp5Ox; kp5Ox: } goto NaItU; CldSb: $sku_imgs = array(); goto w9cse; nBOHF: $data_goods = array("\x67\x6f\x6f\x64\x73\x5f\x6e\141\x6d\x65" => $goods_name, "\x63\141\164\145\x5f\151\144" => $category_id, "\163\165\x70\x70\x6c\x69\x65\162\x5f\x69\144" => $supplier_id, "\142\162\x61\x6e\x64\x5f\151\x64" => $brand_id, "\155\x61\162\153\x65\x74\137\160\x72\151\x63\145" => $market_price, "\x70\x72\151\x63\x65" => $price, "\x70\x72\x6f\x6d\157\164\151\157\156\x5f\x70\x72\x69\x63\x65" => $price, "\x63\x6f\163\x74\x5f\160\162\151\143\145" => $cost_price, "\163\x68\151\160\x70\x69\156\147\137\146\x65\145" => $shipping_fee, "\163\x68\151\160\x70\151\x6e\147\137\x66\145\x65\x5f\x69\144" => $shipping_fee_id, "\x73\x74\157\x63\153" => $stock, "\155\151\156\x5f\142\165\x79" => $min_buy, "\143\x6c\x69\x63\153\x73" => $clicks, "\163\141\x6c\x65\x73" => $sales, "\x6b\x65\171\x77\x6f\x72\x64\163" => $keywords, "\x69\x6e\164\162\157\x64\165\x63\x74\x69\157\x6e" => $introduction, "\x64\145\x73\x63\x72\x69\x70\164\151\x6f\156" => $description, "\x73\x6f\x72\x74" => $sort, "\x69\155\x61\147\x65\x73" => $picture, "\x69\x6d\x67\x5f\x69\x64\137\141\x72\162\x61\171" => $image_array, "\x73\164\x61\x74\x65" => $state, "\147\x6f\x6f\x64\x73\x5f\x61\x74\164\162\x69\142\165\x74\x65\137\x69\144" => $goods_attribute_id, "\147\x6f\157\x64\x73\137\x61\x74\x74\162\151\142\165\164\145" => $goods_attribute, "\147\157\157\144\163\137\163\160\145\x63\x5f\146\157\162\x6d\x61\x74" => $goods_spec_format, "\x6d\x63\x68\x5f\151\x64" => $mch_id, "\142\x61\162\143\157\x64\x65" => $barcode); goto LSfK0; Kuajc: $goods_sku = new GoodsSku(); goto xKaAi; toa1I: $sku_list_array = explode("\xc2\247", $sku_array); goto OvZhc; B2kGk: FLJUF: goto Ld3bj; jcxJW: if (!empty($sku_array)) { goto IO6Pa; } goto uG_Cb; p9h0o: WuDwJ: goto sH7iX; mb2L7: $sku_list_array = explode("\302\247", $sku_array); goto dBSmN; Y3H3y: if (!($this_lib == 1 && $goods_id == 0)) { goto WuDwJ; } goto ReEd7; KBcNz: $res = $goods_sku->save($sku_data, ["\x67\157\x6f\x64\x73\137\x69\x64" => $goods_id]); goto boGaw; WM3u0: return 0; goto kdvy0; tBNkG: } catch (\Exception $e) { $this->goods->rollback(); return $e->getMessage(); } goto nu6Kj; nu6Kj: } public function spec_format($goods_id, $spec_list) { foreach ($spec_list as $k => $v) { goto UAu9h; UAu9h: foreach ($v["\x76\141\x6c\x75\x65"] as $x => $y) { goto PW4ya; TjrfC: $sku_form->save($data, ["\151\x64" => $check["\151\x64"]]); goto Veh1u; kAfLp: S9QA4: goto TjrfC; Nzpin: $sku_form->save($data); goto SZlbF; uQn2q: if ($check) { goto S9QA4; } goto Nzpin; KmI2D: $data = array("\147\x6f\x6f\x64\x73\x5f\151\x64" => $goods_id, "\163\160\145\x63\x5f\166\141\154\x75\145\137\x6e\x61\x6d\x65" => $y["\163\x70\145\143\137\166\141\x6c\165\145\x5f\156\141\155\145"], "\163\160\145\x63\x5f\156\141\155\145" => $y["\163\x70\145\x63\137\x6e\x61\155\145"], "\x73\160\145\x63\x5f\x69\x64" => $y["\163\x70\145\x63\137\x69\144"], "\x73\x70\x65\143\137\x76\141\x6c\x75\145\137\151\x64" => $y["\x73\x70\x65\x63\x5f\166\141\154\x75\x65\x5f\151\x64"]); goto pk9Yd; pk9Yd: $check = Db::name("\x79\x62\163\143\137\x67\157\157\x64\163\137\163\x70\x65\143\x5f\146\x6f\x72\155\141\164")->where($data)->find(); goto uQn2q; Veh1u: GP7e9: goto EMA9B; SZlbF: goto GP7e9; goto kAfLp; EMA9B: DlO_V: goto gw9UB; PW4ya: $sku_form = new GoodsSpecFormat(); goto KmI2D; gw9UB: } goto WDpwq; WDpwq: u5eZR: goto kf9IO; kf9IO: vOOUM: goto towfl; towfl: } cNGtj: } private function deleteSkuItem($goods_id, $sku_list_array) { goto CbZwg; u6hfp: foreach ($sku_list_array as $k => $sku_item_array) { goto f3WRt; Rgss2: $sku_item_list_array[] = $sku_item[0]; goto QCliO; QCliO: cAlgB: goto zfNRR; f3WRt: $sku_item = explode("\xc2\246", $sku_item_array); goto Rgss2; zfNRR: } goto f2sg1; s0a8f: $goods_sku = new GoodsSku(); goto cUZUz; f2sg1: guAHx: goto s0a8f; qFYFd: GRIib: goto nKEGb; gBKJ2: wgXHa: goto qFYFd; AfY2d: foreach ($list as $k => $v) { goto ZWIz2; uFYgp: kZXza: goto tql4O; tql4O: P2oub: goto U5rxr; IQxw4: $goods_sku->destroy($v["\163\153\165\x5f\x69\x64"]); goto uFYgp; ZWIz2: if (in_array($v["\141\x74\x74\x72\x5f\166\x61\x6c\x75\145\137\151\164\x65\155\x73"], $sku_item_list_array)) { goto kZXza; } goto IQxw4; U5rxr: } goto gBKJ2; cUZUz: $list = $goods_sku->where("\147\157\x6f\x64\163\137\151\144\x3d" . $goods_id)->select(); goto QRvhj; CbZwg: $sku_item_list_array = array(); goto u6hfp; QRvhj: if (empty($list)) { goto GRIib; } goto AfY2d; nKEGb: } public function addGoodsSkuPicture($goods_id, $sku_img_array) { goto QqNxE; sDtHc: return $retval; goto Z_8Zo; QqNxE: $goods_sku_picture = new GoodsSku(); goto eb4Ml; JHUbN: $retval = $goods_sku_picture->save($data); goto sDtHc; eb4Ml: $data = array("\147\157\157\x64\163\x5f\151\144" => $goods_id, "\x69\x6d\141\147\145\x73" => $sku_img_array); goto JHUbN; Z_8Zo: } private function addOrUpdateGoodsSkuItem($goods_id, $sku_item_array, $img_ids, $img_arr) { goto F_iSy; vqTjC: P_IOB: goto ZbEgP; jMYCj: suz2t: goto GoiaV; KI4fO: $data = array("\147\x6f\157\144\x73\x5f\x69\x64" => $goods_id, "\x73\153\x75\137\156\141\x6d\145" => $sku_name, "\x70\162\151\x63\145" => $sku_item[1], "\160\162\157\155\x6f\164\145\x5f\160\x72\151\143\145" => $sku_item[1], "\155\x61\x72\153\x65\x74\x5f\160\x72\151\143\x65" => $sku_item[2], "\143\157\163\x74\137\160\162\x69\143\145" => $sku_item[3], "\x73\x74\157\143\153" => $sku_item[4], "\x69\155\141\147\145\x73" => $img_ids, "\x75\x70\x64\x61\164\x65\x5f\144\x61\164\145" => time()); goto e5vMU; oD9xJ: return $goods_sku->sku_id; goto jMYCj; sbqm0: $goods_sku->save($data); goto oD9xJ; ymjWq: $aa = explode("\x3b", $sku_item[0]); goto k7JWG; ZbEgP: ceSON: goto N3uX3; CqIbb: if (!(!empty($sku_item[0]) && !empty($img_arr))) { goto ceSON; } goto ymjWq; UCopb: $condition = array("\147\157\x6f\144\163\x5f\x69\x64" => $goods_id, "\141\x74\164\162\137\x76\x61\154\x75\145\x5f\151\164\x65\x6d\x73" => $sku_item[0]); goto CqIbb; Qau0w: $data = array("\x67\157\x6f\x64\x73\x5f\x69\x64" => $goods_id, "\163\x6b\x75\x5f\x6e\x61\155\x65" => $sku_name, "\141\x74\x74\x72\x5f\166\141\x6c\x75\x65\137\x69\164\145\155\x73" => $sku_item[0], "\160\x72\x69\x63\x65" => $sku_item[1], "\160\x72\x6f\x6d\x6f\x74\145\137\x70\162\x69\x63\x65" => $sku_item[1], "\155\x61\x72\153\x65\x74\x5f\160\162\151\x63\x65" => $sku_item[2], "\143\x6f\163\x74\x5f\160\x72\x69\x63\145" => $sku_item[3], "\x73\164\x6f\x63\x6b" => $sku_item[4], "\151\x6d\141\x67\x65\163" => $img_ids, "\143\x72\x65\141\164\145\137\144\141\x74\x65" => time()); goto sbqm0; Wur4k: rFf8x: goto Qau0w; k7JWG: if (!$aa) { goto P_IOB; } goto uosfo; xgHbV: $goods_sku = new GoodsSku(); goto NUNuh; N3uX3: $sku_count = $goods_sku->where($condition)->find(); goto M2WzJ; F_iSy: $sku_item = explode("\xc2\xa6", $sku_item_array); goto xgHbV; NUNuh: $sku_name = $this->createSkuName($sku_item[0]); goto UCopb; jgWzA: return $res; goto eA29Q; eA29Q: goto suz2t; goto Wur4k; M2WzJ: if (empty($sku_count)) { goto rFf8x; } goto KI4fO; bAOjH: ZaZen: goto vqTjC; uosfo: foreach ($aa as $k => $v) { goto m15xL; m15xL: $v = explode("\72", $v); goto nC85b; KJ8x5: avIt4: goto Imnd1; Tkekf: a0O1H: goto KJ8x5; dCCQF: $i++; goto Mrme1; ntmNQ: if (!($img_arr[$i]["\x73\x70\145\143\137\x69\x64"] == $v[0] && $img_arr[$i]["\x73\x70\145\143\x5f\166\141\x6c\x75\145\x5f\151\x64"] == $v[1])) { goto b2VI8; } goto Z1ieH; Mrme1: goto xoyy3; goto Tkekf; Z1ieH: $img_ids = $img_arr[$i]["\151\x6d\147\137\151\x64\163"]; goto iCMUO; FmKmF: xoyy3: goto IOka7; IOka7: if (!($i < count($img_arr))) { goto a0O1H; } goto ntmNQ; nC85b: $i = 0; goto FmKmF; V58Ot: xX0tR: goto dCCQF; iCMUO: b2VI8: goto V58Ot; Imnd1: } goto bAOjH; e5vMU: $res = $goods_sku->save($data, ["\163\153\165\x5f\151\144" => $sku_count["\x73\153\x75\137\151\x64"]]); goto jgWzA; GoiaV: } private function createSkuName($pvs) { goto p8FyV; p8FyV: $name = ''; goto wVZW_; AQXxZ: foreach ($pvs_array as $k => $v) { goto rFmdo; rFmdo: $value = explode("\x3a", $v); goto hfxmD; t0GK8: $name = $name . $value_name["\x73\160\x65\x63\137\166\x61\154\165\145\137\x6e\141\155\145"] . "\40"; goto GbpSo; hfxmD: $prop_id = $value[0]; goto vKl2m; GbpSo: OT_o7: goto R1PuZ; syv6U: $value_name = $goods_spec_value_model->getInfo(["\x73\x70\x65\x63\137\166\141\x6c\x75\145\x5f\x69\x64" => $prop_value], "\163\160\145\143\137\166\x61\x6c\165\x65\137\156\141\x6d\145"); goto t0GK8; vKl2m: $prop_value = $value[1]; goto pLqg3; pLqg3: $goods_spec_value_model = new GoodsSpecValue(); goto syv6U; R1PuZ: } goto Nye6x; yx1Uk: return $name; goto k333k; wVZW_: $pvs_array = explode("\x3b", $pvs); goto AQXxZ; Nye6x: dS7uC: goto yx1Uk; k333k: } public function regainGoodsDeleted($goods_ids) { $this->goods->startTrans(); try { goto keu8j; keu8j: $data = array("\x69\x73\x5f\x64\145\x6c" => 0, "\x75\x70\144\x61\164\145\137\164\x69\155\145" => time()); goto WN2uT; WN2uT: $result = $this->goods->save($data, "\x67\x6f\x6f\x64\163\137\151\144\40\40\x69\156\x28{$goods_ids}\51"); goto fCHX3; sjpD8: return SUCCESS; goto X5ANH; fCHX3: $this->goods->commit(); goto sjpD8; X5ANH: } catch (\Exception $e) { $this->goods->rollback(); return UPDATA_FAIL; } } public function deleteRecycleGoods($goods_id) { goto RG4mk; RG4mk: $goods_delete = new \app\common\model\Goods(); goto xQJeu; xQJeu: $goods_delete->startTrans(); goto Eydnt; Eydnt: try { goto ocAlL; nHlSP: if ($res > 0) { goto IG9fb; } goto HSOun; oSEaI: $goods_delete->commit(); goto nHlSP; ydrCN: IG9fb: goto VmmeU; iw9JQ: qFeMI: goto cX9Pt; GZE36: $goods_id_array = explode("\54", $goods_id); goto ld4g5; mVGcN: C4tCl: goto KP2fq; rIWv4: if (!($res > 0)) { goto Q6yo0; } goto GZE36; VmmeU: return SUCCESS; goto iw9JQ; HSOun: return DELETE_FAIL; goto n25HQ; ld4g5: $goods_sku_model = new GoodsSku(); goto GDZdj; n25HQ: goto qFeMI; goto ydrCN; ocAlL: $res = $goods_delete->where("\x67\x6f\157\144\163\x5f\x69\144\40\x69\156\x20\x28{$goods_id}\51\40")->delete(); goto rIWv4; GDZdj: $goods_attribute_model = new GoodsAttr(); goto vjBwR; vjBwR: foreach ($goods_id_array as $k => $v) { goto aJm9s; WkFTf: $goods_attribute_model->where("\147\x6f\157\x64\163\x5f\151\x64\x20\75\40{$v}")->delete(); goto MAd7j; MAd7j: O8Wig: goto eegTh; aJm9s: $goods_sku_model->where("\147\157\x6f\x64\163\x5f\151\144\x20\75\40{$v}")->delete(); goto WkFTf; eegTh: } goto mVGcN; KP2fq: Q6yo0: goto oSEaI; cX9Pt: } catch (\Exception $e) { $goods_delete->rollback(); return DELETE_FAIL; } goto DNwu8; DNwu8: } public function getGoodsDetail($goods_id) { goto bbuBU; jyg6K: fAB31: goto EIO2N; vyhIB: $goods_img_list = $goods_img->getQuerys(["\x69\155\147\137\x69\x64" => ["\151\156", $goods_detail["\151\155\x67\137\151\144\137\x61\162\162\x61\171"]]], "\x2a", $order); goto Y3hW1; eqsg6: $goods_detail["\x67\x6f\157\144\163\x5f\141\x74\164\x72\151\x62\x75\164\x65\137\x6e\141\x6d\145"] = ''; goto tqNPe; mHdDA: qOg82: goto jyg6K; Vhs6H: $goods_attribute_model = new GoodsAttr(); goto bKgd4; SzuL7: $goods_detail["\x73\160\145\x63\137\154\x69\x73\x74"] = $spec_list; goto AfpRN; aMrax: if (empty($spec_list)) { goto UQG40; } goto fH9Fr; AfpRN: $goods_img = new \app\common\model\Images(); goto DqDd1; kjkuN: goto wNAaK; goto pyDXB; CnAKW: $album_picture = new \app\common\model\Images(); goto CHyM7; Sgnuq: $attribute_model = new GoodsAttrModule(); goto ZeXnb; rS6vf: return null; goto T1vBu; ZeXnb: $attribute_info = $attribute_model->getInfo(["\141\x74\x74\162\137\151\x64" => $goods_detail["\147\157\157\144\163\x5f\x61\164\164\162\151\x62\x75\164\x65\137\x69\x64"]], "\141\164\x74\162\137\156\x61\x6d\x65"); goto rpvMS; T1vBu: vrJni: goto uQ2zW; Y3hW1: $img_temp_array = array(); goto URqfI; aIuD2: $num = 0; goto dUTX3; a3lAy: $goods_detail["\160\151\x63\164\165\x72\145\x5f\144\x65\164\x61\x69\x6c"] = $goods_picture; goto rD5In; T7yWV: $goods_detail["\x67\x6f\157\144\163\137\141\164\164\162\x69\142\x75\x74\x65\137\x6c\151\x73\164"] = $goods_attribute_list; goto fDFlI; StZH0: $goods_detail["\151\155\147\137\x6c\x69\x73\164"] = $goods_img_list; goto a3lAy; pyDXB: glynX: goto Sgnuq; tqNPe: $goods_detail["\147\x6f\157\144\163\137\141\x74\x74\x72\x69\142\165\164\145\137\x6c\x69\x73\x74"] = array(); goto kjkuN; kXpWR: $spec_list = json_decode($goods_detail["\x67\157\157\x64\x73\137\x73\160\x65\x63\137\146\157\x72\155\x61\164"], true); goto aMrax; uQ2zW: $goods_sku = new GoodsSku(); goto mjjam; DqDd1: $order = "\151\156\x73\x74\x72\x28\47\x2c" . $goods_detail["\151\155\x67\x5f\151\x64\137\x61\x72\x72\141\x79"] . "\54\x27\54\x43\x4f\116\x43\101\124\x28\47\54\47\54\151\155\147\x5f\151\144\54\x27\x2c\x27\51\x29"; goto vyhIB; fDFlI: wNAaK: goto uSqCV; mjjam: $goods_sku_detail = $goods_sku->where("\x67\157\x6f\x64\163\x5f\x69\144\75" . $goods_id)->select(); goto VHIfT; VHIfT: foreach ($goods_sku_detail as $k => $goods_sku) { $goods_sku_detail[$k]["\x6d\x65\155\142\145\x72\137\x70\x72\x69\x63\x65"] = $goods_sku["\x70\x72\151\143\x65"]; F9r9Y: } goto NdI11; y08Lq: $goods_detail["\x69\155\x67\x5f\164\145\x6d\x70\x5f\x61\x72\162\x61\x79"] = $img_temp_array; goto StZH0; dtlLj: $goods_detail["\163\153\165\137\154\151\163\x74"] = $goods_sku_detail; goto kXpWR; COCnW: if (!($goods_detail == null)) { goto vrJni; } goto rS6vf; FjeNP: sort($goos_sku_picture_query); goto muSgS; CHyM7: foreach ($goos_sku_picture_query as $k => $v) { goto ebt7N; ebt7N: if ($v["\x69\155\141\x67\145\163"] != "\60") { goto OD3EM; } goto BFCIs; BOmfd: goto IVykg; goto xw3Yf; rJ5bL: $goos_sku_picture_query[$k]["\x73\x6b\165\137\160\151\x63\164\165\x72\145\137\161\165\145\162\x79"] = $tmp_img_array; goto N6qAt; N6qAt: IVykg: goto smfJ5; BFCIs: unset($goos_sku_picture_query[$k]); goto BOmfd; xw3Yf: OD3EM: goto C232T; C232T: $tmp_img_array = $album_picture->getQuerys(["\x69\155\147\x5f\151\x64" => $v["\x69\155\x61\147\x65\163"]], "\52", ''); goto rJ5bL; smfJ5: lZP8c: goto W5qoP; W5qoP: } goto p3YfI; nzAak: $orderGoods = new \app\common\model\OrderGoods(); goto aIuD2; WL4k8: $goods_detail = $goods->get($goods_id); goto COCnW; A8zZV: UQG40: goto SzuL7; URqfI: if (!(trim($goods_detail["\151\x6d\x67\x5f\x69\x64\137\141\162\x72\x61\171"]) != '')) { goto fAB31; } goto fiChJ; SQTAI: if ($goods_detail["\147\157\x6f\x64\x73\x5f\141\164\x74\x72\151\x62\165\164\145\x5f\151\x64"] != 0) { goto glynX; } goto eqsg6; uSqCV: $goos_sku_picture_query = $goods_sku->getQuerys(["\x67\x6f\x6f\144\x73\137\x69\144" => $goods_id], "\151\x6d\141\147\145\163\x2c\141\x74\x74\162\137\x76\141\x6c\x75\x65\x5f\151\x74\x65\155\x73", ''); goto CnAKW; fH9Fr: foreach ($spec_list as $k => $v) { goto Vgphb; aG0Lv: rfvmX: goto s2Uf1; s2Uf1: avS7V: goto o1nbE; Vgphb: foreach ($v["\166\141\154\165\x65"] as $m => $t) { goto KDhiP; HgOPC: $spec_list[$k]["\166\x61\x6c\165\x65"][$m]["\163\x70\x65\x63\137\163\150\x6f\x77\137\x74\171\x70\145"] = 1; goto ekG1Q; qFTpj: nlvWh: goto XFzYx; ekG1Q: P4mcJ: goto qFTpj; KDhiP: if (!empty($t["\x73\160\x65\x63\x5f\x73\150\157\x77\137\164\x79\x70\x65"])) { goto P4mcJ; } goto HgOPC; XFzYx: } goto aG0Lv; o1nbE: } goto WOY2E; EQSz4: $goods_detail["\x63\141\x74\x65\x5f\x6e\x61\x6d\x65"] = $category_name; goto SQTAI; bbuBU: $goods = new \app\common\model\Goods(); goto WL4k8; rD5In: $category_name = $this->getGoodsCategoryName($goods_detail["\x63\x61\164\145\x5f\x69\x64"]); goto EQSz4; bKgd4: $goods_attribute_list = $goods_attribute_model->getQuerys(["\x67\x6f\x6f\x64\x73\137\151\144" => $goods_id], "\52", ''); goto T7yWV; WOY2E: mxhLa: goto A8zZV; dUTX3: $num = $orderGoods->getSum(["\x67\x6f\x6f\x64\x73\x5f\x69\x64" => $goods_id], "\x6e\x75\155"); goto jrw9Z; viLXc: return $goods_detail; goto sk8y2; NdI11: upBzt: goto dtlLj; EIO2N: $goods_picture = $goods_img->get($goods_detail["\x69\155\141\147\x65\163"]); goto y08Lq; p3YfI: ATEqn: goto FjeNP; muSgS: $goods_detail["\163\153\x75\x5f\x70\x69\x63\x74\165\x72\x65\137\141\162\162\141\x79"] = $goos_sku_picture_query; goto nzAak; rpvMS: $goods_detail["\147\x6f\x6f\144\x73\137\x61\164\x74\x72\x69\142\165\x74\x65\137\156\141\155\145"] = $attribute_info["\141\x74\164\x72\137\156\141\155\x65"]; goto Vhs6H; fiChJ: $img_array = explode("\x2c", $goods_detail["\151\x6d\x67\137\x69\x64\x5f\x61\x72\x72\x61\171"]); goto UpO3M; UpO3M: foreach ($img_array as $k => $v) { goto SfiDv; SfiDv: if (empty($goods_img_list)) { goto B3dt2; } goto HE8xQ; HE8xQ: foreach ($goods_img_list as $t => $m) { goto vwOs7; vwOs7: if (!($m["\x69\155\147\137\151\144"] == $v)) { goto jD32P; } goto DMb8k; nqrcm: OzzIP: goto uuMG4; DMb8k: $img_temp_array[] = $m; goto EYGHq; EYGHq: jD32P: goto nqrcm; uuMG4: } goto bohB4; QSu6q: hm6tL: goto YSv87; vq2Z0: B3dt2: goto QSu6q; bohB4: blMUA: goto vq2Z0; YSv87: } goto mHdDA; jrw9Z: $goods_detail["\160\165\162\143\x68\141\x73\145\137\156\165\x6d"] = $num; goto viLXc; sk8y2: } private function getGoodsCategoryName($cate_id, $name = '') { goto x_sLm; oV1wx: return $name; goto Elyzu; jNmB6: $cate_id = $info["\x70\x69\x64"]; goto Tlcir; eKkHU: $name .= $info["\143\141\x74\145\x5f\x6e\141\155\145"]; goto ka2zK; bwANP: Hnvyi: goto m0nHh; kEVdC: goto JlnLK; goto aguB1; VDVqf: $info = $goods_category->getInfo(["\x63\141\164\145\137\151\x64" => $cate_id], "\x63\x61\164\145\x5f\156\x61\x6d\x65\x2c\160\151\x64"); goto enHku; Elyzu: goto KmMGW; goto DEszn; YukvV: $name = $info["\143\141\x74\145\137\156\x61\x6d\145"] . "\x20\76\40" . $name; goto kEVdC; Tlcir: return $this->getGoodsCategoryName($cate_id, $name); goto UYz2A; ka2zK: JlnLK: goto bwANP; aXhiA: if ($name == '') { goto bwVUW; } goto YukvV; aguB1: bwVUW: goto eKkHU; DEszn: mvgPN: goto jNmB6; m0nHh: if ($info["\x70\151\x64"] != 0) { goto mvgPN; } goto oV1wx; UYz2A: KmMGW: goto GSmD2; x_sLm: $goods_category = new \app\common\model\GoodsCate(); goto VDVqf; enHku: if (empty($info["\143\x61\x74\x65\x5f\x6e\141\x6d\x65"])) { goto Hnvyi; } goto aXhiA; GSmD2: } public function ModifyGoodsRecommend($goods_ids, $re) { goto KVPRk; yFUDE: try { goto IReiH; RYW5W: $data = array("\x69\163\137\x68\157\164" => $re); goto nai2e; MLja6: return 1; goto vgRPg; nai2e: foreach ($goods_id_array as $k => $v) { goto MK0gF; Eco62: YRS6C: goto QTbwp; BNx4H: $goods->save($data, ["\147\x6f\157\x64\163\137\x69\x64" => $v]); goto Eco62; MK0gF: $goods = new \app\common\model\Goods(); goto BNx4H; QTbwp: } goto knqo0; IReiH: $goods_id_array = explode("\54", $goods_ids); goto RYW5W; YO30i: $goods->commit(); goto MLja6; knqo0: dGNvf: goto YO30i; vgRPg: } catch (\Exception $e) { $goods->rollback(); return $e->getMessage(); } goto AH5qz; KVPRk: $goods = new \app\common\model\Goods(); goto xdpj3; xdpj3: $goods->startTrans(); goto yFUDE; AH5qz: } public function ModifyGoodsRecommendNew($goods_ids, $new) { goto KCfxg; KCfxg: $goods = new \app\common\model\Goods(); goto zOpsI; zOpsI: $goods->startTrans(); goto J9LnR; J9LnR: try { goto IY1ad; iypZn: foreach ($goods_id_array as $k => $v) { goto x4yrb; x4yrb: $goods = new \app\common\model\Goods(); goto Diwhj; Diwhj: $goods->save($data, ["\x67\157\157\144\x73\137\x69\144" => $v]); goto QS9Xt; QS9Xt: USUYC: goto RTTEX; RTTEX: } goto zxMy0; Qm1Lf: $data = array("\151\x73\x5f\x6e\145\167" => $new); goto iypZn; N3_d3: $goods->commit(); goto UWARR; zxMy0: IP9_o: goto N3_d3; IY1ad: $goods_id_array = explode("\54", $goods_ids); goto Qm1Lf; UWARR: return 1; goto adaNO; adaNO: } catch (\Exception $e) { $goods->rollback(); return $e->getMessage(); } goto gD_Wg; gD_Wg: } public function ModifyGoodsRecommendTui($goods_ids, $new) { goto c6lJ8; MKS8m: try { goto a6jO1; TLT4i: CAz2q: goto RNzdz; ob2d9: foreach ($goods_id_array as $k => $v) { goto T9InF; uukzQ: $goods->save($data, ["\147\157\157\x64\x73\x5f\151\x64" => $v]); goto ZsEZf; T9InF: $goods = new \app\common\model\Goods(); goto uukzQ; ZsEZf: MurGv: goto HgDGh; HgDGh: } goto TLT4i; RNzdz: $goods->commit(); goto x1URi; a6jO1: $goods_id_array = explode("\x2c", $goods_ids); goto ufFFN; x1URi: return 1; goto q1LJw; ufFFN: $data = array("\151\x73\x5f\x72\145\143\x6f\x6d\x6d\145\156\144" => $new); goto ob2d9; q1LJw: } catch (\Exception $e) { $goods->rollback(); return $e->getMessage(); } goto U50cQ; c6lJ8: $goods = new \app\common\model\Goods(); goto sc6KE; sc6KE: $goods->startTrans(); goto MKS8m; U50cQ: } public function attrModDel($mod_id) { goto mmz4r; ftGaY: return $res; goto HfrCK; mmz4r: $mod = new GoodsAttrModule(); goto QBatg; QBatg: $res = $mod->destroy(["\x61\164\x74\x72\x5f\x69\x64" => $mod_id]); goto ftGaY; HfrCK: } public function attrModIs_use($mod_id) { goto F0l3a; kktWZ: $res = $mod->destroy(["\x61\x74\164\162\x5f\151\144" => $mod_id]); goto qChd0; F0l3a: $mod = new GoodsAttrModule(); goto kktWZ; qChd0: return $res; goto GxCiF; GxCiF: } public function attrModOff($mod_id) { goto IMrjV; IMrjV: $mod = new GoodsAttrModule(); goto l2W5n; l2W5n: $res = $mod->save(["\151\163\x5f\165\163\145" => 0], ["\x61\164\x74\162\137\151\x64" => $mod_id]); goto JdQoH; JdQoH: return $res; goto LHAr_; LHAr_: } public function attrModOn($mod_id) { goto TLUbY; hbUxQ: return $res; goto g3yYl; TLUbY: $mod = new GoodsAttrModule(); goto tLH6I; tLH6I: $res = $mod->save(["\x69\163\x5f\x75\163\145" => 1], ["\141\164\164\x72\137\151\x64" => $mod_id]); goto hbUxQ; g3yYl: } public function editGoodsType($good_id, $key) { goto IzYmy; nNB9y: if (!($key == "\150\x6f\164")) { goto LxdBN; } goto Hpeyb; B75Qt: $data = array("\x69\163\x5f\162\x65\x63\157\x6d\155\x65\156\144" => 0); goto pHbpi; Hpeyb: $data = array("\x69\163\x5f\x68\157\164" => 0); goto cjTPv; InbRZ: tQ_YV: goto nNB9y; ThL4g: if (!($key == "\x6e\x65\167")) { goto tQ_YV; } goto jWhYl; IzYmy: $goods = new \app\common\model\Goods(); goto ThL4g; pHbpi: qTJdn: goto sm3gM; wZfAt: if (!($key == "\x74\165\x69")) { goto qTJdn; } goto B75Qt; sm3gM: $res = $goods->save($data, ["\147\157\157\144\163\137\151\x64" => $good_id]); goto A_fiw; A_fiw: return $res; goto zeRAN; cjTPv: LxdBN: goto wZfAt; jWhYl: $data = array("\x69\x73\137\156\x65\x77" => 0); goto InbRZ; zeRAN: } }
