<?php
 namespace app\api\controller; require_once BASE_ROOT . "\143\x6f\162\x65\x2f\x61\160\x70\x6c\x69\143\x61\x74\x69\157\x6e\x2f\141\160\x69\x2f\x63\157\x6e\164\162\157\154\x6c\145\162\x2f\102\141\163\x65\x43\157\x6e\164\x72\157\154\154\145\162\56\160\x68\x70"; use think\Request; use think\Db; use think\Session; use think\Cache; class Share extends BaseController { public function share() { goto Fcmv2; f351L: $rule = [["\155\143\x68\137\151\144", "\x72\145\161\165\x69\x72\145", "\xe4\xb8\x8d\xe5\xad\230\345\234\xa8\xe5\225\x86\346\x88\xb7"]]; goto RwpQw; zoiFr: $gData = ["\160\x69\143" => Request::instance()->param("\x69\x6d\x67"), "\164\x69\x74\154\145" => Request::instance()->param("\164\x69\x74\x6c\145"), "\160\x72\x69\143\145" => Request::instance()->param("\x70\x72\151\143\145"), "\x6f\162\151\x67\151\x6e\141\154\137\160\x72\x69\x63\x65" => Request::instance()->param("\157\x72\x69\147\x69\156\x61\x6c\137\160\162\151\143\x65") * 2, "\143\x6f\165\160\x6f\x6e\x5f\x70\x72\x69\143\145" => 100, "\161\x63\157\x64\145" => $data]; goto BOAsM; zdKhO: $paths = array("\x67\x6f\157\x64\x73" => "\x79\142\x5f\163\150\x6f\x70\x2f\x70\141\147\x65\x73\57\147\157\157\144\x73\x2f\144\145\164\141\151\154\x2f\151\156\x64\x65\170", "\153\x61\x6e\152\x69\141" => "\x79\142\137\x73\x68\x6f\x70\57\x70\x61\147\x65\x73\57\x6b\141\x6e\x6a\x69\x61\x2f\147\x6f\x6f\x64\163\x5f\151\156\x66\x6f\57\151\x6e\144\x65\x78", "\160\x69\156\x74\x75\141\156" => "\171\x62\137\163\x68\157\x70\57\160\141\x67\145\x73\x2f\160\x69\156\164\165\x61\156\x2f\160\141\147\145\x73\x2f\x67\157\x6f\x64\x73\x2f\144\145\x74\141\151\154"); goto f351L; O15VZ: return json_encode($rs); goto iKo6g; OF10H: $param = Db::name("\x79\142\163\x63\x5f\143\157\156\146\x69\147")->where("\153\145\x79", "\x57\x58\x50\x41\131")->where("\x6d\x63\150\137\151\x64", $mch_id)->value("\166\141\154\165\145"); goto pGHM6; pGHM6: $param = json_decode($param, true); goto Z6GYO; Fcmv2: $rs = array("\143\157\144\x65" => 0, "\x69\156\146\157" => array()); goto xZIDZ; ALAXN: pD1jM: goto OF10H; cKQF2: $data = $this->send_post($url, $post_data); goto zoiFr; eCi2g: $post_data = array("\x73\x63\145\156\145" => $id, "\x70\141\164\150" => $paths[$type]); goto SbgSd; iKo6g: pJ7nq: goto fTlmu; Ec5Vx: $rs["\143\x6f\144\145"] = 1; goto kDc8k; jn5Q6: $id = Request::instance()->param("\x69\x64"); goto zdKhO; HmPmF: if (!(empty($APP_ID) || empty($APPSECRET))) { goto pJ7nq; } goto r21uU; v0j3B: $APPSECRET = $param["\x41\x50\x50\137\x53\x45\103\x52\x45\x54"]; goto HmPmF; fONzc: if (empty($result)) { goto pD1jM; } goto Ec5Vx; BOAsM: $this->createSharePng($gData, BASE_ROOT . "\x2f\163\143\141\x6e\56\x70\156\x67"); goto kAdRn; r21uU: $rs["\143\x6f\x64\x65"] = 1; goto mbWnO; E99ge: $url = "\150\x74\x74\160\163\72\x2f\x2f\141\160\x69\56\x77\x65\x69\170\151\x6e\x2e\161\x71\56\143\157\155\57\167\x78\141\57\x67\145\x74\167\x78\x61\x63\x6f\144\145\165\x6e\154\151\x6d\x69\164\77\141\143\143\145\163\x73\137\x74\x6f\153\x65\x6e\75" . $ACCESS_TOKEN["\x61\x63\143\145\163\x73\137\x74\x6f\153\145\x6e"]; goto eCi2g; SbgSd: $post_data = json_encode($post_data); goto cKQF2; P2jQg: return json_encode($rs); goto ALAXN; RwpQw: $data = ["\x6d\x63\150\137\151\x64" => $mch_id]; goto IKmGg; xZIDZ: $app_id = Request::instance()->param("\151"); goto jSna0; jSna0: $mch_id = $this->getMchId($app_id); goto FjnNu; mbWnO: $rs["\155\x73\147"] = "\xe6\234\xaa\351\205\x8d\xe7\275\xae\345\225\x86\xe6\x88\267\344\277\xa1\xe6\x81\257"; goto O15VZ; FjnNu: $type = Request::instance()->param("\x74\171\x70\145"); goto jn5Q6; kDc8k: $rs["\x6d\163\147"] = $result; goto P2jQg; fTlmu: $ACCESS_TOKEN = $this->getWxAccessToken($APP_ID, $APPSECRET); goto E99ge; Z6GYO: $APP_ID = $param["\x41\120\120\137\x49\104"]; goto v0j3B; IKmGg: $result = $this->checkParam($rule, $data); goto fONzc; kAdRn: } public function getpic() { goto Q6fJ_; S1a9B: $rule = [["\x6d\x63\150\x5f\x69\x64", "\x72\145\161\x75\151\x72\x65", "\xe4\xb8\215\xe5\255\230\xe5\x9c\xa8\xe5\x95\x86\xe6\210\xb7"]]; goto PsxyN; scA7U: if (empty($result)) { goto n4z6B; } goto ReqB0; bcA7J: n4z6B: goto Jdrk3; ePSNv: $mch_id = $this->getMchId($app_id); goto f4Ozg; dUzLD: exit($data); goto W7qFP; f4Ozg: $url = Request::instance()->param("\165\x72\154"); goto S1a9B; ReqB0: $rs["\x63\157\x64\145"] = 1; goto ttN9B; ttN9B: $rs["\x6d\x73\x67"] = $result; goto JoQOv; Q6fJ_: $app_id = Request::instance()->param("\151"); goto ePSNv; l7U8H: Header("\x43\x6f\x6e\164\x65\x6e\164\55\124\171\x70\x65\72\40\x69\155\141\147\x65\x2f\160\156\147"); goto dUzLD; JoQOv: return json_encode($rs); goto bcA7J; Jdrk3: $data = file_get_contents(urldecode($url)); goto l7U8H; PsxyN: $data = ["\155\x63\150\x5f\151\x64" => $mch_id]; goto tks1I; tks1I: $result = $this->checkParam($rule, $data); goto scA7U; W7qFP: } public function getqrcode() { goto p6UeS; W8u8L: $data = ["\155\x63\x68\137\x69\x64" => $mch_id]; goto xbO_p; ZoRz1: $path = Request::instance()->param("\x70\141\164\x68"); goto X7lyg; q6k14: return json_encode($rs); goto kSMs_; K1m9U: $rs["\x6d\x73\147"] = $result; goto q6k14; NoWRs: return json_encode($rs); goto Q2M3T; wUH1N: $rs["\143\x6f\144\x65"] = 1; goto K1m9U; p6UeS: $rs = array("\x63\157\x64\145" => 0, "\x69\x6e\146\157" => array()); goto PBslC; PzSFf: $mch_id = $this->getMchId($app_id); goto ZoRz1; Pk0ps: if (!(empty($APP_ID) || empty($APPSECRET))) { goto YbG5x; } goto L_jLh; MLVT4: $param = Db::name("\171\142\163\143\x5f\143\157\x6e\x66\x69\x67")->where("\153\145\x79", "\127\x58\120\101\x59")->where("\155\143\x68\x5f\151\x64", $mch_id)->value("\166\x61\x6c\x75\145"); goto TVghY; DMr7N: global $_W; goto IFJfA; oCsV1: $ACCESS_TOKEN = $this->getWxAccessToken($APP_ID, $APPSECRET); goto g8bBM; WwZUz: $post_data = array("\x73\143\x65\x6e\145" => $scene . "\54" . $pid, "\160\141\x67\x65" => $path); goto VYkVS; kSMs_: IhDWd: goto MLVT4; Bym6l: $APPSECRET = $_W["\x61\x63\143\x6f\165\156\x74"]["\163\x65\143\x72\x65\164"] ? $_W["\141\x63\143\157\x75\156\164"]["\163\x65\143\162\145\164"] : $param["\x41\x50\120\x5f\123\105\103\122\x45\124"]; goto Pk0ps; iDVWq: if (empty($result)) { goto IhDWd; } goto wUH1N; L_jLh: $rs["\143\157\144\x65"] = 1; goto gv9hu; IFJfA: $APP_ID = $_W["\141\x63\143\x6f\165\156\x74"]["\153\x65\x79"] ? $_W["\x61\143\x63\x6f\165\156\164"]["\153\145\171"] : $param["\101\120\120\x5f\111\104"]; goto Bym6l; KF9Pg: $data = $this->send_post($url, $post_data); goto a2B9Y; GDDeb: $rule = [["\x6d\x63\150\x5f\x69\x64", "\162\x65\x71\x75\151\x72\x65", "\xe4\270\x8d\xe5\255\230\xe5\234\250\345\x95\206\xe6\x88\xb7"]]; goto W8u8L; PBslC: $app_id = Request::instance()->param("\x69"); goto PzSFf; VYkVS: $post_data = json_encode($post_data); goto KF9Pg; gv9hu: $rs["\155\163\147"] = "\346\234\252\351\x85\215\347\275\xae\xe5\225\x86\346\210\267\344\xbf\241\xe6\x81\xaf"; goto NoWRs; xbO_p: $result = $this->checkParam($rule, $data); goto iDVWq; BOmOA: exit($data); goto oYuIC; ay8WV: $pid = Request::instance()->param("\x70\x69\x64", 0); goto GDDeb; X7lyg: $scene = Request::instance()->param("\163\143\145\156\x65"); goto ay8WV; a2B9Y: Header("\103\x6f\156\164\x65\x6e\164\55\x54\171\x70\x65\72\40\151\155\141\x67\x65\x2f\160\x6e\147"); goto BOmOA; g8bBM: $url = "\150\x74\164\160\163\72\57\x2f\141\x70\x69\x2e\167\145\151\170\x69\x6e\x2e\x71\x71\x2e\143\157\x6d\57\167\x78\x61\x2f\x67\x65\164\x77\170\x61\x63\x6f\x64\145\x75\156\x6c\x69\x6d\151\164\77\141\143\143\x65\163\163\137\x74\x6f\x6b\145\156\75" . $ACCESS_TOKEN["\x61\x63\143\145\x73\x73\x5f\x74\157\153\x65\156"]; goto WwZUz; Q2M3T: YbG5x: goto oCsV1; TVghY: $param = json_decode($param, true); goto DMr7N; oYuIC: } private function createSharePng($gData, $codeName, $fileName = '') { goto Bx1uo; nc7Xr: $font_file = BASE_ROOT . "\x2f\x63\x6f\x72\145\57\x70\x75\142\x6c\151\143\x2f\163\164\141\x74\151\x63\x2f\x66\157\156\x74\57\x4d\x53\131\110\x2e\x54\124\x43"; goto VQQ3G; zJS0w: $color = imagecolorallocate($im, 255, 255, 255); goto IwkJt; XF2F2: $theTitle = $this->cn_row_substr($gData["\x74\151\x74\154\145"], 2, 16); goto TR6GD; lzK_d: imagecopyresized($im, $codeImg, 524, 800, 0, 0, 170, 170, 430, 430); goto XF2F2; vmwk_: imagecopyresized($im, $codeImg, 485, 765, 0, 0, 250, 250, $code_w, $code_h); goto PAOYr; k1qrT: imagedestroy($goodImg); goto Wv59i; hfHr4: $font_color_red = ImageColorAllocate($im, 217, 45, 32); goto KTWe4; pXpC4: Header("\x43\157\x6e\x74\x65\x6e\x74\x2d\124\171\x70\145\72\x20\x69\x6d\x61\147\x65\x2f\x70\x6e\x67"); goto P0G9b; INvE3: imagecopyresized($im, $goodImg, 0, 0, 0, 0, 750, 750, $g_w, $g_h); goto bZSkL; JnFKE: $goodImg = $this->createImageFromFile($gData["\x70\151\x63"]); goto INvE3; TrtDD: imagepng($im, $fileName); goto Ua1IK; WFvH3: imagettftext($im, 18, 0, 12, 840, $font_color_2, $font_file, $theTitle[2]); goto kxnYd; Bx1uo: $im = imagecreatetruecolor(750, 1030); goto zJS0w; DcYh4: if ($fileName) { goto TWfAl; } goto pXpC4; WV7nd: imagesetthickness($im, 2); goto W2e0m; h8rzL: imagettftext($im, 28, 0, 85, 990, $font_color_red, $font_file_bold, $gData["\160\162\151\143\x65"]); goto WV7nd; PAOYr: $codeImg = @imagecreatefromstring($gData["\161\x63\157\144\145"]); goto lzK_d; IwkJt: imagefill($im, 0, 0, $color); goto nc7Xr; W2e0m: imageline($im, 12, 912, 120, 912, $font_color_3); goto DcYh4; Ua1IK: JnJxb: goto BjZiH; A5AzZ: TWfAl: goto TrtDD; D0Gvy: $font_color_2 = ImageColorAllocate($im, 28, 28, 28); goto q8s8r; TR6GD: imagettftext($im, 18, 0, 12, 805, $font_color_2, $font_file, $theTitle[1]); goto WFvH3; KTWe4: $fang_bg_color = ImageColorAllocate($im, 254, 216, 217); goto Zih_c; kxnYd: imagettftext($im, 14, 0, 12, 920, $font_color_3, $font_file, "\345\216\x9f\344\273\xb7\xef\xbf\245" . $gData["\157\x72\x69\147\151\x6e\x61\154\x5f\x70\162\x69\143\x65"]); goto NwaFe; JksUK: goto JnJxb; goto A5AzZ; P0G9b: imagepng($im); goto JksUK; BjZiH: imagedestroy($im); goto k1qrT; VQQ3G: $font_file_bold = BASE_ROOT . "\57\x63\x6f\162\145\x2f\160\165\x62\154\151\143\57\x73\x74\141\x74\x69\x63\x2f\x66\x6f\156\164\x2f\x4d\x53\x59\x48\x42\x44\x2e\x54\x54\103"; goto D0Gvy; q8s8r: $font_color_3 = ImageColorAllocate($im, 129, 129, 129); goto hfHr4; NwaFe: imagettftext($im, 14, 0, 12, 990, $font_color_2, $font_file, "\xe4\274\x98\346\203\240\xe4\xbb\267\357\xbf\245"); goto h8rzL; bZSkL: list($code_w, $code_h) = getimagesize($codeName); goto n74HB; Zih_c: list($g_w, $g_h) = getimagesize($gData["\160\x69\143"]); goto JnFKE; n74HB: $codeImg = $this->createImageFromFile($codeName); goto vmwk_; Wv59i: imagedestroy($codeImg); goto c3Kn1; c3Kn1: } function createImageFromFile($file) { goto Jf3H_; Jf3H_: if (preg_match("\57\x68\x74\x74\160\50\163\x29\x3f\72\134\x2f\134\57\57", $file)) { goto ZqCzB; } goto Y0oh3; jQc2W: Axxck: goto qCMLe; d7XuQ: goto VoXbL; goto AiIUx; h7hvI: RIY7X: goto JXhW7; qCMLe: uE3b4: goto dYqCJ; JXhW7: switch ($fileSuffix) { case "\x6a\x70\x65\147": $theImage = @imagecreatefromjpeg($file); goto uE3b4; case "\x6a\x70\x67": $theImage = @imagecreatefromjpeg($file); goto uE3b4; case "\x70\x6e\147": $theImage = @imagecreatefrompng($file); goto uE3b4; case "\x67\151\146": $theImage = @imagecreatefromgif($file); goto uE3b4; default: $theImage = @imagecreatefromstring(file_get_contents($file)); goto uE3b4; } goto jQc2W; Y0oh3: $fileSuffix = pathinfo($file, PATHINFO_EXTENSION); goto d7XuQ; z2JNw: $fileSuffix = $this->getNetworkImgType($file); goto bnoKJ; AiIUx: ZqCzB: goto z2JNw; bnoKJ: VoXbL: goto ms_gS; NEvDE: return false; goto h7hvI; dYqCJ: return $theImage; goto su3tL; ms_gS: if ($fileSuffix) { goto RIY7X; } goto NEvDE; su3tL: } function getNetworkImgType($url) { goto q7v1m; o0tmz: $http_code = curl_getinfo($ch); goto kMlZ3; xaUA2: Bg2cX: goto D9Sbq; Q3bMV: Bd8lE: goto xaUA2; tINoA: return false; goto V4HPf; bPCvm: $theImgType = explode("\57", $http_code["\143\x6f\156\164\145\x6e\x74\137\164\171\160\x65"]); goto PtSkE; JK5Zn: curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false); goto Tkd1E; V4HPf: goto Bg2cX; goto rq6fk; Yu1c2: curl_setopt($ch, CURLOPT_CONNECTTIMEOUT, 3); goto UaGqO; z2kt6: curl_setopt($ch, CURLOPT_URL, $url); goto OxnBP; PtSkE: if ($theImgType[0] == "\x69\x6d\141\147\145") { goto ejLGI; } goto tFPae; u5euT: if ($http_code["\x68\164\x74\160\137\x63\157\x64\145"] == 200) { goto NQxJE; } goto tINoA; Tkd1E: curl_exec($ch); goto o0tmz; rq6fk: NQxJE: goto bPCvm; OxnBP: curl_setopt($ch, CURLOPT_NOBODY, 1); goto Yu1c2; kMlZ3: curl_close($ch); goto u5euT; YdtQJ: goto Bd8lE; goto E4dBf; tFPae: return false; goto YdtQJ; q7v1m: $ch = curl_init(); goto z2kt6; UaGqO: curl_setopt($ch, CURLOPT_TIMEOUT, 3); goto JK5Zn; E4dBf: ejLGI: goto jo4rY; jo4rY: return $theImgType[1]; goto Q3bMV; D9Sbq: } function cn_row_substr($str, $row = 1, $number = 10, $suffix = true) { goto kwFBj; m5YyJ: $str = trim($str); goto Gh3OF; ps1mZ: if (!($r <= $row)) { goto ETcgC; } goto zZRDc; P3JPu: ETcgC: goto aJ6Lz; vLTbA: $r++; goto EQ0hj; aJ6Lz: return $result; goto Q63f5; NUktF: $r = 1; goto iaO6j; q9BKh: LYhN0: goto SEIQU; zZRDc: if ($r == $row and $theStrlen > $r * $oneRowNum and $suffix) { goto LYhN0; } goto FG_fV; EQ0hj: goto wNSDH; goto P3JPu; r1ula: $result[$r] = ''; goto sspm5; PV828: goto JGJ8x; goto BIwap; HNnX1: wNSDH: goto ps1mZ; oQnBQ: $theStrlen = strlen($str); goto eLT0U; FG_fV: $result[$r] = $this->mg_cn_substr($str, $oneRowNum, ($r - 1) * $oneRowNum); goto IpPl8; NdLZQ: goto ETcgC; goto UAuWT; IpPl8: goto CaULQ; goto q9BKh; vYZNu: CaULQ: goto ERjYH; Udof7: ikmig: goto vLTbA; iaO6j: JGJ8x: goto o1wJX; JnGK7: $r = 1; goto HNnX1; xPZim: mVo95: goto oQnBQ; o1wJX: if (!($r <= $row)) { goto aZK2W; } goto r1ula; kwFBj: $result = array(); goto NUktF; HlJAL: return $result; goto xPZim; SEIQU: $result[$r] = $this->mg_cn_substr($str, $oneRowNum - 6, ($r - 1) * $oneRowNum) . "\56\x2e\56"; goto vYZNu; sspm5: KZyyk: goto MU308; BIwap: aZK2W: goto m5YyJ; ERjYH: if (!($theStrlen < $r * $oneRowNum)) { goto cYbXT; } goto NdLZQ; UAuWT: cYbXT: goto Udof7; MU308: $r++; goto PV828; Gh3OF: if ($str) { goto mVo95; } goto HlJAL; eLT0U: $oneRowNum = $number * 3; goto JnGK7; Q63f5: } function mg_cn_substr($str, $len, $start = 0) { goto Fnq3u; cBMiw: BRIzi: goto GFovw; dzlPC: $q_strlen = $start + $len > strlen($str) ? strlen($str) : $start + $len; goto PKgQJ; CqBhy: $q_str .= substr($str, $i, 3); goto tR_hx; U3gIk: $i++; goto B8Toa; iSRYG: tsyVS: goto eppj6; nF_MZ: if (!($a < 3)) { goto pV2kl; } goto heLo4; PKgQJ: if (!($start and json_encode(substr($str, $start, 1)) === false)) { goto tsyVS; } goto o1BjJ; Kpb4v: $q_str .= substr($str, $i, 1); goto i11DN; i11DN: goto BRIzi; goto JOAbj; eppj6: $i = $start; goto TSx2v; o1BjJ: $a = 0; goto f88lA; mydZ3: $start = $new_start; goto J0Y2s; QZ6MT: return $q_str; goto Di6Yk; JOAbj: UnVtt: goto CqBhy; Gdv3N: pV2kl: goto iSRYG; MQqC6: hp2R0: goto MpsxO; upAHC: if (ord(substr($str, $i, 1)) > 0xa0) { goto UnVtt; } goto Kpb4v; P3wgz: if (!($i < $q_strlen)) { goto CKL3y; } goto upAHC; GFovw: RUhS5: goto U3gIk; Fnq3u: $q_str = ''; goto dzlPC; w1DhR: goto ZTB68; goto Gdv3N; B8Toa: goto qXb9G; goto ytHqE; skoan: $m_str = substr($str, $new_start, 3); goto DK50c; TSx2v: qXb9G: goto P3wgz; heLo4: $new_start = $start + $a; goto skoan; J0Y2s: goto pV2kl; goto MQqC6; tR_hx: $i += 2; goto cBMiw; f88lA: ZTB68: goto nF_MZ; DK50c: if (!(json_encode($m_str) !== false)) { goto hp2R0; } goto mydZ3; v4dFw: $a++; goto w1DhR; ytHqE: CKL3y: goto QZ6MT; MpsxO: V147Z: goto v4dFw; Di6Yk: } }
