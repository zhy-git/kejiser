<?php
 namespace app\api\controller; use think\Request; use think\Db; use think\Cache; require_once BASE_ROOT . "\143\x6f\x72\x65\57\145\170\164\145\156\x64\57\127\x78\160\141\171\57\x57\x78\x50\141\171\56\x41\x70\x69\x2e\160\x68\160"; require_once BASE_ROOT . "\143\x6f\162\x65\57\141\x70\x70\x6c\151\x63\x61\x74\x69\x6f\156\57\141\x70\151\57\x63\157\156\x74\x72\157\x6c\x6c\x65\x72\57\102\141\163\x65\103\157\156\x74\x72\157\154\x6c\145\162\x2e\x70\150\160"; class Paycontent extends BaseController { public function paycontentClass() { goto dMOk1; ENzZN: $data = ["\155\x63\x68\x5f\151\x64" => $mch_id]; goto psxz3; aW2kz: foreach ($cate_list as $value) { $info[] = $value; QNZyg: } goto BqWAP; RizNk: if (empty($result)) { goto kPRH6; } goto we81o; dMOk1: $rs = array("\143\157\x64\x65" => 0, "\x69\x6e\146\157" => array()); goto Dlqsh; NOAAk: $info = array(); goto NchS1; NchS1: $cate_list = Db::name("\171\142\x73\x63\x5f\160\x61\171\143\157\156\164\145\156\x74\137\x63\x6c\141\x73\x73")->where("\155\x63\x68\137\151\144", $mch_id)->order("\163\x6f\x72\164\40\x61\x73\143")->select(); goto aW2kz; BqWAP: NxaE3: goto rNa5f; Dlqsh: $app_id = Request::instance()->param("\151"); goto Y1AfL; r7OHK: return json_encode($rs); goto XhfRt; XhfRt: kPRH6: goto dm6pD; xtR8a: i0a_Q: goto NOAAk; zYe8k: $rs["\x69\156\x66\157"] = $info; goto leBy1; rNa5f: Cache::set($mch_id . "\x5f\x70\141\171\143\157\156\164\145\x6e\164\137\x63\154\x61\x73\x73", $rs, CACHE_TIME); goto rlGsS; UtPFM: return json_encode($rs); goto ikIzx; we81o: $rs["\x63\157\144\145"] = 1; goto bSqA9; dm6pD: $info = Cache::get($mch_id . "\137\x70\141\171\x63\157\x6e\164\145\x6e\x74\x5f\x63\154\141\x73\163"); goto DWB3u; N3vT5: $result = $this->checkParam($rule, $data); goto RizNk; Y1AfL: $mch_id = $this->getMchId($app_id); goto ENzZN; DWB3u: if (!($info != false)) { goto i0a_Q; } goto zYe8k; leBy1: json_encode($rs); goto xtR8a; bSqA9: $rs["\155\x73\147"] = $result; goto r7OHK; psxz3: $rule = [["\x6d\x63\x68\x5f\151\x64", "\x72\145\x71\x75\x69\162\x65", "\344\xb8\215\xe5\xad\x98\xe5\x9c\250\xe5\x95\206\346\x88\xb7"]]; goto N3vT5; rlGsS: $rs["\151\156\146\x6f"] = $info; goto UtPFM; ikIzx: } public function paycontent_list() { goto QPgUg; hFL1y: $rs["\143\157\x64\x65"] = 1; goto bWIfj; ySuCs: $data = ["\x6d\x63\x68\x5f\x69\x64" => $mch_id, "\x63\154\141\x73\163\137\151\x64" => $class_id]; goto bjmb4; MR2jT: $class_id = Request::instance()->param("\x63\x6c\x61\163\163\x5f\x69\144", 0); goto oRFf2; qaPdh: return json_encode($rs); goto Dzb2R; YI_vE: LwPdc: goto Lwwd4; bWIfj: $rs["\155\x73\x67"] = $result; goto qaPdh; Dzb2R: B54e1: goto NzmQb; Lwwd4: $info = Db::name("\171\142\163\x63\x5f\x70\141\x79\x63\x6f\x6e\164\145\x6e\164")->alias("\x70")->join("\x79\x62\x73\x63\137\x70\x61\x79\143\157\x6e\x74\145\x6e\164\x5f\x6f\162\144\x65\x72\163\x20\x6f", "\x6f\56\x63\x6f\x6e\164\145\x6e\x74\x5f\151\144\x20\x3d\x20\160\x2e\x69\144\x20\x61\156\x64\x20\x6f\x2e\151\163\120\141\171\x20\75\x20\61", "\x4c\105\106\124")->where($where)->field("\160\56\x69\144\54\160\56\163\157\x72\x74\x2c\160\x2e\164\x69\x74\154\145\x2c\160\x2e\143\154\141\163\x73\x5f\151\x64\54\x70\x2e\x67\x72\157\165\x70\x5f\151\144\x2c\160\x2e\151\x6d\141\x67\145\x2c\160\56\160\141\x79\x63\157\x6e\x74\145\x6e\164\x5f\164\x79\160\145\54\x70\x2e\x70\162\x69\143\145\x2c\x70\56\x63\162\x65\x61\x74\x65\x5f\164\151\x6d\x65\54\x70\x2e\x66\x72\145\x65\x2c\x70\56\166\x69\145\167\x2c\x70\x2e\154\151\153\145\x73\54\160\56\142\x75\x79\137\143\x6f\165\156\164\137\151\x6e\x69\164\x2c\x70\56\x62\165\x79\137\x63\x6f\165\156\164\x5f\x72\x65\141\x6c\54\x6f\56\x69\144\x20\x61\163\x20\x69\163\x62\x75\x79")->order("\x70\x2e\163\157\x72\164\x20\141\x73\143\x2c\x70\56\151\144\x20\x64\145\163\143")->page($page, 20)->select(); goto YIJNk; YIJNk: if (!empty($info)) { goto EU0Fi; } goto p3Tt_; QPgUg: $rs = array("\143\157\144\x65" => 0, "\151\x6e\146\157" => array()); goto MR2jT; neAXG: return json_encode($rs); goto nLM5a; k4jbw: $uid = Request::instance()->param("\165\151\x64", 0); goto Amr3N; SmHAJ: if (empty($result)) { goto B54e1; } goto hFL1y; Evp5r: $where["\x70\56\143\154\x61\x73\163\x5f\x69\x64"] = $class_id; goto YI_vE; bjmb4: $data = array_filter($data); goto a0Tmn; NzmQb: $where["\160\56\155\x63\150\x5f\x69\144"] = $mch_id; goto jHlSM; F1CPI: $result = $this->checkParam($rule, $data); goto SmHAJ; jHlSM: $where["\x70\56\x73\x74\x61\164\165\163"] = 1; goto PGzKL; oRFf2: $app_id = Request::instance()->param("\151"); goto ahll4; PGzKL: if (!($class_id > 0)) { goto LwPdc; } goto Evp5r; Amr3N: $mch_id = $this->getMchId($app_id); goto ySuCs; p3Tt_: return json_encode($rs); goto g1Uhm; tRg94: $rs["\x69\x6e\146\x6f"] = $info; goto neAXG; ahll4: $page = Request::instance()->param("\x70\x61\x67\145", 1); goto k4jbw; a0Tmn: $rule = [["\x6d\x63\150\x5f\x69\144", "\x72\x65\x71\165\151\x72\x65", "\344\270\x8d\xe5\xad\x98\xe5\x9c\xa8\xe5\225\x86\346\210\267"]]; goto F1CPI; g1Uhm: EU0Fi: goto tRg94; nLM5a: } public function checkuser() { goto gKeoO; GjrPN: $rs["\x69\156\x66\157"] = $user["\145\170\x70\x69\x72\x65"] >= time(); goto kojbC; jx2QP: if (!empty($user)) { goto Bz5_d; } goto f1t0v; RULgw: $rs["\x6d\163\x67"] = $result; goto rCEdr; l8gvT: if (empty($result)) { goto vPp00; } goto hoqOI; m1Wj6: vPp00: goto d04XZ; GAQrb: Bz5_d: goto GjrPN; kU5NL: $uid = Request::instance()->param("\x75\151\144", 0); goto Mo_qT; kojbC: return json_encode($rs); goto bVBmF; JOPbL: $result = $this->checkParam($rule, $data); goto l8gvT; Mo_qT: $mch_id = $this->getMchId($app_id); goto fedGk; xqaml: $data = array_filter($data); goto eqtWD; VN88f: $app_id = Request::instance()->param("\x69"); goto kU5NL; RgLLj: $class_id = Request::instance()->param("\143\x6c\x61\163\163\137\151\x64", 0); goto VN88f; f1t0v: $user["\145\x78\x70\151\x72\145"] = 0; goto GAQrb; gKeoO: $rs = array("\143\157\144\145" => 0, "\x69\156\146\157" => array()); goto RgLLj; fedGk: $data = ["\155\143\150\x5f\x69\144" => $mch_id, "\143\x6c\141\x73\163\x5f\x69\x64" => $class_id]; goto xqaml; eqtWD: $rule = [["\155\x63\x68\x5f\x69\144", "\162\x65\x71\165\x69\x72\x65", "\344\270\215\345\xad\230\345\234\xa8\345\x95\206\346\x88\xb7"]]; goto JOPbL; d04XZ: $user = Db::name("\x79\142\x73\143\x5f\x70\x61\171\143\157\x6e\164\x65\x6e\x74\x5f\165\163\145\162")->where(["\165\151\x64" => $uid])->find(); goto jx2QP; rCEdr: return json_encode($rs); goto m1Wj6; hoqOI: $rs["\x63\157\x64\145"] = 1; goto RULgw; bVBmF: } public function paycontent_info() { goto zeIgA; d9sBJ: $rs["\x69\x6e\x66\157"] = $info; goto d49k0; kgaIz: $group["\x62\x75\171\137\x63\157\165\x6e\164"] = $info["\142\165\171\x5f\x63\x6f\x75\156\x74\137\x69\x6e\151\164"] + $info["\x62\x75\x79\137\143\x6f\x75\x6e\164\x5f\162\x65\x61\x6c"]; goto kgVTA; GhzVX: if (!empty($group)) { goto R8n6m; } goto NmFno; gCR94: $info["\x76\151\x65\167"] += 1; goto pgKL3; fpEjl: $likes = Db::name("\x79\x62\163\x63\x5f\160\x61\x79\143\157\x6e\x74\145\x6e\x74\x5f\154\x69\153\x65\x73")->where(["\x75\151\144" => $uid, "\x6d\x63\150\x5f\x69\x64" => $mch_id, "\x70\141\171\x63\x6f\156\164\x65\156\164\137\151\x64" => $id])->find(); goto a3_rM; W5IrU: if (!empty($info)) { goto khTaR; } goto CqVC8; T4LdR: $info["\147\162\157\x75\x70"] = $group; goto fpEjl; SACeF: $group["\x6c\151\x6b\x65\x5f\x63\x6f\x75\156\x74"] = $count["\x6c\151\x6b\145\x5f\x63\x6f\165\156\164"]; goto BAHpW; NmFno: $group = array(); goto rpv52; FAPgA: $info = Db::name("\x79\x62\163\x63\137\x70\141\171\x63\157\156\x74\x65\156\x74")->alias("\x70")->join("\171\x62\163\x63\137\160\x61\x79\143\157\x6e\x74\145\x6e\164\137\157\x72\144\x65\162\x73\40\x6f", "\x70\x2e\x69\x64\40\x3d\40\157\56\143\x6f\x6e\x74\145\156\x74\137\x69\144\x20\x61\156\x64\40\x6f\x2e\x69\x73\x50\x61\171\x20\75\x20\x31", "\x4c\105\106\x54")->where(["\160\x2e\x69\x64" => $id, "\160\56\155\x63\150\x5f\x69\x64" => $mch_id])->field("\x70\x2e\x2a\54\157\x2e\151\144\40\141\163\40\x69\163\x62\x75\171")->find(); goto W5IrU; dnxya: goto AwJnp; goto IGTxw; fTIbO: $group["\166\151\145\167\137\x63\x6f\x75\156\164"] = $count["\166\x69\145\167\x5f\143\x6f\165\x6e\164"]; goto SACeF; bFlbj: AwJnp: goto KD2f8; OWuQL: $app_id = Request::instance()->param("\151"); goto r4KzZ; Fb0dU: $uid = Request::instance()->param("\x75\x69\x64", 0); goto FAPgA; Nt0o0: $group = Db::name("\171\x62\163\143\x5f\x70\141\171\x63\157\156\x74\x65\x6e\x74\x5f\x67\162\157\165\160")->where(["\151\x64" => $info["\147\x72\x6f\165\x70\137\x69\144"], "\155\143\x68\x5f\x69\x64" => $mch_id])->find(); goto GhzVX; UcNf7: unset($info["\166\x69\144\x65\157\137\x75\x72\x6c"]); goto tckBA; IGTxw: R8n6m: goto YRm0s; kgVTA: $group["\151\x6d\x67"] = $info["\x69\155\x61\x67\x65"]; goto dnxya; zeIgA: $rs = array("\143\157\144\145" => 0, "\151\156\x66\157" => array()); goto OWuQL; G3hXM: if (!($info["\x66\162\145\x65"] != 1 && ($info["\x70\x72\x69\143\x65"] == 0.0 && empty($user) || $info["\x70\x72\x69\143\x65"] > 0.0 && empty($info["\x69\163\x62\165\171"])))) { goto RxXyo; } goto ig17p; LxbNl: $group["\x6c\x69\x6b\145\137\143\x6f\165\x6e\x74"] = $info["\154\151\153\145\163"]; goto kgaIz; a3_rM: $info["\154\151\153\145\144"] = !empty($likes); goto d9sBJ; r4KzZ: $mch_id = $this->getMchId($app_id); goto Kb7Fk; pgKL3: $samegroup = 0; goto cPpUO; rpv52: $group["\x76\151\145\167\137\143\157\x75\156\x74"] = $info["\x76\x69\145\x77"]; goto LxbNl; h7sWQ: XoFpw: goto Nt0o0; BAHpW: $group["\x62\165\171\x5f\x63\157\x75\x6e\164"] = $count["\142\x75\x79\x5f\x63\157\x75\x6e\x74"]; goto bFlbj; l2p_s: return json_encode($rs); goto hhDgq; ig17p: unset($info["\143\157\x6e\164\145\156\164"]); goto UcNf7; cPpUO: if (empty($info["\x67\162\x6f\165\160\x5f\151\x64"])) { goto XoFpw; } goto aeze8; uH5y0: $user = Db::name("\x79\x62\163\143\137\x70\x61\x79\143\x6f\x6e\164\145\x6e\164\137\x75\163\x65\x72")->where(["\x75\151\144" => $uid, "\x6d\143\x68\x5f\x69\x64" => $mch_id, "\145\170\x70\151\x72\x65" => ["\x67\164", time()]])->find(); goto G3hXM; KD2f8: $group["\163\x61\155\x65\x5f\x63\157\x75\156\x74"] = $samegroup; goto uH5y0; JWr_P: RxXyo: goto T4LdR; tckBA: unset($info["\141\165\x64\151\x6f\137\x75\x72\154"]); goto JWr_P; YRm0s: $count = Db::name("\x79\142\x73\143\137\x70\141\x79\143\157\156\164\145\x6e\164")->where(["\x67\162\157\x75\x70\x5f\x69\x64" => $info["\147\x72\157\x75\160\137\151\x64"], "\155\143\150\x5f\151\144" => $mch_id])->field("\x73\x75\155\x28\166\x69\145\167\51\x20\141\163\x20\166\151\145\167\137\143\157\x75\156\x74\54\x73\165\155\50\154\151\x6b\145\163\x29\x20\x61\x73\40\x6c\151\153\145\137\143\157\165\156\164\x2c\163\165\x6d\50\142\x75\171\137\x63\157\165\x6e\164\x5f\x69\156\151\164\x2b\x62\x75\x79\x5f\x63\x6f\x75\156\164\137\162\x65\x61\x6c\x29\40\x61\x73\40\x62\x75\x79\x5f\x63\157\x75\156\164")->find(); goto fTIbO; hhDgq: khTaR: goto PUO9W; Kb7Fk: $id = Request::instance()->param("\151\x64"); goto Fb0dU; d49k0: return json_encode($rs); goto QMTId; PUO9W: Db::name("\171\142\163\143\x5f\160\141\171\143\157\x6e\x74\x65\x6e\164")->where(["\x69\x64" => $id, "\155\143\x68\137\151\144" => $mch_id])->setInc("\166\x69\x65\167"); goto gCR94; CqVC8: $rs["\x6d\x73\147"] = "\346\232\202\346\x97\240\346\x96\207\xe7\253\240"; goto l2p_s; aeze8: $samegroup = Db::name("\171\x62\x73\143\x5f\160\x61\171\143\157\x6e\x74\145\156\164")->where(["\x67\162\157\165\160\x5f\151\144" => $info["\x67\162\x6f\x75\160\x5f\151\x64"], "\155\x63\x68\137\x69\x64" => $mch_id])->count(); goto h7sWQ; QMTId: } public function samegroup() { goto Jm2mW; Eq16p: if (!empty($info)) { goto ys7Qq; } goto chQFP; DRv73: if (empty($info["\x67\x72\157\x75\x70\x5f\151\144"])) { goto w3j3b; } goto LVyGJ; xMAB7: $mch_id = $this->getMchId($app_id); goto d72LP; d72LP: $id = Request::instance()->param("\151\x64"); goto ltONX; Jm2mW: $rs = array("\143\157\144\145" => 0, "\151\x6e\146\x6f" => array()); goto f2PVE; chQFP: $rs["\155\x73\x67"] = "\346\x9a\x82\346\x97\xa0\345\206\205\345\256\271"; goto ZVCDD; kJ0Zv: ys7Qq: goto HNNJG; HNNJG: $list = array(); goto DRv73; f2PVE: $app_id = Request::instance()->param("\x69"); goto xMAB7; hQk24: $info = Db::name("\171\142\163\143\x5f\160\x61\x79\x63\x6f\156\164\x65\156\x74")->where(["\x69\x64" => $id, "\x6d\x63\x68\137\x69\x64" => $mch_id])->find(); goto Eq16p; LYT5E: return json_encode($rs); goto x8uia; ZVCDD: return json_encode($rs); goto kJ0Zv; LVyGJ: $list = Db::name("\x79\142\163\143\x5f\160\x61\171\x63\157\156\164\x65\156\164")->alias("\160")->join("\171\x62\163\143\x5f\160\x61\171\143\157\156\164\x65\x6e\x74\137\x6f\162\x64\x65\x72\163\40\x6f", "\157\x2e\143\x6f\156\x74\x65\156\164\137\151\144\40\75\x20\160\56\x69\x64\40\141\x6e\x64\x20\157\56\151\x73\x50\141\171\x20\x3d\40\x31", "\x4c\105\x46\124")->where(["\160\56\x67\162\157\x75\x70\x5f\x69\144" => $info["\x67\x72\157\x75\x70\x5f\x69\144"], "\x70\56\x6d\143\150\x5f\151\144" => $mch_id])->field("\x70\x2e\151\144\54\160\x2e\163\157\x72\x74\54\x70\x2e\164\151\164\154\145\54\x70\x2e\x63\154\x61\163\163\x5f\x69\x64\54\160\x2e\147\x72\x6f\x75\x70\x5f\151\144\x2c\x70\x2e\151\155\x61\147\x65\x2c\x70\x2e\160\141\x79\143\157\156\164\145\156\x74\137\164\x79\x70\145\54\160\56\x70\162\x69\x63\x65\54\160\56\143\x72\x65\141\x74\145\x5f\x74\x69\x6d\145\54\x70\56\146\162\x65\145\x2c\160\56\166\151\145\x77\54\160\x2e\154\x69\153\145\x73\x2c\160\56\x62\x75\171\x5f\143\x6f\165\156\x74\137\x69\x6e\x69\164\x2c\x70\56\x62\x75\171\137\143\x6f\165\x6e\x74\x5f\162\x65\x61\154\54\157\56\151\144\x20\141\x73\x20\x69\x73\142\165\x79")->order("\160\56\163\x6f\x72\164\40\141\x73\x63\x2c\x70\x2e\151\x64\40\x64\x65\163\143")->page($page, 20)->select(); goto jwEMM; ltONX: $page = Request::instance()->param("\160\x61\x67\145", 1); goto hQk24; Mainx: $rs["\151\x6e\146\x6f"] = $list; goto LYT5E; jwEMM: w3j3b: goto Mainx; x8uia: } public function dolike() { goto rRoHE; wJvkB: $rs["\x63\157\x64\145"] = $res; goto y30J6; y30J6: return json_encode($rs); goto DoSxR; jtYCK: $data["\155\143\x68\x5f\151\x64"] = $mch_id; goto EI5UF; zQOu6: $res = Db::name("\x79\x62\163\x63\137\x70\141\171\143\x6f\x6e\164\145\156\164\x5f\154\x69\x6b\145\163")->where(["\x69\x64" => $likes["\151\144"]])->delete(); goto TI50E; TI50E: goto C0HZN; goto dYwiH; cDazw: C0HZN: goto wJvkB; rRoHE: $rs = array("\x63\x6f\144\145" => 0, "\x69\156\146\x6f" => array()); goto cgQdg; TsJE1: $data["\165\x69\144"] = $uid; goto t7aiu; Pc9wJ: $id = Request::instance()->param("\151\144"); goto PU1JU; t7aiu: $data["\160\141\x79\143\157\156\x74\x65\x6e\164\137\x69\x64"] = $id; goto jtYCK; IpmYn: $mch_id = $this->getMchId($app_id); goto Pc9wJ; H81Dt: if (empty($likes)) { goto NT5E0; } goto zQOu6; dYwiH: NT5E0: goto TsJE1; rZzQ2: $likes = Db::name("\x79\142\x73\143\137\x70\x61\x79\143\x6f\156\x74\145\x6e\164\x5f\x6c\x69\153\x65\163")->where(["\165\151\144" => $uid, "\x6d\143\x68\137\x69\x64" => $mch_id, "\160\141\171\x63\x6f\x6e\164\145\156\164\x5f\151\x64" => $id])->find(); goto H81Dt; dRKR4: Db::name("\171\142\163\143\137\160\x61\171\x63\157\x6e\164\x65\156\164")->where(["\x69\x64" => $id, "\155\143\x68\x5f\151\144" => $mch_id])->setInc("\154\x69\153\145\163"); goto cDazw; PU1JU: $uid = Request::instance()->param("\165\x69\x64", 0); goto rZzQ2; cgQdg: $app_id = Request::instance()->param("\x69"); goto IpmYn; EI5UF: $res = Db::name("\171\x62\163\143\137\x70\141\171\x63\x6f\156\164\145\x6e\x74\137\x6c\x69\153\145\163")->insert($data); goto dRKR4; DoSxR: } public function allprice() { goto PZPss; DXZRw: $list = [["\x6e\141\x6d\x65" => "\345\215\x95\347\213\254\350\xb4\255\344\271\xb0", "\x69\144" => 0, "\160\162\151\143\145" => $info["\160\162\x69\x63\x65"], "\151\x6e\x66\157" => "\350\xb4\xad\xe4\xb9\xb0\345\220\x8e\345\215\xb3\345\217\xaf\346\265\x8f\xe8\xa7\210\346\x9f\245\xe7\x9c\x8b\xe6\xad\244\345\206\x85\345\256\xb9"]]; goto B07N9; lrqMF: goto MJ7pU; goto XMYyW; RXvSO: $app_id = Request::instance()->param("\x69"); goto LkvZ5; d60ne: $id = Request::instance()->param("\151\144", 0); goto LH6Sa; mQCqb: $rs["\x69\x6e\x66\157"] = $list; goto mmn83; LH6Sa: $info = Db::name("\171\142\x73\x63\x5f\x70\x61\x79\x63\x6f\x6e\x74\145\x6e\164")->where(["\x6d\143\x68\137\x69\x64" => $mch_id, "\x69\144" => $id])->find(); goto b2g2t; PZPss: $rs = array("\x63\157\x64\145" => 0, "\151\156\146\x6f" => array()); goto RXvSO; mmn83: return json_encode($rs); goto F7vgO; XMYyW: PZ1iB: goto DXZRw; jhrsq: $list = Db::name("\171\142\163\x63\x5f\x70\141\171\143\157\156\164\145\x6e\x74\137\160\162\151\x63\145\x73")->where(["\x6d\x63\x68\x5f\151\144" => $mch_id, "\x73\164\141\164\165\x73" => 1])->order("\163\157\162\164\40\x61\x73\143")->select(); goto lrqMF; B07N9: MJ7pU: goto mQCqb; LkvZ5: $mch_id = $this->getMchId($app_id); goto d60ne; b2g2t: if (!empty($info) && $info["\160\x72\151\x63\145"] > 0) { goto PZ1iB; } goto jhrsq; F7vgO: } public function uinfo() { goto icvFw; wVdWZ: $user["\x65\x78\160\151\162\145\137\144\x61\x79"] = date("\131\x2d\x6d\x2d\x64", $user["\145\170\x70\x69\162\x65"]); goto cQxDT; X2IXP: return json_encode($rs); goto gDBOO; IVT65: $rs["\x63\157\x64\x65"] = empty($user) ? 0 : 1; goto u4qiv; vgVEz: $mch_id = $this->getMchId($app_id); goto G3x7j; tpRZM: $user = Db::name("\171\142\163\x63\x5f\160\141\171\x63\157\x6e\164\x65\x6e\x74\137\165\x73\x65\162")->where(["\165\151\x64" => $uid, "\155\x63\150\137\151\x64" => $mch_id])->find(); goto Kx7U7; u4qiv: $rs["\x69\156\146\x6f"] = $user; goto X2IXP; Kx7U7: if (empty($user)) { goto JuXu3; } goto wVdWZ; G3x7j: $uid = Request::instance()->param("\165\151\144", 0); goto tpRZM; iJLqb: $app_id = Request::instance()->param("\x69"); goto vgVEz; cQxDT: $user["\151\163\x76\151\160"] = $user["\145\170\160\151\x72\145"] > time(); goto qN0oY; qN0oY: JuXu3: goto IVT65; icvFw: $rs = array("\143\157\144\145" => 0, "\151\x6e\x66\x6f" => array()); goto iJLqb; gDBOO: } public function order() { goto bW5G3; sD9Tw: $mch_id = $this->getMchId($app_id); goto XFDOn; bW5G3: $rs = array("\x63\157\144\x65" => 0, "\151\156\146\x6f" => array()); goto aJ31u; lG3kJ: $rs["\151\156\x66\x6f"] = $list; goto kkpY2; OyCG5: foreach ($list as &$item) { goto WCMNI; WCMNI: $item["\142\165\x79\137\x74\x69\x6d\x65"] = date("\x59\x2d\155\55\x64\40\x48\72\x69\72\x73", $item["\143\x72\x65\141\164\x65\137\164\x69\155\x65"]); goto Z5PBo; sxh60: gunaC: goto TFSoI; Z5PBo: $item["\142\x75\x79\137\x69\156\x66\x6f"] = $item["\160\x72\x69\143\145\137\x6e\141\155\145"] . "\x20\170\x20" . $item["\x6e\x75\x6d"]; goto sxh60; TFSoI: } goto yllhK; hrM8_: $list = Db::name("\171\x62\x73\143\x5f\160\141\x79\143\157\x6e\x74\x65\156\164\137\157\162\x64\x65\162\x73")->where(["\x75\x69\144" => $uid, "\x6d\143\150\137\x69\144" => $mch_id, "\151\163\120\141\171" => 1])->page($page, 20)->select(); goto OyCG5; yllhK: cuEJb: goto DKlW7; kkpY2: return json_encode($rs); goto fnZCz; XFDOn: $uid = Request::instance()->param("\165\x69\x64", 0); goto S2VZe; aJ31u: $app_id = Request::instance()->param("\151"); goto sD9Tw; DKlW7: $rs["\143\x6f\x64\145"] = 1; goto lG3kJ; S2VZe: $page = Request::instance()->param("\x70\141\147\x65", 1); goto hrM8_; fnZCz: } public function likes() { goto YlKQw; hY4XC: $rs["\x63\157\144\x65"] = 1; goto PLt1Q; jVqzU: $app_id = Request::instance()->param("\151"); goto kLrZF; kLrZF: $mch_id = $this->getMchId($app_id); goto nq99D; izty4: $list = Db::name("\171\142\x73\143\x5f\160\141\x79\x63\x6f\156\x74\x65\x6e\x74\x5f\154\151\153\x65\163")->alias("\154")->join("\171\142\163\x63\137\160\x61\x79\143\157\x6e\x74\x65\x6e\164\40\x63", "\154\x2e\160\x61\171\143\157\156\x74\x65\156\x74\137\x69\144\x3d\143\56\151\x64")->where(["\154\56\165\151\x64" => $uid, "\x6c\x2e\155\143\x68\x5f\151\x64" => $mch_id])->field("\143\56\x2a")->page($page, 20)->select(); goto hY4XC; PLt1Q: $rs["\x69\x6e\146\x6f"] = $list; goto p2ZjR; p2ZjR: return json_encode($rs); goto Qh1oc; rfPd2: $page = Request::instance()->param("\160\141\147\x65", 1); goto izty4; YlKQw: $rs = array("\143\157\144\145" => 0, "\x69\156\146\x6f" => array()); goto jVqzU; nq99D: $uid = Request::instance()->param("\165\x69\x64", 0); goto rfPd2; Qh1oc: } public function createOrder() { goto PJZUi; tcFx_: $content_id = Request::instance()->param("\x63\x6f\x6e\164\145\x6e\x74\x5f\x69\144", 0); goto LOpP9; ygOSs: $input->SetOpenid($openid); goto cyrLY; QLaYf: $data["\x70\162\x69\143\145"] = $price_info["\x70\x72\151\143\x65"]; goto Hb_Mz; ZvPjW: exit(json_encode($rs, true)); goto TKXPs; jbdiq: $notice_url = $_W["\163\151\164\145\162\x6f\157\x74"] . "\141\144\x64\x6f\156\163\x2f\171\142\x5f\x73\x68\x6f\x70\x2f\143\157\162\x65\x2f\160\141\171\137\x70\141\171\143\157\x6e\x74\x65\x6e\x74\x2e\160\150\160"; goto XNCP0; cyrLY: $input->SetDetail($pay_data["\x70\x61\x79\137\x64\x65\164\x61\151\x6c"]); goto vc7S3; pNDT4: $uid = Request::instance()->param("\165\151\x64"); goto CrHaa; fhEsj: $data["\143\x72\145\x61\164\145\137\164\x69\155\145"] = $time; goto rKb5b; Ahly2: if (!empty($pay_data)) { goto DCsQl; } goto jJVdN; g2iVA: $price_info = Db::name("\171\x62\x73\x63\137\x70\141\171\143\157\156\164\145\x6e\x74\137\x70\x72\151\143\145\163")->where(["\x69\144" => $price_id, "\155\143\150\137\151\144" => $mch_id])->find(); goto G6LWN; gtiz2: if (!($unifiedorder["\162\x65\x74\x75\x72\x6e\137\143\x6f\x64\145"] == "\106\101\111\x4c")) { goto Gi5aF; } goto qFE9d; LZdDh: Db::startTrans(); goto M_Hax; isuhw: GQr0b: goto g2iVA; qFE9d: $rs["\143\x6f\x64\145"] = 1; goto ciVzY; fx0C3: $data["\x6e\165\x6d"] = $num; goto oLYKl; qrvAx: $pay_info["\160\x61\x79\123\x69\147\156"] = $pay_info["\x73\151\147\156"]; goto VR2nJ; ciVzY: $rs["\155\163\x67"] = $unifiedorder["\162\145\164\165\162\156\x5f\155\x73\147"]; goto XhOiA; Qx4zx: $rs["\x63\157\144\145"] = 1; goto tcPQa; G6LWN: RoEwG: goto aA3rN; V5glm: goto RoEwG; goto isuhw; E9g53: $input->SetOut_trade_no($pay_data["\x6f\x75\x74\x5f\164\x72\141\144\x65\137\156\157"]); goto yIkOi; tcPQa: $rs["\155\x73\x67"] = "\347\x94\x9f\346\x88\x90\350\xae\242\345\x8d\225\xe5\xa4\261\350\xb4\245"; goto kh12K; M54mq: $data["\x6f\x72\x64\x65\x72\137\156\x6f"] = $this->createOrderNo(); goto ZBUCX; ogLtQ: $mch_id = $this->getMchId($app_id); goto t1MAx; liQuM: $res = $this->weixinapp($unifiedorder); goto YlC_i; xxkY5: $rs["\155\163\147"] = $unifiedorder["\145\162\162\137\143\157\x64\145\x5f\x64\x65\x73"]; goto ZvPjW; VbPl9: if (!empty($id)) { goto pZ7fI; } goto Qx4zx; f6523: return json_encode($rs); goto Q9nfR; QKMUx: $data["\160\162\x69\143\145\137\x6e\x61\155\x65"] = $price_info["\x6e\141\155\x65"]; goto fx0C3; XNCP0: $input->SetNotify_url($notice_url); goto ztlUd; ztlUd: $unifiedorder = \WxPayApi::unifiedOrder($input); goto gtiz2; xLBFL: $data["\x64\x61\171"] = $price_info["\144\141\171"]; goto fhEsj; rKb5b: $data["\x6d\143\x68\x5f\x69\144"] = $mch_id; goto M54mq; kh12K: return json_encode($rs); goto JowoI; u9_qj: $rs["\155\x73\147"] = "\xe7\224\237\xe6\210\220\350\256\242\xe5\215\x95\345\244\261\xe8\xb4\245"; goto eTBwO; Glz6y: goto G5zB2; goto mz_tR; oLYKl: $data["\164\x6f\x74\x61\x6c\x50\x72\151\143\x65"] = round($data["\x6e\x75\x6d"] * $data["\x70\162\x69\x63\x65"], 2); goto xLBFL; LJ9lO: $info = Db::name("\171\142\163\143\137\160\x61\171\143\157\156\164\x65\x6e\x74")->where(["\151\144" => $content_id, "\155\x63\x68\x5f\151\144" => $mch_id])->find(); goto LlHlv; jJVdN: $rs["\x63\x6f\x64\145"] = 1; goto u9_qj; CrHaa: $openid = Request::instance()->param("\x6f\x70\145\156\x69\x64"); goto tcFx_; m0xCQ: $app_id = Request::instance()->param("\151"); goto ogLtQ; Zqh1s: $data["\x70\162\151\x63\145\x5f\151\x64"] = $price_id; goto QKMUx; XhOiA: exit(json_encode($rs, true)); goto m8YIq; mz_tR: DCsQl: goto hgI37; RNy7s: $rs["\143\157\x64\x65"] = 1; goto xxkY5; YlC_i: $pay_info = array(); goto U0Oo4; m8YIq: Gi5aF: goto YFPyB; LOpP9: if ($price_id > 0) { goto GQr0b; } goto LJ9lO; e9xGi: $input->SetBody($pay_data["\x70\141\171\x5f\142\157\x64\x79"]); goto ygOSs; Hb_Mz: $data["\165\151\x64"] = $uid; goto MedYM; M_Hax: try { goto b05K0; WjyOk: $pay_data = array("\157\x75\164\137\164\x72\x61\x64\145\137\x6e\157" => $data["\157\165\x74\x5f\x74\162\x61\144\x65\x5f\156\157"], "\x70\x61\x79\x5f\164\171\160\x65" => Request::instance()->param("\160\x61\171\x5f\x74\171\x70\145", "\61"), "\x74\x79\x70\145\137\141\x6c\151\163\137\151\x64" => $id, "\160\x61\171\x5f\x62\x6f\x64\171" => "\345\xb9\263\345\217\260\346\x94\xaf\xe4\273\230", "\x70\x61\x79\x5f\144\x65\164\x61\x69\x6c" => "\345\xb9\xb3\xe5\x8f\xb0\350\264\xad\xe4\271\xb0\xe5\x95\x86\345\223\201", "\x70\141\171\137\x6d\x6f\x6e\145\x79" => $data["\164\x6f\164\141\x6c\120\x72\151\x63\145"], "\143\162\x65\141\x74\145\137\x74\x69\x6d\145" => $time); goto yaotv; yaotv: Db::name("\171\142\x73\143\137\x70\x61\x79\143\x6f\x6e\164\x65\x6e\x74\137\160\x61\x79\155\x65\156\164")->insert($pay_data); goto ve3oV; b05K0: $id = Db::name("\171\x62\x73\x63\x5f\x70\141\171\x63\x6f\x6e\x74\145\x6e\164\137\x6f\x72\x64\145\x72\x73")->strict(true)->insertGetId($data); goto WjyOk; ve3oV: Db::commit(); goto vYtXL; vYtXL: } catch (\Exception $e) { $id = 0; Db::rollback(); } goto VbPl9; ZBUCX: $data["\x6f\165\x74\137\164\162\141\144\145\x5f\x6e\x6f"] = $this->createOutTradeNo(); goto LZdDh; PJZUi: $rs = array("\x63\157\x64\x65" => 0, "\151\x6e\x66\x6f" => array()); goto m0xCQ; MedYM: $data["\143\157\156\x74\145\156\164\137\x69\x64"] = $content_id; goto Zqh1s; efzkx: $input = new \WxPayUnifiedOrder(); goto e9xGi; eTBwO: return json_encode($rs); goto Glz6y; hgI37: $GLOBALS["\155\143\150\x5f\151\x64"] = $mch_id; goto efzkx; LLa7B: global $_W; goto jbdiq; oqX05: dArOd: goto qrvAx; yIkOi: $input->SetTrade_type("\x4a\123\101\x50\111"); goto LLa7B; VR2nJ: unset($pay_info["\163\151\x67\156"]); goto HRbUe; t1MAx: $price_id = Request::instance()->param("\160\x72\x69\x63\145\x5f\151\144", 0); goto GtejN; aA3rN: $time = time(); goto QLaYf; vc7S3: $input->SetTotal_fee($pay_data["\160\141\x79\137\155\x6f\156\x65\171"] * 100); goto E9g53; U0Oo4: foreach ($this->objectArray($res) as $value) { $pay_info = $value; Gq5QR: } goto oqX05; YFPyB: if (!($unifiedorder["\x72\x65\163\x75\154\x74\137\143\x6f\144\145"] == "\x46\x41\x49\x4c")) { goto OTtS1; } goto RNy7s; JowoI: pZ7fI: goto Ahly2; GtejN: $num = Request::instance()->param("\156\x75\155"); goto pNDT4; HRbUe: $rs["\x69\x6e\146\x6f"] = $pay_info; goto f6523; TKXPs: OTtS1: goto liQuM; Q9nfR: G5zB2: goto qIsls; LlHlv: $price_info = ["\x70\x72\151\143\x65" => $info["\x70\x72\151\143\x65"], "\x6e\x61\x6d\145" => "\345\x86\205\xe5\256\271\xe5\x8d\225\xe7\x8b\254\350\xb4\xad\344\271\260", "\x64\141\171" => 0]; goto V5glm; qIsls: } private function weixinapp($unifiedorder) { goto mV0CR; aL7vT: return $input; goto oqsgw; mV0CR: $input = new \WxPayJsApiPay(); goto D1Jli; juwsO: $input->SetSign(); goto aL7vT; eGGdQ: $input->SetTimeStamp('' . time() . ''); goto krf4Q; o5huM: $input->SetPackage("\x70\x72\x65\160\141\171\x5f\151\x64\x3d" . $unifiedorder["\160\162\x65\x70\x61\171\x5f\151\x64"]); goto H2CoM; krf4Q: $input->SetNonceStr($this->createNoncestr()); goto o5huM; H2CoM: $input->SetSignType("\115\x44\65"); goto juwsO; D1Jli: $input->SetAppid($unifiedorder["\x61\160\x70\x69\x64"]); goto eGGdQ; oqsgw: } private function createNoncestr($length = 32) { goto bK0Ks; J2nnz: $i = 0; goto HRBim; rQXs2: if (!($i < $length)) { goto psjKy; } goto F4cwh; ApCR_: pDrM8: goto JQzIY; sk4bm: goto kzD19; goto Md9NP; F4cwh: $str .= substr($chars, mt_rand(0, strlen($chars) - 1), 1); goto ApCR_; Md9NP: psjKy: goto buP48; bK0Ks: $chars = "\141\x62\x63\x64\145\146\x67\150\x69\x6a\x6b\154\x6d\156\157\160\161\162\163\x74\x75\x76\x77\x78\x79\x7a\x30\x31\62\63\64\65\x36\67\x38\x39"; goto cihdn; HRBim: kzD19: goto rQXs2; cihdn: $str = ''; goto J2nnz; buP48: return $str; goto N8q65; JQzIY: $i++; goto sk4bm; N8q65: } }
