<?php
 namespace app\api\service; use think\Db; require_once BASE_ROOT . "\x63\x6f\x72\x65\57\x61\x70\x70\x6c\151\143\141\x74\x69\x6f\156\57\143\157\x6d\x6d\157\x6e\x2e\x70\x68\x70"; class UserService { protected $config = array("\165\x72\154" => "\150\x74\x74\x70\x73\72\x2f\x2f\x61\x70\x69\x2e\167\145\151\x78\x69\x6e\x2e\x71\x71\x2e\143\x6f\x6d\57\x73\x6e\x73\57\x6a\x73\x63\157\x64\145\x32\x73\x65\163\163\x69\x6f\x6e", "\x61\160\160\x69\144" => "\x79\x6f\165\x72\40\141\160\x70\111\x64", "\163\x65\x63\162\x65\164" => "\171\157\x75\162\40\x73\145\143\x72\x65\x74", "\x67\x72\141\156\164\x5f\x74\x79\160\x65" => "\141\165\164\150\x6f\162\x69\172\x61\x74\151\x6f\156\137\143\x6f\x64\x65"); public function __construct() { goto bbDG3; Rpkc8: $this->config["\141\x70\160\x69\144"] = $key; goto HS3Y4; bbDG3: global $_W; goto vCAyw; HS3Y4: $this->config["\163\x65\143\162\x65\x74"] = $secret; goto Fq0nX; Tgeq6: if (!(empty($key) || empty($secret))) { goto APzxM; } goto akGDb; akGDb: $param = Db::name("\x79\142\163\x63\x5f\x63\157\x6e\x66\x69\x67")->where("\153\145\x79", "\x57\x58\x50\101\x59")->where("\155\x63\150\137\151\x64", $GLOBALS["\155\143\x68\137\x69\144"])->value("\x76\141\x6c\165\145"); goto t5zNT; vCAyw: $key = $_W["\x61\x63\x63\157\x75\156\164"]["\153\x65\171"]; goto sPiD0; PPjIY: $secret = $param["\x41\x50\120\x5f\x53\105\x43\x52\105\x54"]; goto gqU3i; t5zNT: $param = json_decode($param, true); goto PO0Fs; sPiD0: $secret = $_W["\141\x63\143\x6f\165\156\x74"]["\x73\145\x63\x72\x65\x74"]; goto Tgeq6; PO0Fs: $key = $param["\101\x50\x50\137\x49\104"]; goto PPjIY; gqU3i: APzxM: goto Rpkc8; Fq0nX: } public function checkUser($appId, $pid) { goto CFcda; CFcda: $rs = Db::name("\171\142\163\143\137\x75\163\145\162")->where("\x77\x78\137\157\x70\x65\x6e\x69\144", $appId)->find(); goto OvMHz; jFvFK: RoaqB: goto FVoFV; rCWxh: Pz8le: goto XDOgA; OI3e9: e4Zma: goto LmyLs; ZmgPe: Db::name("\x79\142\163\143\137\165\x73\145\162")->where("\167\x78\137\x6f\160\x65\x6e\151\x64", $appId)->update(["\160\x69\144" => $pid]); goto rCWxh; D_Evq: return null; goto etrar; etrar: goto RoaqB; goto OI3e9; LmyLs: return $rs["\x75\x69\144"]; goto jFvFK; XDOgA: if (!empty($rs) && $rs["\x75\151\144"]) { goto e4Zma; } goto D_Evq; OvMHz: if (!(!empty($rs) && $pid != 0 && $rs["\x70\151\x64"] == 0)) { goto Pz8le; } goto ZmgPe; FVoFV: } public function addUser($data) { goto sqW_C; O0M7F: F64QZ: goto QVv1l; d6rQn: if (!(empty($info) || $info["\154\x65\x76\145\x6c"] == 0)) { goto F64QZ; } goto SteeA; QVv1l: $rs = Db::name("\x79\142\163\x63\137\165\163\145\162")->insertGetId($data); goto a1c1Z; a1c1Z: return $rs; goto QbI4t; sqW_C: $info = Db::name("\171\x62\x73\x63\137\165\163\x65\x72\x5f\x73\150\x61\x72\145\x5f\163\x65\164\x74\x69\156\x67")->where("\155\x63\x68\x5f\151\144", $data["\x6d\x63\x68\x5f\x69\144"])->find(); goto d6rQn; SteeA: $data["\x70\151\144"] = 0; goto O0M7F; QbI4t: } public function getUser($uid) { $result = Db::name("\171\x62\x73\143\137\x75\x73\x65\x72")->where("\x75\x69\x64", $uid)->find(); return $result; } public function checkLogin($code, $encryptedData, $iv) { goto kauTn; vXHtl: $a = json_decode($res["\x72\145\x73\x75\154\164"], true); goto l6RRN; kauTn: $params = array("\141\x70\x70\x69\x64" => $this->config["\x61\160\160\151\144"], "\x73\x65\143\x72\145\x74" => $this->config["\163\x65\x63\x72\145\164"], "\x6a\163\x5f\143\x6f\x64\x65" => $code, "\147\162\x61\x6e\164\x5f\164\171\x70\145" => $this->config["\147\x72\141\156\164\x5f\164\x79\x70\x65"]); goto c5EnE; rsox5: $a["\x75\x6e\151\157\156\x49\x64"] = $info["\x75\156\x69\x6f\x6e\x49\x64"] ? $info["\x75\x6e\x69\x6f\156\x49\x64"] : null; goto nlDzP; l6RRN: $a["\x75\x6e\x69\157\156\x49\x64"] = null; goto mTdsF; l8qTw: $info = json_decode(json_encode($data), true); goto rsox5; nlDzP: r4NVH: goto wYa5a; wYa5a: return $a; goto y80Ej; mTdsF: if (!($encryptedData && $iv)) { goto r4NVH; } goto yqDbv; yqDbv: $data = $this->decryptData($encryptedData, $a["\163\x65\163\x73\151\x6f\156\137\153\x65\171"], $this->config["\x61\160\160\151\144"], $iv); goto l8qTw; c5EnE: $res = $this->makeRequest($this->config["\165\x72\x6c"], $params); goto vXHtl; y80Ej: } protected function makeRequest($url, $params = array(), $expire = 0, $extend = array(), $hostIp = '') { goto MivkK; EnMEC: $url = str_replace($urlInfo["\150\157\x73\x74"], $hostIp, $url); goto qRMZX; N5O0Y: $_header[] = "\x48\157\163\164\x3a\x20{$urlInfo["\x68\157\163\x74"]}"; goto X_Bwx; McvaG: $result["\x63\x6f\x64\x65"] = curl_getinfo($_curl, CURLINFO_HTTP_CODE); goto tIoH6; rcBOm: QyZXH: goto N5O0Y; H6gP7: curl_setopt($_curl, CURLOPT_POST, true); goto G6tSi; Mgp9e: $result["\x72\145\163\165\154\x74"] = curl_error($_curl); goto s8Ro_; MivkK: if (!empty($url)) { goto QjfJ3; } goto TWM9d; G6tSi: nokc0: goto LL6oT; sK1BJ: curl_close($_curl); goto WxK_4; zHvHN: $result["\162\145\163\x75\x6c\x74"] = curl_exec($_curl); goto McvaG; hxH2b: curl_setopt($_curl, CURLOPT_POSTFIELDS, http_build_query($params)); goto H6gP7; A7Js6: BLuBa: goto zHvHN; kKUH3: curl_setopt($_curl, CURLOPT_SSL_VERIFYPEER, FALSE); goto Vsm_6; yUzIQ: $urlInfo = parse_url($url); goto Aty38; CaKBK: $urlInfo["\x68\x6f\x73\164"] = substr(DOMAIN, 7, -1); goto bcigg; u1nL6: curl_setopt($_curl, CURLOPT_USERAGENT, "\x41\x50\111\x20\x50\x48\x50\40\x43\x55\x52\x4c"); goto hsZrz; tIoH6: $result["\x69\x6e\x66\x6f"] = curl_getinfo($_curl); goto pd1J8; JmfoH: $_header = array("\x41\x63\x63\145\160\x74\x2d\x4c\x61\x6e\147\165\x61\x67\x65\72\40\172\150\x2d\103\x4e", "\103\x6f\156\x6e\x65\x63\164\x69\x6f\156\x3a\40\113\x65\145\x70\55\101\154\151\166\145", "\103\x61\143\x68\x65\55\103\157\156\x74\x72\157\x6c\x3a\40\156\157\55\143\x61\143\x68\x65"); goto YbXPJ; e7ga1: c07P5: goto sK1BJ; Aty38: if (empty($urlInfo["\150\x6f\163\164"])) { goto siCup; } goto EnMEC; eT3ie: EDDPU: goto EWFci; YbXPJ: if (empty($hostIp)) { goto g9uVY; } goto yUzIQ; MXU5y: QjfJ3: goto Rq1Ld; s8Ro_: $result["\x63\157\x64\145"] = -curl_errno($_curl); goto e7ga1; qRMZX: goto QyZXH; goto kHHsL; WR3z4: curl_setopt($_curl, CURLOPT_RETURNTRANSFER, true); goto u1nL6; X_Bwx: g9uVY: goto ZOfrk; eBxvv: if (!($expire > 0)) { goto gdKHl; } goto HdaNP; kHHsL: siCup: goto CaKBK; jAFD2: curl_setopt($_curl, CURLOPT_CONNECTTIMEOUT, $expire); goto CNH0e; HdaNP: curl_setopt($_curl, CURLOPT_TIMEOUT, $expire); goto jAFD2; pd1J8: if (!($result["\x72\145\x73\165\154\164"] === false)) { goto c07P5; } goto Mgp9e; OOJlm: if (empty($extend)) { goto BLuBa; } goto hs1yM; Vsm_6: curl_setopt($_curl, CURLOPT_SSL_VERIFYHOST, FALSE); goto eT3ie; hsZrz: curl_setopt($_curl, CURLOPT_HTTPHEADER, $_header); goto eBxvv; hs1yM: curl_setopt_array($_curl, $extend); goto A7Js6; bcigg: $url = "\x68\164\164\x70\x3a\57\57{$hostIp}{$url}"; goto rcBOm; CNH0e: gdKHl: goto OOJlm; EWFci: curl_setopt($_curl, CURLOPT_URL, $url); goto WR3z4; WxK_4: return $result; goto R_FVd; LL6oT: if (!(substr($url, 0, 8) == "\150\164\x74\160\163\72\57\x2f")) { goto EDDPU; } goto kKUH3; ZOfrk: if (empty($params)) { goto nokc0; } goto hxH2b; TWM9d: return array("\x63\157\144\145" => "\x31\x30\x30"); goto MXU5y; Rq1Ld: $_curl = curl_init(); goto JmfoH; R_FVd: } public function get_userinfo($data) { $u = Db::name("\x79\x62\163\143\x5f\165\x73\145\x72")->where("\x75\151\144", $data["\165\x69\144"])->find(); return $u; } public function orderCount($data) { goto MS0cd; nnetr: $rs["\x63\157\160\171\162\151\x67\x68\x74"] = "\346\264\233\xe9\x98\xb3\xe5\xa3\xb9\344\xbd\260\xe7\xbd\x91\xe7\xbb\x9c\xe6\x8f\x90\344\xbe\233\346\x8a\200\346\x9c\xaf\346\x94\257\xe6\214\x81"; goto max5o; ek236: if (empty($copyright)) { goto aL0yx; } goto qCP9D; xJCUu: if (!($u["\154\x65\166\x65\154\x5f\x69\144"] != 0)) { goto GCy4o; } goto pftG9; My6zX: goto F4KDA; goto QnC3z; T4nmR: aL0yx: goto peLr_; pftG9: $a = Db::name("\x79\142\163\x63\x5f\165\x73\x65\162\x5f\154\145\166\x65\154")->where(["\151\x64" => $u["\x6c\x65\x76\x65\154\x5f\151\x64"], "\x6d\143\x68\137\x69\x64" => $data["\155\143\x68\137\x69\x64"]])->find(); goto OJFdm; PYfZY: if ($copy["\x63\157\144\x65"] == 0) { goto MilZK; } goto nnetr; l01tY: return $rs; goto V76Vg; kyKx6: $rs["\x66\141\166\157\x72\x69\x74\145\x73"] = Db::name("\x79\142\163\x63\137\x75\x73\145\162\137\x66\141\x76\x6f\162\151\x74\x65\163")->where("\165\151\144", $data["\165\x69\144"])->count(); goto TivZX; TApzA: MilZK: goto dCTCV; gyGdU: if (!empty($copy)) { goto ljVxF; } goto Kwe81; Oz8h5: $u = Db::name("\x79\x62\163\143\137\x75\163\x65\162")->where("\165\151\x64", $data["\x75\x69\x64"])->find(); goto xBlNE; woiCb: $rs["\x70\x65\156\144\151\156\147\137\163\x68\151\160\155\145\156\x74"] = Db::name("\x79\x62\x73\143\x5f\157\x72\x64\145\x72")->where("\142\x75\171\145\162\x5f\151\x64", $data["\165\x69\144"])->where("\151\x73\x5f\144\x65\154\x65\x74\x65\x64", 0)->where("\155\143\x68\137\x69\x64", $data["\x6d\x63\150\x5f\x69\144"])->where("\x6f\162\x64\145\x72\x5f\163\164\141\164\165\x73", 1)->count(); goto YuS8K; yPm1E: $copy = file_get_contents("\x68\x74\x74\160\72\57\57\x76\151\x70\56\154\171\x31\x30\60\56\x77\x61\156\x67\x2f\141\160\x69\x2f\141\160\151\x2f\151\x6e\144\x65\170\57\x69\163\x5f\163\150\x6f\167\x5f\x63\157\160\x79\162\151\x67\x68\x74\x3f\x75\x6e\151\141\143\x69\144\x3d" . $data["\141\160\x70\137\151\x64"] . "\46\x79\165\x6d\x69\156\x67\x3d" . $_SERVER["\110\x54\x54\120\137\110\117\123\x54"]); goto gyGdU; TTJQE: fzLvp: goto My6zX; Kwe81: $rs["\143\157\x70\171\162\x69\147\150\164"] = ''; goto E9B9J; OJFdm: $rs["\154\x65\x76\145\154\137\156\x61\x6d\x65"] = $a["\154\145\166\x65\154\x5f\x6e\x61\155\145"]; goto VVXqO; YuS8K: $rs["\x70\x65\156\x64\x69\x6e\147\137\x72\145\143\145\x69\x70\x74"] = Db::name("\171\142\163\143\x5f\157\x72\144\145\x72")->where("\142\165\x79\145\162\x5f\151\x64", $data["\x75\x69\144"])->where("\x69\x73\x5f\x64\x65\154\x65\x74\x65\x64", 0)->where("\155\143\150\x5f\151\144", $data["\x6d\x63\150\137\151\144"])->where("\157\x72\144\x65\x72\x5f\163\x74\x61\x74\165\x73", 2)->count(); goto WtS_o; WtS_o: $rs["\x72\x65\x66\165\156\144"] = Db::name("\x79\x62\163\143\137\x6f\162\144\145\x72")->where("\142\x75\171\145\162\137\151\144", $data["\x75\151\144"])->where("\x69\x73\137\x64\x65\x6c\145\164\145\144", 0)->where("\155\143\x68\x5f\x69\144", $data["\x6d\x63\x68\137\x69\144"])->where("\x6f\x72\144\145\162\x5f\163\164\x61\164\165\163", 4)->count(); goto kyKx6; qCP9D: $rs["\143\x6f\x70\171\x72\151\147\x68\164"] = $copyright["\x63\x6f\x6e\x74\x65\156\164"]; goto T4nmR; iuIYY: $rs["\x63\x6f\160\x79\162\151\x67\150\x74"] = ''; goto HYnWz; HYnWz: F4KDA: goto l01tY; h0srj: $rs["\x70\145\x6e\144\x69\x6e\x67\137\x70\141\171\x6d\145\156\x74"] = Db::name("\x79\142\163\143\x5f\x6f\x72\x64\145\162")->where("\142\x75\x79\x65\162\137\x69\x64", $data["\x75\151\x64"])->where("\x69\163\137\144\145\x6c\x65\164\145\x64", 0)->where("\155\143\150\x5f\x69\144", $data["\x6d\143\x68\x5f\x69\144"])->where("\157\162\x64\x65\x72\137\163\x74\x61\x74\165\x73", 0)->count(); goto woiCb; xBlNE: $rs["\165\x73\x65\x72\x5f\x6c\145\x76\x65\x6c"] = $u["\154\x65\x76\145\154\x5f\151\x64"]; goto xJCUu; QnC3z: PQrfG: goto iuIYY; peLr_: piw_7: goto TTJQE; E9B9J: goto fzLvp; goto Q3slX; MS0cd: $rs = array(); goto Oz8h5; dCTCV: $copyright = Db::name("\171\142\163\143\x5f\143\x6f\x70\x79\162\x69\147\150\x74")->where("\151\144", 1)->find(); goto ek236; max5o: goto piw_7; goto TApzA; VVXqO: GCy4o: goto h0srj; CbiMf: if (!empty($cop) && $cop == 1) { goto PQrfG; } goto yPm1E; TivZX: $cop = Db::name("\x79\x62\163\x63\137\165\163\145\x72\x5f\x70\145\162\155\151\x73\163\x69\157\156")->where("\165\x73\145\162\x5f\x69\144", $data["\x6d\143\150\137\x69\144"])->value("\151\x73\137\x73\x68\157\167\x5f\x63\157\x70\x79\x72\x69\x67\x68\164"); goto CbiMf; Q3slX: ljVxF: goto PYfZY; V76Vg: } public function about($data) { goto FAG0e; K9Ixp: return $rs; goto Faje1; L6Vt3: $rs["\x6c\157\147\157"] = __IMG($rs["\154\157\147\157"]); goto wnQ2d; YusSV: q1kRD: goto aOWQA; iGo60: $a = Db::name("\x79\142\163\143\137\165\163\x65\x72\137\x6c\x65\x76\x65\154")->where(["\x69\x64" => $u["\x6c\x65\x76\x65\x6c\x5f\x69\x64"], "\x6d\143\x68\137\x69\x64" => $data["\x6d\143\150\137\x69\x64"]])->find(); goto H766t; BbWX1: EXlfA: goto YusSV; wnQ2d: if (!($data["\165\151\144"] != 0)) { goto j2qPs; } goto nwOsF; bGbX6: $rs["\165\163\x65\162\x5f\162\145\142\141\x74\x65"] = 10.0; goto qDnXG; H766t: if (!$a) { goto EXlfA; } goto PoGqK; czD0p: $rs["\x75\x73\x65\162\137\x6c\x65\x76\145\154"] = $u["\x6c\x65\166\x65\x6c\x5f\x69\x64"]; goto bGbX6; nwOsF: $u = Db::name("\171\142\163\x63\137\165\163\x65\162")->where($data)->find(); goto czD0p; aOWQA: j2qPs: goto K9Ixp; qDnXG: if (!($u["\154\x65\166\x65\x6c\137\151\144"] != 0)) { goto q1kRD; } goto iGo60; FAG0e: $rs = Db::name("\x79\142\x73\143\137\x62\x75\x73\151\x6e\145\x73\163\x5f\141\142\157\165\164")->where("\155\143\150\137\151\144", $data["\155\x63\150\137\x69\x64"])->find(); goto L6Vt3; PoGqK: $rs["\165\163\145\x72\x5f\x72\145\x62\141\164\145"] = $a["\162\145\142\141\164\145"]; goto BbWX1; Faje1: } public static $OK = 0; public static $IllegalAesKey = -41001; public static $IllegalIv = -41002; public static $IllegalBuffer = -41003; public static $DecodeBase64Error = -41004; public function decryptData($encryptedData, $sessionKey, $app_id, $iv) { goto M38cP; HZ4rb: ytcFI: goto MbI2H; rEBws: $aesKey = base64_decode($sessionKey); goto f8onv; MXCzM: return $dataObj; goto pLRCM; J2YVU: return self::$IllegalBuffer; goto jPUYH; f8onv: if (!(strlen($iv) != 24)) { goto ytcFI; } goto ZU5do; WWiu5: $dataObj = json_decode($result); goto AcxI0; ZU5do: return self::$IllegalIv; goto HZ4rb; M38cP: if (!(strlen($sessionKey) != 24)) { goto MfK3v; } goto snkT2; MbI2H: $aesIV = base64_decode($iv); goto QuSfv; mRIyg: if (!($dataObj->watermark->appid != $app_id)) { goto FI0Ci; } goto u2VGU; jPUYH: Kw3zG: goto mRIyg; di59I: MfK3v: goto rEBws; AILPc: FI0Ci: goto MXCzM; u2VGU: return self::$IllegalBuffer; goto AILPc; AcxI0: if (!($dataObj == NULL)) { goto Kw3zG; } goto J2YVU; snkT2: return self::$IllegalAesKey; goto di59I; QuSfv: $aesCipher = base64_decode($encryptedData); goto hzWyR; hzWyR: $result = openssl_decrypt($aesCipher, "\101\x45\x53\x2d\61\62\x38\x2d\x43\102\103", $aesKey, 1, $aesIV); goto WWiu5; pLRCM: } }
