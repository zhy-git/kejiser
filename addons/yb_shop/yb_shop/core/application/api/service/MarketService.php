<?php
 namespace app\api\service; use think\Db; require_once BASE_ROOT . "\143\x6f\162\145\57\x61\x70\160\x6c\151\x63\x61\x74\151\157\156\x2f\143\x6f\x6d\x6d\x6f\x6e\56\x70\150\x70"; class MarketService { private $hd = "\171\x62\163\x63\137\x62\x75\x73\x69\x6e\x65\x73\x73\137\141\x63\x74\151\x76\x69\164\x79"; private $bus = "\171\142\163\x63\x5f\x62\165\163\x69\156\x65\x73\x73"; private $uc = "\171\142\x73\143\137\165\x73\x65\162\137\x63\x6f\x75\x70\x6f\x6e"; private $bc = "\171\x62\163\143\x5f\142\165\x73\x69\156\145\163\163\x5f\143\157\165\160\x6f\156"; private $rt = "\x79\x62\x73\x63\137\162\x65\163\145\162\166\145\x5f\164\x68\151\x6e\147"; public function ManJian($mch_id) { goto PrX8Y; PrX8Y: $info = Db::name($this->hd)->where("\155\x63\150\137\151\144", $mch_id)->where("\151\163\x5f\165\x73\x65", 1)->order("\x73\x61\164\151\163\x66\x79\137\x6d\157\x6e\145\171", "\x64\x65\x73\143")->where("\163\164\x61\162\137\x74\151\155\145", "\x3c", time())->where("\x65\156\x64\x5f\164\x69\x6d\145", "\76", time())->select(); goto LJCY8; LJCY8: foreach ($info as $act_k => $act_v) { goto g3jeC; gl50R: l9CWo: goto ZHGLz; g3jeC: $act_v["\163\x74\x61\162\x5f\164\151\x6d\145"] = date("\x59\55\x6d\55\144\x20\x48\x3a\151\x3a\x73", $act_v["\163\x74\x61\x72\x5f\164\x69\x6d\145"]); goto jMDm3; jMDm3: $act_v["\x65\156\x64\x5f\x74\151\155\145"] = date("\x59\55\155\x2d\144\x20\110\x3a\x69\x3a\x73", $act_v["\145\x6e\x64\x5f\x74\151\x6d\145"]); goto gl50R; ZHGLz: } goto hL9br; aIkII: return $info; goto mvY12; hL9br: WU88h: goto aIkII; mvY12: } public function mchInfo($mch_id) { $info = Db::name($this->bus)->field("\x69\x64\x2c\156\x69\x63\153\x5f\156\x61\155\x65\54\156\141\x6d\x65\54\x70\x68\157\x6e\x65\x2c\x6d\x6f\144\x5f\143\154\141\163\163\x5f\151\x64\54\x70\x61\x79\155\x65\156\x74\x5f\x6d\145\x74\x68\157\144")->where("\151\144", $mch_id)->where("\151\x73\137\x64\x65\x6c", 1)->find(); return $info; } public function BusCoupon($data, $page) { goto E2qb4; Oxc61: foreach ($info as $act_k => $act_v) { goto RMOQN; Sh4Eh: $info[$act_k]["\144\151\x73\143\157\165\x6e\x74\x5f\155\157\156\x65\171"] = intval($act_v["\144\151\x73\143\x6f\165\x6e\x74\x5f\155\157\156\145\171"]); goto HQED8; n23Yl: $info[$act_k]["\x65\156\x64\164\x69\155\145"] = date("\131\55\x6d\55\144", $act_v["\x65\156\144\137\164\x69\155\x65"]); goto XgMDe; RMOQN: $user_data = ["\x75\163\x65\x72\137\x69\x64" => $data["\165\x73\x65\162\x5f\151\144"], "\x63\x6f\165\x70\x6f\x6e\x5f\151\x64" => $act_v["\x69\144"]]; goto R2ppy; XgMDe: K4I26: goto dn70b; HQED8: $info[$act_k]["\x73\x74\141\x72\x5f\x74\x69\x6d\x65"] = __TIME($act_v["\163\x74\x61\162\x5f\x74\151\x6d\145"]); goto n23Yl; Rj2my: $info[$act_k]["\163\141\x74\x69\x73\x66\x79\x5f\x6d\157\156\145\x79"] = intval($act_v["\x73\x61\x74\151\x73\x66\171\x5f\x6d\x6f\x6e\145\171"]); goto Sh4Eh; ATvTN: $info[$act_k]["\151\x73\137\147\x65\164"] = $count == 0 ? 0 : 1; goto Rj2my; R2ppy: $count = Db::name($this->uc)->where($user_data)->count(); goto ATvTN; dn70b: } goto DRlPo; HtQC2: return $info; goto HVLJp; E2qb4: $info = Db::name($this->bc)->where("\155\x63\150\137\x69\144", $data["\155\143\x68\x5f\151\144"])->where("\x69\163\x5f\165\x73\145", 1)->page($page, PAGE_NUM)->order("\151\144", "\144\145\x73\143")->where("\x73\164\141\162\x5f\x74\151\155\145", "\74", time())->where("\145\x6e\x64\137\x74\151\x6d\x65", "\76", time())->select(); goto Oxc61; DRlPo: q0HDi: goto HtQC2; HVLJp: } public function booklist($data, $page) { $info = Db::name($this->rt)->where("\155\x63\x68\137\151\x64", $data["\x6d\143\x68\137\x69\x64"])->page($page, PAGE_NUM)->order("\x69\144", "\144\x65\x73\143")->select(); return $info; } public function bookinfo($data) { $info = Db::name($this->rt)->where($data)->find(); return $info; } function in_form($form, $name) { goto ZL2oJ; SB3ex: lzbXq: goto Lpmla; Fj4ZG: $i = 0; goto Urqf3; Lpmla: return $title; goto waBG3; Urqf3: oALan: goto LMtX4; S21H1: e9rZ0: goto YCFgT; YCFgT: BM_Q5: goto NXdvi; uJqih: $title = $form[$i]["\164\x69\x74\x6c\145"]; goto FYO9Q; ZL2oJ: $title = ''; goto Fj4ZG; aT_9W: if (!($form[$i]["\156\141\155\145"] == $name)) { goto e9rZ0; } goto uJqih; FYO9Q: goto lzbXq; goto S21H1; NXdvi: $i++; goto teVKS; teVKS: goto oALan; goto SB3ex; LMtX4: if (!($i < count($form))) { goto lzbXq; } goto aT_9W; waBG3: } public function UserBook($data, $page) { goto S7Rws; LIbX8: if (!empty($list)) { goto yL_Ev; } goto VfRbQ; YC4Xd: nx26E: goto ZXist; aT3Fq: yL_Ev: goto q7YMz; VfRbQ: return $list; goto aT3Fq; ZXist: return $list; goto oAIRP; q7YMz: foreach ($list as $k => $v) { goto waNF7; uE73v: FGpX7: goto h2Tm2; h2Tm2: $list[$k]["\160\141\162\x61\x6d"] = str_replace("\x5c\156", "\74\142\162\76", $list[$k]["\160\141\x72\141\155"]); goto RZEBU; RZEBU: $list[$k]["\x70\141\162\x61\155"] = json_decode($list[$k]["\x70\141\162\x61\155"], true); goto eW8IV; vepl4: kR1xe: goto MmzZS; chFOF: ufrj2: goto vepl4; Jaq3z: $list[$k]["\156\141\x6d\145"] = $u["\156\x61\x6d\145"]; goto Kmpbh; EmM5q: $u = Db::name("\171\x62\x73\x63\137\162\145\x73\x65\x72\166\x65\x5f\164\150\151\156\147")->where("\x69\x64", $list[$k]["\x74\x68\151\x6e\147\137\151\x64"])->find(); goto aOElR; eW8IV: foreach ($list[$k]["\160\x61\162\141\155"] as $k1 => $v1) { goto daDi1; j7iND: fXvUw: goto G7IDA; b7yzy: $list[$k]["\x70\x61\x72\141\155"][$k1]["\153\145\x79"] = $string_arr[1]; goto j7iND; daDi1: $string_arr = explode("\x2d", $list[$k]["\160\141\x72\x61\x6d"][$k1]["\x6e\141\x6d\x65"]); goto b7yzy; G7IDA: } goto chFOF; Kmpbh: $list[$k]["\x69\155\147"] = $u["\151\x6d\x67"]; goto uE73v; waNF7: $list[$k]["\143\162\x65\141\x74\145\137\x74\151\155\x65"] = date("\x59\x2d\155\x2d\x64\x20\x48\72\x69\x3a\x73", $list[$k]["\143\x72\x65\141\x74\145\137\164\x69\x6d\145"]); goto EmM5q; aOElR: if (!$u) { goto FGpX7; } goto Jaq3z; MmzZS: } goto YC4Xd; S7Rws: $list = Db::name("\171\x62\163\x63\137\x72\145\163\145\x72\166\145\137\160\157\x69\x6e\x74")->where($data)->page($page, PAGE_NUM)->order("\151\144", "\144\145\x73\x63")->select(); goto LIbX8; oAIRP: } public function submit_form($data) { goto gG2Ym; otAkx: $a = Db::name("\x79\142\163\143\137\x72\x65\x73\x65\x72\166\x65\x5f\160\x6f\151\156\x74")->where($where)->count(); goto RJalv; c1oaC: if (!(count($param) == 0)) { goto XDjhy; } goto yqY7C; uLx7I: $form_id = Db::name("\171\142\x73\143\x5f\162\x65\x73\x65\x72\166\145\x5f\160\x6f\151\156\x74")->insertGetId($where); goto TvhTP; DYyF_: return -1; goto rTN1W; ih0Lf: $arr = array(); goto P2QXc; s0BZV: XDjhy: goto ih0Lf; RJalv: if (!($a > 0)) { goto ZkBLR; } goto DYyF_; gG2Ym: $time = time(); goto Yo2N9; Yo2N9: $form = json_decode($data["\146\x6f\162\x6d"], true); goto a4gXH; aAe8a: $where["\143\162\145\141\x74\x65\137\x74\x69\155\x65"] = $time; goto uLx7I; TvhTP: return $form_id; goto jYxH1; Pn8ib: YLxWV: goto MwEzn; rTN1W: ZkBLR: goto aAe8a; MwEzn: $where = ["\164\x68\x69\156\147\x5f\151\144" => $data["\x74\150\x69\156\147\137\x69\x64"], "\x75\x73\145\162\137\151\x64" => $data["\165\163\x65\x72\137\151\144"], "\155\143\x68\137\151\x64" => $data["\x6d\143\150\x5f\151\x64"], "\x70\141\x72\x61\x6d" => json_encode($arr)]; goto otAkx; P2QXc: $n = 0; goto t50fe; a4gXH: $param = json_decode($data["\x70\x61\162\141\x6d"], true); goto c1oaC; t50fe: foreach ($param as $k => $v) { goto xVtoG; xVtoG: $arr[$n]["\x6e\141\x6d\x65"] = $k; goto JxS9X; ZsImZ: $n++; goto B_GmV; b7pUW: $arr[$n]["\164\151\164\x6c\145"] = $this->in_form($form, $k); goto ZsImZ; B_GmV: E5szQ: goto KgIko; JxS9X: $arr[$n]["\166\x61\154\165\x65"] = $v; goto b7pUW; KgIko: } goto Pn8ib; yqY7C: return null; goto s0BZV; jYxH1: } public function getCoupon($data) { goto mLGfc; Bl_VZ: UK7X3: goto DI6nB; kjjhM: Mqix0: goto GdgE2; RLs1h: RPrW_: goto p_hDm; YfePW: goto UK7X3; goto h0psF; sXqh8: if ($count > 0) { goto RPrW_; } goto FzeVR; p_hDm: return "\x65\170\x69\x73\x74"; goto kjjhM; FzeVR: $as = Db::name($this->bc)->where("\151\144", $data["\143\157\165\160\x6f\156\x5f\151\144"])->find(); goto bLUd4; XT7cg: return "\x65\x6d\x70\164\x79"; goto YfePW; DI6nB: goto Mqix0; goto RLs1h; oDEd9: return $info; goto Bl_VZ; bLUd4: if ($as["\x72\x65\155\137\143\x6f\165\156\164"] > 0) { goto Zd1B0; } goto XT7cg; mLGfc: $count = Db::name($this->uc)->where("\x63\157\165\160\157\156\x5f\x69\x64", $data["\143\x6f\165\x70\157\156\x5f\151\144"])->where("\x75\163\x65\162\x5f\x69\x64", $data["\x75\x73\x65\x72\137\x69\x64"])->count(); goto sXqh8; KqigN: $info = Db::name($this->uc)->insert($data); goto oDEd9; Q32qo: Db::name($this->bc)->where("\151\144", $data["\x63\x6f\x75\x70\x6f\x6e\137\x69\144"])->setDec("\x72\x65\155\x5f\143\157\x75\x6e\x74", 1); goto KqigN; h0psF: Zd1B0: goto Q32qo; GdgE2: } public function UserCoupon($data, $page) { goto aopWk; rQ9Ot: return $info; goto lpWWZ; liZGc: b0l_z: goto rQ9Ot; ssg25: foreach ($info as $act_k => $act_v) { goto iJBvA; E9GBY: yihF1: goto boWEq; xoyDT: if (!$a) { goto yihF1; } goto cKnZJ; cKnZJ: $info[$act_k]["\x73\x61\x74\x69\163\x66\x79\x5f\x6d\x6f\x6e\145\x79"] = intval($a["\x73\141\164\x69\x73\146\171\x5f\x6d\157\x6e\145\x79"]); goto rJRro; ihLvq: $info[$act_k]["\x65\156\144\164\151\155\145"] = date("\x59\55\x6d\55\144", $a["\x65\x6e\144\137\x74\x69\155\145"]); goto XlhFJ; rJRro: $info[$act_k]["\144\151\163\143\157\165\x6e\164\137\155\157\156\x65\171"] = intval($a["\144\x69\163\x63\157\x75\x6e\x74\137\x6d\x6f\x6e\145\171"]); goto nCgQo; R_EtB: KQ4vo: goto rN6kD; boWEq: $info[$act_k]["\x67\145\x74\x5f\x74\151\x6d\145"] = date("\131\55\x6d\x2d\x64\x20\110\x3a\x69\72\163", $act_v["\147\145\164\x5f\164\x69\x6d\145"]); goto R_EtB; iJBvA: $a = Db::name($this->bc)->where("\151\x64", $act_v["\x63\x6f\165\x70\157\x6e\x5f\151\x64"])->find(); goto xoyDT; XlhFJ: $info[$act_k]["\145\156\144\x5f\x74\x69\x6d\145"] = $a["\145\156\x64\137\164\151\155\145"]; goto E9GBY; nCgQo: $info[$act_k]["\164\x6f\x67\145\x74\x68\145\x72"] = $a["\164\x6f\147\x65\164\150\145\x72"]; goto ihLvq; rN6kD: } goto liZGc; aopWk: $info = Db::name($this->uc)->where($data)->where("\151\x73\137\x64\x65\x6c", 0)->page($page, PAGE_NUM)->order("\151\144", "\x64\145\163\x63")->order("\x73\164\141\164\x75\163", "\144\145\163\143")->select(); goto ssg25; lpWWZ: } public function getFormid($data) { goto tvvBh; xPOqB: $info = $formid->save($data); goto nGYux; tvvBh: $formid = new UserFormid(); goto xPOqB; nGYux: return $info; goto Bsd_S; Bsd_S: } }
