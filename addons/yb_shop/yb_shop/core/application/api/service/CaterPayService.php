<?php
 namespace app\api\service; use app\common\model\ResOrderPayment; use app\common\model\Config; use app\common\model\ResOrder; use app\common\model\Area; use think\Db; require EXTEND_PATH . "\x57\x78\x70\141\x79\57\127\170\x50\x61\x79\x2e\101\x70\151\56\160\x68\160"; class CaterPayService { public function orderInfo($data) { goto KV1lx; nb1jL: $info = $order->getInfo($data); goto eQ1a9; eQ1a9: return $info; goto Fqnht; KV1lx: $order = new ResOrder(); goto nb1jL; Fqnht: } public function orderPay($data) { goto z8nPk; tjX09: $rs["\143\x6f\x64\145"] = 1; goto jn02W; BhDTE: $input->SetDetail($info->pay_detail); goto RAjkJ; Y2uMf: $input->SetOpenid($data["\157\x70\x65\156\x69\x64"]); goto BhDTE; hHEpS: $payment = new ResOrderPayment(); goto vW2Av; bPzoC: $rs["\155\x73\147"] = "\xe8\xae\242\xe5\215\x95\xe4\xb8\xbb\351\242\x98\345\267\xb2\xe6\224\xb9\345\x8f\230"; goto Lrk6o; jn02W: $rs["\155\163\147"] = "\350\256\242\xe5\215\225\344\270\215\xe5\xad\x98\xe5\x9c\250"; goto WDp27; IaBZM: if (!($unifiedorder["\x72\x65\164\165\x72\156\x5f\x63\157\144\145"] == "\106\101\x49\x4c")) { goto Og2h_; } goto mNZDn; BgTMm: $res = $this->weixinapp($unifiedorder); goto SeU06; J37GF: AfR3q: goto OfcRc; JwIFN: return $rs; goto VoD0A; VoD0A: Og2h_: goto PFjtL; M5h1X: $input->SetTrade_type("\x4a\123\x41\120\111"); goto pxf_b; pxf_b: $unifiedorder = \WxPayApi::unifiedOrder($input); goto IaBZM; Lrk6o: return $rs; goto tv968; TEBDb: $input->SetOut_trade_no($data["\x6f\165\x74\x5f\x74\162\141\144\145\137\156\157"]); goto M5h1X; tW4fX: $rs["\143\157\x64\x65"] = 1; goto Jdpyj; tv968: rQevI: goto iXW7b; PFjtL: if (!($unifiedorder["\x72\145\163\x75\x6c\x74\x5f\143\157\x64\x65"] == "\x46\x41\x49\114")) { goto g7pnT; } goto tW4fX; WDp27: return $rs; goto J37GF; RAjkJ: $input->SetTotal_fee($info->pay_money * 100); goto TEBDb; z8nPk: $rs = array("\143\157\144\x65" => 0, "\151\156\x66\157" => array()); goto hHEpS; OfcRc: if (!($info->pay_status != 0)) { goto rQevI; } goto Owc7J; hxZNX: $input = new \WxPayUnifiedOrder(); goto qCQ6y; Lsc24: if (!empty($info)) { goto AfR3q; } goto tjX09; ovWDE: return $rs; goto VOcvi; qCQ6y: $input->SetBody($info->pay_body); goto Y2uMf; Jdpyj: $rs["\155\x73\147"] = $unifiedorder["\x65\162\162\137\x63\157\x64\x65\x5f\144\x65\x73"]; goto Wkfas; Q0EOo: $rs["\x6d\163\x67"] = $unifiedorder["\x72\145\164\x75\162\x6e\137\x6d\x73\x67"]; goto JwIFN; SeU06: $rs["\151\x6e\x66\157"] = $res; goto ovWDE; Wkfas: return $rs; goto kh6Qn; kh6Qn: g7pnT: goto BgTMm; mNZDn: $rs["\x63\x6f\144\145"] = 1; goto Q0EOo; Owc7J: $rs["\x63\x6f\144\x65"] = 1; goto bPzoC; iXW7b: $GLOBALS["\x6d\143\x68\x5f\151\144"] = $data["\155\x63\150\x5f\x69\144"]; goto hxZNX; vW2Av: $info = $payment->where("\x6f\x75\164\x5f\164\162\x61\144\x65\x5f\x6e\157", $data["\157\x75\164\x5f\164\162\x61\x64\145\x5f\156\157"])->find(); goto Lsc24; VOcvi: } private function weixinapp($unifiedorder) { goto KGG0o; UwV5Y: $input = new \WxPayJsApiPay(); goto FaeQo; GccLC: $input->SetNonceStr($this->createNoncestr()); goto divkS; HVIpm: $input->SetTimeStamp('' . time() . ''); goto GccLC; KGG0o: $con = new Config(); goto GWOZO; divkS: $input->SetPackage("\160\162\145\x70\x61\171\x5f\151\x64\75" . $unifiedorder["\160\x72\145\160\x61\171\137\x69\x64"]); goto YmJAe; FaeQo: $input->SetAppid($param["\x41\120\x50\x5f\x49\x44"]); goto HVIpm; YmJAe: $input->SetSignType("\x4d\104\65"); goto tXrJ8; tXrJ8: $input->SetSign(); goto VzqNx; VzqNx: return $input; goto yTmrl; GWOZO: $param = $con->where("\x6b\x65\171", "\127\x58\x50\101\x59")->where("\x6d\x63\150\137\x69\x64", $GLOBALS["\155\x63\x68\x5f\x69\x64"])->where("\x69\x73\137\165\x73\145", 1)->value("\166\141\154\165\145"); goto R0pS1; R0pS1: $param = json_decode($param, true); goto UwV5Y; yTmrl: } private function createNoncestr($length = 32) { goto XJvYT; Pv4Bw: if (!($i < $length)) { goto tCRFF; } goto Mjn4o; JhUB9: return $str; goto bARzA; tmP0l: vut1P: goto Pv4Bw; BZnxR: TWFpp: goto DhHqM; Mjn4o: $str .= substr($chars, mt_rand(0, strlen($chars) - 1), 1); goto BZnxR; EO06w: $i = 0; goto tmP0l; a6hSS: tCRFF: goto JhUB9; DhHqM: $i++; goto Z0EIX; XJvYT: $chars = "\x61\x62\x63\x64\x65\146\x67\x68\151\152\153\154\x6d\156\157\160\x71\162\163\x74\x75\166\x77\x78\x79\x7a\60\x31\62\x33\64\x35\66\x37\x38\71"; goto y0ySg; Z0EIX: goto vut1P; goto a6hSS; y0ySg: $str = ''; goto EO06w; bARzA: } public function payCallback($out_trade_no, $pay_type) { goto kAGXW; b7irc: try { goto l9Hrw; UKr7P: $order->allowField(true)->save($data, ["\157\165\x74\x5f\x74\x72\x61\x64\145\x5f\x6e\157" => $out_trade_no]); goto C8BLY; C8BLY: $payment = new ResOrderPayment(); goto AmB2Q; UNaX3: Db::commit(); goto LLri_; l9Hrw: $order = new ResOrder(); goto UKr7P; AmB2Q: $payment->allowField(true)->save($data, ["\157\x75\164\137\164\x72\x61\x64\x65\137\156\157" => $out_trade_no]); goto UNaX3; LLri_: } catch (\Exception $e) { Db::rollback(); return null; } goto uyqe0; xk3uY: Db::startTrans(); goto b7irc; kAGXW: $data = array("\157\162\x64\x65\162\137\x73\x74\141\x74\165\x73" => 2, "\x70\141\171\137\x73\x74\141\x74\x75\x73" => 2, "\x70\x61\x79\137\164\x79\x70\x65" => $pay_type, "\x70\141\x79\137\164\151\x6d\x65" => time()); goto xk3uY; uyqe0: return "\x73\165\x63\143\x65\x73\x73"; goto OvTd_; OvTd_: } }
