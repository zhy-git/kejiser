(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["yb_shop-pages-poster-index"],{8238:function(e,t,n){"use strict";var o=n("c24c"),a=n.n(o);a.a},b0b4:function(e,t,n){"use strict";n.r(t);var o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-uni-view",[n("v-uni-canvas",{staticStyle:{width:"750px",height:"1030px",position:"absolute",left:"-800px"},attrs:{"canvas-id":"poster"}}),n("v-uni-image",{staticStyle:{width:"100%",height:"80vh"},attrs:{src:e.src,mode:"widthFix"}}),n("v-uni-button",{attrs:{bindtap:"dosave"}},[e._v("保存图片")])],1)},a=[],i=n("ca7b");function s(e,t){return c(e)||r(e,t)||l()}function l(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function r(e,t){var n=[],o=!0,a=!1,i=void 0;try{for(var s,l=e[Symbol.iterator]();!(o=(s=l.next()).done);o=!0)if(n.push(s.value),t&&n.length===t)break}catch(r){a=!0,i=r}finally{try{o||null==l["return"]||l["return"]()}finally{if(a)throw i}}return n}function c(e){if(Array.isArray(e))return e}var u=getApp(),d=getApp().wechat,h=getApp().core,p={extends:i["a"],data:function(){return{src:"",paths:{goods:"yb_shop/pages/goods/detail/index",kanjia:"yb_shop/pages/kanjia/goods_info/index",pintuan:"yb_shop/pages/pintuan/pages/goods/detail"}}},methods:{dosave:function(){this.src.length>0?(wx.showLoading({title:"保存中..."}),d.saveImageToPhotosAlbum(this.src).then(function(e){wx.hideLoading(),h.alert("海报保存成功")}).catch(function(e){wx.hideLoading(),h.alert("海报保存失败,请重试")})):h.alert("海报正在生成,请稍候")},textByteLength:function(e,t){for(var n=0,o=1,a=0,i=[],s=0;s<e.length;s++)e.charCodeAt(s)>255?(n+=2,n>o*t&&(n++,i.push(e.slice(a,s)),a=s,o++)):(n++,n>o*t&&(i.push(e.slice(a,s)),a=s,o++));return i.push(e.slice(a,e.length)),[n,i,o]},onReady:function(){},onShow:function(){},onHide:function(){},onUnload:function(){},onPullDownRefresh:function(){},onReachBottom:function(){},onShareAppMessage:function(){}},onLoad:function(e){console.log(e);var t=this.paths[e.share_type],n=e.id,o=u.util.makeurl({url:"entry/wxapp/net_img",data:{url:encodeURIComponent(e.img)}});e.img=o,console.log(o),h.loading("海报生成中"),console.log(uni);var a=uni.createCanvasContext("poster");a.clearRect(0,0,0,0),a.setFillStyle("#ffffff"),a.fillRect(0,0,750,1030);var i=34,l=this.textByteLength(e.title,i),r=s(l,3),c=(r[0],r[1]);r[2];a.setTextAlign("left"),a.setFontSize(28),a.setFillStyle("#333333");for(var p=35,f=0;f<c.length;f++)a.fillText(c[f],12,805+p*f);var g="原价￥"+e.original_price;a.setFontSize(22),a.setFillStyle("#818181"),a.fillText(g,12,920);var v=a.measureText(g);a.setFontSize(22),a.setFillStyle("#333333"),a.fillText("优惠价￥",12,990),a.setFontSize(48),a.setFillStyle("#d92d20"),a.fillText(e.price,100,993),a.setStrokeStyle("#818181"),a.beginPath(),a.setLineWidth(1),a.moveTo(12,911),a.lineTo(v.width+12,911),a.stroke();var m=u.util.makeurl({url:"entry/wxapp/qr_code",data:{path:t,scene:n,pid:u.getCache("userinfo").uid}});console.log(m);var w=u.util.md5("share_type="+e.share_type+"&id="+e.id),x=u.getCache(w);console.log(x);var y=this;""!=x?(console.log("has save !!!!!!!"),a.drawImage(x,490,765,236,236),d.downloadFile(e.img).then(function(e){console.log(e),a.drawImage(e.tempFilePath,0,0,750,750),a.draw(!1,function(){wx.canvasToTempFilePath({destWidth:750,destHeight:1030,canvasId:"poster",success:function(e){h.hideLoading(),console.log(e.tempFilePath),y.setData({src:e.tempFilePath})}})})}).catch(function(e){h.alert("商品图片无法下载,海报生成失败")})):(console.log("not save !!!!!!!"),d.downloadFile(e.img).then(function(e){return console.log(e),a.drawImage(e.tempFilePath,0,0,750,750),d.downloadFile(m)}).then(function(e){return console.log(e),d.saveFile(e.tempFilePath)}).then(function(e){console.log(e);var t=e.savedFilePath;u.setCache(w,t),a.drawImage(t,490,765,236,236),a.draw(!1,function(){wx.canvasToTempFilePath({destWidth:750,destHeight:1030,canvasId:"poster",success:function(e){console.log(e),h.hideLoading(),y.setData({src:e.tempFilePath})}})})}).catch(function(e){h.alert("商品图片无法下载,海报生成失败")}))}},f=p,g=(n("8238"),n("2877")),v=Object(g["a"])(f,o,a,!1,null,"6e792535",null);v.options.__file="index.vue";t["default"]=v.exports},c24c:function(e,t,n){var o=n("c5af");"string"===typeof o&&(o=[[e.i,o,""]]),o.locals&&(e.exports=o.locals);var a=n("4f06").default;a("cbf25752",o,!0,{sourceMap:!1,shadowMode:!1})},c5af:function(e,t,n){t=e.exports=n("2350")(!1),t.push([e.i,"\nuni-button[data-v-6e792535]{border:none;background:#ee5352;color:#fff;position:absolute;width:80%;bottom:%?40?%;left:10%\n}",""])},ca7b:function(e,t,n){"use strict";var o,a,i=n("e143"),s={computed:{Vue:function(){return i["default"]}},methods:{setData:function(e){if(e)try{for(var t in e)this[t]=e[t]}catch(n){console.log(n)}},menu_url:function(e){getApp().core.menu_url(e,2)},formSubmit:function(e){var t={currentTarget:{dataset:{}}},n=e.detail.value;t.currentTarget.dataset=n,getApp().core.menu_url(t,1)},isLogin:function(){return!!getApp().getCache("userinfo").uid||(getApp().core.alert("请先登录",function(){wx.redirectTo({url:"/yb_shop/pages/wap/login"})}),!1)}}},l=s,r=n("2877"),c=Object(r["a"])(l,o,a,!1,null,null,null);c.options.__file="Base.vue";t["a"]=c.exports}}]);