<?php
 goto EBBol; EBBol: define("\122\x4f\117\124\x5f\x50\101\124\110", IA_ROOT . "\57\141\x64\x64\x6f\x6e\163\x2f\163\165\144\x75\70\137\x70\x61\147\x65\57"); goto LJ8c0; LJ8c0: header("\103\157\156\x74\145\156\x74\x2d\x74\171\x70\x65\x3a\x74\x65\x78\164\x2f\150\x74\155\154\73\40\103\150\x61\x72\163\x65\x74\75\165\164\x66\55\70"); goto zFT0x; zFT0x: class WxpayService { protected $mchid; protected $appid; protected $appKey; protected $apiKey; protected $uniacid; public $data = null; public function __construct($mchid, $appid, $appKey, $key) { goto X0eSt; dG13d: $this->appid = $appid; goto H2vUr; H2vUr: $this->appKey = $appKey; goto CFrkj; CFrkj: $this->apiKey = $key; goto IC4zx; X0eSt: $this->mchid = $mchid; goto dG13d; IC4zx: } private function ToUrlParams($urlObj) { goto Rjjx1; wu9l4: $buff = trim($buff, "\46"); goto tR3X_; m2s16: bJCo9: goto wu9l4; tR3X_: return $buff; goto Qck90; dSYgB: foreach ($urlObj as $k => $v) { goto Q9FyE; r1hLX: O42ay: goto SeTAK; d9Ugt: $buff .= $k . "\x3d" . $v . "\46"; goto yFkgx; Q9FyE: if (!($k != "\x73\151\x67\156")) { goto KSraq; } goto d9Ugt; yFkgx: KSraq: goto r1hLX; SeTAK: } goto m2s16; Rjjx1: $buff = ''; goto dSYgB; Qck90: } public function createJsBizPackage($openid, $totalFee, $outTradeNo, $trueName, $uniacid) { goto EbEzu; hnFSs: $responseXml = $this->curlPost("\150\164\164\x70\163\x3a\x2f\x2f\x61\160\x69\56\x6d\x63\150\56\x77\145\x69\x78\151\x6e\56\x71\x71\x2e\x63\x6f\x6d\57\155\155\160\141\x79\x6d\x6b\164\164\x72\141\x6e\x73\x66\x65\x72\x73\57\160\x72\157\155\157\164\151\157\156\x2f\164\x72\x61\156\x73\146\x65\162\x73", self::arrayToXml($unified), $uniacid); goto ESP0u; VF13z: die("\346\x82\xa8\xe7\x9a\x84\344\273\x98\xe6\254\276\345\270\220\xe5\217\xb7\xe4\xbd\x99\351\xa2\x9d\344\270\215\xe8\xb6\xb3\xe6\x88\x96\350\xb5\x84\351\207\221\346\x9c\252\xe5\210\260\xe8\xb4\246"); goto CWJCT; YJ9oo: goto NJJdp; goto OdpOt; puQ6I: if ($unifiedOrder->err_code == "\116\117\x54\105\116\x4f\125\107\110") { goto OvXaI; } goto prux6; IzpSZ: if (!($unifiedOrder === false)) { goto WFvgA; } goto tain1; oAFgx: die("\xe5\x8f\x82\xe6\225\xb0\xe9\x94\x99\350\257\xaf"); goto GC14h; t7FHT: if (!($unifiedOrder->result_code != "\x53\125\103\x43\105\x53\x53")) { goto P5v8e; } goto puQ6I; O1jxJ: goto uEKrh; goto qvlTH; H9FJC: goto aFfr_; goto CR_kX; xcldp: $config = array("\155\x63\x68\x5f\151\144" => $this->mchid, "\141\x70\160\151\144" => $this->appid, "\x6b\x65\171" => $this->apiKey); goto xJcBd; DQ7V4: if (!($unifiedOrder->return_code != "\x53\x55\103\x43\105\123\x53")) { goto wx2zy; } goto RfxW7; i0hXC: NJJdp: goto yDxSy; w06hc: die("\xe9\207\x91\351\242\235\xe8\266\205\351\x99\x90"); goto i0hXC; xWhzb: wx2zy: goto t7FHT; RfxW7: die($unifiedOrder->return_msg); goto xWhzb; W9f0C: die($unifiedOrder->err_code); goto O1jxJ; yDxSy: goto lnPc_; goto Up3NL; EbEzu: $ip = $_SERVER["\x53\105\x52\x56\105\x52\x5f\101\104\104\122"]; goto xcldp; eDfy0: WFvgA: goto DQ7V4; CR_kX: OvXaI: goto VF13z; ZCxtd: lnPc_: goto H9FJC; qvlTH: lNQ75: goto oAFgx; dDgMX: return true; goto ibT6S; TLR9r: if ($unifiedOrder->err_code == "\x41\115\x4f\x55\x4e\x54\x5f\114\x49\115\x49\x54") { goto MI5PF; } goto ElIiN; rkr8e: die("\xe6\xb2\241\xe6\234\211\350\257\xa5\346\x8e\xa5\345\217\243\346\x9d\x83\xe9\231\x90"); goto ZCxtd; Up3NL: qd3a3: goto rkr8e; tain1: die("\350\257\267\346\243\200\346\x9f\245\xe7\xb3\xbb\347\xbb\x9f\55\x3e\345\260\217\347\250\213\345\272\x8f\350\xae\xbe\xe7\xbd\xae\x2d\76\xe6\x94\xaf\344\273\230\350\256\xbe\xe7\xbd\xae\55\x3e\344\xbc\x81\xe4\270\232\xe4\xbb\x98\xe6\254\276\xe8\256\xbe\xe7\275\256"); goto eDfy0; xJcBd: $unified = array("\x6d\x63\x68\x5f\x61\160\x70\151\x64" => $config["\x61\x70\160\x69\144"], "\155\143\150\x69\x64" => $config["\155\x63\x68\x5f\x69\x64"], "\x6e\x6f\156\143\x65\x5f\163\x74\x72" => self::createNonceStr(), "\157\x70\x65\x6e\x69\144" => $openid, "\x63\150\145\143\x6b\x5f\156\141\155\x65" => "\x4e\117\x5f\x43\x48\x45\103\113", "\x72\145\137\x75\x73\145\162\137\156\x61\155\145" => $trueName, "\160\141\162\164\x6e\x65\162\x5f\164\x72\141\144\x65\137\156\157" => $outTradeNo, "\163\160\142\151\154\x6c\x5f\143\x72\145\x61\164\145\137\151\160" => $ip, "\x61\155\x6f\x75\156\164" => intval($totalFee * 100), "\x64\x65\163\143" => "\344\xbb\230\346\xac\276"); goto GMeAU; OdpOt: MI5PF: goto w06hc; prux6: if ($unifiedOrder->err_code == "\x4e\117\x5f\x41\125\x54\x48") { goto qd3a3; } goto TLR9r; LNKYA: P5v8e: goto dDgMX; CWJCT: aFfr_: goto LNKYA; ESP0u: $unifiedOrder = simplexml_load_string($responseXml, "\x53\151\155\160\x6c\x65\130\x4d\x4c\105\x6c\x65\x6d\145\156\x74", LIBXML_NOCDATA); goto IzpSZ; GMeAU: $unified["\x73\x69\x67\x6e"] = self::getSign($unified, $config["\153\145\171"]); goto hnFSs; GC14h: uEKrh: goto YJ9oo; ElIiN: if ($unifiedOrder->err_code == "\x50\x41\122\101\115\137\x45\122\x52\117\x52") { goto lNQ75; } goto W9f0C; ibT6S: } public static function curlGet($url = '', $options = array()) { goto o16gU; o16gU: $ch = curl_init($url); goto SKMpC; OPOw2: $data = curl_exec($ch); goto YiXSj; VSj_i: curl_setopt_array($ch, $options); goto kAqXc; YiXSj: curl_close($ch); goto LYWXY; SKMpC: curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1); goto RVyYZ; kAqXc: bvc7g: goto BPZ24; BPZ24: curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false); goto x2gsT; RVyYZ: curl_setopt($ch, CURLOPT_TIMEOUT, 30); goto XoUHq; LYWXY: return $data; goto gJKn4; XoUHq: if (empty($options)) { goto bvc7g; } goto VSj_i; x2gsT: curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, false); goto OPOw2; gJKn4: } public function curlPost($url = '', $postData = '', $uniacid, $options = array()) { goto Be2Rq; lsanK: curl_setopt($ch, CURLOPT_TIMEOUT, 30); goto ImtrT; Qf7EJ: qAGg2: goto lAAiU; LpOK7: curl_setopt($ch, CURLOPT_SSLKEYTYPE, "\x50\x45\115"); goto JBS53; Be2Rq: if (!is_array($postData)) { goto qAGg2; } goto sn0s1; I77zq: curl_setopt($ch, CURLOPT_SSLCERT, ROOT_PATH . "\x43\145\x72\164\x2f" . $uniacid . "\x2f\141\160\151\x63\x6c\151\145\156\164\x5f\143\145\162\164\56\160\145\155"); goto LpOK7; N54Jq: curl_setopt($ch, CURLOPT_POST, 1); goto bR_el; HYiCv: curl_setopt_array($ch, $options); goto onnUw; HWU49: curl_close($ch); goto JWE9o; ImtrT: if (empty($options)) { goto rgEza; } goto HYiCv; lAAiU: $ch = curl_init(); goto N_6aU; bR_el: curl_setopt($ch, CURLOPT_POSTFIELDS, $postData); goto lsanK; JWE9o: return $data; goto yCQc9; ozM4t: curl_setopt($ch, CURLOPT_SSLCERTTYPE, "\120\105\115"); goto I77zq; N_6aU: curl_setopt($ch, CURLOPT_URL, $url); goto BZYLY; ftu1W: curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, false); goto ozM4t; BZYLY: curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1); goto N54Jq; JBS53: curl_setopt($ch, CURLOPT_SSLKEY, ROOT_PATH . "\103\145\162\164\57" . $uniacid . "\57\x61\160\x69\143\154\x69\x65\156\x74\x5f\153\145\x79\56\x70\145\x6d"); goto X4KgX; X4KgX: $data = curl_exec($ch); goto HWU49; p3kff: curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false); goto ftu1W; onnUw: rgEza: goto p3kff; sn0s1: $postData = http_build_query($postData); goto Qf7EJ; yCQc9: } public static function createNonceStr($length = 16) { goto iz03O; ZoO2Z: if (!($i < $length)) { goto X6U4Z; } goto BRpiD; Phs1w: X6U4Z: goto X1one; wohGr: $i++; goto DMtkf; f0FkQ: $str = ''; goto ehFfJ; X1one: return $str; goto stM0i; BRpiD: $str .= substr($chars, mt_rand(0, strlen($chars) - 1), 1); goto tZIPk; ehFfJ: $i = 0; goto akCX5; DMtkf: goto c8h9O; goto Phs1w; tZIPk: Xxz3T: goto wohGr; iz03O: $chars = "\141\142\143\x64\145\146\147\150\x69\152\x6b\154\x6d\156\x6f\x70\161\x72\163\x74\x75\x76\x77\x78\171\172\101\102\103\104\105\106\x47\110\x49\x4a\x4b\x4c\x4d\x4e\x4f\120\x51\122\123\124\x55\126\127\x58\x59\132\x30\x31\x32\63\x34\65\x36\x37\70\71"; goto f0FkQ; akCX5: c8h9O: goto ZoO2Z; stM0i: } public static function arrayToXml($arr) { goto axq26; sNdTb: foreach ($arr as $key => $val) { goto oxkGB; mvq77: goto hZ_cB; goto wSe9Y; u3ht5: hZ_cB: goto OwGqh; X1U3S: $xml .= "\74" . $key . "\76" . $val . "\74\x2f" . $key . "\76"; goto u3ht5; M9IdT: $xml .= "\74" . $key . "\x3e\x3c\x21\133\103\x44\x41\124\101\x5b" . $val . "\135\135\76\74\x2f" . $key . "\x3e"; goto mvq77; OwGqh: JaIWD: goto sf09r; oxkGB: if (is_numeric($val)) { goto OZkqp; } goto M9IdT; wSe9Y: OZkqp: goto X1U3S; sf09r: } goto W1xOE; W1xOE: vwrKq: goto PnUBJ; axq26: $xml = "\x3c\x78\x6d\x6c\x3e"; goto sNdTb; DHLe9: return $xml; goto JFQ0J; PnUBJ: $xml .= "\x3c\57\170\155\x6c\76"; goto DHLe9; JFQ0J: } public static function getSign($params, $key) { goto RDjxP; dEP2e: $unSignParaString = self::formatQueryParaMap($params, false); goto OYRcd; Jlenk: return $signStr; goto eBVrm; OYRcd: $signStr = strtoupper(md5($unSignParaString . "\x26\x6b\145\x79\x3d" . $key)); goto Jlenk; RDjxP: ksort($params, SORT_STRING); goto dEP2e; eBVrm: } protected static function formatQueryParaMap($paraMap, $urlEncode = false) { goto L3qvu; Xif5X: $reqPar = substr($buff, 0, strlen($buff) - 1); goto MFB9V; IKzKr: foreach ($paraMap as $k => $v) { goto TbEHT; TbEHT: if (!(null != $v && "\x6e\x75\154\154" != $v)) { goto WyxER; } goto svStr; WTyH2: WyxER: goto dfQnj; rJIrM: $v = urlencode($v); goto D34om; svStr: if (!$urlEncode) { goto cD80H; } goto rJIrM; XC36b: $buff .= $k . "\x3d" . $v . "\46"; goto WTyH2; D34om: cD80H: goto XC36b; dfQnj: UJY8w: goto yPOqs; yPOqs: } goto jmaeN; L3qvu: $buff = ''; goto Lhwzl; MFB9V: qj8BG: goto ojQ2R; jmaeN: vU0aG: goto LAPlP; ojQ2R: return $reqPar; goto e288A; Nsyw1: if (!(strlen($buff) > 0)) { goto qj8BG; } goto Xif5X; Lhwzl: ksort($paraMap); goto IKzKr; LAPlP: $reqPar = ''; goto Nsyw1; e288A: } }