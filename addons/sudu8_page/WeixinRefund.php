<?php
 include "\x57\x65\151\x78\x69\156\120\141\x79\x2e\160\150\x70"; class WeixinRefund extends WeixinPay { protected $sslcert_path; protected $sslkey_path; protected $appid; protected $mch_id; protected $out_trade_no; protected $out_refund_no; protected $total_fee; protected $refund_fee; protected $key; protected $uniacid; protected $types; protected $formid; function __construct($appid, $key, $mch_id, $out_trade_no, $out_refund_no, $total_fee, $refund_fee, $path, $types, $formid = '') { goto hcfIt; hcfIt: $this->appid = $appid; goto oTolp; BozY4: if (!$path) { goto EjEwn; } goto WdKJf; WdKJf: $this->sslcert_path = __DIR__ . "\x2f\103\x65\x72\164\57" . $path . "\x2f\x61\160\151\143\x6c\151\x65\156\x74\x5f\x63\x65\x72\164\x2e\x70\145\x6d"; goto h0ToO; EkS2b: $this->key = $key; goto rlIi1; yJfqV: $this->out_refund_no = $out_refund_no; goto QCo0W; PPfDt: $this->refund_fee = $refund_fee; goto EkS2b; QCo0W: $this->total_fee = $total_fee; goto PPfDt; oTolp: $this->mch_id = $mch_id; goto hRtYZ; spLzh: EjEwn: goto Xn02B; GGIbR: $this->formid = $formid; goto BozY4; rlIi1: $this->uniacid = $path; goto E4vFw; h0ToO: $this->sslkey_path = __DIR__ . "\x2f\103\x65\x72\x74\57" . $path . "\x2f\141\160\151\143\154\151\145\x6e\x74\x5f\153\145\171\x2e\160\145\x6d"; goto spLzh; E4vFw: $this->types = $types; goto GGIbR; hRtYZ: $this->out_trade_no = $out_trade_no; goto yJfqV; Xn02B: } public function refund() { $result = $this->wxrefundapi(); return $result; } private function wxrefundapi() { goto ojjdG; ags6x: if (!($this->types == "\x79\x75\171\x75\145" || $this->types == "\x79\x75\171\x75\x65\x71\170")) { goto rxlOP; } goto Lo52I; Lo52I: $url = $this->getNotifyUrl("\x2f\x61\x70\x70\57\151\156\x64\145\170\56\x70\x68\x70\x3f\151\75" . $this->uniacid . "\x26\146\x72\157\155\x3d\x77\170\141\x70\160\46\143\75\145\x6e\164\x72\171\46\141\x3d\167\170\141\x70\x70\46\144\157\75\162\145\146\165\x6e\144\156\x6f\x74\151\x66\x79\46\x6d\75\163\x75\x64\x75\70\137\x70\x61\147\x65\x26\x6f\165\164\x5f\x72\x65\x66\165\156\x64\x5f\156\157\x3d" . $result["\x6f\x75\164\x5f\162\x65\146\x75\x6e\144\137\156\157"] . "\46\x74\171\x70\x65\x73\x3d" . $this->types . "\46\146\157\x72\x6d\151\x64\x3d" . $this->formid); goto NK4ws; ldeQB: gq98S: goto ags6x; QqDpX: rxlOP: goto jBwcl; DtxHb: $xmldata = $this->arrayToXml($parameters); goto jKfvn; ojjdG: $url = "\x68\164\164\160\x73\x3a\57\x2f\x61\160\x69\x2e\155\143\x68\x2e\167\x65\151\x78\x69\156\56\x71\161\56\x63\157\x6d\x2f\x73\145\x63\x61\160\151\57\x70\x61\171\x2f\x72\x65\x66\x75\x6e\144"; goto RM5xv; TwD3_: if (!($result["\162\145\164\165\162\156\137\143\x6f\x64\x65"] == "\x53\125\103\x43\x45\123\x53" && $result["\x72\145\x73\165\x6c\164\137\x63\x6f\x64\145"] == "\123\x55\x43\103\105\x53\123")) { goto rpo1w; } goto SICeX; ogFtK: $result = $this->xmlToArray($xmlresult); goto TwD3_; jKfvn: $xmlresult = $this->postXmlSSLCurl($xmldata, $url, 60); goto ogFtK; SICeX: if (!($this->types == "\x64\x75\157" || $this->types == "\144\x75\x6f\x71\170" || $this->types == "\144\x75\157\164\153" || $this->types == "\x64\141\x6e" || $this->types == "\x64\x61\x6e\161\170" || $this->types == "\x64\x61\x6e\x74\x6b")) { goto gq98S; } goto h1I4h; RM5xv: $parameters = array("\x61\160\160\x69\144" => $this->appid, "\x6d\143\150\x5f\151\x64" => $this->mch_id, "\156\x6f\x6e\143\x65\137\163\164\x72" => $this->createNoncestr(), "\x6f\165\164\x5f\162\x65\146\165\x6e\144\x5f\156\x6f" => $this->out_refund_no, "\157\x75\164\x5f\164\162\141\144\x65\137\156\157" => $this->out_trade_no, "\x72\145\x66\165\x6e\144\x5f\146\145\x65" => $this->refund_fee, "\164\157\x74\141\x6c\x5f\x66\145\145" => $this->total_fee); goto dREvw; h1I4h: $url = $this->getNotifyUrl("\x2f\141\160\160\57\151\x6e\x64\145\x78\56\160\150\160\x3f\x69\x3d" . $this->uniacid . "\x26\146\162\157\155\75\167\170\x61\x70\x70\x26\143\x3d\x65\x6e\x74\x72\171\x26\x61\x3d\x77\x78\x61\160\x70\46\x64\157\x3d\162\x65\146\x75\156\144\156\157\x74\151\146\x79\46\x6d\x3d\163\165\144\165\x38\137\160\141\x67\x65\x26\x6f\x75\164\137\162\145\x66\x75\x6e\x64\x5f\x6e\157\x3d" . $result["\x6f\x75\164\137\162\x65\x66\x75\156\x64\x5f\156\x6f"] . "\x26\x74\x79\x70\x65\x73\75" . $this->types); goto eNuLd; jBwcl: rpo1w: goto YR6WR; eNuLd: file_get_contents($url); goto ldeQB; dREvw: $parameters["\163\x69\147\156"] = $this->getSign($parameters); goto DtxHb; NK4ws: file_get_contents($url); goto QqDpX; YR6WR: return $result; goto EvBJx; EvBJx: } private function postXmlSSLCurl($xml, $url, $second = 30) { goto M33lA; rBI1O: curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, FALSE); goto nDxUd; tQXwU: curl_setopt($ch, CURLOPT_SSLKEYTYPE, "\120\x45\x4d"); goto N6MXB; LXW15: goto A73RL; goto GU7Na; nDxUd: curl_setopt($ch, CURLOPT_HEADER, FALSE); goto chzNt; lA4vN: return $data; goto zR9QD; XtNBq: $error = curl_errno($ch); goto OFlX9; N6MXB: curl_setopt($ch, CURLOPT_SSLKEY, $this->sslkey_path); goto xtzND; zR9QD: A73RL: goto lpZMQ; OFlX9: curl_close($ch); goto RwgGd; h_fS6: $data = curl_exec($ch); goto LfaGy; M33lA: $ch = curl_init(); goto zjaVV; chzNt: curl_setopt($ch, CURLOPT_RETURNTRANSFER, TRUE); goto tCvmj; SsfRg: curl_close($ch); goto lA4vN; WPhoo: curl_setopt($ch, CURLOPT_URL, $url); goto yPh6G; LfaGy: if ($data) { goto XuR3c; } goto XtNBq; GU7Na: XuR3c: goto SsfRg; yPh6G: curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, FALSE); goto rBI1O; RwgGd: return false; goto LXW15; xtzND: curl_setopt($ch, CURLOPT_POST, true); goto A8qpk; tCvmj: curl_setopt($ch, CURLOPT_SSLCERTTYPE, "\x50\105\x4d"); goto NfWsF; NfWsF: curl_setopt($ch, CURLOPT_SSLCERT, $this->sslcert_path); goto tQXwU; A8qpk: curl_setopt($ch, CURLOPT_POSTFIELDS, $xml); goto h_fS6; zjaVV: curl_setopt($ch, CURLOPT_TIMEOUT, $second); goto WPhoo; lpZMQ: } }