var clock_index=0,currentPlaying=null,room_id=user_info.room_id,avatar=user_info.headimgurl,nickname=user_info.nickname;var clock_handler=null,current_voiclocalid=null,globalObj=new Object();WEB_SOCKET_DEBUG=true;globalObj.chat_images=[];var ws,name=user_info.nickname,client_list={};function startRec(){$(".second_dd var").eq(0).text(clock_index);clock_index++;if(clock_index==58){clock_index=60;$("#btnStopRec").click()}}function reward(){$(".btn_ilike").unbind();$(".btn_ilike").click(function(){var A=$(this).parent().children(".head_portrait").children("img").attr("src");$(".live_headpic").children("img").attr("src",A.replace("46","132"));$(".redbagBox").attr("msg_id",$(this).parents(".left_bubble").attr("msg_id"));$(".redbagBox").show();var B=$(this).parent().children(".speaker_name").children("b").text();globalObj.reward={to_name:B,to_avatar:A,from_name:user_info.nickname,from_avatar:user_info.headimgurl}});$(".redbag_cancel").unbind();$(".redbag_cancel").click(function(){$(".redbagBox").hide()});$(".live_othermoney").unbind();$(".live_othermoney").click(function(){$(".otherRedmoneyBox").show()});$(".payli").unbind();$(".payli").click(function(){var A=$(this).text();var B=$(this).parents(".redbagBox").attr("msg_id");console.dir(B);globalObj.reward.money=A;var C=JSON.stringify(globalObj.reward);globalObj.reward_last={type:"say",target:"main",msgtype:"reward",headimg:avatar,to_client_id:"all",to_client_name:"all",content:C};$.getJSON(reward_url,{pay:A,msg_id:B},function(D){callpay(D)})});$(".otherRedmoneyBox .gene_confirm").unbind();$(".otherRedmoneyBox .gene_confirm").click(function(){var A=$("#money").val();if(A==""){return}var B=$(".redbagBox").attr("msg_id");globalObj.reward.money=A;var C=JSON.stringify(globalObj.reward);globalObj.reward_last={type:"say",target:"main",msgtype:"reward",headimg:avatar,to_client_id:"all",to_client_name:"all",content:C};$.getJSON(reward_url,{pay:A,msg_id:B},function(D){$(".geneBox").hide();callpay(D)})});$(".lm_main").unbind();$(".lm_main").click(function(){$(".thank_money").children("var").text($(this).attr("attr-money"));var A=$(this).attr("attr-imgurl");A=A.replace("46","132");$(".LmTipsBox").find(".live_headpic").children("img").attr("src",A);var B=$(this).attr("from-name")+"赞赏了"+$(this).attr("attr-toname");$(".LmTipsBox").find(".live_towhy").text(B);$(".LmTipsBox").show()});$(".redbag_cancel").click(function(){$(".redbag_box").hide()})}function jsApiCall(A){WeixinJSBridge.invoke("getBrandWCPayRequest",A,function(B){WeixinJSBridge.log(B.err_msg);if(B.err_msg=="get_brand_wcpay_request:ok"){if(globalObj.reward_last){sentContent(globalObj.reward_last)}}else{if(B.err_msg=="get_brand_wcpay_request:cancel"){}else{alert(B.err_msg)}}})}function callpay(A){if(typeof WeixinJSBridge=="undefined"){if(document.addEventListener){document.addEventListener("WeixinJSBridgeReady",jsApiCall,false)}else{if(document.attachEvent){document.attachEvent("WeixinJSBridgeReady",jsApiCall);document.attachEvent("onWeixinJSBridgeReady",jsApiCall)}}}else{jsApiCall(A)}}function get_contenthtml(C){var D='<dd class="left_bubble hasTime" msg_id="'+C.msg_id+'">';D+='<div class="speak_time">'+C.time+"</div>";D+='<div class="head_portrait"><img src="'+C.headimg+'"></div>';D+='<div class="speaker_name"><b>'+C.from_client_name+"</b></div>";D+='<div class="bubble_content "><p>'+C.content+"</p></div>";if(topic_setting.reward_status==1){D+='<a class="btn_ilike" href="javascript:;">赏</a>'}D+="</dd>";if(C.msgtype=="voice"){var A=getRecordClass(C.last);D='<dd class="left_bubble hasTime" msg_id="'+C.msg_id+'">';D+='<div class="speak_time">'+C.time+"</div>";D+='<div class="head_portrait"><img src="'+C.headimg+'"></div>';D+='<div class="speaker_name"><b>'+C.from_client_name+"</b></div>";D+='<div class="bubble_content recordingMsg isReaded '+A+'">';D+='<i class="audio_info" attr-src="'+C.content+'"></i><var>'+C.last+"</var></div>";if(topic_setting.reward_status==1){D+='<a class="btn_ilike" href="javascript:;">赏</a>'}D+="</dd>"}if(C.msgtype=="image"){D='<dd class="left_bubble hasTime" msg_id="'+C.msg_id+'">';D+='<div class="speak_time">'+C.time+"</div>";D+='<div class="head_portrait"><img src="'+C.headimg+'"></div>';D+='<div class="speaker_name"><b>'+C.from_client_name+"</b></div>";D+='<div class="bubble_content ">';D+='<img id="sub_'+C.msg_id+'" class="chat_img" mediaid="'+C.content+'" src="'+C.content+'"></div>';if(topic_setting.reward_status==1){D+='<a class="btn_ilike" href="javascript:;">赏</a>'}D+="</dd>"}if(C.msgtype=="ask"){var E=JSON.parse(C.content);D='<dd class="left_bubble hasTime" msg_id="'+C.msg_id+'">';D+='<div class="speak_time">'+C.time+"</div>";D+='<div class="head_portrait"><img src="'+C.headimg+'"></div>';D+='<div class="speaker_name"><b>'+C.from_client_name+"</b></div>";D+='<div class="bubble_content "><p><b>'+E.N+':</b><em class="ask_label">问</em>'+E.Q+"</p><p><b>回复:</b>"+E.replay+"</p></div>";if(topic_setting.reward_status==1){D+='<a class="btn_ilike" href="javascript:;">赏</a>'}D+="</dd>"}if(C.msgtype=="reward"){var B=JSON.parse(C.content);var D='<dt class="luckyMoney" msg_id="'+C.msg_id+'">';D+='<div class="lm_main" attr-imgurl="'+B.to_avatar+'" attr-money="'+B.money+'" attr-toname="'+B.to_name+'" from-name="'+C.from_client_name+'" from-avatar="'+C.headimg+'">';D+="<var>"+C.from_client_name+"</var> 赞赏了 <var>"+B.to_name+"</var> 一个<b>红包</b>";D+="</div>";D+="</dt>"}return D}function get_discontenthtml(A){var B='<dd class="comment_dd"  msg_id="'+A.msg_id+'">';B+='<span class="right_info">';if(user_info.is_manager){B+='<i class="btn_wall">上墙</i>'}B+='<i class="btn_like">0</i> <i class="btn_hate">0</i></span>';B+='<a class="avatar"><img src="'+A.headimg+'"></a><a class="author_name">'+A.from_client_name+"</a>";B+='<b class="time">'+A.time+"</b>";if(user_info.is_manager){B+='<i class="commentManage">管理<span class="commentManageTab" style="display:none;">';B+='<a class="delCommentMsg">删除</a><a class="shutUpSet">禁言</a></span></i>'}if(A.is_ask){A.content='<em class="ask_label">问</em>'+A.content}B+='<p class="content">'+A.content+"</p></dd>";return B}function getRecordClass(A){if(A<12){return"recordwid1"}else{if(A>=12&&A<24){return"recordwid2"}else{if(A>=24&&A<36){return"recordwid3"}else{if(A>=36&&A<48){return"recordwid4"}else{if(A>48){return"recordwid5"}else{return"recordwid1"}}}}}}function sentContent(A){var B=location.href;$.post(B,A,function(C){if(C.success==-1){alert(C.data);return}A.msg_id=C.msg_id;ws.send(JSON.stringify(A));globalObj.reward=null;globalObj.reward_last=null})}function voicePlayOver(){if(globalObj.voicePlaying){globalObj.voicePlaying.removeClass("isPlaying");globalObj.voicePlaying.addClass("isReaded ");globalObj.isPlaying=false;var A=globalObj.voicePlaying.parents("dd").attr("msg_id");$(".recordingMsg").each(function(){if($(this).parents("dd").attr("msg_id")>A){$(this).click();return false}})}}function voiceDown(){$(".recordingMsg").unbind();$(".recordingMsg").click(function(){var C=$(this).children("i");var D=$(this);$(".isPlaying").removeClass("isPlaying");var A=C.attr("attr-src");if(A&&A.indexOf("http")==0){if($("#audioPlayer").attr("src")!=A){$("#audioPlayer").attr("src",A)}var B=$("#audioPlayer")[0];if(B.paused){B.play();D.addClass("isPlaying");globalObj.isPlaying=true}else{B.pause();D.removeClass("isPlaying")}globalObj.voicePlaying=D;B.removeEventListener("ended",voicePlayOver,false);B.addEventListener("ended",voicePlayOver,false);return}})}var page_object={sub_pindex:1,sub_pages:sub_pages,com_pindex:1,com_pages:discuss_pages,loaded:[],loadeddis:[]};function ajax_content(B,A){if($.inArray(B,page_object.loaded)==-1){page_object.loaded.push(B)}else{$(".btnLoadSpeakEnd").removeClass("on");$(".btnLoadSpeak").removeClass("on");return}var C=location.href;$.getJSON(C,{pindex:B,target:"main"},function(E){page_object.sub_pages=E.total;page_object.sub_pindex=E.pindex;var D="";$.each(E.rows,function(F,G){if(G.msgtype=="image"){if($.inArray(G.content,globalObj.chat_images)==-1){globalObj.chat_images.push(G.content)}}D+=get_contenthtml(G)});if(A=="down"){$("#speakBubbles").append(D)}else{$("#speakBubbles").prepend(D)}voiceDown();$(".chat_img").unbind();$(".chat_img").click(function(){wx.previewImage({current:$(this).attr("src"),urls:globalObj.chat_images})});if(A=="down"){$(".speakContentBox").scrollTop($(".speakContentBox")[0].scrollHeight-530)}else{$(".speakContentBox").scrollTop(18)}$(".btnLoadSpeakEnd").removeClass("on");$(".btnLoadSpeak").removeClass("on");reward()})}function ajax_discuss_content(B){if($.inArray(B,page_object.loadeddis)==-1){page_object.loadeddis.push(B)}else{$(".btnLoadComment ").removeClass("on");return}var A=location.href;$.getJSON(A,{pindex:B,target:"discuss"},function(D){page_object.com_pages=D.total;page_object.com_pindex=D.pindex;if(B==1&&D.rows.length>0){$("#loadNone").hide()}var C="";$.each(D.rows,function(E,F){C+=get_discontenthtml(F)});$("#commentDl").append(C);$(".btn_wall").click(function(){var E=$(this).parents("dd").children(".author_name").text();var F=$(this).parents("dd").children(".content").text();if(F.indexOf("问")==0){F=F.replace("问","")}globalObj.Question={N:E,Q:F};$(".commentReplyBox").show()});$(".commentManage").unbind();$(".commentManage").click(function(){var E=$(this).children().css("display");if(E=="none"){$(this).children().show()}else{$(this).children().hide()}});$(".delCommentMsg").unbind();$(".delCommentMsg").click(function(){var F=confirm("确认要删除吗?");if(F){var E=$(this).parents("dd").attr("msg_id");var G=$(this).parents("dd");$.post(location.href,{msg_id:E,op:"del"},function(H){if(H.success==1){G.remove()}})}});$(".shutUpSet").unbind();$(".shutUpSet").click(function(){var F=confirm("确认要对此用户禁言吗?");if(F){var E=$(this).parents("dd").attr("msg_id");var G=$(this).parents("dd");$.post(location.href,{msg_id:E,op:"shutup"},function(H){if(H.success==1){alert(H.data)}})}});$(".commentContentBox").scrollTop($(".commentContentBox")[0].scrollHeight-530);$(".btnLoadComment ").removeClass("on")})}function uploadVoic(A){wx.uploadVoice({localId:A,isShowProgressTips:1,success:function(B){var C=B.serverId;$.post(down_url,{"mid":C,"mtype":"voice"},function(E){var F=E.data;var D={type:"say",target:"main",msgtype:"voice",headimg:avatar,"last":clock_index,to_client_id:"all",to_client_name:"all",content:F};sentContent(D);clock_index=0})}})}function TcpSocketConnect(){ws=new WebSocket("ws://toupiao.duoguan.com:7272");ws.onopen=onopen;ws.onmessage=onmessage;ws.onclose=function(){TcpSocketConnect()};ws.onerror=function(){console.log("出现错误")}}function onopen(){if(!name){name=nickname}var A={type:"login",headimg:avatar,client_name:name,room_id:room_id};ws.send(JSON.stringify(A))}function onmessage(A){console.log(A.data);var B=JSON.parse(A.data);switch(B["type"]){case"ping":ws.send('{"type":"pong"}');break;case"login":if(user_info.is_manager||user_info.is_guest){$(".qlOLPeople").text(B["users"])}else{$(".qlOLPeople").text(parseInt($(".qlOLPeople").text())+1)}break;case"say":if(B.target=="main"){say(B)}else{say_discuss(B)}break;case"logout":break;case"tipmsg":if(user_info.is_manager||user_info.is_guest){$(".qlOLPeople").text(B["users"])}}}function say_discuss(A){$("#loadNone").hide();var B='<dd class="comment_dd " msg_id="'+A.msg_id+'">';B+='<span class="right_info">';if(user_info.is_manager){B+='<i class="btn_wall">上墙</i>'}B+='<i class="btn_like">0</i> <i class="btn_hate">0</i></span>';B+='<a class="avatar"><img src="'+A.headimg+'"></a><a class="author_name">'+A.from_client_name+"</a>";B+='<b class="time">'+A.time+"</b>";if(user_info.is_manager){B+='<i class="commentManage">管理<span class="commentManageTab" style="display:none;">';B+='<a class="delCommentMsg">删除</a><a class="shutUpSet">禁言</a></span></i>'}if(A.is_ask){A.content='<em class="ask_label">问</em>'+A.content}B+='<p class="content">'+A.content+"</p></dd>";$("#commentDl").prepend(B);$(".commentContentBox").scrollTop(15);$(".btn_wall").unbind();$(".btn_wall").click(function(){var C=$(this).parents("dd").children(".author_name").text();var D=$(this).parents("dd").children(".content").text();if(D.indexOf("问")==0){D=D.replace("问","")}globalObj.Question={N:C,Q:D};$(".commentReplyBox").show()});$(".commentManage").unbind();$(".commentManage").click(function(){var C=$(this).children().css("display");if(C=="none"){$(this).children().show()}else{$(this).children().hide()}});$(".delCommentMsg").unbind();$(".delCommentMsg").click(function(){var D=confirm("确认要删除吗?");if(D){var C=$(this).parents("dd").attr("msg_id");var E=$(this).parents("dd");$.post(location.href,{msg_id:C,op:"del"},function(F){if(F.success==1){E.remove()}})}});$(".shutUpSet").unbind();$(".shutUpSet").click(function(){var D=confirm("确认要对此用户禁言吗?");if(D){var C=$(this).parents("dd").attr("msg_id");var E=$(this).parents("dd");$.post(location.href,{msg_id:C,op:"shutup"},function(F){if(F.success==1){alert(F.data)}})}})}function say(C){var D='<dd class="left_bubble hasTime" msg_id="'+C.msg_id+'">';D+='<div class="speak_time">'+C.time+"</div>";D+='<div class="head_portrait"><img src="'+C.headimg+'"></div>';D+='<div class="speaker_name"><b>'+C.from_client_name+"</b></div>";D+='<div class="bubble_content "><p>'+C.content+"</p></div>";if(topic_setting.reward_status==1){D+='<a class="btn_ilike" href="javascript:;">赏</a>'}D+="</dd>";if(C.msgtype=="voice"){var A=getRecordClass(C.last);D='<dd class="left_bubble hasTime" msg_id="'+C.msg_id+'">';D+='<div class="speak_time">'+C.time+"</div>";D+='<div class="head_portrait"><img src="'+C.headimg+'"></div>';D+='<div class="speaker_name"><b>'+C.from_client_name+"</b></div>";D+='<div class="bubble_content recordingMsg '+A+'">';D+='<i class="audio_info" attr-src="'+C.content+'"></i><var>'+C.last+"</var></div>";if(topic_setting.reward_status==1){D+='<a class="btn_ilike" href="javascript:;">赏</a>'}D+="</dd>"}if(C.msgtype=="image"){D='<dd class="left_bubble hasTime" msg_id="'+C.msg_id+'">';D+='<div class="speak_time">'+C.time+"</div>";D+='<div class="head_portrait"><img src="'+C.headimg+'"></div>';D+='<div class="speaker_name"><b>'+C.from_client_name+"</b></div>";D+='<div class="bubble_content ">';D+='<img class="chat_img" mediaid="'+C.content+'" src="'+C.content+'"></div>';if(topic_setting.reward_status==1){D+='<a class="btn_ilike" href="javascript:;">赏</a>'}D+="</dd>"}if(C.msgtype=="ask"){var E=JSON.parse(unescape(C.content));D='<dd class="left_bubble hasTime" msg_id="'+C.msg_id+'">';D+='<div class="speak_time">'+C.time+"</div>";D+='<div class="head_portrait"><img src="'+C.headimg+'"></div>';D+='<div class="speaker_name"><b>'+C.from_client_name+"</b></div>";D+='<div class="bubble_content "><p><b>'+E.N+':</b><em class="ask_label">问</em>'+E.Q+"</p><p><b>回复:</b>"+E.replay+"</p></div>";if(topic_setting.reward_status==1){D+='<a class="btn_ilike" href="javascript:;">赏</a>'}D+="</dd>"}if(C.msgtype=="reward"){var B=JSON.parse(unescape(C.content));D='<dt class="luckyMoney" msg_id="'+C.msg_id+'">';D+='<div class="lm_main" attr-imgurl="'+B.to_avatar+'" attr-money="'+B.money+'" attr-toname="'+B.to_name+'" from-name="'+C.from_client_name+'" from-avatar="'+C.headimg+'">';D+="<var>"+C.from_client_name+"</var> 赞赏了 <var>"+B.to_name+"</var> 一个<b>红包</b>";D+="</div>";D+="</dt>"}if(C.msgtype=="shutup"){if(C.content=="on"){D='<dt class="bubble_dt"><b>讨论区现在禁止发言</b></dt>';$(".commentBox").find(".comment_input_box").html('<b class="shutupbox">本直播当前为禁言状态</b>')}else{D='<dt class="bubble_dt"><b>讨论区现在允许发言</b></dt>';$(".commentBox").find(".comment_input_box").html('<b class="commentInput">来说点什么吧...</b>');$(".commentInput").unbind();$(".commentInput").click(function(){$(".commentBox").addClass("typing");$(".danmuBottom").show();$(".danmuBottom").css("max-height","25rem");$(".qlDanmuBg").show()})}}$("#speakBubbles").append(D);$(".speakContentBox").scrollTop($(".speakContentBox")[0].scrollHeight);if(C.msgtype=="voice"){voiceDown();if(!globalObj.isPlaying||globalObj.isPlaying==false){$(".recordingMsg").last().click()}}$(".chat_img").unbind();$(".chat_img").click(function(){if($.inArray($(this).attr("src"),globalObj.chat_images)==-1){globalObj.chat_images.push($(this).attr("src"))}wx.previewImage({current:$(this).attr("src"),urls:globalObj.chat_images})});reward()}$(function(){TcpSocketConnect();if(istopic_end==0){page_object.sub_pindex=page_object.sub_pages}ajax_content(page_object.sub_pindex,"down");ajax_discuss_content(page_object.com_pindex);$(".btn_ask").click(function(){$(this).toggleClass("on")});$(".btnLiveTalk").click(function(){var B=$(".speakInput").val();if(B==""){return}var A={type:"say",target:"main",msgtype:"text",headimg:avatar,to_client_id:"all",to_client_name:"all",content:B};sentContent(A);$(".speakInput").val("")});$("#btnStartRec").click(function(){$(".rec_Title_box").hide();$(".tab_recordingType").hide();$(".btn_dd").addClass("startRec");$(".second_dd").show();wx.startRecord();startRec();$("#btnStopRec").show();clock_handler=setInterval(startRec,1000)});$("#btnStopRec").click(function(){clearInterval(clock_handler);$(".btn_dd").removeClass("startRec");$(".btn_dd").addClass("stopRec");$("#btnStopRec").hide();$("#btnSentRec").show();wx.stopRecord({success:function(A){current_voiclocalid=A.localId}})});$("#btnSentRec").click(function(){if(current_voiclocalid!=null){uploadVoic(current_voiclocalid)}$("#btnSentRec").hide();$(".btn_dd").removeClass("stopRec");$(".second_dd var").eq(0).text(0);$(".rec_Title_box").show();$(".tab_recordingType").show();$(".second_dd").hide()});$("#btnCancelRec").click(function(){current_voiclocalid==null;$("#btnSentRec").hide();$(".btn_dd").removeClass("stopRec");$(".second_dd var").eq(0).text(0);$(".rec_Title_box").show();$(".tab_recordingType").show();$(".second_dd").hide();clock_index=0});$(".btn_img").click(function(){wx.chooseImage({count:1,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(D){var C=D.localIds;var A=0,B=1;globalObj.localIds=C;function E(){var F=globalObj.localIds[A].toString();wx.uploadImage({localId:F,isShowProgressTips:1,success:function(G){var H=G.serverId;$.post(down_url,{"mid":H,"mtype":"image"},function(J){var K=J.data;var I={type:"say",target:"main",msgtype:"image",headimg:avatar,to_client_id:"all",to_client_name:"all",content:K};sentContent(I)});A++;if(A<1){E()}}})}E()}});return false});$(".commentContentBox").scroll(function(){var A=$(this).scrollTop();var C=$(this)[0].scrollHeight;var B=$(this)[0].clientHeight;console.dir(A+B+"__"+C);if(A+B+1>=C){if(page_object.com_pindex<page_object.com_pages){page_object.com_pindex=page_object.com_pindex+1;$(".btnLoadComment ").addClass("on");ajax_discuss_content(page_object.com_pindex)}}});$(".speakContentBox").scroll(function(){var A=$(this).scrollTop();var C=$(this)[0].scrollHeight;var B=$(this)[0].clientHeight;if(A+B+2>=C){if(page_object.sub_pindex<sub_pages){$(".btnLoadSpeakEnd").addClass("on");page_object.sub_pindex=page_object.sub_pindex+1;ajax_content(page_object.sub_pindex,"down")}}if(A<3){if(page_object.sub_pindex>1){$(".btnLoadSpeak").addClass("on");page_object.sub_pindex=page_object.sub_pindex-1;ajax_content(page_object.sub_pindex,"up")}}});$(".btn_wall").click(function(){var A=$(this).parents("dd").children(".author_name").text();var B=$(this).parents("dd").children(".content").html();globalObj.Question={N:A,Q:B};$(".commentReplyBox").show()});$(".gene_cancel").click(function(){$(".geneBox").hide()});$(".commentManage").first().click(function(){var A=$(this).children().css("display");if(A=="none"){$(this).children().show()}else{$(this).children().hide()}});$(".commentReplyBox .gene_confirm").click(function(){var B=$(".commentReplyBox .reply_textarea").val();if(B==""){return}if(!globalObj.Question){return}globalObj.Question.replay=B;var A={type:"say",target:"main",msgtype:"ask",headimg:avatar,to_client_id:"all",to_client_name:"all",content:JSON.stringify(globalObj.Question)};sentContent(A);$(".reply_textarea").val("");$(".commentReplyBox").hide()});$(".redbag_cancel").click(function(){$(".redbag_box").hide()});$("#allShutup").click(function(){$(this).toggleClass("swon");if($(this).hasClass("swon")){var A={type:"say",target:"main",msgtype:"shutup",headimg:avatar,to_client_id:"all",to_client_name:"all",content:"on"};sentContent(A)}else{var A={type:"say",target:"main",msgtype:"shutup",headimg:avatar,to_client_id:"all",to_client_name:"all",content:"off"};sentContent(A)}});$("#btnAutoPlay").click(function(){$(this).toggleClass("swon")})});$(function(){$(".btnBackVoice").click(function(){$(".speakBox").removeClass("textBottom");$(".speakBox").addClass("hasTabBottom")});$(".tabToComment,.write_dan_a").click(function(){$(".commentBox").show()});$(".backToLive").click(function(){$(".commentBox").hide()});$(".commentInput").click(function(){$(".commentBox").addClass("typing");$(".danmuBottom").show();$(".danmuBottom").css("max-height","25rem");$(".qlDanmuBg").show()});$(".btnCommentCancel").click(function(){$(".commentBox").removeClass("typing");$(".danmuBottom").hide();$(".danmuBottom").css("max-height","0rem");$(".qlDanmuBg").hide()});$("#btn_discuss_send").click(function(){var B=$(".danmuInput").val();if(B==""){return}var A={type:"say",target:"discuss",msgtype:"text",headimg:avatar,to_client_id:"all",to_client_name:"all",content:B};if($(".btn_ask").hasClass("on")){A.is_ask=true}sentContent(A);$(".danmuInput").val("");$(".btn_ask").removeClass("on")});$(".isdan_btn_a").click(function(){$(".danmu_bar").toggleClass("on");if($(this).text()=="关"){$(this).text("弹")}else{$(this).text("关")}});$(".btn_gtb_close").click(function(){$(".setGuestTips").hide()});$(".tab_others").click(function(){if(!$(".speakBox").hasClass("othersBottom")){$(".speakBox").removeClass("hasTabBottom")}else{$(".speakBox").addClass("hasTabBottom")}$(".speakBox").removeClass("textBottom");$(".speakBox").removeClass("voiceBottom");$(".speakBox").toggleClass("othersBottom")});$(".tab_text").click(function(){if(!$(".speakBox").hasClass("textBottom")){$(".speakBox").removeClass("hasTabBottom")}else{$(".speakBox").addClass("hasTabBottom")}$(".speakBox").removeClass("othersBottom");$(".speakBox").removeClass("voiceBottom");$(".speakBox").toggleClass("textBottom")});$(".tab_voice").click(function(){$(".speakBox").removeClass("othersBottom");$(".speakBox").removeClass("textBottom");if(!$(".speakBox").hasClass("voiceBottom")){$(".speakBox").removeClass("hasTabBottom")}else{$(".speakBox").addClass("hasTabBottom")}$(".speakBox").toggleClass("voiceBottom")});$(".btnControlBox").click(function(){$(".cbox_main").css("margin-bottom","0px");$(".control_box").addClass("on")});$(".btn_closeCBox").click(function(){$(".cbox_main").css("margin-bottom","-250px");$(".control_box").removeClass("on")});$(".close_elt").click(function(){$(".qlMsgTips").hide()});$(".btn_finish_live").click(function(){var A=$(this).attr("attr-topicid");var B=confirm("确定要结束吗?");if(B){$.post(topic_overurl,{topic_id:A},function(C){if(C.success==1){location.href=location.href+"&r=1"}else{alert(C.data)}})}})});