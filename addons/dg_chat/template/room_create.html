{template 'common/header'}

<ul class="nav nav-tabs">
	<li {if $_GPC['do'] =='' || $_GPC['do'] == 'chat_manage'}class="active"{/if}><a href="{php echo $this->createWebUrl('chat_manage')}">直播间管理</a></li>

</ul>

<div class="main">
 <form action="" method="post" class="form-horizontal form" id="setting-form">
		<div class="panel panel-default">

			<div class="panel-body">

			<div class="form-group">
					<label class="col-xs-12 col-sm-3 col-md-2 control-label">直播间头像</label>
					<div class="col-sm-9 col-xs-12">
						{php echo tpl_form_field_image('room_icon', $topic['room_icon'])}
					</div>
				</div>

				<div class="form-group">
					<label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label"><span style="color:red;">*</span>直播间名称</label>
					<div class="col-sm-8">
						<input type="text" name="room_name" class="form-control" value="{$topic['room_name']}" />
					</div>
				</div>

				<div class="form-group" style="display: block;">
					<label class="col-xs-12 col-sm-3 col-md-2 control-label"><span style="color:red">*</span>用户选择</label>
					<div class="col-sm-9 col-xs-12">
						<div class="input-group ">
							<input type="text" name="link" id="user_nickname" class="form-control" value="{$banner['agent_nickname']}" onblur="seluser()">
							<input type="hidden" name="select_uid" id="select_uid" value="{$banner['agent_uid']}">
							<span class="input-group-btn">
								<button class="btn btn-default btn_seluser" type="button" >选择用户</button>
							</span>
						</div>
					</div>
				</div>

				<div class="form-group">
					<label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label">直播间简介</label>
					<div class="col-sm-8">
					 <textarea style="height: 160px;" id="room_desc" name="room_desc"
                          class="form-control span7" cols="60">{$topic['room_desc']}</textarea>
					</div>
				</div>

				<div class="form-group">
					<label class="col-xs-12 col-sm-3 col-md-2 control-label">概要图片</label>
					<div class="col-sm-9 col-xs-12">
						{php echo tpl_form_field_multi_image('chat_imgs', $topic['chat_imgs'])}
					</div>
				</div>

				<div class="form-group">
					<label class="col-xs-12 col-sm-3 col-md-2 control-label">直播间背景</label>
					<div class="col-sm-9 col-xs-12">
						{php echo tpl_form_field_image('bg_img', $topic['bg_img'])}
					</div>
				</div>



				<div class="form-group">

					<label class="col-xs-12 col-sm-3 col-md-2 control-label"> 排序</label>

					<div class="col-sm-9 col-xs-12">

						<input type="text" name="room_order" id="room_order" value="{$room['room_order']}" class="form-control">

					</div>

				</div>

				<div class="form-group">

					<label class="col-xs-12 col-sm-3 col-md-2 control-label"> 赞赏功能</label>

					<div class="col-sm-9 col-xs-12">

						<div class="input-group">

							<input type="text" class="form-control" name="reward_percent" value="{$room['reward_percent']}">
							<span class="input-group-addon">%</span>
						</div>

					</div>

				</div>
				<div class="form-group">

					<label class="col-xs-12 col-sm-3 col-md-2 control-label"> 直播间分佣</label>

					<div class="col-sm-9 col-xs-12">
						<div class="input-group">

							<input type="text" class="form-control" name="subcom_percent" value="{$room['subcom_percent']}">
							<span class="input-group-addon">%</span>
						</div>


					</div>

				</div>

				<div class="form-group ">

					<label class="col-xs-12 col-sm-3 col-md-2 control-label">分类标签</label>
					<div class="col-sm-9 col-xs-12">
						{loop $tag_record $row}
					 <label class="checkbox-inline">
				        <input type="checkbox" name="tags_name[]" class="tag_check" value="{$row['id']}"> {$row['tag_name']}
				    </label>
					  {/loop}
					</div>
				</div>

 	</div>
		</div>

		<div class="form-group col-sm-12">
			<input type="submit" name="submit" value="提交" class="btn btn-primary col-lg-1" />
			<input type="hidden" name="token" value="{$_W['token']}" />
		</div>
	</form>
</div>


<div class="modal fade" id="user-info" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-dialog" style="width:800px;top:360px;">
			<div class="modal-content">
				<form action="./index.php?c=extension&a=module&do=info&" method="post" enctype="multipart/form-data" class="form-horizontal form" id="form-info">
					<input type="hidden" name="m" value=""/>
					<div class="modal-header">
						<button type="button" class="close close_user" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
						<h4>选择用户</h4>
					</div>
					<div class="modal-body">
                                        <div class="row">
                                            <div class="input-group">
                                                <input type="text" class="form-control" name="keyword" value="" id="keyword_user" placeholder="请输入用户名称关键字">
                                                <span class="input-group-btn"><button type="button" class="btn btn-default" onclick="search_users();">搜索</button></span>
                                            </div>
                                        </div>
                                        <div id="module-menus" style="padding-top:5px;"><div style="max-height:500px;overflow:auto;min-width:750px;">
			<table class="table table-hover" style="min-width:750px;">
				<tbody id="user_list">
				</tbody>
			</table>
				    </div></div>
				 </div>

				</form>
			</div>
		</div>
</div>

<script type="text/javascript">
require(['jquery', 'util'], function ($, u) {
    $(function () {
        $('.tag_check').click(function(){
			if($("input:checkbox:checked").length==3){
				util.message('最多只能选择两个标签');
				$(this).attr("checked",false);
			}
		})
		$('#setting-form').submit(function(){
			var result = true;
			if($('input[name="room_name"]').val() == ''){
				result = false;
				util.message('未填写直播间名称');
			}
			if($('input[name="select_uid"]').val() == ''){
				util.message('未填写用户');
				result = false;
			}
			return result;
		});
    });
});

</script>
<script type="text/javascript">

function getuserRows(data){
	var html='';
	for(i=0;i<data.length;i++){
		html+='<tr>';
		html+='<td><img src="'+data[i].avatar+'" style="width:30px;height:30px;padding1px;border:1px solid #ccc"> '+data[i].nickname+'</td>';
		html+='<td></td>';
		html+='<td></td>';
		html+='<td style="width:80px;"><a href="javascript:;" onclick="select_user(this)" link_name='+data[i].nickname+' user_uid='+data[i].id+'>选择</a></td>';
	    html+='</tr>';
	}
	return html;
}


function search_users(){
	var keyword_user=$("#keyword_user").val();
	$("#user_list").empty();

	$.post(location.href,{keyword_user:keyword_user},function(result){
		var html=getuserRows(result.data);
		$("#user_list").append(html);
	});
}
function  seluser(){
	var user_nickname = $("#user_nickname").val();
	if(user_nickname !=''){
		$.post(location.href,{user_nickname:user_nickname},function(result){
			if(result.success == 1){
				 $("#select_uid").val(result.data);
			}else{
				alert(result.data);
			}
		});
	}

}

function select_user(obj){
   $("#user_nickname").val($(obj).attr('link_name'));
   $("#select_uid").val($(obj).attr('user_uid'));
   $('#user-info').modal('hide');
}

$(function(){

	$(".btn_seluser").click(function(){
		$('#user-info').modal('show');
	});


	$(".close_user").click(function(){
		$('#user-info').modal('hide');
		$("#keyword_user").val('');
		$("#user_list").empty();
	});
});

</script>
{template 'common/footer'}