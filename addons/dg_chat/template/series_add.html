{template 'common/header'}

<ul class="nav nav-tabs">
	<li {if $_GPC['do'] =='' || $_GPC['do'] == 'series_manage'}class="active"{/if}><a href="{php echo $this->createWebUrl('series_manage')}">添加音乐</a></li>
	
</ul>

<div class="main">
 <form action="" method="post" class="form-horizontal form" id="setting-form">
		<div class="panel panel-default">
		
			<div class="panel-body">
			
			<div class="form-group">
					<label class="col-xs-12 col-sm-3 col-md-2 control-label"><span style="color:red;">*</span>音乐封面</label>
					<div class="col-sm-9 col-xs-12">
						{php echo tpl_form_field_image('room_icon', $topic['room_icon'])}
					</div>
				</div>
				
				<div class="form-group">
					<label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label"><span style="color:red;">*</span>音乐标题</label>
					<div class="col-sm-8">
						<input type="text" name="room_name" class="form-control" value="{$topic['room_name']}" />
					</div>
				</div>
				
				
				<div class="form-group">
					<label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label"><span style="color:red;">*</span>音乐介绍</label>
					<div class="col-sm-8">
					 <textarea style="height: 160px;" id="room_desc" name="room_desc"
                          class="form-control span7" cols="60">{$topic['room_desc']}</textarea>
					</div>
				</div>
				
				<div class="form-group">
					<label class="col-xs-12 col-sm-3 col-md-2 control-label"><span style="color:red;">*</span>概要图片</label>
					<div class="col-sm-9 col-xs-12">
						{php echo tpl_form_field_multi_image('chat_imgs', $topic['chat_imgs'])}
					</div>
				</div>

				<div class="form-group">
					<label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label"><span style="color:red;">*</span>排课计划</label>
					<div class="col-sm-8">
						<input type="number" name="count_subject" class="form-control" value="{$topic['count_subject']}" />
					<div class="help-block">预计多少节课</div>
					</div>
				</div>
				
				
			

			<div class="form-group ticket-type"style="display:block;">
				<label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label"><span style="color:red;">*</span>设置音乐付费价格</label>
					<div class="col-sm-8">
						<input type="text"value="" class="form-control" attr-id="" name="series_price">
					</div>
					
			</div>
			
			<div class="form-group">
					<label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label"><span style="color:red;">*</span>所属直播间</label>
					<div class="col-sm-8">
						 <select name="room_id" id="change_room" class="form-control">
						 	<option value="0">请选择</option>
						 	{loop $chat_rooms $row}
						 	<option value="{$row['room_id']}">{$row['room_name']}</option>
						 	{/loop}
						  </select>
					</div>
			</div>

           
           <div class="form-group">
 			<label class="col-xs-12 col-sm-3 col-md-2 control-label">文件格式上传</label>
            <div class="col-sm-9 col-xs-6">
				<div class="input-group">
	                <label class="radio-inline">
	                	<input type="radio" checked="checked" name="topic_style" value="1" class="back_video">音频格式
	                </label>
	                <label class="radio-inline">
	                	<input type="radio" name="topic_style" value="2" class="back_video">视频格式
	                </label>
				</div>
            </div>
         </div>

         <div class="form-group video-id">
					<label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label"><span style="color:red;">*</span>上传音频</label>
					<div class="col-sm-8">
						{php echo tpl_form_field_audio('third_url',$topic['third_url']);}
			</div> 
		</div>
            <div class="form-group third-url" style="display:none" >
					<label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label"><span style="color:red;">*</span>上传视频</label>
					<div class="col-sm-8">
						{php echo tpl_form_field_video('third_url',$topic['third_url']);}
						<div class="help-block">请将视频分享的【通用代码】中src=""内容（不包括src=和引号）复制到下列输入框 
例：<iframe frameborder="0" width="640" height="498" src="https://v.qq.com/iframe/player.html?vid=v0019c7up3l&tiny=0&auto=0"allowfullscreen></iframe>（红色部分）</div>
					</div>
			</div>

			
			<div class="form-group ">
				<label class="col-xs-12 col-sm-3 col-md-2 control-label">分类标签</label>
				<div class="col-sm-9 col-xs-12">
					{loop $tag_record $row}
				 <label class="checkbox-inline">
			        <input type="checkbox" name="tags_name[]" class="tag_check" value="{$row['id']}"> {$row['tag_name']}
			    </label>
				  {/loop}
				</div>
			</div>
         				
 	</div>
		</div>
	
		<div class="form-group col-sm-12">
			<input type="submit" name="submit" value="提交" class="btn btn-primary col-lg-1" />
			<input type="hidden" name="token" value="{$_W['token']}" />
		</div>
</div>


<script type="text/javascript">
$('.tag_check').click(function(){
	if($("input:checkbox:checked").length==3){
		alert('最多只能选择两个标签');
		$(this).attr("checked",false);
	}
})
require(['jquery', 'util'], function ($, u) {
    $(function () {
        //u.editor($('#topic_desc')[0]);
        //u.editor($('#guest_info')[0]);
    });
});	

$(".back_video").click(function(){
			if($(this).val() == 1){
				$(".activityid").show();
				$(".third-url").hide();
				$(".video-id").show();
			}else if($(this).val() == 2){
				$(".activityid").hide();
				$(".video-id").hide();
				$(".third-url").show();
			}
			
})

//		$(document).ready(function(){
			$('.jia').click(function(){
				tags1 = $("#add_tags").val();
				room_id_ol = $("#change_room").val();
				$.post(location.href,{'jia':true,'add_tags':tags1,room_id_ol:room_id_ol},function(result){
				last_html ='';
				content = result.list;
				console.log(content);
				for(var qindex in content){
					  last_html+=getHtml(qindex,content);
					}
				$('.dizhi').append('<p style="margin-bottom: 5px;"><select name="tags_name[]" id="add_tags"><option value="0">请选择</option>'+last_html+' </select><span class="jian glyphicon glyphicon-minus"  style="cursor:pointer;"></span><p/>');
				$(".jia").hide();
				});
				
			})
			
			$('body').on('click','.jian',function(){
				$(this).parent().remove();
			})
//		})
		function getHtml(Qindex,List){
			text ='';
			text+='<option value="'+List[Qindex].id+'">'+List[Qindex].tag_name+'</option>';
			return text;
		}
function search_members() {
        if ($.trim($('#search-kwd').val()) == '') {
            Tip.focus('#search-kwd', '请输入关键词');
            return;
        }
        $("#module-menus").html("正在搜索....");
        $.get(location.href, { 
            keyword: $.trim($('#search-kwd').val())
        }, function (dat) {
            $('#module-menus').html(dat);
        });
    }
    function select_member(o) {

        if ($('.multi-item[openid="' + o.openid + '"]').length > 0) {
            return;
        }
        var html = '<div class="multi-item" openid="' + o.openid + '">';
        html += '<img class="img-responsive img-thumbnail" src="' + o.avatar + '" onerror="this.src=\'./resource/images/nopic.jpg\'; this.title=\'图片未找到.\'">';
        html += '<div class="img-nickname">' + o.nickname + '</div>';
        html += '<input type="hidden" value="' + o.openid + '" name="openids[]">';
        html += '<em onclick="remove_member(this)"  class="close">×</em>';
        html += '</div>';
        $("#saler_container").append(html);
        refresh_members(o.nickname);
    }

    function remove_member(obj) {
        $(obj).parent().remove();
        refresh_members();
    }
    function refresh_members() {
        var nickname = "";
        $('.multi-item').each(function () {
        	if($(this).find('.img-nickname').html()!=undefined){
        		nickname += " " + $(this).find('.img-nickname').html() + "; ";
        	}
        });
        $('#salers').val(nickname);
    }
    function gettagHtml(Qindex,List){
    	text1 ='';
		text1+='<option value="'+List[Qindex].id+'">'+List[Qindex].tag_name+'</option>';
		return text1;
    }
//	function change(){
//		room_id = $("#change_room").val();
//		$.post(location.href,{room_ids:room_id},function(result){
//			$(".tag-box").show();
//			last_html ='';
//			content = result.list;
//			console.log(content);
//			for(var qindex in content){
//				  last_html+=gettagHtml(qindex,content);
//				}
//			$("#add_tags option:not(:first)").remove();
//			$('#add_tags').append(last_html);
////			$(".jia").hide();
////			console.log(result);
//		})
//	}
	function change_tags(){
		tags1 = $("#tags1").val();
		$.post(location.href,{tags1:tags1},function(result){
			$(".tag-box").show();
			last_html ='';
			content = result.list;
			console.log(content);
			for(var qindex in content){
				  last_html+=gettagHtml(qindex,content);
				}
			$("#add_tags option:not(:first)").remove();
			$('#add_tags').append(last_html);
//			$(".jia").hide();
//			console.log(result);
		})
	}
// function select_member(uid){
//    $.post(location.href,{uid:uid},function(result){
//    	$('#module-info').modal('hide');
// 	  $("#invite_user").show();
// 	  $("#invite_user").val(result.nickname);
// 	  $("#invite_id").val(result.id);
//    });	
// }
</script>
{template 'common/footer'}