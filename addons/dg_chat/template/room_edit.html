{template 'common/header'}



<ul class="nav nav-tabs">

	<li><a href="{php echo $this->createWebUrl('chat_manage')}">直播间管理</a></li>

	<li class="active"><a href="#">编辑直播间</a></li>

</ul>
<div class="main">
   <form action="" method="post" class="form-horizontal form" id="setting-form">
		<div class="panel panel-default">
			<div class="panel-body">

			<div class="form-group">
					<label class="col-xs-12 col-sm-3 col-md-2 control-label"><span style="color:red;">*</span>房间图标</label>
					<div class="col-sm-9 col-xs-12">
						{php echo tpl_form_field_image('room_icon', $room['room_icon'])}
					</div>
				</div>

				<div class="form-group">

					<label class="col-xs-12 col-sm-3 col-md-2 control-label"> 房间名</label>

					<div class="col-sm-9 col-xs-12">

						<input type="text" name="room_name" id="room_name" value="{$room['room_name']}" class="form-control">

					</div>

				</div>



				<div class="form-group">

					<label class="col-xs-12 col-sm-3 col-md-2 control-label"> 房间描述</label>

					<div class="col-sm-9 col-xs-12">

						<input type="text" name="room_desc" id="room_desc" value="{$room['room_desc']}" class="form-control">

					</div>

				</div>

				<div class="form-group">
					<label class="col-xs-12 col-sm-3 col-md-2 control-label">房间背景</label>
					<div class="col-sm-9 col-xs-12">
						{php echo tpl_form_field_image('bg_img', $room['bg_img'])}
					</div>
				</div>


				<div class="form-group">
					<label class="col-xs-12 col-sm-3 col-md-2 control-label"><span style="color:red;">*</span>概要图片</label>
					<div class="col-sm-9 col-xs-12">
						{php echo tpl_form_field_multi_image('chat_imgs', $room['chat_imgs'])}
					</div>
				</div>


				<div class="form-group">

					<label class="col-xs-12 col-sm-3 col-md-2 control-label"> 排序</label>

					<div class="col-sm-9 col-xs-12">

						<input type="text" name="room_order" id="room_order" value="{$room['room_order']}" class="form-control">

					</div>

				</div>

				<div class="form-group">
					<label class="col-xs-12 col-sm-3 col-md-2 control-label"> 赞赏功能(%)</label>
					<div class="col-sm-9 col-xs-12">
						<input type="text" name="reward_percent" id="reward_percent" value="{$room['reward_percent']}" class="form-control">
					</div>
				</div>
				<div class="form-group">
					<label class="col-xs-12 col-sm-3 col-md-2 control-label"> 直播间分佣(%)</label>
					<div class="col-sm-9 col-xs-12">
						<input type="text" name="subcom_percent" id="subcom_percent" value="{$room['subcom_percent']}" class="form-control">
					</div>
				</div>

				<div class="form-group" style="display: block;">
					<label class="col-xs-12 col-sm-3 col-md-2 control-label"><span style="color:red">*</span>招商员</label>
					<div class="col-sm-9 col-xs-12">
						<div class="input-group ">
							<input type="text" name="merchants" id="merchants_nickname" class="form-control" value="{$merchants['nickname']}" onblur="seluser()">
							<input type="hidden" name="merchants_uid" id="merchants_uid" value="{$room['merchants_uid']}">
							<span class="input-group-btn">
								<button class="btn btn-default btn_seluser" type="button" >选择用户</button>
							</span>
						</div>
					</div>
				</div>

				<div class="form-group">
					<label class="col-xs-12 col-sm-3 col-md-2 control-label"> 招商员分成(%)</label>
					<div class="col-sm-9 col-xs-12">
						<input type="text" name="merchants_percent" id="merchants_percent" value="{$room['merchants_percent']}" class="form-control">
					</div>
				</div>

				<div class="form-group" style="display: block;">
					<label class="col-xs-12 col-sm-3 col-md-2 control-label"><span style="color:red">*</span>选择分院用户</label>
					<div class="col-sm-9 col-xs-12">
						<div class="input-group ">
							<input type="text" name="branchcourt" id="branchcourt_nickname" class="form-control" value="{$branchcourt['nickname']}" onblur="bh_seluser()">
							<input type="hidden" name="branchcourt_uid" id="branchcourt_uid" value="{$room['branchcourt_uid']}">
							<span class="input-group-btn">
								<button class="btn btn-default branchcourt_seluser" type="button" >选择用户</button>
							</span>
						</div>
					</div>
				</div>

				<div class="form-group">
					<label class="col-xs-12 col-sm-3 col-md-2 control-label">分院分成(%)</label>
					<div class="col-sm-9 col-xs-12">
						<input type="text" name="branchcourt_percent" id="branchcourt_percent" value="{$room['branchcourt_percent']}" class="form-control">
					</div>
				</div>


				<div class="form-group">
					<label class="col-xs-12 col-sm-3 col-md-2 control-label"> 房间状态</label>
					<div class="col-sm-9 col-xs-12">
						<select id='room_status' name="room_status" class="form-control">
						 <option value="0" {if $room['room_status']==0}selected{/if}>审核中</option>
						 <option value="-1" {if $room['room_status']==-1}selected{/if}>禁用</option>
						 <option value="1" {if $room['room_status']==1}selected{/if}>正常</option>
						</select>
					</div>
				</div>

				<div class="form-group ">
					<label class="col-xs-12 col-sm-3 col-md-2 control-label">分类标签</label>
					<div class="col-sm-9 col-xs-12">
						{loop $tag_record $row}
					 <label class="checkbox-inline">
				        <input type="checkbox" name="tags_name[]" class="tag_check" value="{$row['id']}" {if in_array($row['id'],$tag,true)}checked{/if}> {$row['tag_name']}
				    </label>
					  {/loop}
					</div>
				</div>
		</div>
		</div>
		<div class="form-group col-sm-12">
			<input type="submit" name="submit" value="提交" class="btn btn-primary col-lg-1" />
			<input type="hidden" name="token" value="{$_W['token']}" />
		</div>
	</form>
</div>
<div class="modal fade" id="user-info" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-dialog" style="width:800px;top:360px;">
			<div class="modal-content">
				<form action="./index.php?c=extension&a=module&do=info&" method="post" enctype="multipart/form-data" class="form-horizontal form" id="form-info">
					<input type="hidden" name="m" value=""/>
					<div class="modal-header">
						<button type="button" class="close close_user" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
						<h4>选择用户</h4>
					</div>
					<div class="modal-body">
                                        <div class="row">
                                            <div class="input-group">
                                                <input type="text" class="form-control" name="keyword" value="" id="keyword_user" placeholder="请输入用户名称关键字">
                                                <span class="input-group-btn"><button type="button" class="btn btn-default" onclick="search_users();">搜索</button></span>
                                            </div>
                                        </div>
                                        <div id="module-menus" style="padding-top:5px;"><div style="max-height:500px;overflow:auto;min-width:750px;">
			<table class="table table-hover" style="min-width:750px;">
				<tbody id="user_list">
				</tbody>
			</table>
				    </div></div>
				 </div>

				</form>
			</div>
		</div>
</div>

<div class="modal fade" id="bh-user-info" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-dialog" style="width:800px;top:360px;">
			<div class="modal-content">
				<form action="./index.php?c=extension&a=module&do=info&" method="post" enctype="multipart/form-data" class="form-horizontal form" id="form-info">
					<input type="hidden" name="m" value=""/>
					<div class="modal-header">
						<button type="button" class="close close_user" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
						<h4>选择用户</h4>
					</div>
					<div class="modal-body">
                                        <div class="row">
                                            <div class="input-group">
                                                <input type="text" class="form-control" name="keyword" value="" id="bh_keyword_user" placeholder="请输入用户名称关键字">
                                                <span class="input-group-btn"><button type="button" class="btn btn-default" onclick="bh_search_users();">搜索</button></span>
                                            </div>
                                        </div>
                                        <div id="module-menus" style="padding-top:5px;"><div style="max-height:500px;overflow:auto;min-width:750px;">
			<table class="table table-hover" style="min-width:750px;">
				<tbody id="bh_user_list">
				</tbody>
			</table>
				    </div></div>
				 </div>

				</form>
			</div>
		</div>
</div>

<script type="text/javascript">
$('.tag_check').click(function(){
	if($("input:checkbox:checked").length==3){
		alert('最多只能选择两个标签');
		$(this).attr("checked",false);
	}
})
var tags = "{$room['tags']}";
require(['jquery', 'util'], function ($, u) {

    $(function () {

			if(tags!=''){
				var tagsarray=tags.split(',');
				for(i=0;i<tagsarray.length;i++){
					$(".tag_"+tagsarray[i]).addClass("active");
				}
			}
		function getHtml(Qindex,List){
			text ='';
			text+='<option value="'+List[Qindex].id+'">'+List[Qindex].tag_name+'</option>';
			return text;
		}


        u.editor($('#room_diy_desc')[0]);

    });

});
</script>

<script type="text/javascript">

function getuserRows(data){
	var html='';
	for(i=0;i<data.length;i++){
		html+='<tr>';
		html+='<td><img src="'+data[i].avatar+'" style="width:30px;height:30px;padding1px;border:1px solid #ccc"> '+data[i].nickname+'</td>';
		html+='<td></td>';
		html+='<td></td>';
		html+='<td style="width:80px;"><a href="javascript:;" onclick="select_user(this)" link_name='+data[i].nickname+' user_uid='+data[i].id+'>选择</a></td>';
	    html+='</tr>';
	}
	return html;
}

function bh_getuserRows(data){
	var html='';
	for(i=0;i<data.length;i++){
		html+='<tr>';
		html+='<td><img src="'+data[i].avatar+'" style="width:30px;height:30px;padding1px;border:1px solid #ccc"> '+data[i].nickname+'</td>';
		html+='<td></td>';
		html+='<td></td>';
		html+='<td style="width:80px;"><a href="javascript:;" onclick="bh_select_user(this)" link_name='+data[i].nickname+' user_uid='+data[i].id+'>选择</a></td>';
	    html+='</tr>';
	}
	return html;
}


function search_users(){
	var keyword_user=$("#keyword_user").val();
	$("#user_list").empty();

	$.post(location.href,{keyword_user:keyword_user},function(result){
		var html=getuserRows(result.data);
		$("#user_list").append(html);
	});
}

function bh_search_users(){
	var keyword_user=$("#bh_keyword_user").val();
	$("#user_list").empty();

	$.post(location.href,{keyword_user:keyword_user},function(result){
		var html=bh_getuserRows(result.data);
		$("#bh_user_list").append(html);
	});
}


function  seluser(){
	var user_nickname = $("#merchants_nickname").val();
	if(user_nickname !=''){
		$.post(location.href,{user_nickname:user_nickname},function(result){
			if(result.success == 1){
				 $("#merchants_uid").val(result.data);
			}else{
				alert(result.data);
			}
		});
	}
}

function  bh_seluser(){
	var user_nickname = $("#branchcourt_nickname").val();
	if(user_nickname !=''){
		$.post(location.href,{user_nickname:user_nickname},function(result){
			if(result.success == 1){
				 $("#branchcourt_uid").val(result.data);
			}else{
				alert(result.data);
			}
		});
	}

}


function select_user(obj){
   $("#merchants_nickname").val($(obj).attr('link_name'));
   $("#merchants_uid").val($(obj).attr('user_uid'));
   $('#user-info').modal('hide');
}

function bh_select_user(obj){
   $("#branchcourt_nickname").val($(obj).attr('link_name'));
   $("#branchcourt_uid").val($(obj).attr('user_uid'));
   $('#bh-user-info').modal('hide');
}


$(function(){

	$(".btn_seluser").click(function(){
		$('#user-info').modal('show');
	});

	$(".branchcourt_seluser").click(function(){
		$('#bh-user-info').modal('show');
	});


	$(".close_user").click(function(){
		$('#user-info').modal('hide');
		$("#keyword_user").val('');
		$("#user_list").empty();
	});
});

</script>

{template 'common/footer'}