<!doctype html>
<html>

	<head>
		<meta name="viewport" content="width=device-width,initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
		<meta charset="utf-8">
		<meta name="format-detection" content="telephone=no" />
		<link rel="stylesheet" href="{TEMPLATE_PATH}/wtCommon.css" />
		<link rel="stylesheet" href="{TEMPLATE_PATH}/live.css" />
		<link rel="stylesheet" href="{TEMPLATE_PATH}/css/style_new.css?v=1" />
		<link rel="stylesheet" href="{TEMPLATE_PATH}/css/zhibo-item.css?v=1" />
		<script src="{TEMPLATE_PATH}/js/jquery.min.js"></script>
		<title>搜索结果</title>
		<style>
			.tMain {
				top: 0rem;
				bottom: 1.2rem;
				position: absolute;
				overflow: scroll;
				overflow-x: hidden;
				width: 100%;
				-webkit-overflow-scrolling: touch;
			}
			.lineText{ overflow: hidden;text-overflow: ellipsis;}
.lineText{ white-space: nowrap;}
		</style>
		<script type="text/javascript">
			var c_index = "{php echo $this->createMobileUrl('c_index')}";
			var chat_url = "{php echo $this->createMobileUrl('topic_info')}";
			var series_info = "{php echo $this->createMobileUrl('series_info')}";
			var keyword = "{$keyword}";

			function pageLoadCommon(a, b) {
				a.scroll(function() {
					distanceScrollCount = a[0].scrollHeight;
					distanceScroll = a[0].scrollTop;
					topicPageHight = a.height();
					//console.dir(distanceScrollCount +"-"+ distanceScroll +"-"+ topicPageHight+"="+(distanceScrollCount - distanceScroll - topicPageHight));
					2 >= distanceScrollCount - distanceScroll - topicPageHight && b()
				})
			}

			function getHtml(Qindex, List) {
				var html = "<li>";
				html += '<a href="' + c_index + "&room_id=" + List[Qindex].room_id + '">';
				html += '<div class="avatar">';
				html += '<img src="' + List[Qindex].room_icon + '" width="100%" height="100%">';
				html += '</div>';
				html += '<h2>' + List[Qindex].room_name + '</h2>';
				html += '<p class="lineText">' + List[Qindex].room_desc + '</p>';
				if(List[Qindex].time_small) {
					html += "<p>" + List[Qindex].time_small + "开播</p>";
				}
				html += '</a>';
				html += '</li>';
				return html;
			}

			function getseriesHtml(Qindex, List) {
				var html = '<li class="zhibo-item">';
				html += '<a  class="flex" href="' + series_info + "&series_id=" + List[Qindex].id + '">';
				html += '<div class="zhibo-item-img mr10">';
				html += '<img src="' + List[Qindex].room_icon + '" width="100%" height="100%">';
				html += '</div>';
				html += '<div style="flex:1;"><p>' + List[Qindex].room_name + '</p>';
				html += '<div class="grey f12 mt5">';
				
				html += '<div><span>' + List[Qindex].count + '人次学习</span>';
				if(List[Qindex].series_price > 0) {
					html += '<span class="fr red">￥' + List[Qindex].common_price + '</span></div>';
				}else {
					html += '<span class="fr red">免费</span></div>';
				}
				html += '</div>';
				html += '</div>';
				html += '</a>';
				html += '</li>';
				return html;
			}

			var pindex = 1;

			function loadHtml(postData) {
				postData.keyword = $("#keyword").val();
				$.post(location.href, postData, function(result) {
					$(".loading").hide();
					if(result.pages < pindex) {
						$(".noMore").show();
						return false;
					}
					pindex = result.pindex;
					var last_html = "";
					if(result.condition == 'topic') {
						for(var qindex in result.list) {
							last_html += gettopicHtml(qindex, result.list);
						}
						$("#topic_list").append(last_html);
						$(".searchZb").hide();
						$(".tHome").show();
					} else if(result.condition == 'series') {
						for(var qindex in result.list) {
							last_html += getseriesHtml(qindex, result.list);
						}
						$("#topic_list").append(last_html);
						$(".searchZb").hide();
						$(".tHome").show();
					}else{
						for(var qindex in result.list) {
							last_html += getHtml(qindex, result.list);
						}
						$("#room_list").append(last_html);
						$(".searchZb").show();
						$(".tHome").hide();
					}

				});
			}

			function gettopicHtml(Qindex, List) {
				var html = '<li class="zhibo-item">';
				
				html += '<a  class="flex" href="' + chat_url + "&topic_id=" + List[Qindex].id + '">';
				html += '<div class="zhibo-item-img mr10">';
				html += '<img src="' + List[Qindex].topic_icon + '" width="60" height="60">';
				html += '</div>';
				html += '<div class="sub"><p class="lineText">' + List[Qindex].topic_name + '</p>';
				html += '<div class="grey f12 mt5"><div>';
				
				if(List[Qindex].ing == 2) {
					html += '<span class="mr10">' + List[Qindex].relative + '</span>';
				} else if(List[Qindex].ing == 1) {
					html += '<span class="tip-tag">直播中</span>';
				}
				html += '<span>' + List[Qindex].begin_time + '</span>';
				html += '<span class="fr">话题</span></div>';
				html += '<div><span>人气:' + List[Qindex].look_numbers + '</span>';
				if(List[Qindex].room_paymoney > 0) {
					html += '<span class="fr red">￥' + List[Qindex].room_paymoney + '</span></div>';
				}else {
					html += '<span class="fr red">免费</span></div>';
				}
				html += '</div>';
				html += '</div>';
				html += '</a>';
				html += '</li>';
				return html;
			}
			$(function() {
				pageLoadCommon($(".tMain"), function() {
					if($(".mytag.active").attr("data") == 0) {
						pindex++;
						var postData = {
							pindex: pindex,
							condition: 'series'
						};
						loadHtml(postData);
					} else if($(".mytag.active").attr("data") == 1) {
						pindex++;
						var postData = {
							pindex: pindex,
							condition: 'topic'
						};
						loadHtml(postData);
					} else {
						pindex++;
						var postData = {
							pindex: pindex,
							condition: 'room'
						};
						loadHtml(postData);
					}
				})
				$(".mytag").click(function() {
					data = $(this).attr('data');
					$("#topic_list").empty();
					$("#room_list").empty();
					pindex = 1;
					if(data == 0) {
						var postData = {
							pindex: pindex,
							condition: 'series'
						};
						$("#series_list").empty();
					} else if(data == 1) {
						var postData = {
							pindex: pindex,
							condition: 'topic'
						};
						$("#topic_list").empty();
					} else {
						var postData = {
							pindex: pindex,
							condition: 'room'
						};
						$("#room_list").empty();
					}
					loadHtml(postData);
					$(".mytag").removeClass("active");
					$(this).addClass('active');
					var data = $(this).attr('data');

				});

				$(".btn_search").click(function() {
					var text = $("keyword").val();
					if(text == "") {
						return false;
					}
					$("#form_search").submit();
				});
			});
		</script>

	</head>

	<body>

		<div class="tMain">

			<div class="tNav tc f16">
				<div class="searchBox" style="display:block; padding-left: 15px;">
					<form name="form_search" id="form_search" action="" method="post">
						<div class="sInput">
							<input type="text" name="keyword" value="{$keyword}" placeholder="搜索直播或者直播间" id="keyword" />
							<button><i class="iconfont icon-search btn_search"></i></button>
						</div>
					</form>
				</div>
			</div>

			<div class="searchNav f16">
				<ul class="flex tab_li flex">
					<li data="1" class="active sub mytag">直播课</li>
					<li data="0" class="sub mytag">系列课</li>
					<li data="2" class="sub mytag">直播间</li>

				</ul>
			</div>

			<div class="list searchZb" style="display: none;">
				<ul id="room_list">
					{loop $rooms $room}
					<li>
						<a href="{php echo $this->createMobileUrl('c_index',array('room_id'=>$room['room_id']))}">
							<div class="avatar"><img src="{$room['room_icon']}" width="100%" height="100%"></div>
							<h2>{$room['room_name']}</h2>
							<p>{$room['room_desc']}</p>
						</a>
					</li>
					{/loop}
				</ul>
			</div>

			<div class="thome">
				<ul class="zhibo-item-box" id="topic_list">
					{loop $topic_his $topic}
					<li class="zhibo-item">
						
							<a class="flex" href="{php echo $this->createMobileUrl('topic_info',array('topic_id'=>$topic['id']))}">
								<div class="zhibo-item-img mr10"><img src="{$topic['icon']}" alt="" width="60" height="60"></div>
								<div class="sub">
									<p class="lineText">{$topic['topic_name']}</p>
									<div class="grey f12 mt5">
										<div>
											{if $topic['ing'] == 2}
											<span class="mr10">{$topic['relative']}</span> {elseif $topic['ing']== 1}
											<span class="tip-tag">直播中</span> {/if}

											<span>{$topic['begin_time']}</span>

											<span class="fr">{if !empty($topic['series_id'])}系列课{else}话题{/if}</span>
										</div>

										<div>
											<span>人气:{$topic['look_numbers']}</span>
											<span class="fr red">{if $topic['room_paymoney']>0}￥{$topic['room_paymoney']}{else}免费{/if}</span>
										</div>
									</div>
								</div>
							</a>
					</li>
					{/loop}
				</ul>

			</div>

		</div>
		

		{template footer}

	</body>
	

</html>