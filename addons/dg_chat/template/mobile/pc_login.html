<!DOCTYPE html>
<html>

<head>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">
	<meta charset="UTF-8">
	<meta name="keywords" content="" />
	<meta name="description" content="" />
	<title>直播登录</title>
	<script src="{TEMPLATE_PATH}/js/zepto.min.js"></script>
	<style type="text/css">
		.content {
			display: flex;
			flex-direction: column;
			align-items: center;
		}

		.head {
			width: 100%;
			padding: 30px 0;
			border-bottom: 1px solid #ededed;
			display: flex;
			flex-direction: row;
			justify-content: center;
			align-items: flex-start;
		}

		.logo {
			display: flex;
			flex-direction: column;
			align-items: flex-start;

		}

		.text {
			font-size: 20px;
			color: #2a75ed;
		}

		.slogan {
			font-size: 14px;
			color: #999;
		}

		.reg_code {
			margin-top: 50px;
		}

		.deepDark {
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			background: rgba(0, 0, 0, .7);
			z-index: 100;
		}

		.messageBox {
			z-index: 101;
			padding: 20px;
			border-radius: 10px;
			background-color: #fff;
			position: absolute;
			-webkit-transform: translateY(-50%);
			transform: translateY(-50%);
			left: 50%;
			top: 50%;
			width: 540px;
			height: 300px;
			margin-left: -270px;
			font-weight: 700;
			color: #353535;
		}

		.messageBox .cancelBtn {
			display: block;
			width: 24px;
			height: 24px;
			position: absolute;
			top: 10px;
			right: 10px;
			cursor: pointer;
			background: url(../addons/dg_chat/resource/img/icon_Pop-ups_close.svg) 50% no-repeat;
		}

		.iconBox {
			text-align: center;
		}

		.txtBody {
			margin-top: 34px;
		}

		.footerBox {
			margin-top: 26px;
			text-align: center;
		}

		.clickBtn {
			display: inline-block;
			cursor: pointer;
			width: 100px;
			height: 36px;
			line-height: 36px;
			text-align: center;
			font-weight: 400;
			border-radius: 4px;
			background-color: #04BE02;
			color: #fff;
			font-size: 14px;
			margin: 0 auto;
		}
	</style>
</head>
<script>
	$(function () {
		$.post(location.href, { 'type': 'qrcode' }, function (res) {
			$('#qrcode').attr('src', res.code_url);
		})
	})
	var t = setInterval("Login()", 1000);
	var i = 1;
	function Login() {

		$.ajax({
			type: "POST",
			url: location.href,
			timeout: 60000,
			async: true,
			data: "type=login_status&l_num=" + i,
			success: function (data, textStatus) {
				if (data.success == 1) {
					console.log('第' + i + '次轮询');
				}
				i++;
				if (data.success == 2) {

				}
				if (data.success == 3) {
					//location.href = "{php echo $this->createMobileUrl('index')}"
					//top.location.reload()
					alert("登录成功")
					//$('#ems').text('登录成功')
					top.location.reload()
					setTimeout(function () { clearInterval(t) }, 3000);
				}

				if (data.success == 4) {
					$('#ems').text('你已取消登录')
					$('.deepDark').show();
					clearInterval(t);

				}
				if (data.success == 5) {
					$('.deepDark').show();
					clearInterval(t);

				}
			}
		});
	}
</script>

<body>
	<div class="content">
		<div class="head">
			<img src="{$_W['account']['logo']}"/ style="width:30px;height:30px;margin-right: 10px;">
			<div class="logo">
				<div class="text">{$_W['account']['name']}</div>
				<div class="slogan">微课时代来临，时刻利用碎片时间学习！</div>
			</div>

		</div>
		<div class="reg_code ased" id="login_container" style="width:250px;height:250px;border:1px solid #ddd">
			<img src="" style="width:250px;height:250px" id="qrcode" alt="">
		</div>
		<div class="reg_code ased" style="margin-top:10px;">
			请使用微信扫描二维码登录
		</div>
		<div class="reg_code ased" style="margin-top:5px;">
			"{$_W['account']['name']} PC版"
		</div>
	</div>
	<div class="deepDark" style="display:none">
		<div class="messageBox">
			<a class="cancelBtn new_click"></a>
			<div class="iconBox">
				<img src="../addons/dg_chat/resource/img/blue_info_prompt.svg" alt="图标" />
				<p class="title">提示</p>
			</div>
			<div class="txtBody" style="text-align:center">
				<p id="ems"> 由于您长时间未扫码，当前二维码已失效。请重新刷新页面。 </p>
			</div>
			<div class="footerBox">
				<div class="clickBtn new_click">
					确认
				</div>
			</div>
		</div>
	</div>
	<script>
		$('.new_click').click(function () {
			top.location.reload()
		})
	</script>
</body>